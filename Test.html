<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Test.md – -</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        background-color: #232629;
        color: #7a7c7d;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #7a7c7d;  padding-left: 4px; }
    div.sourceCode
      { color: #cfcfc2; background-color: #232629; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span. { color: #cfcfc2; } /* Normal */
    code span.al { color: #95da4c; background-color: #4d1f24; font-weight: bold; } /* Alert */
    code span.an { color: #3f8058; } /* Annotation */
    code span.at { color: #2980b9; } /* Attribute */
    code span.bn { color: #f67400; } /* BaseN */
    code span.bu { color: #7f8c8d; } /* BuiltIn */
    code span.cf { color: #fdbc4b; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #3daee9; } /* Char */
    code span.cn { color: #27aeae; font-weight: bold; } /* Constant */
    code span.co { color: #7a7c7d; } /* Comment */
    code span.cv { color: #7f8c8d; } /* CommentVar */
    code span.do { color: #a43340; } /* Documentation */
    code span.dt { color: #2980b9; } /* DataType */
    code span.dv { color: #f67400; } /* DecVal */
    code span.er { color: #da4453; text-decoration: underline; } /* Error */
    code span.ex { color: #0099ff; font-weight: bold; } /* Extension */
    code span.fl { color: #f67400; } /* Float */
    code span.fu { color: #8e44ad; } /* Function */
    code span.im { color: #27ae60; } /* Import */
    code span.in { color: #c45b00; } /* Information */
    code span.kw { color: #cfcfc2; font-weight: bold; } /* Keyword */
    code span.op { color: #cfcfc2; } /* Operator */
    code span.ot { color: #27ae60; } /* Other */
    code span.pp { color: #27ae60; } /* Preprocessor */
    code span.re { color: #2980b9; background-color: #153042; } /* RegionMarker */
    code span.sc { color: #3daee9; } /* SpecialChar */
    code span.ss { color: #da4453; } /* SpecialString */
    code span.st { color: #f44f4f; } /* String */
    code span.va { color: #27aeae; } /* Variable */
    code span.vs { color: #da4453; } /* VerbatimString */
    code span.wa { color: #da4453; } /* Warning */
  </style>
  <link rel="stylesheet" href="Css/include.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p>zeazeaz even more modifyed, testing igt zea Still working, must change for html</p>
<p><a href="/home2/tourneboeuf/Test/test2.md.html">True test2</a></p>
<section id="contents" class="level1">
<h1>Contents</h1>
<ul>
<li><p><a href="#Test1">Test1</a></p></li>
<li><p><a href="#Test2">Test2</a></p></li>
<li><p><a href="#Test3">Test3</a></p></li>
</ul>
</section>
<section id="test1" class="level1">
<h1>Test1</h1>
<ul>
<li><p><a href="#Test1">Test1</a></p></li>
<li><p><a href="#Test2">Test2</a></p></li>
<li><p><a href="#Test3">Test3</a></p></li>
</ul>
</section>
<section id="test2" class="level1">
<h1>Test2</h1>
<ul>
<li><p><a href="#Test1">Test1</a></p></li>
<li><p><a href="#Test2">Test2</a></p></li>
<li><p><a href="#Test3">Test3</a></p></li>
</ul>
</section>
<section id="test3" class="level1">
<h1>Test3</h1>
<ul>
<li><p><a href="Math.html">Math</a></p></li>
<li><p><a href="diary/2019-02-10.html">This is a diary test</a></p></li>
<li><p><a href="Test.html">Self</a></p></li>
</ul>
</section>
<section id="array-test" class="level1">
<h1>Array test</h1>
<table>
<thead>
<tr class="header">
<th>1</th>
<th>2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="#Test1">Test1</a></td>
<td><a href="#Test2">Test2</a></td>
</tr>
</tbody>
</table>
</section>
<section id="languages" class="level1">
<h1>Languages</h1>
<p>((( ( (here $1 is matched for [[name]]) ) )))</p>
<p>{{{python for i in range(10): print(“hello world”) }}}</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a>  <span class="bu">echo</span> <span class="st">&quot;totot&quot;</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="fu">cat</span> this is <span class="op">&gt;</span> bash </span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">class</span> toto:</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a>        <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb2-4"><a href="#cb2-4"></a>                <span class="va">self</span>.a <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>                <span class="bu">print</span>(<span class="st">&quot;I am initiated&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode perl"><code class="sourceCode perl"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">sub </span><span class="fu">titi</span> {</span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="kw">if</span> </span>
<span id="cb3-3"><a href="#cb3-3"></a>}</span></code></pre></div>
<p><code>class="brush: python" for i in range(1, 5):    print(i)</code></p>
<p>```class=“brush: cpp” #include “helloworld.h”</p>
<p>int helloworld() { printf(“hello world”); }</p>
<pre><code>
or in: &gt;
```cpp
#include &quot;helloworld.h&quot;

int helloworld()
{
  printf(&quot;hello world&quot;);
}</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">5</span>):</span>
<span id="cb5-2"><a href="#cb5-2"></a>   <span class="bu">print</span>(i)</span></code></pre></div>
<p>def</p>
<p>Consider the following example: &gt; = Toggleable list of todo items = * [ ] Toggle list item on/off. * [ ] Simple toggling between [ ] and [X]. * [ ] All list’s subitems should be toggled on/off appropriately. * [ ] Toggle child subitems only if current line is list item * [ ] Parent list item should be toggled depending on it’s child items. * [ ] Make numbered list items toggleable too * [ ] Add highlighting to list item boxes * [ ] Add [ ] to the next list item created with o, O and <CR>.</p>
<p>This sould be followed by code</p>
<pre><code>Here is the code
and yes 
this shoudl be co
de</code></pre>
<p>This is a table</p>
<table>
<thead>
<tr class="header">
<th>Name</th>
<th style="text-align: right;">Size</th>
<th style="text-align: right;">Cost</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Africans</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">31</td>
</tr>
<tr class="even">
<td>Normandie</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">2066.55</td>
</tr>
<tr class="odd">
<td>Nord</td>
<td style="text-align: right;">84</td>
<td style="text-align: right;">33</td>
</tr>
<tr class="even">
<td>Total</td>
<td style="text-align: right;">117.0</td>
<td style="text-align: right;">2099</td>
</tr>
</tbody>
</table>
<p>%% tmf: $4,2=Sum(2:-1) ; $4,3=float2nr(Sum(2:-1))</p>
<p>From CSV</p>
<table>
<thead>
<tr class="header">
<th>Name</th>
<th style="text-align: right;">Pay1</th>
<th style="text-align: right;">Pay2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Frinde1</td>
<td style="text-align: right;">221</td>
<td style="text-align: right;">33</td>
</tr>
<tr class="even">
<td>Frinde2</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">33</td>
</tr>
<tr class="odd">
<td>Frinde3</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">33</td>
</tr>
</tbody>
</table>
<p>aza azeazea</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">if [[</span> <span class="va">$TERM</span> <span class="ot">=</span> *[xeEk]term* ||</span>
<span id="cb7-2"><a href="#cb7-2"></a>      <span class="va">$TERM</span> <span class="ot">=</span> *mlterm* ||</span>
<span id="cb7-3"><a href="#cb7-3"></a>      <span class="va">$TERM</span> <span class="ot">=</span> *rxvt* ||</span>
<span id="cb7-4"><a href="#cb7-4"></a>      <span class="va">$TERM</span> <span class="ot">=</span> *screen* ||</span>
<span id="cb7-5"><a href="#cb7-5"></a>      (<span class="va">$TERM</span> = *linux* &amp;&amp; -S /dev/gpmctl)</span>
<span id="cb7-6"><a href="#cb7-6"></a>   ]]; then</span>
<span id="cb7-7"><a href="#cb7-7"></a></span>
<span id="cb7-8"><a href="#cb7-8"></a>  set-status() { return <span class="va">$1</span>; }</span>
<span id="cb7-9"><a href="#cb7-9"></a></span>
<span id="cb7-10"><a href="#cb7-10"></a>  handle-mouse-event() {</span>
<span id="cb7-11"><a href="#cb7-11"></a>    emulate <span class="ot">-L</span> zsh</span>
<span id="cb7-12"><a href="#cb7-12"></a>    local bt=<span class="va">$1</span></span>
<span id="cb7-13"><a href="#cb7-13"></a></span>
<span id="cb7-14"><a href="#cb7-14"></a>    case <span class="va">$bt</span> in</span>
<span id="cb7-15"><a href="#cb7-15"></a>      3)</span>
<span id="cb7-16"><a href="#cb7-16"></a>    return 0;;<span class="co"># Process on press, discard release</span></span>
<span id="cb7-17"><a href="#cb7-17"></a></span>
<span id="cb7-18"><a href="#cb7-18"></a><span class="co"># mlterm sends 3 on mouse-wheel-up but also on every button</span></span>
<span id="cb7-19"><a href="#cb7-19"></a></span>
<span id="cb7-20"><a href="#cb7-20"></a><span class="co"># release, so it&#39;s unusable</span></span>
<span id="cb7-21"><a href="#cb7-21"></a></span>
<span id="cb7-22"><a href="#cb7-22"></a>      64)</span>
<span id="cb7-23"><a href="#cb7-23"></a><span class="co"># eterm, rxvt, gnome/KDE terminal mouse wheel</span></span>
<span id="cb7-24"><a href="#cb7-24"></a></span>
<span id="cb7-25"><a href="#cb7-25"></a>    zle up-line-or-history</span>
<span id="cb7-26"><a href="#cb7-26"></a>    return;;</span>
<span id="cb7-27"><a href="#cb7-27"></a>      4|65)</span>
<span id="cb7-28"><a href="#cb7-28"></a><span class="co"># mlterm or eterm, rxvt, gnome/KDE terminal mouse wheel</span></span>
<span id="cb7-29"><a href="#cb7-29"></a></span>
<span id="cb7-30"><a href="#cb7-30"></a>    zle down-line-or-history</span>
<span id="cb7-31"><a href="#cb7-31"></a>    return;;</span>
<span id="cb7-32"><a href="#cb7-32"></a>    esac</span>
<span id="cb7-33"><a href="#cb7-33"></a>    local mx=<span class="va">$2</span> my=<span class="va">$3</span> last_status=<span class="va">$4</span></span>
<span id="cb7-34"><a href="#cb7-34"></a>    local cx cy i</span>
<span id="cb7-35"><a href="#cb7-35"></a>    setopt extendedglob</span>
<span id="cb7-36"><a href="#cb7-36"></a></span>
<span id="cb7-37"><a href="#cb7-37"></a>    print <span class="ot">-n</span> <span class="st">&#39;\e[6n&#39;</span># query cursor position</span>
<span id="cb7-38"><a href="#cb7-38"></a></span>
<span id="cb7-39"><a href="#cb7-39"></a></span>
<span id="cb7-40"><a href="#cb7-40"></a>    local match mbegin mend buf=</span>
<span id="cb7-41"><a href="#cb7-41"></a></span>
<span id="cb7-42"><a href="#cb7-42"></a>        while ( read -k i &amp;&amp; buf+=<span class="va">$i</span> &amp;&amp; [[ <span class="va">$buf</span> != <span class="st">&quot;*\[([0-9]##)\;[0-9]##R&quot;</span> ]] ) ; do :; done</span>
<span id="cb7-43"><a href="#cb7-43"></a></span>
<span id="cb7-44"><a href="#cb7-44"></a><span class="co"># read response from terminal.</span></span>
<span id="cb7-45"><a href="#cb7-45"></a></span>
<span id="cb7-46"><a href="#cb7-46"></a><span class="co"># note that we may also get a mouse tracking btn-release event,</span></span>
<span id="cb7-47"><a href="#cb7-47"></a></span>
<span id="cb7-48"><a href="#cb7-48"></a><span class="co"># which would then be discarded.</span></span>
<span id="cb7-49"><a href="#cb7-49"></a></span>
<span id="cb7-50"><a href="#cb7-50"></a></span>
<span id="cb7-51"><a href="#cb7-51"></a>    [[ <span class="va">$buf</span> <span class="ot">=</span> <span class="st">&quot;(#b)*\[([0-9]##)\;[0-9]##R&quot;</span><span class="kw"> ]]</span> <span class="kw">||</span> <span class="bu">return</span></span>
<span id="cb7-52"><a href="#cb7-52"></a></span>
<span id="cb7-53"><a href="#cb7-53"></a>    <span class="va">cy=$match[1]</span># <span class="ex">we</span> don<span class="st">&#39;t need cx</span></span>
<span id="cb7-54"><a href="#cb7-54"></a></span>
<span id="cb7-55"><a href="#cb7-55"></a></span>
<span id="cb7-56"><a href="#cb7-56"></a><span class="st">    local cur_prompt</span></span>
<span id="cb7-57"><a href="#cb7-57"></a></span>
<span id="cb7-58"><a href="#cb7-58"></a><span class="st"># trying to guess the current prompt</span></span>
<span id="cb7-59"><a href="#cb7-59"></a></span>
<span id="cb7-60"><a href="#cb7-60"></a><span class="st">    case $CONTEXT in</span></span>
<span id="cb7-61"><a href="#cb7-61"></a><span class="st">      (vared)</span></span>
<span id="cb7-62"><a href="#cb7-62"></a><span class="st">        if [[ $0 = zcalc ]]; then</span></span>
<span id="cb7-63"><a href="#cb7-63"></a><span class="st">      cur_prompt=${ZCALCPROMPT-&#39;</span>%1v<span class="op">&gt;</span> <span class="st">&#39;}</span></span>
<span id="cb7-64"><a href="#cb7-64"></a><span class="st">      setopt nopromptsubst nopromptbang promptpercent</span></span>
<span id="cb7-65"><a href="#cb7-65"></a><span class="st"># (ZCALCPROMPT is expanded with (%))</span></span>
<span id="cb7-66"><a href="#cb7-66"></a></span>
<span id="cb7-67"><a href="#cb7-67"></a><span class="st">    fi;;</span></span>
<span id="cb7-68"><a href="#cb7-68"></a><span class="st"># if vared is passed a prompt, we&#39;</span>re lost</span>
<span id="cb7-69"><a href="#cb7-69"></a></span>
<span id="cb7-70"><a href="#cb7-70"></a>      <span class="kw">(select)</span></span>
<span id="cb7-71"><a href="#cb7-71"></a>        <span class="va">cur_prompt=$PS3</span>;;</span>
<span id="cb7-72"><a href="#cb7-72"></a>      <span class="kw">(</span><span class="ex">cont</span><span class="kw">)</span></span>
<span id="cb7-73"><a href="#cb7-73"></a>    <span class="va">cur_prompt=$PS2</span>;;</span>
<span id="cb7-74"><a href="#cb7-74"></a>      <span class="kw">(</span><span class="ex">start</span><span class="kw">)</span></span>
<span id="cb7-75"><a href="#cb7-75"></a>    <span class="va">cur_prompt=$PS1</span>;;</span>
<span id="cb7-76"><a href="#cb7-76"></a>    <span class="ex">esac</span></span>
<span id="cb7-77"><a href="#cb7-77"></a></span>
<span id="cb7-78"><a href="#cb7-78"></a><span class="co"># if promptsubst, then we need first to do the expansions (to</span></span>
<span id="cb7-79"><a href="#cb7-79"></a></span>
<span id="cb7-80"><a href="#cb7-80"></a><span class="co"># be able to remove the visual effects) and disable further</span></span>
<span id="cb7-81"><a href="#cb7-81"></a></span>
<span id="cb7-82"><a href="#cb7-82"></a><span class="co"># expansions</span></span>
<span id="cb7-83"><a href="#cb7-83"></a></span>
<span id="cb7-84"><a href="#cb7-84"></a>    [[ <span class="ex">-o</span> promptsubst ]] <span class="kw">&amp;&amp;</span> <span class="va">cur_prompt=</span>$<span class="dt">{${(e)cur_prompt}//(#b)([\\\$\`])/\\</span><span class="va">$match</span><span class="dt">}</span></span>
<span id="cb7-85"><a href="#cb7-85"></a></span>
<span id="cb7-86"><a href="#cb7-86"></a></span>
<span id="cb7-87"><a href="#cb7-87"></a><span class="co"># restore the exit status in case $PS&lt;n&gt; relies on it</span></span>
<span id="cb7-88"><a href="#cb7-88"></a></span>
<span id="cb7-89"><a href="#cb7-89"></a>    <span class="ex">set-status</span> <span class="va">$last_status</span></span>
<span id="cb7-90"><a href="#cb7-90"></a></span>
<span id="cb7-91"><a href="#cb7-91"></a><span class="co"># remove the visual effects and do the prompt expansion</span></span>
<span id="cb7-92"><a href="#cb7-92"></a></span>
<span id="cb7-93"><a href="#cb7-93"></a>    <span class="va">cur_prompt=</span>$<span class="dt">{(S%%)cur_prompt//(#b)(%([BSUbsu]|{*%})|(%[^BSUbsu{}]))/</span><span class="va">$match[3]</span><span class="dt">}</span></span>
<span id="cb7-94"><a href="#cb7-94"></a></span>
<span id="cb7-95"><a href="#cb7-95"></a></span>
<span id="cb7-96"><a href="#cb7-96"></a><span class="co"># we&#39;re now looping over the whole editing buffer (plus the last</span></span>
<span id="cb7-97"><a href="#cb7-97"></a></span>
<span id="cb7-98"><a href="#cb7-98"></a><span class="co"># line of the prompt) to compute the (x,y) position of each char. We</span></span>
<span id="cb7-99"><a href="#cb7-99"></a></span>
<span id="cb7-100"><a href="#cb7-100"></a><span class="co"># store the characters i for which x(i) &lt;= mx &lt; x(i+1) for every</span></span>
<span id="cb7-101"><a href="#cb7-101"></a></span>
<span id="cb7-102"><a href="#cb7-102"></a><span class="co"># value of y in the pos array. We also get the Y(CURSOR), so that at</span></span>
<span id="cb7-103"><a href="#cb7-103"></a></span>
<span id="cb7-104"><a href="#cb7-104"></a><span class="co"># the end, we&#39;re able to say which pos element is the right one</span></span>
<span id="cb7-105"><a href="#cb7-105"></a></span>
<span id="cb7-106"><a href="#cb7-106"></a></span>
<span id="cb7-107"><a href="#cb7-107"></a>    <span class="bu">local</span> -a <span class="va">pos</span># <span class="va">array</span> <span class="va">holding</span> <span class="va">the</span> <span class="va">possible</span> <span class="va">positions</span> <span class="va">of</span></span>
<span id="cb7-108"><a href="#cb7-108"></a></span>
<span id="cb7-109"><a href="#cb7-109"></a><span class="co"># the mouse pointer</span></span>
<span id="cb7-110"><a href="#cb7-110"></a></span>
<span id="cb7-111"><a href="#cb7-111"></a>    <span class="bu">local</span> -i <span class="va">n</span> <span class="va">x=</span>0 <span class="va">y=</span>1 <span class="va">cursor=$((${#cur_prompt}</span>+<span class="va">$CURSOR</span>+1<span class="va">))</span></span>
<span id="cb7-112"><a href="#cb7-112"></a></span>
<span id="cb7-113"><a href="#cb7-113"></a>    <span class="bu">local</span> <span class="va">Y</span></span>
<span id="cb7-114"><a href="#cb7-114"></a></span>
<span id="cb7-115"><a href="#cb7-115"></a>    <span class="va">buf=$cur_prompt$BUFFER</span></span>
<span id="cb7-116"><a href="#cb7-116"></a>    <span class="kw">for</span> <span class="kw">((</span>i=1; i&lt;=<span class="va">$#</span>buf; i++<span class="kw">))</span>; <span class="kw">do</span></span>
<span id="cb7-117"><a href="#cb7-117"></a></span>
<span id="cb7-118"><a href="#cb7-118"></a>      <span class="kw">((</span> i == cursor <span class="kw">))</span> <span class="kw">&amp;&amp;</span> <span class="va">Y=$y</span></span>
<span id="cb7-119"><a href="#cb7-119"></a>      <span class="va">n=</span>0</span>
<span id="cb7-120"><a href="#cb7-120"></a>      <span class="kw">case</span> <span class="va">$buf[i]</span><span class="kw"> in</span></span>
<span id="cb7-121"><a href="#cb7-121"></a>    <span class="kw">(</span><span class="st">$&#39;</span><span class="dt">\n</span><span class="st">&#39;</span><span class="kw">)</span># <span class="ex">newline</span></span>
<span id="cb7-122"><a href="#cb7-122"></a></span>
<span id="cb7-123"><a href="#cb7-123"></a>      <span class="bu">:</span> <span class="va">${pos[y]=$i}</span></span>
<span id="cb7-124"><a href="#cb7-124"></a>      <span class="kw">((</span> y++, x=0 <span class="kw">));;</span></span>
<span id="cb7-125"><a href="#cb7-125"></a>    <span class="kw">(</span><span class="st">$&#39;</span><span class="dt">\t</span><span class="st">&#39;</span><span class="kw">)</span># <span class="ex">tab</span> advance til next tab stop</span>
<span id="cb7-126"><a href="#cb7-126"></a></span>
<span id="cb7-127"><a href="#cb7-127"></a>      <span class="kw">((</span> x = x/8*8+8 <span class="kw">));;</span></span>
<span id="cb7-128"><a href="#cb7-128"></a>    <span class="kw">(</span>[<span class="st">$&#39;</span><span class="dt">\0</span><span class="st">&#39;</span>-<span class="st">$&#39;</span><span class="dt">\037</span><span class="st">&#39;$&#39;</span><span class="dt">\200</span><span class="st">&#39;</span>-<span class="st">$&#39;</span><span class="dt">\237</span><span class="st">&#39;</span>]<span class="kw">)</span></span>
<span id="cb7-129"><a href="#cb7-129"></a><span class="co"># characters like ^M</span></span>
<span id="cb7-130"><a href="#cb7-130"></a></span>
<span id="cb7-131"><a href="#cb7-131"></a>      <span class="va">n=</span>2<span class="kw">;;</span></span>
<span id="cb7-132"><a href="#cb7-132"></a>    <span class="kw">(</span>*<span class="kw">)</span></span>
<span id="cb7-133"><a href="#cb7-133"></a>      <span class="va">n=</span>1<span class="kw">;;</span></span>
<span id="cb7-134"><a href="#cb7-134"></a>      <span class="kw">esac</span></span>
<span id="cb7-135"><a href="#cb7-135"></a>      <span class="kw">while</span></span>
<span id="cb7-136"><a href="#cb7-136"></a>    <span class="kw">((</span> x &gt;= mx <span class="kw">))</span> <span class="kw">&amp;&amp;</span> <span class="bu">:</span> <span class="va">${pos[y]=$i}</span></span>
<span id="cb7-137"><a href="#cb7-137"></a>    <span class="kw">((</span> x &gt;= COLUMNS <span class="kw">))</span> <span class="kw">&amp;&amp;</span> <span class="kw">((</span> x=0, y++ <span class="kw">))</span></span>
<span id="cb7-138"><a href="#cb7-138"></a>    <span class="kw">((</span> n &gt; 0 <span class="kw">))</span></span>
<span id="cb7-139"><a href="#cb7-139"></a>      <span class="kw">do</span></span>
<span id="cb7-140"><a href="#cb7-140"></a>    <span class="kw">((</span> x++, n-- <span class="kw">))</span></span>
<span id="cb7-141"><a href="#cb7-141"></a>      <span class="kw">done</span></span>
<span id="cb7-142"><a href="#cb7-142"></a>    <span class="kw">done</span></span>
<span id="cb7-143"><a href="#cb7-143"></a>    <span class="bu">:</span> <span class="va">${pos[y]=$i}</span> <span class="va">${Y:=$y}</span></span>
<span id="cb7-144"><a href="#cb7-144"></a></span>
<span id="cb7-145"><a href="#cb7-145"></a>    <span class="bu">local</span> <span class="va">mouse_CURSOR</span></span>
<span id="cb7-146"><a href="#cb7-146"></a>    <span class="kw">if</span> <span class="kw">((</span>my + Y - cy &gt; y<span class="kw">))</span>; <span class="kw">then</span></span>
<span id="cb7-147"><a href="#cb7-147"></a>      <span class="va">mouse_CURSOR=$#</span>BUFFER</span>
<span id="cb7-148"><a href="#cb7-148"></a></span>
<span id="cb7-149"><a href="#cb7-149"></a>    <span class="kw">elif</span> <span class="kw">((</span>my + Y - cy &lt; 1<span class="kw">))</span>; <span class="kw">then</span></span>
<span id="cb7-150"><a href="#cb7-150"></a>      <span class="va">mouse_CURSOR=</span>0</span>
<span id="cb7-151"><a href="#cb7-151"></a>    <span class="kw">else</span></span>
<span id="cb7-152"><a href="#cb7-152"></a>      <span class="va">mouse_CURSOR=$(($pos[my + Y - cy]</span> - <span class="va">${#cur_prompt}</span> - 1<span class="va">))</span></span>
<span id="cb7-153"><a href="#cb7-153"></a></span>
<span id="cb7-154"><a href="#cb7-154"></a>    <span class="kw">fi</span></span>
<span id="cb7-155"><a href="#cb7-155"></a></span>
<span id="cb7-156"><a href="#cb7-156"></a>    <span class="kw">case</span> <span class="va">$bt</span><span class="kw"> in</span></span>
<span id="cb7-157"><a href="#cb7-157"></a>      <span class="kw">(</span>0<span class="kw">)</span></span>
<span id="cb7-158"><a href="#cb7-158"></a><span class="co"># Button 1.  Move cursor.</span></span>
<span id="cb7-159"><a href="#cb7-159"></a></span>
<span id="cb7-160"><a href="#cb7-160"></a>    <span class="va">CURSOR=$mouse_CURSOR</span></span>
<span id="cb7-161"><a href="#cb7-161"></a>      <span class="kw">;;</span></span>
<span id="cb7-162"><a href="#cb7-162"></a></span>
<span id="cb7-163"><a href="#cb7-163"></a>      <span class="kw">(</span>1<span class="kw">)</span></span>
<span id="cb7-164"><a href="#cb7-164"></a><span class="co"># Button 2.  Insert selection at mouse cursor postion.</span></span>
<span id="cb7-165"><a href="#cb7-165"></a></span>
<span id="cb7-166"><a href="#cb7-166"></a>    <span class="ex">get-x-clipboard</span></span>
<span id="cb7-167"><a href="#cb7-167"></a>    <span class="va">BUFFER=$BUFFER[1,mouse_CURSOR]$CUTBUFFER$BUFFER[mouse_CURSOR+1,-1]</span></span>
<span id="cb7-168"><a href="#cb7-168"></a>    <span class="kw">((</span> CURSOR = <span class="va">$mouse_CURSOR</span> + <span class="va">$#</span>CUTBUFFER <span class="kw">))</span></span>
<span id="cb7-169"><a href="#cb7-169"></a></span>
<span id="cb7-170"><a href="#cb7-170"></a>      <span class="kw">;;</span></span>
<span id="cb7-171"><a href="#cb7-171"></a></span>
<span id="cb7-172"><a href="#cb7-172"></a>      <span class="kw">(</span>2<span class="kw">)</span></span>
<span id="cb7-173"><a href="#cb7-173"></a><span class="co"># Button 3.  Copy from cursor to mouse to cutbuffer.</span></span>
<span id="cb7-174"><a href="#cb7-174"></a></span>
<span id="cb7-175"><a href="#cb7-175"></a>    <span class="va">killring=(</span><span class="st">&quot;</span><span class="va">$CUTBUFFER</span><span class="st">&quot;</span> <span class="st">&quot;${(@)killring[1,-2]}&quot;</span><span class="va">)</span></span>
<span id="cb7-176"><a href="#cb7-176"></a>    <span class="kw">if</span> <span class="kw">((</span> mouse_CURSOR &lt; CURSOR <span class="kw">))</span>; <span class="kw">then</span></span>
<span id="cb7-177"><a href="#cb7-177"></a>      <span class="va">CUTBUFFER=$BUFFER[mouse_CURSOR+1,CURSOR+1]</span></span>
<span id="cb7-178"><a href="#cb7-178"></a>    <span class="kw">else</span></span>
<span id="cb7-179"><a href="#cb7-179"></a>      <span class="va">CUTBUFFER=$BUFFER[CURSOR+1,mouse_CURSOR+1]</span></span>
<span id="cb7-180"><a href="#cb7-180"></a>    <span class="kw">fi</span></span>
<span id="cb7-181"><a href="#cb7-181"></a>    <span class="ex">set-x-clipboard</span> <span class="va">$CUTBUFFER</span></span>
<span id="cb7-182"><a href="#cb7-182"></a>      <span class="kw">;;</span></span>
<span id="cb7-183"><a href="#cb7-183"></a>    <span class="kw">esac</span></span>
<span id="cb7-184"><a href="#cb7-184"></a>  }</span>
<span id="cb7-185"><a href="#cb7-185"></a></span>
<span id="cb7-186"><a href="#cb7-186"></a>  <span class="ex">zle</span> -N handle-mouse-event</span>
<span id="cb7-187"><a href="#cb7-187"></a></span>
<span id="cb7-188"><a href="#cb7-188"></a>  <span class="fu">handle-xterm-mouse-event()</span> <span class="kw">{</span></span>
<span id="cb7-189"><a href="#cb7-189"></a>    <span class="bu">local</span> <span class="va">last_status=$?</span></span>
<span id="cb7-190"><a href="#cb7-190"></a>    <span class="ex">emulate</span> -L zsh</span>
<span id="cb7-191"><a href="#cb7-191"></a>    <span class="bu">local</span> <span class="va">bt</span> <span class="va">mx</span> <span class="va">my</span></span>
<span id="cb7-192"><a href="#cb7-192"></a></span>
<span id="cb7-193"><a href="#cb7-193"></a><span class="co"># either xterm mouse tracking or bound xterm event</span></span>
<span id="cb7-194"><a href="#cb7-194"></a></span>
<span id="cb7-195"><a href="#cb7-195"></a><span class="co"># read the event from the terminal</span></span>
<span id="cb7-196"><a href="#cb7-196"></a></span>
<span id="cb7-197"><a href="#cb7-197"></a>    <span class="bu">read</span> -k <span class="va">bt</span># <span class="va">mouse</span> <span class="va">button</span>, <span class="va">x</span>, <span class="va">y</span> <span class="va">reported</span> <span class="va">after</span> \<span class="va">e[M</span></span>
<span id="cb7-198"><a href="#cb7-198"></a></span>
<span id="cb7-199"><a href="#cb7-199"></a><span class="va">    bt=$((</span>#bt &amp; 0x47<span class="va">))</span></span>
<span id="cb7-200"><a href="#cb7-200"></a></span>
<span id="cb7-201"><a href="#cb7-201"></a><span class="va">    read -k mx</span></span>
<span id="cb7-202"><a href="#cb7-202"></a><span class="va">    read -k my</span></span>
<span id="cb7-203"><a href="#cb7-203"></a><span class="va">    if [[ $mx = </span><span class="st">$&#39;</span><span class="dt">\030</span><span class="st">&#39;</span><span class="va"> ]</span>]; <span class="kw">then</span></span>
<span id="cb7-204"><a href="#cb7-204"></a><span class="co"># assume event is \E[M&lt;btn&gt;dired-button()(^X\EG&lt;x&gt;&lt;y&gt;)</span></span>
<span id="cb7-205"><a href="#cb7-205"></a></span>
<span id="cb7-206"><a href="#cb7-206"></a>      <span class="bu">read</span> -k <span class="va">mx</span></span>
<span id="cb7-207"><a href="#cb7-207"></a>      <span class="bu">read</span> -k <span class="va">mx</span></span>
<span id="cb7-208"><a href="#cb7-208"></a>      <span class="bu">read</span> -k <span class="va">my</span></span>
<span id="cb7-209"><a href="#cb7-209"></a>      <span class="kw">((</span> my =#my - 31 <span class="kw">))</span></span>
<span id="cb7-210"><a href="#cb7-210"></a></span>
<span id="cb7-211"><a href="#cb7-211"></a>      <span class="kw">((</span> mx =#mx - 31 <span class="kw">))</span></span>
<span id="cb7-212"><a href="#cb7-212"></a></span>
<span id="cb7-213"><a href="#cb7-213"></a>    <span class="kw">else</span></span>
<span id="cb7-214"><a href="#cb7-214"></a><span class="co"># that&#39;s a VT200 mouse tracking event</span></span>
<span id="cb7-215"><a href="#cb7-215"></a></span>
<span id="cb7-216"><a href="#cb7-216"></a>      <span class="kw">((</span> my =#my - 32 <span class="kw">))</span></span>
<span id="cb7-217"><a href="#cb7-217"></a></span>
<span id="cb7-218"><a href="#cb7-218"></a>      <span class="kw">((</span> mx =#mx - 32 <span class="kw">))</span></span>
<span id="cb7-219"><a href="#cb7-219"></a></span>
<span id="cb7-220"><a href="#cb7-220"></a>    <span class="kw">fi</span></span>
<span id="cb7-221"><a href="#cb7-221"></a>    <span class="ex">handle-mouse-event</span> <span class="va">$bt</span> <span class="va">$mx</span> <span class="va">$my</span> <span class="va">$last_status</span></span>
<span id="cb7-222"><a href="#cb7-222"></a>  <span class="kw">}</span></span>
<span id="cb7-223"><a href="#cb7-223"></a></span>
<span id="cb7-224"><a href="#cb7-224"></a>  <span class="ex">zle</span> -N handle-xterm-mouse-event</span>
<span id="cb7-225"><a href="#cb7-225"></a></span>
<span id="cb7-226"><a href="#cb7-226"></a>  <span class="kw">if [[</span> <span class="va">$TERM</span> <span class="ot">=</span> *linux* &amp;&amp; <span class="ot">-S</span> /dev/gpmctl<span class="kw"> ]]</span>; <span class="kw">then</span></span>
<span id="cb7-227"><a href="#cb7-227"></a><span class="co"># GPM mouse support</span></span>
<span id="cb7-228"><a href="#cb7-228"></a></span>
<span id="cb7-229"><a href="#cb7-229"></a>    <span class="kw">if</span> <span class="ex">zmodload</span> -i zsh/net/socket<span class="kw">;</span> <span class="kw">then</span></span>
<span id="cb7-230"><a href="#cb7-230"></a></span>
<span id="cb7-231"><a href="#cb7-231"></a>      <span class="fu">zle-update-mouse-driver()</span> <span class="kw">{</span></span>
<span id="cb7-232"><a href="#cb7-232"></a>    <span class="kw">if [[</span> <span class="ot">-n</span> <span class="va">$ZLE_USE_MOUSE</span><span class="kw"> ]]</span>; <span class="kw">then</span></span>
<span id="cb7-233"><a href="#cb7-233"></a>      <span class="kw">if</span> <span class="kw">((</span> ! $+ZSH_GPM_FD <span class="kw">))</span>; <span class="kw">then</span></span>
<span id="cb7-234"><a href="#cb7-234"></a>        <span class="kw">if</span> <span class="ex">zsocket</span> -d 9 /dev/gpmctl<span class="kw">;</span> <span class="kw">then</span></span>
<span id="cb7-235"><a href="#cb7-235"></a>          <span class="va">ZSH_GPM_FD=$REPLY</span></span>
<span id="cb7-236"><a href="#cb7-236"></a><span class="co"># gpm initialisation:</span></span>
<span id="cb7-237"><a href="#cb7-237"></a></span>
<span id="cb7-238"><a href="#cb7-238"></a><span class="co"># request single click events with given modifiers</span></span>
<span id="cb7-239"><a href="#cb7-239"></a></span>
<span id="cb7-240"><a href="#cb7-240"></a>          <span class="bu">local</span> -A <span class="va">modifiers</span></span>
<span id="cb7-241"><a href="#cb7-241"></a>          <span class="va">modifiers=(</span></span>
<span id="cb7-242"><a href="#cb7-242"></a>            <span class="ex">none</span>        0</span>
<span id="cb7-243"><a href="#cb7-243"></a>        <span class="bu">shift</span>       1</span>
<span id="cb7-244"><a href="#cb7-244"></a>        <span class="ex">altgr</span>       2</span>
<span id="cb7-245"><a href="#cb7-245"></a>        <span class="ex">ctrl</span>        4</span>
<span id="cb7-246"><a href="#cb7-246"></a>        <span class="ex">alt</span>         8</span>
<span id="cb7-247"><a href="#cb7-247"></a>        <span class="ex">left-shift</span>  16</span>
<span id="cb7-248"><a href="#cb7-248"></a>        <span class="ex">right-shift</span> 32</span>
<span id="cb7-249"><a href="#cb7-249"></a>        <span class="ex">left-ctrl</span>   64</span>
<span id="cb7-250"><a href="#cb7-250"></a>        <span class="ex">right-ctrl</span>  128</span>
<span id="cb7-251"><a href="#cb7-251"></a>        <span class="ex">caps-shift</span>  256</span>
<span id="cb7-252"><a href="#cb7-252"></a>          )</span>
<span id="cb7-253"><a href="#cb7-253"></a>          <span class="bu">local</span> <span class="va">min</span> <span class="va">max</span></span>
<span id="cb7-254"><a href="#cb7-254"></a><span class="co"># modifiers that need to be on</span></span>
<span id="cb7-255"><a href="#cb7-255"></a></span>
<span id="cb7-256"><a href="#cb7-256"></a>          <span class="va">min=$((</span>modifiers[none]<span class="va">))</span></span>
<span id="cb7-257"><a href="#cb7-257"></a><span class="co"># modifiers that may be on</span></span>
<span id="cb7-258"><a href="#cb7-258"></a></span>
<span id="cb7-259"><a href="#cb7-259"></a>          <span class="va">max=$min</span></span>
<span id="cb7-260"><a href="#cb7-260"></a></span>
<span id="cb7-261"><a href="#cb7-261"></a><span class="co"># send 16 bytes:</span></span>
<span id="cb7-262"><a href="#cb7-262"></a></span>
<span id="cb7-263"><a href="#cb7-263"></a><span class="co">#   1-2: LE short: requested events (btn down = 0x0004)</span></span>
<span id="cb7-264"><a href="#cb7-264"></a></span>
<span id="cb7-265"><a href="#cb7-265"></a><span class="co">#   3-4: LE short: event passed through (~GPM_HARD=0xFEFF)</span></span>
<span id="cb7-266"><a href="#cb7-266"></a></span>
<span id="cb7-267"><a href="#cb7-267"></a><span class="co">#   5-6: LE short: min modifiers</span></span>
<span id="cb7-268"><a href="#cb7-268"></a></span>
<span id="cb7-269"><a href="#cb7-269"></a><span class="co">#   7-8: LE short: max modifiers</span></span>
<span id="cb7-270"><a href="#cb7-270"></a></span>
<span id="cb7-271"><a href="#cb7-271"></a><span class="co">#  9-12: LE int: pid</span></span>
<span id="cb7-272"><a href="#cb7-272"></a></span>
<span id="cb7-273"><a href="#cb7-273"></a><span class="co"># 13-16: LE int: virtual console number</span></span>
<span id="cb7-274"><a href="#cb7-274"></a></span>
<span id="cb7-275"><a href="#cb7-275"></a></span>
<span id="cb7-276"><a href="#cb7-276"></a>          <span class="ex">print</span> -u<span class="va">$ZSH_GPM_FD</span> -n <span class="st">&quot;\4\0\377\376</span><span class="dt">\\</span><span class="va">$((</span>[##8]min&amp;255</span>
<span id="cb7-277"><a href="#cb7-277"></a></span>
<span id="cb7-278"><a href="#cb7-278"></a>          <span class="va">))</span><span class="dt">\\</span><span class="va">$((</span>[##8]min&gt;&gt;8<span class="va">))</span><span class="dt">\\</span><span class="va">$((</span>[##8]max&amp;255<span class="va">))</span><span class="dt">\\</span><span class="va">$((</span>[##8]max&gt;&gt;8</span>
<span id="cb7-279"><a href="#cb7-279"></a></span>
<span id="cb7-280"><a href="#cb7-280"></a>          <span class="va">))</span><span class="dt">\\</span><span class="va">$((</span>[##8]<span class="va">$$</span>&amp;255<span class="va">))</span><span class="dt">\\</span><span class="va">$((</span>[##8]<span class="va">$$</span>&gt;&gt;8&amp;255<span class="va">))</span><span class="dt">\\</span><span class="va">$((</span></span>
<span id="cb7-281"><a href="#cb7-281"></a></span>
<span id="cb7-282"><a href="#cb7-282"></a>          [##8]<span class="va">$$</span>&gt;&gt;16&amp;255<span class="va">))</span><span class="dt">\\</span><span class="va">$((</span> [##8]<span class="va">$$</span>&gt;&gt;24<span class="va">))</span><span class="dt">\\</span><span class="va">$((</span></span>
<span id="cb7-283"><a href="#cb7-283"></a></span>
<span id="cb7-284"><a href="#cb7-284"></a>          [##8]<span class="va">${TTY#</span>/dev/tty<span class="va">}))</span><span class="st">\0\0\0&quot;</span></span>
<span id="cb7-285"><a href="#cb7-285"></a></span>
<span id="cb7-286"><a href="#cb7-286"></a>          <span class="ex">zle</span> -F <span class="va">$ZSH_GPM_FD</span> handle-gpm-mouse-event</span>
<span id="cb7-287"><a href="#cb7-287"></a>            <span class="kw">else</span></span>
<span id="cb7-288"><a href="#cb7-288"></a>          <span class="ex">zle-error</span> <span class="st">&#39;Error: unable to connect to GPM&#39;</span></span>
<span id="cb7-289"><a href="#cb7-289"></a>          <span class="va">ZLE_USE_MOUSE=</span></span>
<span id="cb7-290"><a href="#cb7-290"></a>        <span class="kw">fi</span></span>
<span id="cb7-291"><a href="#cb7-291"></a>      <span class="kw">fi</span></span>
<span id="cb7-292"><a href="#cb7-292"></a>    <span class="kw">else</span></span>
<span id="cb7-293"><a href="#cb7-293"></a><span class="co"># ZLE_USE_MOUSE disabled, close GPM connection</span></span>
<span id="cb7-294"><a href="#cb7-294"></a></span>
<span id="cb7-295"><a href="#cb7-295"></a>      <span class="kw">if</span> <span class="kw">((</span> $+ZSH_GPM_FD <span class="kw">))</span>; <span class="kw">then</span></span>
<span id="cb7-296"><a href="#cb7-296"></a>        <span class="bu">eval</span> <span class="st">&quot;exec </span><span class="va">$ZSH_GPM_FD</span><span class="st">&gt;&amp;-&quot;</span></span>
<span id="cb7-297"><a href="#cb7-297"></a><span class="co"># what if $ZSH_GPM_FD &gt; 9 ?</span></span>
<span id="cb7-298"><a href="#cb7-298"></a></span>
<span id="cb7-299"><a href="#cb7-299"></a>        <span class="ex">zle</span> -F <span class="va">$ZSH_GPM_FD</span># remove the handler</span>
<span id="cb7-300"><a href="#cb7-300"></a></span>
<span id="cb7-301"><a href="#cb7-301"></a>        <span class="bu">unset</span> <span class="va">ZSH_GPM_FD</span></span>
<span id="cb7-302"><a href="#cb7-302"></a>      <span class="kw">fi</span></span>
<span id="cb7-303"><a href="#cb7-303"></a>    <span class="kw">fi</span></span>
<span id="cb7-304"><a href="#cb7-304"></a>      <span class="kw">}</span></span>
<span id="cb7-305"><a href="#cb7-305"></a></span>
<span id="cb7-306"><a href="#cb7-306"></a>      <span class="fu">handle-gpm-mouse-event()</span> <span class="kw">{</span></span>
<span id="cb7-307"><a href="#cb7-307"></a>    <span class="bu">local</span> <span class="va">last_status=$?</span></span>
<span id="cb7-308"><a href="#cb7-308"></a>    <span class="bu">local</span> <span class="va">event</span> <span class="va">i</span></span>
<span id="cb7-309"><a href="#cb7-309"></a>    <span class="kw">if</span> <span class="bu">read</span> -u<span class="va">$1</span> -k28 <span class="va">event</span>; <span class="kw">then</span></span>
<span id="cb7-310"><a href="#cb7-310"></a>      <span class="bu">local</span> <span class="va">buttons</span> <span class="va">x</span> <span class="va">y</span></span>
<span id="cb7-311"><a href="#cb7-311"></a>      <span class="kw">((</span> buttons =##<span class="va">$event[1]</span> <span class="kw">))</span></span>
<span id="cb7-312"><a href="#cb7-312"></a></span>
<span id="cb7-313"><a href="#cb7-313"></a>      <span class="kw">((</span> x =##<span class="va">$event[9]</span> + <span class="co">##$event[10] &lt;&lt; 8 ))</span></span>
<span id="cb7-314"><a href="#cb7-314"></a></span>
<span id="cb7-315"><a href="#cb7-315"></a>      (( y =##<span class="va">$event[11]</span> + <span class="co">##$event[12] &lt;&lt; 8 ))</span></span>
<span id="cb7-316"><a href="#cb7-316"></a></span>
<span id="cb7-317"><a href="#cb7-317"></a>      zle handle-mouse-event <span class="va">$((</span> (5 - (buttons &amp; -buttons)) / 2 <span class="va">))</span> <span class="va">$x</span> <span class="va">$y</span> <span class="va">$last_status</span></span>
<span id="cb7-318"><a href="#cb7-318"></a>      zle -R# redraw buffer</span>
<span id="cb7-319"><a href="#cb7-319"></a></span>
<span id="cb7-320"><a href="#cb7-320"></a>    else</span>
<span id="cb7-321"><a href="#cb7-321"></a>      zle -M <span class="st">&#39;Error: connection to GPM lost&#39;</span></span>
<span id="cb7-322"><a href="#cb7-322"></a>      ZLE_USE_MOUSE=</span>
<span id="cb7-323"><a href="#cb7-323"></a>      zle-update-mouse-driver</span>
<span id="cb7-324"><a href="#cb7-324"></a>    fi</span>
<span id="cb7-325"><a href="#cb7-325"></a>      }</span>
<span id="cb7-326"><a href="#cb7-326"></a>    fi </span>
<span id="cb7-327"><a href="#cb7-327"></a>  else</span>
<span id="cb7-328"><a href="#cb7-328"></a><span class="co"># xterm-like mouse support</span></span>
<span id="cb7-329"><a href="#cb7-329"></a></span>
<span id="cb7-330"><a href="#cb7-330"></a>    zmodload -i zsh/parameter# needed for <span class="va">$functions</span></span>
<span id="cb7-331"><a href="#cb7-331"></a></span>
<span id="cb7-332"><a href="#cb7-332"></a></span>
<span id="cb7-333"><a href="#cb7-333"></a>    zle-update-mouse-driver() {</span>
<span id="cb7-334"><a href="#cb7-334"></a>      if [[ -n <span class="va">$WIDGET</span> ]]; then</span>
<span id="cb7-335"><a href="#cb7-335"></a>    if [[ -n <span class="va">$ZLE_USE_MOUSE</span> ]]; then</span>
<span id="cb7-336"><a href="#cb7-336"></a>      print -n <span class="st">&#39;\e[?1000h&#39;</span></span>
<span id="cb7-337"><a href="#cb7-337"></a>    else</span>
<span id="cb7-338"><a href="#cb7-338"></a>      print -n <span class="st">&#39;\e[?1000l&#39;</span></span>
<span id="cb7-339"><a href="#cb7-339"></a>    fi</span>
<span id="cb7-340"><a href="#cb7-340"></a>      fi</span>
<span id="cb7-341"><a href="#cb7-341"></a>    }</span>
<span id="cb7-342"><a href="#cb7-342"></a></span>
<span id="cb7-343"><a href="#cb7-343"></a>    if [[ <span class="va">$functions[precmd]</span> != *ZLE_USE_MOUSE* ]]; then</span>
<span id="cb7-344"><a href="#cb7-344"></a>      functions[precmd]+=<span class="st">&#39;</span></span>
<span id="cb7-345"><a href="#cb7-345"></a><span class="st">      [[ -n $ZLE_USE_MOUSE ]] &amp;&amp; print -n &#39;</span><span class="dt">\&#39;</span><span class="st">&#39;\e[?1000h&#39;</span><span class="dt">\&#39;</span></span>
<span id="cb7-346"><a href="#cb7-346"></a>    fi</span>
<span id="cb7-347"><a href="#cb7-347"></a>    if [[ <span class="va">$functions[preexec]</span> != *ZLE_USE_MOUSE* ]]; then</span>
<span id="cb7-348"><a href="#cb7-348"></a>      functions[preexec]+=<span class="st">&#39;</span></span>
<span id="cb7-349"><a href="#cb7-349"></a><span class="st">      [[ -n $ZLE_USE_MOUSE ]] &amp;&amp; print -n &#39;</span><span class="dt">\&#39;</span><span class="st">&#39;\e[?1000l&#39;</span><span class="dt">\&#39;</span></span>
<span id="cb7-350"><a href="#cb7-350"></a>    fi</span>
<span id="cb7-351"><a href="#cb7-351"></a></span>
<span id="cb7-352"><a href="#cb7-352"></a>    bindkey -M emacs <span class="st">&#39;\e[M&#39;</span> handle-xterm-mouse-event</span>
<span id="cb7-353"><a href="#cb7-353"></a>    bindkey -M viins <span class="st">&#39;\e[M&#39;</span> handle-xterm-mouse-event</span>
<span id="cb7-354"><a href="#cb7-354"></a>    bindkey -M vicmd <span class="st">&#39;\e[M&#39;</span> handle-xterm-mouse-event</span>
<span id="cb7-355"><a href="#cb7-355"></a></span>
<span id="cb7-356"><a href="#cb7-356"></a>    if [[ <span class="va">$TERM</span> = *Eterm* ]]; then</span>
<span id="cb7-357"><a href="#cb7-357"></a><span class="co"># Eterm sends \e[5Mxxxxx on drag events, be want to discard them</span></span>
<span id="cb7-358"><a href="#cb7-358"></a></span>
<span id="cb7-359"><a href="#cb7-359"></a>      discard-mouse-drag() {</span>
<span id="cb7-360"><a href="#cb7-360"></a>        local junk</span>
<span id="cb7-361"><a href="#cb7-361"></a>        read -k5 junk</span>
<span id="cb7-362"><a href="#cb7-362"></a>      }</span>
<span id="cb7-363"><a href="#cb7-363"></a>      zle -N discard-mouse-drag</span>
<span id="cb7-364"><a href="#cb7-364"></a>      bindkey -M emacs <span class="st">&#39;\e[5M&#39;</span> discard-mouse-drag</span>
<span id="cb7-365"><a href="#cb7-365"></a>      bindkey -M viins <span class="st">&#39;\e[5M&#39;</span> discard-mouse-drag</span>
<span id="cb7-366"><a href="#cb7-366"></a>      bindkey -M vicmd <span class="st">&#39;\e[5M&#39;</span> discard-mouse-drag</span>
<span id="cb7-367"><a href="#cb7-367"></a>    fi</span>
<span id="cb7-368"><a href="#cb7-368"></a>  fi</span>
<span id="cb7-369"><a href="#cb7-369"></a></span>
<span id="cb7-370"><a href="#cb7-370"></a>fi</span></code></pre></div>
</section>
</body>
</html>
