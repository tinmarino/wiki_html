<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Test.md – Untitled</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="solarized-dark.css" />
</head>
<body>
<p><a href="/home2/tourneboeuf/Test/test2.md.html">True test2</a></p>
<h1 id="contents">Contents</h1>
<ul>
<li><a href="#Test1">Test1</a></li>
<li><a href="#Test2">Test2</a></li>
<li><a href="#Test3">Test3</a></li>
</ul>
<h1 id="test1">Test1</h1>
<ul>
<li><a href="#Test1">Test1</a></li>
<li><a href="#Test2">Test2</a></li>
<li><a href="#Test3">Test3</a></li>
</ul>
<h1 id="test2">Test2</h1>
<ul>
<li><a href="#Test1">Test1</a></li>
<li><a href="#Test2">Test2</a></li>
<li><a href="#Test3">Test3</a></li>
</ul>
<h1 id="test3">Test3</h1>
<ul>
<li><a href="Math.html">Math</a></li>
<li><a href="diary/2019-02-10.html">This is a diary test</a></li>
</ul>
<h1 id="array-test">Array test</h1>
<table>
<thead>
<tr class="header">
<th>1</th>
<th>2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="#Test1">Test1</a></td>
<td><a href="#Test2">Test2</a></td>
</tr>
</tbody>
</table>
<h1 id="languages">Languages</h1>
<p>((( ( (here $1 is matched for [[name]]) ) )))</p>
<p>{{{python for i in range(10): print(“hello world”) }}}</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1">  <span class="bu">echo</span> <span class="st">&quot;totot&quot;</span></a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="fu">cat</span> this is <span class="op">&gt;</span> bash </a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">class</span> toto:</a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3">        <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-4" title="4">                <span class="va">self</span>.a <span class="op">=</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb2-5" title="5">                <span class="bu">print</span>(<span class="st">&quot;I am initiated&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode perl"><code class="sourceCode perl"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">sub </span><span class="fu">titi</span> {</a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="kw">if</span> </a>
<a class="sourceLine" id="cb3-3" title="3">}</a></code></pre></div>
<p><code>class=&quot;brush: python&quot; for i in range(1, 5):    print(i)</code></p>
<p><code>class=&quot;brush: cpp&quot; #include &quot;helloworld.h&quot; int helloworld() {   printf(&quot;hello world&quot;); }</code></p>
<p>or in: &gt;</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb4-1" title="1"><span class="pp">#include </span><span class="im">&quot;helloworld.h&quot;</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="dt">int</span> helloworld()</a>
<a class="sourceLine" id="cb4-3" title="3">{</a>
<a class="sourceLine" id="cb4-4" title="4">  printf(<span class="st">&quot;hello world&quot;</span>);</a>
<a class="sourceLine" id="cb4-5" title="5">}</a></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" title="1"><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">5</span>):</a>
<a class="sourceLine" id="cb5-2" title="2">   <span class="bu">print</span>(i)</a></code></pre></div>
<p>def</p>
<p>Consider the following example: &gt; = Toggleable list of todo items = * [ ] Toggle list item on/off. * [ ] Simple toggling between [ ] and [X]. * [ ] All list’s subitems should be toggled on/off appropriately. * [ ] Toggle child subitems only if current line is list item * [ ] Parent list item should be toggled depending on it’s child items. * [ ] Make numbered list items toggleable too * [ ] Add highlighting to list item boxes * [ ] Add [ ] to the next list item created with o, O and <CR>.</p>
<p>This sould be followed by code</p>
<pre><code>Here is the code
and yes 
this shoudl be co
de</code></pre>
<p>This is a table</p>
<table>
<thead>
<tr class="header">
<th>Name</th>
<th style="text-align: right;">Size</th>
<th style="text-align: right;">Cost</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Africans</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">31</td>
</tr>
<tr class="even">
<td>Normandie</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">2066.55</td>
</tr>
<tr class="odd">
<td>Nord</td>
<td style="text-align: right;">84</td>
<td style="text-align: right;">33</td>
</tr>
<tr class="even">
<td>Total</td>
<td style="text-align: right;">117.0</td>
<td style="text-align: right;">2099</td>
</tr>
</tbody>
</table>
<p>%% tmf: $4,2=Sum(2:-1) ; $4,3=float2nr(Sum(2:-1))</p>
<p>From CSV</p>
<table>
<thead>
<tr class="header">
<th>Name</th>
<th style="text-align: right;">Pay1</th>
<th style="text-align: right;">Pay2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Frinde1</td>
<td style="text-align: right;">221</td>
<td style="text-align: right;">33</td>
</tr>
<tr class="even">
<td>Frinde2</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">33</td>
</tr>
<tr class="odd">
<td>Frinde3</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">33</td>
</tr>
</tbody>
</table>
<p>aza azeazea</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">if [[</span> <span class="va">$TERM</span> <span class="ot">=</span> *[xeEk]term* ||</a>
<a class="sourceLine" id="cb7-2" title="2">      <span class="va">$TERM</span> <span class="ot">=</span> *mlterm* ||</a>
<a class="sourceLine" id="cb7-3" title="3">      <span class="va">$TERM</span> <span class="ot">=</span> *rxvt* ||</a>
<a class="sourceLine" id="cb7-4" title="4">      <span class="va">$TERM</span> <span class="ot">=</span> *screen* ||</a>
<a class="sourceLine" id="cb7-5" title="5">      (<span class="va">$TERM</span> = *linux* &amp;&amp; -S /dev/gpmctl)</a>
<a class="sourceLine" id="cb7-6" title="6">   ]]; then</a>
<a class="sourceLine" id="cb7-7" title="7"></a>
<a class="sourceLine" id="cb7-8" title="8">  set-status() { return <span class="va">$1</span>; }</a>
<a class="sourceLine" id="cb7-9" title="9"></a>
<a class="sourceLine" id="cb7-10" title="10">  handle-mouse-event() {</a>
<a class="sourceLine" id="cb7-11" title="11">    emulate <span class="ot">-L</span> zsh</a>
<a class="sourceLine" id="cb7-12" title="12">    local bt=<span class="va">$1</span></a>
<a class="sourceLine" id="cb7-13" title="13"></a>
<a class="sourceLine" id="cb7-14" title="14">    case <span class="va">$bt</span> in</a>
<a class="sourceLine" id="cb7-15" title="15">      3)</a>
<a class="sourceLine" id="cb7-16" title="16">    return 0;; <span class="co"># Process on press, discard release</span></a>
<a class="sourceLine" id="cb7-17" title="17">    <span class="co"># mlterm sends 3 on mouse-wheel-up but also on every button</span></a>
<a class="sourceLine" id="cb7-18" title="18">    <span class="co"># release, so it&#39;s unusable</span></a>
<a class="sourceLine" id="cb7-19" title="19">      64)</a>
<a class="sourceLine" id="cb7-20" title="20">    <span class="co"># eterm, rxvt, gnome/KDE terminal mouse wheel</span></a>
<a class="sourceLine" id="cb7-21" title="21">    zle up-line-or-history</a>
<a class="sourceLine" id="cb7-22" title="22">    return;;</a>
<a class="sourceLine" id="cb7-23" title="23">      4|65)</a>
<a class="sourceLine" id="cb7-24" title="24">    <span class="co"># mlterm or eterm, rxvt, gnome/KDE terminal mouse wheel</span></a>
<a class="sourceLine" id="cb7-25" title="25">    zle down-line-or-history</a>
<a class="sourceLine" id="cb7-26" title="26">    return;;</a>
<a class="sourceLine" id="cb7-27" title="27">    esac</a>
<a class="sourceLine" id="cb7-28" title="28">    local mx=<span class="va">$2</span> my=<span class="va">$3</span> last_status=<span class="va">$4</span></a>
<a class="sourceLine" id="cb7-29" title="29">    local cx cy i</a>
<a class="sourceLine" id="cb7-30" title="30">    setopt extendedglob</a>
<a class="sourceLine" id="cb7-31" title="31"></a>
<a class="sourceLine" id="cb7-32" title="32">    print <span class="ot">-n</span> <span class="st">&#39;\e[6n&#39;</span> <span class="co"># query cursor position</span></a>
<a class="sourceLine" id="cb7-33" title="33"></a>
<a class="sourceLine" id="cb7-34" title="34">    local match mbegin mend buf=</a>
<a class="sourceLine" id="cb7-35" title="35"></a>
<a class="sourceLine" id="cb7-36" title="36">        while ( read -k i &amp;&amp; buf+=<span class="va">$i</span> &amp;&amp; [[ <span class="va">$buf</span> != <span class="st">&quot;*\[([0-9]##)\;[0-9]##R&quot;</span> ]] ) ; do :; done</a>
<a class="sourceLine" id="cb7-37" title="37">    <span class="co"># read response from terminal.</span></a>
<a class="sourceLine" id="cb7-38" title="38">    <span class="co"># note that we may also get a mouse tracking btn-release event,</span></a>
<a class="sourceLine" id="cb7-39" title="39">    <span class="co"># which would then be discarded.</span></a>
<a class="sourceLine" id="cb7-40" title="40"></a>
<a class="sourceLine" id="cb7-41" title="41">    [[ <span class="va">$buf</span> <span class="ot">=</span> <span class="st">&quot;(#b)*\[([0-9]##)\;[0-9]##R&quot;</span><span class="kw"> ]]</span> <span class="kw">||</span> <span class="bu">return</span></a>
<a class="sourceLine" id="cb7-42" title="42">    <span class="va">cy=$match[1]</span> <span class="co"># we don&#39;t need cx</span></a>
<a class="sourceLine" id="cb7-43" title="43"></a>
<a class="sourceLine" id="cb7-44" title="44">    <span class="bu">local</span> <span class="va">cur_prompt</span></a>
<a class="sourceLine" id="cb7-45" title="45"></a>
<a class="sourceLine" id="cb7-46" title="46">    <span class="co"># trying to guess the current prompt</span></a>
<a class="sourceLine" id="cb7-47" title="47">    <span class="kw">case</span> <span class="va">$CONTEXT</span><span class="kw"> in</span></a>
<a class="sourceLine" id="cb7-48" title="48">      <span class="kw">(</span>vared<span class="kw">)</span></a>
<a class="sourceLine" id="cb7-49" title="49">        <span class="kw">if [[</span> <span class="va">$0</span> <span class="ot">=</span> zcalc<span class="kw"> ]]</span>; <span class="kw">then</span></a>
<a class="sourceLine" id="cb7-50" title="50">      <span class="va">cur_prompt=${ZCALCPROMPT-</span><span class="st">&#39;%1v&gt; &#39;</span><span class="va">}</span></a>
<a class="sourceLine" id="cb7-51" title="51">      <span class="ex">setopt</span> nopromptsubst nopromptbang promptpercent</a>
<a class="sourceLine" id="cb7-52" title="52">      <span class="co"># (ZCALCPROMPT is expanded with (%))</span></a>
<a class="sourceLine" id="cb7-53" title="53">    <span class="kw">fi;;</span></a>
<a class="sourceLine" id="cb7-54" title="54">    <span class="co"># if vared is passed a prompt, we&#39;re lost</span></a>
<a class="sourceLine" id="cb7-55" title="55">      <span class="kw">(</span>select<span class="kw">)</span></a>
<a class="sourceLine" id="cb7-56" title="56">        <span class="va">cur_prompt=$PS3</span><span class="kw">;;</span></a>
<a class="sourceLine" id="cb7-57" title="57">      <span class="kw">(</span>cont<span class="kw">)</span></a>
<a class="sourceLine" id="cb7-58" title="58">    <span class="va">cur_prompt=$PS2</span><span class="kw">;;</span></a>
<a class="sourceLine" id="cb7-59" title="59">      <span class="kw">(</span>start<span class="kw">)</span></a>
<a class="sourceLine" id="cb7-60" title="60">    <span class="va">cur_prompt=$PS1</span><span class="kw">;;</span></a>
<a class="sourceLine" id="cb7-61" title="61">    <span class="kw">esac</span></a>
<a class="sourceLine" id="cb7-62" title="62"></a>
<a class="sourceLine" id="cb7-63" title="63">    <span class="co"># if promptsubst, then we need first to do the expansions (to</span></a>
<a class="sourceLine" id="cb7-64" title="64">    <span class="co"># be able to remove the visual effects) and disable further</span></a>
<a class="sourceLine" id="cb7-65" title="65">    <span class="co"># expansions</span></a>
<a class="sourceLine" id="cb7-66" title="66">    [[ <span class="ex">-o</span> promptsubst ]] <span class="kw">&amp;&amp;</span> <span class="va">cur_prompt=</span>$<span class="dt">{${(e)cur_prompt}//(#b)([\\\$\`])/\\</span><span class="va">$match</span><span class="dt">}</span></a>
<a class="sourceLine" id="cb7-67" title="67"></a>
<a class="sourceLine" id="cb7-68" title="68">    <span class="co"># restore the exit status in case $PS&lt;n&gt; relies on it</span></a>
<a class="sourceLine" id="cb7-69" title="69">    <span class="ex">set-status</span> <span class="va">$last_status</span></a>
<a class="sourceLine" id="cb7-70" title="70"></a>
<a class="sourceLine" id="cb7-71" title="71">    <span class="co"># remove the visual effects and do the prompt expansion</span></a>
<a class="sourceLine" id="cb7-72" title="72">    <span class="va">cur_prompt=</span>$<span class="dt">{(S%%)cur_prompt//(#b)(%([BSUbsu]|{*%})|(%[^BSUbsu{}]))/</span><span class="va">$match[3]</span><span class="dt">}</span></a>
<a class="sourceLine" id="cb7-73" title="73"></a>
<a class="sourceLine" id="cb7-74" title="74">    <span class="co"># we&#39;re now looping over the whole editing buffer (plus the last</span></a>
<a class="sourceLine" id="cb7-75" title="75">    <span class="co"># line of the prompt) to compute the (x,y) position of each char. We</span></a>
<a class="sourceLine" id="cb7-76" title="76">    <span class="co"># store the characters i for which x(i) &lt;= mx &lt; x(i+1) for every</span></a>
<a class="sourceLine" id="cb7-77" title="77">    <span class="co"># value of y in the pos array. We also get the Y(CURSOR), so that at</span></a>
<a class="sourceLine" id="cb7-78" title="78">    <span class="co"># the end, we&#39;re able to say which pos element is the right one</span></a>
<a class="sourceLine" id="cb7-79" title="79"></a>
<a class="sourceLine" id="cb7-80" title="80">    <span class="bu">local</span> -a <span class="va">pos</span> <span class="co"># array holding the possible positions of</span></a>
<a class="sourceLine" id="cb7-81" title="81">         <span class="co"># the mouse pointer</span></a>
<a class="sourceLine" id="cb7-82" title="82">    <span class="bu">local</span> -i <span class="va">n</span> <span class="va">x=</span>0 <span class="va">y=</span>1 <span class="va">cursor=$((${#cur_prompt}</span>+<span class="va">$CURSOR</span>+1<span class="va">))</span></a>
<a class="sourceLine" id="cb7-83" title="83">    <span class="bu">local</span> <span class="va">Y</span></a>
<a class="sourceLine" id="cb7-84" title="84"></a>
<a class="sourceLine" id="cb7-85" title="85">    <span class="va">buf=$cur_prompt$BUFFER</span></a>
<a class="sourceLine" id="cb7-86" title="86">    <span class="kw">for</span> <span class="kw">((</span>i=1; i&lt;=<span class="va">$#</span>buf; i++<span class="kw">))</span>; <span class="kw">do</span></a>
<a class="sourceLine" id="cb7-87" title="87">      <span class="kw">((</span> i == cursor <span class="kw">))</span> <span class="kw">&amp;&amp;</span> <span class="va">Y=$y</span></a>
<a class="sourceLine" id="cb7-88" title="88">      <span class="va">n=</span>0</a>
<a class="sourceLine" id="cb7-89" title="89">      <span class="kw">case</span> <span class="va">$buf[i]</span><span class="kw"> in</span></a>
<a class="sourceLine" id="cb7-90" title="90">    <span class="kw">(</span><span class="st">$&#39;</span><span class="dt">\n</span><span class="st">&#39;</span><span class="kw">)</span> <span class="co"># newline</span></a>
<a class="sourceLine" id="cb7-91" title="91">      <span class="bu">:</span> <span class="va">${pos[y]=$i}</span></a>
<a class="sourceLine" id="cb7-92" title="92">      <span class="kw">((</span> y++, x=0 <span class="kw">));;</span></a>
<a class="sourceLine" id="cb7-93" title="93">    <span class="kw">(</span><span class="st">$&#39;</span><span class="dt">\t</span><span class="st">&#39;</span><span class="kw">)</span> <span class="co"># tab advance til next tab stop</span></a>
<a class="sourceLine" id="cb7-94" title="94">      <span class="kw">((</span> x = x/8*8+8 <span class="kw">));;</span></a>
<a class="sourceLine" id="cb7-95" title="95">    <span class="kw">(</span>[<span class="st">$&#39;</span><span class="dt">\0</span><span class="st">&#39;</span>-<span class="st">$&#39;</span><span class="dt">\037</span><span class="st">&#39;$&#39;</span><span class="dt">\200</span><span class="st">&#39;</span>-<span class="st">$&#39;</span><span class="dt">\237</span><span class="st">&#39;</span>]<span class="kw">)</span></a>
<a class="sourceLine" id="cb7-96" title="96">      <span class="co"># characters like ^M</span></a>
<a class="sourceLine" id="cb7-97" title="97">      <span class="va">n=</span>2<span class="kw">;;</span></a>
<a class="sourceLine" id="cb7-98" title="98">    <span class="kw">(</span>*<span class="kw">)</span></a>
<a class="sourceLine" id="cb7-99" title="99">      <span class="va">n=</span>1<span class="kw">;;</span></a>
<a class="sourceLine" id="cb7-100" title="100">      <span class="kw">esac</span></a>
<a class="sourceLine" id="cb7-101" title="101">      <span class="kw">while</span></a>
<a class="sourceLine" id="cb7-102" title="102">    <span class="kw">((</span> x &gt;= mx <span class="kw">))</span> <span class="kw">&amp;&amp;</span> <span class="bu">:</span> <span class="va">${pos[y]=$i}</span></a>
<a class="sourceLine" id="cb7-103" title="103">    <span class="kw">((</span> x &gt;= COLUMNS <span class="kw">))</span> <span class="kw">&amp;&amp;</span> <span class="kw">((</span> x=0, y++ <span class="kw">))</span></a>
<a class="sourceLine" id="cb7-104" title="104">    <span class="kw">((</span> n &gt; 0 <span class="kw">))</span></a>
<a class="sourceLine" id="cb7-105" title="105">      <span class="kw">do</span></a>
<a class="sourceLine" id="cb7-106" title="106">    <span class="kw">((</span> x++, n-- <span class="kw">))</span></a>
<a class="sourceLine" id="cb7-107" title="107">      <span class="kw">done</span></a>
<a class="sourceLine" id="cb7-108" title="108">    <span class="kw">done</span></a>
<a class="sourceLine" id="cb7-109" title="109">    <span class="bu">:</span> <span class="va">${pos[y]=$i}</span> <span class="va">${Y:=$y}</span></a>
<a class="sourceLine" id="cb7-110" title="110"></a>
<a class="sourceLine" id="cb7-111" title="111">    <span class="bu">local</span> <span class="va">mouse_CURSOR</span></a>
<a class="sourceLine" id="cb7-112" title="112">    <span class="kw">if</span> <span class="kw">((</span>my + Y - cy &gt; y<span class="kw">))</span>; <span class="kw">then</span></a>
<a class="sourceLine" id="cb7-113" title="113">      <span class="va">mouse_CURSOR=$#</span>BUFFER</a>
<a class="sourceLine" id="cb7-114" title="114">    <span class="kw">elif</span> <span class="kw">((</span>my + Y - cy &lt; 1<span class="kw">))</span>; <span class="kw">then</span></a>
<a class="sourceLine" id="cb7-115" title="115">      <span class="va">mouse_CURSOR=</span>0</a>
<a class="sourceLine" id="cb7-116" title="116">    <span class="kw">else</span></a>
<a class="sourceLine" id="cb7-117" title="117">      <span class="va">mouse_CURSOR=$(($pos[my + Y - cy]</span> - <span class="va">${#cur_prompt}</span> - 1<span class="va">))</span></a>
<a class="sourceLine" id="cb7-118" title="118">    <span class="kw">fi</span></a>
<a class="sourceLine" id="cb7-119" title="119"></a>
<a class="sourceLine" id="cb7-120" title="120">    <span class="kw">case</span> <span class="va">$bt</span><span class="kw"> in</span></a>
<a class="sourceLine" id="cb7-121" title="121">      <span class="kw">(</span>0<span class="kw">)</span></a>
<a class="sourceLine" id="cb7-122" title="122">    <span class="co"># Button 1.  Move cursor.</span></a>
<a class="sourceLine" id="cb7-123" title="123">    <span class="va">CURSOR=$mouse_CURSOR</span></a>
<a class="sourceLine" id="cb7-124" title="124">      <span class="kw">;;</span></a>
<a class="sourceLine" id="cb7-125" title="125"></a>
<a class="sourceLine" id="cb7-126" title="126">      <span class="kw">(</span>1<span class="kw">)</span></a>
<a class="sourceLine" id="cb7-127" title="127">    <span class="co"># Button 2.  Insert selection at mouse cursor postion.</span></a>
<a class="sourceLine" id="cb7-128" title="128">    <span class="ex">get-x-clipboard</span></a>
<a class="sourceLine" id="cb7-129" title="129">    <span class="va">BUFFER=$BUFFER[1,mouse_CURSOR]$CUTBUFFER$BUFFER[mouse_CURSOR+1,-1]</span></a>
<a class="sourceLine" id="cb7-130" title="130">    <span class="kw">((</span> CURSOR = <span class="va">$mouse_CURSOR</span> + <span class="va">$#</span>CUTBUFFER <span class="kw">))</span></a>
<a class="sourceLine" id="cb7-131" title="131">      <span class="kw">;;</span></a>
<a class="sourceLine" id="cb7-132" title="132"></a>
<a class="sourceLine" id="cb7-133" title="133">      <span class="kw">(</span>2<span class="kw">)</span></a>
<a class="sourceLine" id="cb7-134" title="134">    <span class="co"># Button 3.  Copy from cursor to mouse to cutbuffer.</span></a>
<a class="sourceLine" id="cb7-135" title="135">    <span class="va">killring=(</span><span class="st">&quot;</span><span class="va">$CUTBUFFER</span><span class="st">&quot;</span> <span class="st">&quot;${(@)killring[1,-2]}&quot;</span><span class="va">)</span></a>
<a class="sourceLine" id="cb7-136" title="136">    <span class="kw">if</span> <span class="kw">((</span> mouse_CURSOR &lt; CURSOR <span class="kw">))</span>; <span class="kw">then</span></a>
<a class="sourceLine" id="cb7-137" title="137">      <span class="va">CUTBUFFER=$BUFFER[mouse_CURSOR+1,CURSOR+1]</span></a>
<a class="sourceLine" id="cb7-138" title="138">    <span class="kw">else</span></a>
<a class="sourceLine" id="cb7-139" title="139">      <span class="va">CUTBUFFER=$BUFFER[CURSOR+1,mouse_CURSOR+1]</span></a>
<a class="sourceLine" id="cb7-140" title="140">    <span class="kw">fi</span></a>
<a class="sourceLine" id="cb7-141" title="141">    <span class="ex">set-x-clipboard</span> <span class="va">$CUTBUFFER</span></a>
<a class="sourceLine" id="cb7-142" title="142">      <span class="kw">;;</span></a>
<a class="sourceLine" id="cb7-143" title="143">    <span class="kw">esac</span></a>
<a class="sourceLine" id="cb7-144" title="144">  }</a>
<a class="sourceLine" id="cb7-145" title="145"></a>
<a class="sourceLine" id="cb7-146" title="146">  <span class="ex">zle</span> -N handle-mouse-event</a>
<a class="sourceLine" id="cb7-147" title="147"></a>
<a class="sourceLine" id="cb7-148" title="148">  <span class="fu">handle-xterm-mouse-event()</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb7-149" title="149">    <span class="bu">local</span> <span class="va">last_status=$?</span></a>
<a class="sourceLine" id="cb7-150" title="150">    <span class="ex">emulate</span> -L zsh</a>
<a class="sourceLine" id="cb7-151" title="151">    <span class="bu">local</span> <span class="va">bt</span> <span class="va">mx</span> <span class="va">my</span></a>
<a class="sourceLine" id="cb7-152" title="152"></a>
<a class="sourceLine" id="cb7-153" title="153">    <span class="co"># either xterm mouse tracking or bound xterm event</span></a>
<a class="sourceLine" id="cb7-154" title="154">    <span class="co"># read the event from the terminal</span></a>
<a class="sourceLine" id="cb7-155" title="155">    <span class="bu">read</span> -k <span class="va">bt</span> <span class="co"># mouse button, x, y reported after \e[M</span></a>
<a class="sourceLine" id="cb7-156" title="156">    <span class="va">bt=$((</span>#bt &amp; 0x47<span class="va">))</span></a>
<a class="sourceLine" id="cb7-157" title="157">    <span class="bu">read</span> -k <span class="va">mx</span></a>
<a class="sourceLine" id="cb7-158" title="158">    <span class="bu">read</span> -k <span class="va">my</span></a>
<a class="sourceLine" id="cb7-159" title="159">    <span class="kw">if [[</span> <span class="va">$mx</span> <span class="ot">=</span> <span class="st">$&#39;</span><span class="dt">\030</span><span class="st">&#39;</span><span class="kw"> ]]</span>; <span class="kw">then</span></a>
<a class="sourceLine" id="cb7-160" title="160">      <span class="co"># assume event is \E[M&lt;btn&gt;dired-button()(^X\EG&lt;x&gt;&lt;y&gt;)</span></a>
<a class="sourceLine" id="cb7-161" title="161">      <span class="bu">read</span> -k <span class="va">mx</span></a>
<a class="sourceLine" id="cb7-162" title="162">      <span class="bu">read</span> -k <span class="va">mx</span></a>
<a class="sourceLine" id="cb7-163" title="163">      <span class="bu">read</span> -k <span class="va">my</span></a>
<a class="sourceLine" id="cb7-164" title="164">      <span class="kw">((</span> my = <span class="co">#my - 31 ))</span></a>
<a class="sourceLine" id="cb7-165" title="165">      (( mx = <span class="co">#mx - 31 ))</span></a>
<a class="sourceLine" id="cb7-166" title="166">    else</a>
<a class="sourceLine" id="cb7-167" title="167">      <span class="co"># that&#39;s a VT200 mouse tracking event</span></a>
<a class="sourceLine" id="cb7-168" title="168">      (( my = <span class="co">#my - 32 ))</span></a>
<a class="sourceLine" id="cb7-169" title="169">      (( mx = <span class="co">#mx - 32 ))</span></a>
<a class="sourceLine" id="cb7-170" title="170">    fi</a>
<a class="sourceLine" id="cb7-171" title="171">    handle-mouse-event <span class="va">$bt</span> <span class="va">$mx</span> <span class="va">$my</span> <span class="va">$last_status</span></a>
<a class="sourceLine" id="cb7-172" title="172">  }</a>
<a class="sourceLine" id="cb7-173" title="173"></a>
<a class="sourceLine" id="cb7-174" title="174">  zle -N handle-xterm-mouse-event</a>
<a class="sourceLine" id="cb7-175" title="175"></a>
<a class="sourceLine" id="cb7-176" title="176">  if [[ <span class="va">$TERM</span> = *linux* &amp;&amp; -S /dev/gpmctl ]]; then</a>
<a class="sourceLine" id="cb7-177" title="177">    <span class="co"># GPM mouse support</span></a>
<a class="sourceLine" id="cb7-178" title="178">    if zmodload -i zsh/net/socket; then</a>
<a class="sourceLine" id="cb7-179" title="179"></a>
<a class="sourceLine" id="cb7-180" title="180">      zle-update-mouse-driver() {</a>
<a class="sourceLine" id="cb7-181" title="181">    if [[ -n <span class="va">$ZLE_USE_MOUSE</span> ]]; then</a>
<a class="sourceLine" id="cb7-182" title="182">      if (( ! $+ZSH_GPM_FD )); then</a>
<a class="sourceLine" id="cb7-183" title="183">        if zsocket -d 9 /dev/gpmctl; then</a>
<a class="sourceLine" id="cb7-184" title="184">          ZSH_GPM_FD=<span class="va">$REPLY</span></a>
<a class="sourceLine" id="cb7-185" title="185">          <span class="co"># gpm initialisation:</span></a>
<a class="sourceLine" id="cb7-186" title="186">          <span class="co"># request single click events with given modifiers</span></a>
<a class="sourceLine" id="cb7-187" title="187">          local -A modifiers</a>
<a class="sourceLine" id="cb7-188" title="188">          modifiers=(</a>
<a class="sourceLine" id="cb7-189" title="189">            none        0</a>
<a class="sourceLine" id="cb7-190" title="190">        shift       1</a>
<a class="sourceLine" id="cb7-191" title="191">        altgr       2</a>
<a class="sourceLine" id="cb7-192" title="192">        ctrl        4</a>
<a class="sourceLine" id="cb7-193" title="193">        alt         8</a>
<a class="sourceLine" id="cb7-194" title="194">        left-shift  16</a>
<a class="sourceLine" id="cb7-195" title="195">        right-shift 32</a>
<a class="sourceLine" id="cb7-196" title="196">        left-ctrl   64</a>
<a class="sourceLine" id="cb7-197" title="197">        right-ctrl  128</a>
<a class="sourceLine" id="cb7-198" title="198">        caps-shift  256</a>
<a class="sourceLine" id="cb7-199" title="199">          )</a>
<a class="sourceLine" id="cb7-200" title="200">          local min max</a>
<a class="sourceLine" id="cb7-201" title="201">          <span class="co"># modifiers that need to be on</span></a>
<a class="sourceLine" id="cb7-202" title="202">          min=<span class="va">$((</span>modifiers[none]<span class="va">))</span></a>
<a class="sourceLine" id="cb7-203" title="203">          <span class="co"># modifiers that may be on</span></a>
<a class="sourceLine" id="cb7-204" title="204">          max=<span class="va">$min</span></a>
<a class="sourceLine" id="cb7-205" title="205"></a>
<a class="sourceLine" id="cb7-206" title="206">          <span class="co"># send 16 bytes:</span></a>
<a class="sourceLine" id="cb7-207" title="207">          <span class="co">#   1-2: LE short: requested events (btn down = 0x0004)</span></a>
<a class="sourceLine" id="cb7-208" title="208">          <span class="co">#   3-4: LE short: event passed through (~GPM_HARD=0xFEFF)</span></a>
<a class="sourceLine" id="cb7-209" title="209">          <span class="co">#   5-6: LE short: min modifiers</span></a>
<a class="sourceLine" id="cb7-210" title="210">          <span class="co">#   7-8: LE short: max modifiers</span></a>
<a class="sourceLine" id="cb7-211" title="211">          <span class="co">#  9-12: LE int: pid</span></a>
<a class="sourceLine" id="cb7-212" title="212">          <span class="co"># 13-16: LE int: virtual console number</span></a>
<a class="sourceLine" id="cb7-213" title="213"></a>
<a class="sourceLine" id="cb7-214" title="214">          print -u<span class="va">$ZSH_GPM_FD</span> -n <span class="st">&quot;\4\0\377\376</span><span class="dt">\\</span><span class="va">$((</span>[##8]min&amp;255</a>
<a class="sourceLine" id="cb7-215" title="215">          <span class="va">))</span><span class="dt">\\</span><span class="va">$((</span>[##8]min&gt;&gt;8<span class="va">))</span><span class="dt">\\</span><span class="va">$((</span>[##8]max&amp;255<span class="va">))</span><span class="dt">\\</span><span class="va">$((</span>[##8]max&gt;&gt;8</a>
<a class="sourceLine" id="cb7-216" title="216">          <span class="va">))</span><span class="dt">\\</span><span class="va">$((</span>[##8]<span class="va">$$</span>&amp;255<span class="va">))</span><span class="dt">\\</span><span class="va">$((</span>[##8]<span class="va">$$</span>&gt;&gt;8&amp;255<span class="va">))</span><span class="dt">\\</span><span class="va">$((</span></a>
<a class="sourceLine" id="cb7-217" title="217">          [##8]<span class="va">$$</span>&gt;&gt;16&amp;255<span class="va">))</span><span class="dt">\\</span><span class="va">$((</span> [##8]<span class="va">$$</span>&gt;&gt;24<span class="va">))</span><span class="dt">\\</span><span class="va">$((</span></a>
<a class="sourceLine" id="cb7-218" title="218">          [##8]<span class="va">${TTY#</span>/dev/tty<span class="va">}))</span><span class="st">\0\0\0&quot;</span></a>
<a class="sourceLine" id="cb7-219" title="219">          zle -F <span class="va">$ZSH_GPM_FD</span> handle-gpm-mouse-event</a>
<a class="sourceLine" id="cb7-220" title="220">            else</a>
<a class="sourceLine" id="cb7-221" title="221">          zle-error <span class="st">&#39;Error: unable to connect to GPM&#39;</span></a>
<a class="sourceLine" id="cb7-222" title="222">          ZLE_USE_MOUSE=</a>
<a class="sourceLine" id="cb7-223" title="223">        fi</a>
<a class="sourceLine" id="cb7-224" title="224">      fi</a>
<a class="sourceLine" id="cb7-225" title="225">    else</a>
<a class="sourceLine" id="cb7-226" title="226">      <span class="co"># ZLE_USE_MOUSE disabled, close GPM connection</span></a>
<a class="sourceLine" id="cb7-227" title="227">      if (( $+ZSH_GPM_FD )); then</a>
<a class="sourceLine" id="cb7-228" title="228">        eval <span class="st">&quot;exec </span><span class="va">$ZSH_GPM_FD</span><span class="st">&gt;&amp;-&quot;</span></a>
<a class="sourceLine" id="cb7-229" title="229">        <span class="co"># what if $ZSH_GPM_FD &gt; 9 ?</span></a>
<a class="sourceLine" id="cb7-230" title="230">        zle -F <span class="va">$ZSH_GPM_FD</span> <span class="co"># remove the handler</span></a>
<a class="sourceLine" id="cb7-231" title="231">        unset ZSH_GPM_FD</a>
<a class="sourceLine" id="cb7-232" title="232">      fi</a>
<a class="sourceLine" id="cb7-233" title="233">    fi</a>
<a class="sourceLine" id="cb7-234" title="234">      }</a>
<a class="sourceLine" id="cb7-235" title="235"></a>
<a class="sourceLine" id="cb7-236" title="236">      handle-gpm-mouse-event() {</a>
<a class="sourceLine" id="cb7-237" title="237">    local last_status=<span class="va">$?</span></a>
<a class="sourceLine" id="cb7-238" title="238">    local event i</a>
<a class="sourceLine" id="cb7-239" title="239">    if read -u<span class="va">$1</span> -k28 event; then</a>
<a class="sourceLine" id="cb7-240" title="240">      local buttons x y</a>
<a class="sourceLine" id="cb7-241" title="241">      (( buttons = <span class="co">##$event[1] ))</span></a>
<a class="sourceLine" id="cb7-242" title="242">      (( x = <span class="co">##$event[9] + ##$event[10] &lt;&lt; 8 ))</span></a>
<a class="sourceLine" id="cb7-243" title="243">      (( y = <span class="co">##$event[11] + ##$event[12] &lt;&lt; 8 ))</span></a>
<a class="sourceLine" id="cb7-244" title="244">      zle handle-mouse-event <span class="va">$((</span> (5 - (buttons &amp; -buttons)) / 2 <span class="va">))</span> <span class="va">$x</span> <span class="va">$y</span> <span class="va">$last_status</span></a>
<a class="sourceLine" id="cb7-245" title="245">      zle -R <span class="co"># redraw buffer</span></a>
<a class="sourceLine" id="cb7-246" title="246">    else</a>
<a class="sourceLine" id="cb7-247" title="247">      zle -M <span class="st">&#39;Error: connection to GPM lost&#39;</span></a>
<a class="sourceLine" id="cb7-248" title="248">      ZLE_USE_MOUSE=</a>
<a class="sourceLine" id="cb7-249" title="249">      zle-update-mouse-driver</a>
<a class="sourceLine" id="cb7-250" title="250">    fi</a>
<a class="sourceLine" id="cb7-251" title="251">      }</a>
<a class="sourceLine" id="cb7-252" title="252">    fi </a>
<a class="sourceLine" id="cb7-253" title="253">  else</a>
<a class="sourceLine" id="cb7-254" title="254">    <span class="co"># xterm-like mouse support</span></a>
<a class="sourceLine" id="cb7-255" title="255">    zmodload -i zsh/parameter <span class="co"># needed for $functions</span></a>
<a class="sourceLine" id="cb7-256" title="256"></a>
<a class="sourceLine" id="cb7-257" title="257">    zle-update-mouse-driver() {</a>
<a class="sourceLine" id="cb7-258" title="258">      if [[ -n <span class="va">$WIDGET</span> ]]; then</a>
<a class="sourceLine" id="cb7-259" title="259">    if [[ -n <span class="va">$ZLE_USE_MOUSE</span> ]]; then</a>
<a class="sourceLine" id="cb7-260" title="260">      print -n <span class="st">&#39;\e[?1000h&#39;</span></a>
<a class="sourceLine" id="cb7-261" title="261">    else</a>
<a class="sourceLine" id="cb7-262" title="262">      print -n <span class="st">&#39;\e[?1000l&#39;</span></a>
<a class="sourceLine" id="cb7-263" title="263">    fi</a>
<a class="sourceLine" id="cb7-264" title="264">      fi</a>
<a class="sourceLine" id="cb7-265" title="265">    }</a>
<a class="sourceLine" id="cb7-266" title="266"></a>
<a class="sourceLine" id="cb7-267" title="267">    if [[ <span class="va">$functions[precmd]</span> != *ZLE_USE_MOUSE* ]]; then</a>
<a class="sourceLine" id="cb7-268" title="268">      functions[precmd]+=<span class="st">&#39;</span></a>
<a class="sourceLine" id="cb7-269" title="269"><span class="st">      [[ -n $ZLE_USE_MOUSE ]] &amp;&amp; print -n &#39;</span><span class="dt">\&#39;</span><span class="st">&#39;\e[?1000h&#39;</span><span class="dt">\&#39;</span></a>
<a class="sourceLine" id="cb7-270" title="270">    fi</a>
<a class="sourceLine" id="cb7-271" title="271">    if [[ <span class="va">$functions[preexec]</span> != *ZLE_USE_MOUSE* ]]; then</a>
<a class="sourceLine" id="cb7-272" title="272">      functions[preexec]+=<span class="st">&#39;</span></a>
<a class="sourceLine" id="cb7-273" title="273"><span class="st">      [[ -n $ZLE_USE_MOUSE ]] &amp;&amp; print -n &#39;</span><span class="dt">\&#39;</span><span class="st">&#39;\e[?1000l&#39;</span><span class="dt">\&#39;</span></a>
<a class="sourceLine" id="cb7-274" title="274">    fi</a>
<a class="sourceLine" id="cb7-275" title="275"></a>
<a class="sourceLine" id="cb7-276" title="276">    bindkey -M emacs <span class="st">&#39;\e[M&#39;</span> handle-xterm-mouse-event</a>
<a class="sourceLine" id="cb7-277" title="277">    bindkey -M viins <span class="st">&#39;\e[M&#39;</span> handle-xterm-mouse-event</a>
<a class="sourceLine" id="cb7-278" title="278">    bindkey -M vicmd <span class="st">&#39;\e[M&#39;</span> handle-xterm-mouse-event</a>
<a class="sourceLine" id="cb7-279" title="279"></a>
<a class="sourceLine" id="cb7-280" title="280">    if [[ <span class="va">$TERM</span> = *Eterm* ]]; then</a>
<a class="sourceLine" id="cb7-281" title="281">      <span class="co"># Eterm sends \e[5Mxxxxx on drag events, be want to discard them</span></a>
<a class="sourceLine" id="cb7-282" title="282">      discard-mouse-drag() {</a>
<a class="sourceLine" id="cb7-283" title="283">        local junk</a>
<a class="sourceLine" id="cb7-284" title="284">        read -k5 junk</a>
<a class="sourceLine" id="cb7-285" title="285">      }</a>
<a class="sourceLine" id="cb7-286" title="286">      zle -N discard-mouse-drag</a>
<a class="sourceLine" id="cb7-287" title="287">      bindkey -M emacs <span class="st">&#39;\e[5M&#39;</span> discard-mouse-drag</a>
<a class="sourceLine" id="cb7-288" title="288">      bindkey -M viins <span class="st">&#39;\e[5M&#39;</span> discard-mouse-drag</a>
<a class="sourceLine" id="cb7-289" title="289">      bindkey -M vicmd <span class="st">&#39;\e[5M&#39;</span> discard-mouse-drag</a>
<a class="sourceLine" id="cb7-290" title="290">    fi</a>
<a class="sourceLine" id="cb7-291" title="291">  fi</a>
<a class="sourceLine" id="cb7-292" title="292"></a>
<a class="sourceLine" id="cb7-293" title="293">fi</a></code></pre></div>
</body>
</html>
