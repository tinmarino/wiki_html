<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Sql_top_100.md – Sql &lt;- StackOverflow top 100</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        background-color: #232629;
        color: #7a7c7d;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #7a7c7d;  padding-left: 4px; }
    div.sourceCode
      { color: #cfcfc2; background-color: #232629; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span. { color: #cfcfc2; } /* Normal */
    code span.al { color: #95da4c; background-color: #4d1f24; font-weight: bold; } /* Alert */
    code span.an { color: #3f8058; } /* Annotation */
    code span.at { color: #2980b9; } /* Attribute */
    code span.bn { color: #f67400; } /* BaseN */
    code span.bu { color: #7f8c8d; } /* BuiltIn */
    code span.cf { color: #fdbc4b; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #3daee9; } /* Char */
    code span.cn { color: #27aeae; font-weight: bold; } /* Constant */
    code span.co { color: #7a7c7d; } /* Comment */
    code span.cv { color: #7f8c8d; } /* CommentVar */
    code span.do { color: #a43340; } /* Documentation */
    code span.dt { color: #2980b9; } /* DataType */
    code span.dv { color: #f67400; } /* DecVal */
    code span.er { color: #da4453; text-decoration: underline; } /* Error */
    code span.ex { color: #0099ff; font-weight: bold; } /* Extension */
    code span.fl { color: #f67400; } /* Float */
    code span.fu { color: #8e44ad; } /* Function */
    code span.im { color: #27ae60; } /* Import */
    code span.in { color: #c45b00; } /* Information */
    code span.kw { color: #cfcfc2; font-weight: bold; } /* Keyword */
    code span.op { color: #cfcfc2; } /* Operator */
    code span.ot { color: #27ae60; } /* Other */
    code span.pp { color: #27ae60; } /* Preprocessor */
    code span.re { color: #2980b9; background-color: #153042; } /* RegionMarker */
    code span.sc { color: #3daee9; } /* SpecialChar */
    code span.ss { color: #da4453; } /* SpecialString */
    code span.st { color: #f44f4f; } /* String */
    code span.va { color: #27aeae; } /* Variable */
    code span.vs { color: #da4453; } /* VerbatimString */
    code span.wa { color: #da4453; } /* Warning */
  </style>
  <link rel="stylesheet" href="../Css/color_dark_solarized.css" />
  <link rel="stylesheet" href="../Css/layout_toc.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script type="text/javascript" src="../Css/js_masonry_desandro.js"></script>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Sql &lt;- StackOverflow top 100</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#how-do-i-update-from-a-select-in-sql-server-score-4028296-in-2019">1: How do I UPDATE from a SELECT in SQL Server? (score <span>4028296</span> in 2019)</a></li>
<li><a href="#how-do-i-perform-an-ifthen-in-an-sql-select-score-3492496-in-2018">2: How do I perform an IF…THEN in an SQL SELECT? (score <span>3492496</span> in 2018)</a></li>
<li><a href="#or-is-not-supported-with-case-statement-in-sql-server-score-2977623-in-2019">3: OR is not supported with CASE Statement in SQL Server (score <span>2977623</span> in 2019)</a></li>
<li><a href="#how-do-i-import-an-sql-file-using-the-command-line-in-mysql-score-2945526-in-2019">4: How do I import an SQL file using the command line in MySQL? (score <span>2945526</span> in 2019)</a></li>
<li><a href="#add-a-column-with-a-default-value-to-an-existing-table-in-sql-server-score-2693765-in-2018">5: Add a column with a default value to an existing table in SQL Server (score <span>2693765</span> in 2018)</a></li>
<li><a href="#how-to-return-only-the-date-from-a-sql-server-datetime-datatype-score-2620097-in-2017">6: How to return only the Date from a SQL Server DateTime datatype (score <span>2620097</span> in 2017)</a></li>
<li><a href="#finding-duplicate-values-in-a-sql-table-score-2602064-in-2019">7: Finding duplicate values in a SQL table (score <span>2602064</span> in 2019)</a></li>
<li><a href="#inserting-multiple-rows-in-a-single-sql-query-score-2497025-in-2019">8: Inserting multiple rows in a single SQL query? (score <span>2497025</span> in 2019)</a></li>
<li><a href="#insert-into-values-select-from-score-2393511-in-2018">9: Insert into … values ( SELECT … FROM … ) (score <span>2393511</span> in 2018)</a></li>
<li><a href="#what-is-the-difference-between-inner-join-and-outer-join-score-2264024-in-2019">10: What is the difference between “INNER JOIN” and “OUTER JOIN”? (score <span>2264024</span> in 2019)</a></li>
<li><a href="#how-to-concatenate-text-from-multiple-rows-into-a-single-text-string-in-sql-server-score-2175107-in-2018">11: How to concatenate text from multiple rows into a single text string in SQL server? (score <span>2175107</span> in 2018)</a></li>
<li><a href="#get-list-of-all-tables-in-oracle-score-2096870-in-2015">12: Get list of all tables in Oracle? (score <span>2096870</span> in 2015)</a></li>
<li><a href="#find-all-tables-containing-column-with-specified-name---ms-sql-server-score-1904000-in-2018">13: Find all tables containing column with specified name - MS SQL Server (score <span>1904000</span> in 2018)</a></li>
<li><a href="#insert-results-of-a-stored-procedure-into-a-temporary-table-score-1868029-in-2018">14: Insert results of a stored procedure into a temporary table (score <span>1868029</span> in 2018)</a></li>
<li><a href="#sql-select-where-field-contains-words-score-1644153-in-2017">15: SQL SELECT WHERE field contains words (score <span>1644153</span> in 2017)</a></li>
<li><a href="#how-can-i-prevent-sql-injection-in-php-score-1643165-in-2016">16: How can I prevent SQL injection in PHP? (score <span>1643165</span> in 2016)</a></li>
<li><a href="#sql-update-from-one-table-to-another-based-on-a-id-match-score-1639088-in-2018">17: SQL update from one Table to another based on a ID match (score <span>1639088</span> in 2018)</a></li>
<li><a href="#sql-query-to-select-dates-between-two-dates-score-1619137-in-2017">18: SQL query to select dates between two dates (score <span>1619137</span> in 2017)</a></li>
<li><a href="#how-can-i-get-column-names-from-a-table-in-sql-server-score-1538227-in-2017">19: How can I get column names from a table in SQL Server? (score <span>1538227</span> in 2017)</a></li>
<li><a href="#how-can-i-do-an-update-statement-with-join-in-sql-score-1502329-in-2018">20: How can I do an UPDATE statement with JOIN in SQL? (score <span>1502329</span> in 2018)</a></li>
<li><a href="#how-can-i-select-rows-with-maxcolumn-value-distinct-by-another-column-in-sql-score-1406300-in-2018">21: How can I SELECT rows with MAX(Column value), DISTINCT by another column in SQL? (score <span>1406300</span> in 2018)</a></li>
<li><a href="#how-to-convert-datetime-to-varchar-score-1396857-in-2015">22: How to convert DateTime to VarChar (score <span>1396857</span> in 2015)</a></li>
<li><a href="#not-in-vs-not-exists-score-1367238-in-2012">23: NOT IN vs NOT EXISTS (score <span>1367238</span> in 2012)</a></li>
<li><a href="#if-in-select-statement---choose-output-value-based-on-column-values-score-1331519-in-2015">24: ‘IF’ in ‘SELECT’ statement - choose output value based on column values (score <span>1331519</span> in 2015)</a></li>
<li><a href="#whats-the-difference-between-inner-join-left-join-right-join-and-full-join-score-1324680-in-2018">25: What’s the difference between INNER JOIN, LEFT JOIN, RIGHT JOIN and FULL JOIN? (score <span>1324680</span> in 2018)</a></li>
<li><a href="#how-do-i-limit-the-number-of-rows-returned-by-an-oracle-query-after-ordering-score-1310688-in-2018">26: How do I limit the number of rows returned by an Oracle query after ordering? (score <span>1310688</span> in 2018)</a></li>
<li><a href="#what-is-the-difference-between-union-and-union-all-score-1265525-in-2018">27: What is the difference between UNION and UNION ALL? (score <span>1265525</span> in 2018)</a></li>
<li><a href="#search-text-in-stored-procedure-in-sql-server-score-1248594-in-2018">28: Search text in stored procedure in SQL Server (score <span>1248594</span> in 2018)</a></li>
<li><a href="#how-to-delete-using-inner-join-with-sql-server-score-1236813-in-2018">29: How to Delete using INNER JOIN with SQL Server? (score <span>1236813</span> in 2018)</a></li>
<li><a href="#sql-inner-join-with-3-tables-score-1220486-in-2019">30: SQL Inner-join with 3 tables? (score <span>1220486</span> in 2019)</a></li>
<li><a href="#how-to-reset-auto_increment-in-mysql-score-1163265-in-2018">31: How to reset AUTO_INCREMENT in MySQL? (score <span>1163265</span> in 2018)</a></li>
<li><a href="#convert-int-to-varchar-sql-score-1158597-in-2015">32: Convert INT to VARCHAR SQL (score <span>1158597</span> in 2015)</a></li>
<li><a href="#how-to-create-temp-table-with-select-into-temptable-from-cte-query-score-1073684-in-2013">33: How to create Temp table with SELECT * INTO tempTable FROM CTE Query (score <span>1073684</span> in 2013)</a></li>
<li><a href="#rename-column-sql-server-2008-score-1064792-in-2018">34: Rename column SQL Server 2008 (score <span>1064792</span> in 2018)</a></li>
<li><a href="#get-all-table-names-of-a-particular-database-by-sql-query-score-1044124-in-2016">35: Get all table names of a particular database by SQL query? (score <span>1044124</span> in 2016)</a></li>
<li><a href="#sql-select-only-rows-with-max-value-on-a-column-score-1041887-in-2019">36: SQL select only rows with max value on a column (score <span>1041887</span> in 2019)</a></li>
<li><a href="#should-i-use-or-for-not-equal-in-t-sql-score-1016642-in-2018">37: Should I use != or &lt;&gt; for not equal in T-SQL? (score <span>1016642</span> in 2018)</a></li>
<li><a href="#how-do-i-escape-a-single-quote-in-sql-server-score-1006028-in-2019">38: How do I escape a single quote in SQL Server? (score <span>1006028</span> in 2019)</a></li>
<li><a href="#how-do-i-query-for-all-dates-greater-than-a-certain-date-in-sql-server-score-968312-in-2018">39: How do I query for all dates greater than a certain date in SQL Server? (score <span>968312</span> in 2018)</a></li>
<li><a href="#using-group-by-on-multiple-columns-score-950952-in-2018">40: Using group by on multiple columns (score <span>950952</span> in 2018)</a></li>
<li><a href="#how-to-list-the-tables-in-a-sqlite-database-file-that-was-opened-with-attach-score-950088-in-2019">41: How to list the tables in a SQLite database file that was opened with ATTACH? (score <span>950088</span> in 2019)</a></li>
<li><a href="#convert-month-number-to-month-name-function-in-sql-score-931125-in-2012">42: Convert Month Number to Month Name Function in SQL (score <span>931125</span> in 2012)</a></li>
<li><a href="#select-first-row-in-each-group-by-group-score-921853-in-2018">43: Select first row in each GROUP BY group? (score <span>921853</span> in 2018)</a></li>
<li><a href="#how-to-insert-a-line-break-in-a-sql-server-varcharnvarchar-string-score-920209-in-2013">44: How to insert a line break in a SQL Server VARCHAR/NVARCHAR string (score <span>920209</span> in 2013)</a></li>
<li><a href="#how-do-i-see-active-sql-server-connections-score-917310-in-2019">45: How do I see active SQL Server connections? (score <span>917310</span> in 2019)</a></li>
<li><a href="#getting-only-month-and-year-from-sql-date-score-894623-in-2018">46: Getting only Month and Year from SQL DATE (score <span>894623</span> in 2018)</a></li>
<li><a href="#how-to-query-mongodb-with-like-score-894279-in-2019">47: How to query MongoDB with “like”? (score <span>894279</span> in 2019)</a></li>
<li><a href="#convert-date-format-into-ddmmmyyyy-format-in-sql-server-score-891524-in-2016">48: Convert Date format into DD/MMM/YYYY format in SQL Server (score <span>891524</span> in 2016)</a></li>
<li><a href="#oracle-sql-update-a-table-with-data-from-another-table-score-884573-in-2017">49: Oracle SQL: Update a table with data from another table (score <span>884573</span> in 2017)</a></li>
<li><a href="#reset-identity-seed-after-deleting-records-in-sql-server-score-884214-in-2016">50: Reset identity seed after deleting records in SQL Server (score <span>884214</span> in 2016)</a></li>
<li><a href="#how-to-create-id-with-auto_increment-on-oracle-score-874399-in-2017">51: How to create id with AUTO_INCREMENT on Oracle? (score <span>874399</span> in 2017)</a></li>
<li><a href="#how-to-turn-identity_insert-on-and-off-using-sql-server-2008-score-872201-in-2013">52: How to turn IDENTITY_INSERT on and off using SQL Server 2008? (score <span>872201</span> in 2013)</a></li>
<li><a href="#sql-server-query---selecting-count-with-distinct-score-856305-in-2019">53: SQL Server query - Selecting COUNT(*) with DISTINCT (score <span>856305</span> in 2019)</a></li>
<li><a href="#how-do-i-or-can-i-select-distinct-on-multiple-columns-score-850430-in-2014">54: How do I (or can I) SELECT DISTINCT on multiple columns? (score <span>850430</span> in 2014)</a></li>
<li><a href="#sql-update-query-using-joins-score-847493-in-2014">55: SQL update query using joins (score <span>847493</span> in 2014)</a></li>
<li><a href="#how-to-find-third-or-nth-maximum-salary-from-salary-table-score-839668-in-2015">56: How to find third or nth maximum salary from salary table? (score <span>839668</span> in 2015)</a></li>
<li><a href="#sql-query-to-insert-datetime-in-sql-server-score-835603-in-2018">57: Sql query to insert datetime in SQL Server (score <span>835603</span> in 2018)</a></li>
<li><a href="#how-to-create-a-table-from-select-query-result-in-sql-server-2008-score-827650-in-2013">58: How to create a table from select query result in SQL Server 2008 (score <span>827650</span> in 2013)</a></li>
<li><a href="#how-do-i-split-a-string-so-i-can-access-item-x-score-817330-in-2018">59: How do I split a string so I can access item x? (score <span>817330</span> in 2018)</a></li>
<li><a href="#copy-tables-from-one-database-to-another-in-sql-server-score-814936-in-2013">60: Copy tables from one database to another in SQL Server (score <span>814936</span> in 2013)</a></li>
<li><a href="#sql-server---select-from-stored-procedure-score-813645-in-2012">61: SQL Server - SELECT FROM stored procedure (score <span>813645</span> in 2012)</a></li>
<li><a href="#adding-an-identity-to-an-existing-column-score-807332-in-2011">62: Adding an identity to an existing column (score <span>807332</span> in 2011)</a></li>
<li><a href="#how-does-database-indexing-work-score-804940-in-2018">63: How does database indexing work? (score <span>804940</span> in 2018)</a></li>
<li><a href="#sqlmysql---select-distinctunique-but-return-all-columns-score-797787-in-2015">64: SQL/mysql - Select distinct/UNIQUE but return all columns? (score <span>797787</span> in 2015)</a></li>
<li><a href="#sql-with-clause-example-score-797102-in-2017">65: SQL WITH clause example (score <span>797102</span> in 2017)</a></li>
<li><a href="#how-do-i-restore-a-dump-file-from-mysqldump-score-793050-in-2018">66: How do I restore a dump file from mysqldump? (score <span>793050</span> in 2018)</a></li>
<li><a href="#how-do-i-use-row_number-score-792545-in-2013">67: How do I use ROW_NUMBER()? (score <span>792545</span> in 2013)</a></li>
<li><a href="#sql-multiple-column-ordering-score-790109-in-2015">69: SQL multiple column ordering (score <span>790109</span> in 2015)</a></li>
<li><a href="#efficiently-convert-rows-to-columns-in-sql-server-score-785265-in-2018">70: Efficiently convert rows to columns in sql server (score <span>785265</span> in 2018)</a></li>
<li><a href="#best-way-to-get-identity-of-inserted-row-score-784594-in-2018">71: Best way to get identity of inserted row? (score <span>784594</span> in 2018)</a></li>
<li><a href="#case-statement-within-where-clause-in-sql-server-2008-score-782209-in-2012">72: “CASE” statement within “WHERE” clause in SQL Server 2008 (score <span>782209</span> in 2012)</a></li>
<li><a href="#how-to-delete-duplicate-rows-in-sql-server-score-779227-in-2019">73: How to delete duplicate rows in SQL Server? (score <span>779227</span> in 2019)</a></li>
<li><a href="#update-and-replace-part-of-a-string-score-777842-in-2015">74: UPDATE and REPLACE part of a string (score <span>777842</span> in 2015)</a></li>
<li><a href="#convert-rows-to-columns-using-pivot-in-sql-server-score-777059-in-2019">75: Convert Rows to columns using ‘Pivot’ in SQL Server (score <span>777059</span> in 2019)</a></li>
<li><a href="#sql-query-return-data-from-multiple-tables-score-775509-in-2018">76: SQL query return data from multiple tables (score <span>775509</span> in 2018)</a></li>
<li><a href="#how-do-i-set-a-column-value-to-null-in-sql-server-management-studio-score-774030-in-2019">77: How do I set a column value to NULL in SQL Server Management Studio? (score <span>774030</span> in 2019)</a></li>
<li><a href="#how-to-calculate-percentage-with-a-sql-statement-score-771868-in-2013">78: How to calculate percentage with a SQL statement (score <span>771868</span> in 2013)</a></li>
<li><a href="#conversion-failed-when-converting-date-andor-time-from-character-string-while-inserting-datetime-score-771777-in-2013">79: Conversion failed when converting date and/or time from character string while inserting datetime (score <span>771777</span> in 2013)</a></li>
<li><a href="#insert-into-a-mysql-table-or-update-if-exists-score-762170-in-2019">80: Insert into a MySQL table or update if exists (score <span>762170</span> in 2019)</a></li>
<li><a href="#how-to-replace-a-string-in-a-sql-server-table-column-score-755845-in-2018">81: How to replace a string in a SQL Server Table Column (score <span>755845</span> in 2018)</a></li>
<li><a href="#sql-if-clause-within-where-clause-score-754551-in-2008">82: SQL: IF clause within WHERE clause (score <span>754551</span> in 2008)</a></li>
<li><a href="#sql-error-ora-01722-invalid-number-score-751360-in-2018">83: SQL error “ORA-01722: invalid number” (score <span>751360</span> in 2018)</a></li>
<li><a href="#how-to-avoid-the-divide-by-zero-error-in-sql-score-744505-in-2018">84: How to avoid the “divide by zero” error in SQL? (score <span>744505</span> in 2018)</a></li>
<li><a href="#select-statement-to-find-duplicates-on-certain-fields-score-743636-in-2014">85: Select statement to find duplicates on certain fields (score <span>743636</span> in 2014)</a></li>
<li><a href="#case-in-select-statement-score-742394-in-2013">86: Case in Select Statement (score <span>742394</span> in 2013)</a></li>
<li><a href="#sql-server-select-into-variable-score-742086-in-2011">87: SQL Server SELECT INTO <span class="citation" data-cites="variable">@variable</span>? (score <span>742086</span> in 2011)</a></li>
<li><a href="#inserting-data-into-a-temporary-table-score-737037-in">88: Inserting data into a temporary table (score <span>737037</span> in )</a></li>
<li><a href="#how-do-i-do-multiple-case-when-conditions-using-sql-server-2008-score-736058-in-2017">89: How do I do multiple CASE WHEN conditions using SQL Server 2008? (score <span>736058</span> in 2017)</a></li>
<li><a href="#write-a-number-with-two-decimal-places-sql-server-score-733058-in-2013">90: Write a number with two decimal places SQL server (score <span>733058</span> in 2013)</a></li>
<li><a href="#remove-all-spaces-from-a-string-in-sql-server-score-729620-in-2018">91: Remove all spaces from a string in SQL Server (score <span>729620</span> in 2018)</a></li>
<li><a href="#error-string-or-binary-data-would-be-truncated-when-trying-to-insert-score-726384-in-2017">92: error, string or binary data would be truncated when trying to insert (score <span>726384</span> in 2017)</a></li>
<li><a href="#how-to-select-all-records-from-one-table-that-do-not-exist-in-another-table-score-725294-in-2013">93: How to select all records from one table that do not exist in another table? (score <span>725294</span> in 2013)</a></li>
<li><a href="#mysql-query-string-contains-score-721783-in-2017">94: MySQL query String contains (score <span>721783</span> in 2017)</a></li>
<li><a href="#oracle-select-top-10-records-score-720286-in-2017">95: Oracle SELECT TOP 10 records (score <span>720286</span> in 2017)</a></li>
<li><a href="#pad-a-string-with-leading-zeros-so-its-3-characters-long-in-sql-server-2008-score-718842-in-2015">96: Pad a string with leading zeros so it’s 3 characters long in SQL Server 2008 (score <span>718842</span> in 2015)</a></li>
<li><a href="#best-approach-to-remove-time-part-of-datetime-in-sql-server-score-715443-in-2011">97: Best approach to remove time part of datetime in SQL Server (score <span>715443</span> in 2011)</a></li>
<li><a href="#the-multi-part-identifier-could-not-be-bound-score-713638-in-2016">98: The multi-part identifier could not be bound (score <span>713638</span> in 2016)</a></li>
<li><a href="#get-month-and-year-from-a-datetime-in-sql-server-2005-score-711888-in-2017">99: Get month and year from a datetime in SQL Server 2005 (score <span>711888</span> in 2017)</a></li>
<li><a href="#how-do-i-list-all-the-columns-in-a-table-score-710519-in">100: How do I list all the columns in a table? (score <span>710519</span> in )</a></li>
</ul>
</nav>
<section class="level2">
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
<section id="how-do-i-update-from-a-select-in-sql-server-score-4028296-in-2019" class="level3">
<h3>1: How do I UPDATE from a SELECT in SQL Server? (score <a href="https://stackoverflow.com/q/2334712.html">4028296</a> in 2019)</h3>
<section id="question" class="level4">
<h4>Question</h4>
<p>In <strong>SQL Server</strong>, it’s possible to <code>insert</code> into a table using a <code>SELECT</code> statement:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> <span class="kw">Table</span> (col1, col2, col3)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">SELECT</span> col1, col2, col3 </span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">FROM</span> other_table </span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">WHERE</span> sql <span class="op">=</span> <span class="st">&#39;cool&#39;</span></span></code></pre></div>
<p>Is it also possible to <em>update</em> via a <code>SELECT</code>? I have a temporary table containing the values and would like to update another table using those values. Perhaps something like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">UPDATE</span> <span class="kw">Table</span> <span class="kw">SET</span> col1, col2</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw">SELECT</span> col1, col2 </span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">FROM</span> other_table </span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="kw">WHERE</span> sql <span class="op">=</span> <span class="st">&#39;cool&#39;</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="kw">WHERE</span> <span class="kw">Table</span>.<span class="kw">id</span> <span class="op">=</span> other_table.<span class="kw">id</span></span></code></pre></div>
</section>
<section id="answer-accepted-score-5105" class="level4">
<h4>Answer accepted (score 5105)</h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">UPDATE</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>    Table_A</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="kw">SET</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>    Table_A.col1 <span class="op">=</span> Table_B.col1,</span>
<span id="cb3-5"><a href="#cb3-5"></a>    Table_A.col2 <span class="op">=</span> Table_B.col2</span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="kw">FROM</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>    Some_Table <span class="kw">AS</span> Table_A</span>
<span id="cb3-8"><a href="#cb3-8"></a>    <span class="kw">INNER</span> <span class="kw">JOIN</span> Other_Table <span class="kw">AS</span> Table_B</span>
<span id="cb3-9"><a href="#cb3-9"></a>        <span class="kw">ON</span> Table_A.<span class="kw">id</span> <span class="op">=</span> Table_B.<span class="kw">id</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="kw">WHERE</span></span>
<span id="cb3-11"><a href="#cb3-11"></a>    Table_A.col3 <span class="op">=</span> <span class="st">&#39;cool&#39;</span></span></code></pre></div>
</section>
<section id="answer-2-score-737" class="level4">
<h4>Answer 2 (score 737)</h4>
<p>In SQL Server 2008 (or better), use <a href="http://technet.microsoft.com/en-us/library/bb510625.aspx" rel="noreferrer"><code>MERGE</code></a></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">MERGE</span> <span class="kw">INTO</span> YourTable T</span>
<span id="cb4-2"><a href="#cb4-2"></a>   <span class="kw">USING</span> other_table S </span>
<span id="cb4-3"><a href="#cb4-3"></a>      <span class="kw">ON</span> T.<span class="kw">id</span> <span class="op">=</span> S.<span class="kw">id</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>         <span class="kw">AND</span> S.tsql <span class="op">=</span> <span class="st">&#39;cool&#39;</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="cf">WHEN</span> MATCHED <span class="cf">THEN</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>   <span class="kw">UPDATE</span> </span>
<span id="cb4-7"><a href="#cb4-7"></a>      <span class="kw">SET</span> col1 <span class="op">=</span> S.col1, </span>
<span id="cb4-8"><a href="#cb4-8"></a>          col2 <span class="op">=</span> S.col2;</span></code></pre></div>
<p>Alternatively:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">MERGE</span> <span class="kw">INTO</span> YourTable T</span>
<span id="cb5-2"><a href="#cb5-2"></a>   <span class="kw">USING</span> (</span>
<span id="cb5-3"><a href="#cb5-3"></a>          <span class="kw">SELECT</span> <span class="kw">id</span>, col1, col2 </span>
<span id="cb5-4"><a href="#cb5-4"></a>            <span class="kw">FROM</span> other_table </span>
<span id="cb5-5"><a href="#cb5-5"></a>           <span class="kw">WHERE</span> tsql <span class="op">=</span> <span class="st">&#39;cool&#39;</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>         ) S</span>
<span id="cb5-7"><a href="#cb5-7"></a>      <span class="kw">ON</span> T.<span class="kw">id</span> <span class="op">=</span> S.<span class="kw">id</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="cf">WHEN</span> MATCHED <span class="cf">THEN</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>   <span class="kw">UPDATE</span> </span>
<span id="cb5-10"><a href="#cb5-10"></a>      <span class="kw">SET</span> col1 <span class="op">=</span> S.col1, </span>
<span id="cb5-11"><a href="#cb5-11"></a>          col2 <span class="op">=</span> S.col2;</span></code></pre></div>
</section>
<section id="answer-3-score-616" class="level4">
<h4>Answer 3 (score 616)</h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">UPDATE</span> <span class="kw">table</span> </span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">SET</span> Col1 <span class="op">=</span> i.Col1, </span>
<span id="cb6-3"><a href="#cb6-3"></a>    Col2 <span class="op">=</span> i.Col2 </span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="kw">FROM</span> (</span>
<span id="cb6-5"><a href="#cb6-5"></a>    <span class="kw">SELECT</span> <span class="kw">ID</span>, Col1, Col2 </span>
<span id="cb6-6"><a href="#cb6-6"></a>    <span class="kw">FROM</span> other_table) i</span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="kw">WHERE</span> </span>
<span id="cb6-8"><a href="#cb6-8"></a>    i.<span class="kw">ID</span> <span class="op">=</span> <span class="kw">table</span>.<span class="kw">ID</span></span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-do-i-perform-an-ifthen-in-an-sql-select-score-3492496-in-2018" class="level3">
<h3>2: How do I perform an IF…THEN in an SQL SELECT? (score <a href="https://stackoverflow.com/q/63447.html">3492496</a> in 2018)</h3>
<section id="question-1" class="level4">
<h4>Question</h4>
<p>How do I perform an <code>IF...THEN</code> in an <code>SQL SELECT</code> statement?</p>
<p>For example:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">SELECT</span> <span class="cf">IF</span>(Obsolete <span class="op">=</span> <span class="st">&#39;N&#39;</span> <span class="kw">OR</span> InStock <span class="op">=</span> <span class="st">&#39;Y&#39;</span> ? <span class="dv">1</span> : <span class="dv">0</span>) <span class="kw">AS</span> Saleable, <span class="op">*</span> <span class="kw">FROM</span> Product</span></code></pre></div>
</section>
<section id="answer-accepted-score-1679" class="level4">
<h4>Answer accepted (score 1679)</h4>
<p>The <code>CASE</code> statement is the closest to IF in SQL and is supported on all versions of SQL Server.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">SELECT</span> <span class="fu">CAST</span>(</span>
<span id="cb8-2"><a href="#cb8-2"></a>             <span class="cf">CASE</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>                  <span class="cf">WHEN</span> Obsolete <span class="op">=</span> <span class="st">&#39;N&#39;</span> <span class="kw">or</span> InStock <span class="op">=</span> <span class="st">&#39;Y&#39;</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>                     <span class="cf">THEN</span> <span class="dv">1</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>                  <span class="cf">ELSE</span> <span class="dv">0</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>             <span class="cf">END</span> <span class="kw">AS</span> bit) <span class="kw">as</span> Saleable, <span class="op">*</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="kw">FROM</span> Product</span></code></pre></div>
<p>You only need to do the <code>CAST</code> if you want the result as a Boolean value. If you are happy with an <code>int</code>, this works:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">SELECT</span> <span class="cf">CASE</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>            <span class="cf">WHEN</span> Obsolete <span class="op">=</span> <span class="st">&#39;N&#39;</span> <span class="kw">or</span> InStock <span class="op">=</span> <span class="st">&#39;Y&#39;</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>               <span class="cf">THEN</span> <span class="dv">1</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>               <span class="cf">ELSE</span> <span class="dv">0</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>       <span class="cf">END</span> <span class="kw">as</span> Saleable, <span class="op">*</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="kw">FROM</span> Product</span></code></pre></div>
<p><code>CASE</code> statements can be embedded in other <code>CASE</code> statements and even included in aggregates.</p>
<p>SQL Server Denali (SQL Server 2012) adds the <a href="http://msdn.microsoft.com/en-us/library/hh213574%28v=sql.110%29.aspx" rel="noreferrer">IIF</a> statement which is also available in <a href="http://www.techonthenet.com/access/functions/advanced/iif.php" rel="noreferrer">access</a> (pointed out by <a href="https://stackoverflow.com/questions/63447/how-do-you-perform-an-if-then-in-an-sql-select/6769805#6769805">Martin Smith</a>):</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">SELECT</span> IIF(Obsolete <span class="op">=</span> <span class="st">&#39;N&#39;</span> <span class="kw">or</span> InStock <span class="op">=</span> <span class="st">&#39;Y&#39;</span>, <span class="dv">1</span>, <span class="dv">0</span>) <span class="kw">as</span> Saleable, <span class="op">*</span> <span class="kw">FROM</span> Product</span></code></pre></div>
</section>
<section id="answer-2-score-317" class="level4">
<h4>Answer 2 (score 317)</h4>
<p>The case statement is your friend in this situation, and takes one of two forms:</p>
<p>The simple case:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">SELECT</span> <span class="cf">CASE</span> <span class="op">&lt;</span>variable<span class="op">&gt;</span> <span class="cf">WHEN</span> <span class="op">&lt;</span><span class="fu">value</span><span class="op">&gt;</span>      <span class="cf">THEN</span> <span class="op">&lt;</span>returnvalue<span class="op">&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>                       <span class="cf">WHEN</span> <span class="op">&lt;</span>othervalue<span class="op">&gt;</span> <span class="cf">THEN</span> <span class="op">&lt;</span>returnthis<span class="op">&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>                                         <span class="cf">ELSE</span> <span class="op">&lt;</span>returndefaultcase<span class="op">&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>       <span class="cf">END</span> <span class="kw">AS</span> <span class="op">&lt;</span>newcolumnname<span class="op">&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="kw">FROM</span> <span class="op">&lt;</span><span class="kw">table</span><span class="op">&gt;</span></span></code></pre></div>
<p>The extended case:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">SELECT</span> <span class="cf">CASE</span> <span class="cf">WHEN</span> <span class="op">&lt;</span>test<span class="op">&gt;</span>      <span class="cf">THEN</span> <span class="op">&lt;</span>returnvalue<span class="op">&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>            <span class="cf">WHEN</span> <span class="op">&lt;</span>othertest<span class="op">&gt;</span> <span class="cf">THEN</span> <span class="op">&lt;</span>returnthis<span class="op">&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>                             <span class="cf">ELSE</span> <span class="op">&lt;</span>returndefaultcase<span class="op">&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>       <span class="cf">END</span> <span class="kw">AS</span> <span class="op">&lt;</span>newcolumnname<span class="op">&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="kw">FROM</span> <span class="op">&lt;</span><span class="kw">table</span><span class="op">&gt;</span></span></code></pre></div>
<p>You can even put case statements in an order by clause for really fancy ordering.</p>
</section>
<section id="answer-3-score-258" class="level4">
<h4>Answer 3 (score 258)</h4>
<p>From SQL Server 2012 you can use the <a href="http://msdn.microsoft.com/en-us/library/hh213574(v=sql.110).aspx" rel="noreferrer"><strong><code>IIF</code></strong> function</a> for this.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw">SELECT</span> IIF(Obsolete <span class="op">=</span> <span class="st">&#39;N&#39;</span> <span class="kw">OR</span> InStock <span class="op">=</span> <span class="st">&#39;Y&#39;</span>, <span class="dv">1</span>, <span class="dv">0</span>) <span class="kw">AS</span> Salable, <span class="op">*</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="kw">FROM</span>   Product</span></code></pre></div>
<p>This is effectively just a shorthand (albeit not standard SQL) way of writing <code>CASE</code>.</p>
<p>I prefer the conciseness when compared with the expanded <code>CASE</code> version.</p>
<p>Both <code>IIF()</code> and <code>CASE</code> resolve as expressions within a SQL statement and can only be used in well-defined places.</p>
<blockquote>
<p>
The CASE expression cannot be used to control the flow of execution of Transact-SQL statements, statement blocks, user-defined functions, and stored procedures.
</p>
</blockquote>
<p>If your needs can not be satisfied by these limitations (for example, a need to return differently shaped result sets dependent on some condition) then SQL Server does also have a procedural <a href="http://msdn.microsoft.com/en-gb/library/ms182717.aspx" rel="noreferrer"><code>IF</code></a> keyword.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1"></a><span class="cf">IF</span> @IncludeExtendedInformation <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="cf">BEGIN</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>      <span class="kw">SELECT</span> A,B,C,X,Y,Z</span>
<span id="cb14-4"><a href="#cb14-4"></a>      <span class="kw">FROM</span>   T</span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="cf">END</span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="cf">ELSE</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>  <span class="cf">BEGIN</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>      <span class="kw">SELECT</span> A,B,C</span>
<span id="cb14-9"><a href="#cb14-9"></a>      <span class="kw">FROM</span>   T</span>
<span id="cb14-10"><a href="#cb14-10"></a>  <span class="cf">END</span></span></code></pre></div>
<p><a href="https://dba.stackexchange.com/a/9874/3690">Care must sometimes be taken to avoid parameter sniffing issues with this approach however</a>.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="or-is-not-supported-with-case-statement-in-sql-server-score-2977623-in-2019" class="level3">
<h3>3: OR is not supported with CASE Statement in SQL Server (score <a href="https://stackoverflow.com/q/5487892.html">2977623</a> in 2019)</h3>
<section id="question-2" class="level4">
<h4>Question</h4>
<p>The <code>OR</code> operator in the <code>WHEN</code> clause of a <code>CASE</code> statement is not supported. How can I do this?</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1"></a><span class="cf">CASE</span> ebv.db_no </span>
<span id="cb15-2"><a href="#cb15-2"></a>    <span class="cf">WHEN</span> <span class="dv">22978</span> <span class="kw">OR</span> <span class="dv">23218</span> <span class="kw">OR</span> <span class="dv">23219</span> <span class="cf">THEN</span> <span class="st">&#39;WECS 9500&#39;</span> </span>
<span id="cb15-3"><a href="#cb15-3"></a>    <span class="cf">ELSE</span> <span class="st">&#39;WECS 9520&#39;</span> </span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="cf">END</span> <span class="kw">as</span> wecs_system </span></code></pre></div>
</section>
<section id="answer-accepted-score-1059" class="level4">
<h4>Answer accepted (score 1059)</h4>
<p>That format requires you to use either:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1"></a><span class="cf">CASE</span> ebv.db_no </span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="cf">WHEN</span> <span class="dv">22978</span> <span class="cf">THEN</span> <span class="st">&#39;WECS 9500&#39;</span> </span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="cf">WHEN</span> <span class="dv">23218</span> <span class="cf">THEN</span> <span class="st">&#39;WECS 9500&#39;</span>  </span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="cf">WHEN</span> <span class="dv">23219</span> <span class="cf">THEN</span> <span class="st">&#39;WECS 9500&#39;</span> </span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="cf">ELSE</span> <span class="st">&#39;WECS 9520&#39;</span> </span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="cf">END</span> <span class="kw">as</span> wecs_system </span></code></pre></div>
<p>Otherwise, use:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1"></a><span class="cf">CASE</span>  </span>
<span id="cb17-2"><a href="#cb17-2"></a>  <span class="cf">WHEN</span> ebv.db_no <span class="kw">IN</span> (<span class="dv">22978</span>, <span class="dv">23218</span>, <span class="dv">23219</span>) <span class="cf">THEN</span> <span class="st">&#39;WECS 9500&#39;</span> </span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="cf">ELSE</span> <span class="st">&#39;WECS 9520&#39;</span> </span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="cf">END</span> <span class="kw">as</span> wecs_system </span></code></pre></div>
</section>
<section id="answer-2-score-243" class="level4">
<h4>Answer 2 (score 243)</h4>
<div class="sourceCode" id="cb18"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1"></a><span class="cf">CASE</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="cf">WHEN</span> ebv.db_no <span class="op">=</span> <span class="dv">22978</span> <span class="kw">OR</span> </span>
<span id="cb18-3"><a href="#cb18-3"></a>       ebv.db_no <span class="op">=</span> <span class="dv">23218</span> <span class="kw">OR</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>       ebv.db_no <span class="op">=</span> <span class="dv">23219</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>  <span class="cf">THEN</span> <span class="st">&#39;WECS 9500&#39;</span> </span>
<span id="cb18-6"><a href="#cb18-6"></a>  <span class="cf">ELSE</span> <span class="st">&#39;WECS 9520&#39;</span> </span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="cf">END</span> <span class="kw">as</span> wecs_system </span></code></pre></div>
</section>
<section id="answer-3-score-57" class="level4">
<h4>Answer 3 (score 57)</h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1"></a><span class="cf">CASE</span> <span class="cf">WHEN</span> ebv.db_no  <span class="kw">IN</span> (<span class="dv">22978</span>, <span class="dv">23218</span>, <span class="dv">23219</span>) <span class="cf">THEN</span> <span class="st">&#39;WECS 9500&#39;</span> </span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="cf">ELSE</span> <span class="st">&#39;WECS 9520&#39;</span> </span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="cf">END</span> <span class="kw">as</span> wecs_system </span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-do-i-import-an-sql-file-using-the-command-line-in-mysql-score-2945526-in-2019" class="level3">
<h3>4: How do I import an SQL file using the command line in MySQL? (score <a href="https://stackoverflow.com/q/17666249.html">2945526</a> in 2019)</h3>
<section id="question-3" class="level4">
<h4>Question</h4>
<p>I have a <code>.sql</code> file with an export from <code>phpMyAdmin</code>. I want to import it into a different server using the command line.</p>
<p>I have a <a href="http://en.wikipedia.org/wiki/Windows_Server_2008" rel="noreferrer">Windows Server 2008</a> R2 installation. I placed the <code>.sql</code> file on the <strong><em>C drive</em></strong>, and I tried this command</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb20-1"><a href="#cb20-1"></a>database_name <span class="op">&lt;</span> <span class="kw">file</span>.sql</span></code></pre></div>
<p>It is not working. I get syntax errors.</p>
<ul>
<li>
How can I import this file without a problem?
</li>
<li>
Do I need to create a database first?
</li>
</ul>
</section>
<section id="answer-accepted-score-3384" class="level4">
<h4>Answer accepted (score 3384)</h4>
<p>Try:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb21-1"><a href="#cb21-1"></a>mysql <span class="op">-</span>u username <span class="op">-</span>p database_name <span class="op">&lt;</span> <span class="kw">file</span>.sql</span></code></pre></div>
<p>Check <a href="http://dev.mysql.com/doc/refman/5.0/en/mysql-command-options.html" rel="noreferrer">MySQL Options</a>.</p>
<p><strong>Note-1:</strong> It is better to use the full path of the SQL file <code>file.sql</code>.</p>
<p><strong>Note-2:</strong> Use <code>-R</code> and <code>--triggers</code> to keep the routines and triggers of original database. They are not copied by default.</p>
<p><strong>Note-3</strong> You may have to create the (empty) database from mysql if it doesn’t exist already and the exported SQL don’t contain <code>CREATE DATABASE</code> (exported with <code>--no-create-db</code> or <code>-n</code> option), before you can import it.</p>
</section>
<section id="answer-2-score-694" class="level4">
<h4>Answer 2 (score 694)</h4>
<p>A common use of <a href="http://dev.mysql.com/doc/refman/5.1/en/mysqldump.html" rel="noreferrer">mysqldump</a> is for making a backup of an entire database:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb22-1"><a href="#cb22-1"></a>shell<span class="op">&gt;</span> mysqldump db_name <span class="op">&gt;</span> <span class="kw">backup</span><span class="op">-</span><span class="kw">file</span>.sql</span></code></pre></div>
<p>You can load the dump file back into the server like this:</p>
<p><strong>UNIX</strong></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb23-1"><a href="#cb23-1"></a>shell<span class="op">&gt;</span> mysql db_name <span class="op">&lt;</span> <span class="kw">backup</span><span class="op">-</span><span class="kw">file</span>.sql</span></code></pre></div>
<p>The same in <strong>Windows</strong> command prompt:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb24-1"><a href="#cb24-1"></a>mysql <span class="op">-</span>p <span class="op">-</span>u [<span class="fu">user</span>] [<span class="kw">database</span>] <span class="op">&lt;</span> <span class="kw">backup</span><span class="op">-</span><span class="kw">file</span>.sql</span></code></pre></div>
<p><strong>PowerShell</strong></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb25-1"><a href="#cb25-1"></a>C:\<span class="op">&gt;</span> cmd.exe <span class="op">/</span>c <span class="ot">&quot;mysql -u root -p db_name &lt; backup-file.sql&quot;</span></span></code></pre></div>
<p><strong>MySQL command line</strong></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb26-1"><a href="#cb26-1"></a>mysql<span class="op">&gt;</span> <span class="kw">use</span> db_name;</span>
<span id="cb26-2"><a href="#cb26-2"></a>mysql<span class="op">&gt;</span> <span class="kw">source</span> <span class="kw">backup</span><span class="op">-</span><span class="kw">file</span>.sql;</span></code></pre></div>
</section>
<section id="answer-3-score-289" class="level4">
<h4>Answer 3 (score 289)</h4>
<p>Regarding the time taken for importing huge files: most importantly, it takes more time because the default setting of MySQL is <code>autocommit = true</code>. You must set that off before importing your file and then check how import works like a gem.</p>
<p>You just need to do the following thing:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb27-1"><a href="#cb27-1"></a>mysql<span class="op">&gt;</span> <span class="kw">use</span> db_name;</span>
<span id="cb27-2"><a href="#cb27-2"></a></span>
<span id="cb27-3"><a href="#cb27-3"></a>mysql<span class="op">&gt;</span> <span class="kw">SET</span> autocommit<span class="op">=</span><span class="dv">0</span> ; <span class="kw">source</span> the_sql_file.sql ; <span class="kw">COMMIT</span> ;</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="add-a-column-with-a-default-value-to-an-existing-table-in-sql-server-score-2693765-in-2018" class="level3">
<h3>5: Add a column with a default value to an existing table in SQL Server (score <a href="https://stackoverflow.com/q/92082.html">2693765</a> in 2018)</h3>
<section id="question-4" class="level4">
<h4>Question</h4>
<p>How can a column with a default value be added to an existing table in <a href="http://en.wikipedia.org/wiki/Microsoft_SQL_Server#Genesis" rel="noreferrer">SQL Server 2000</a> / <a href="http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2005" rel="noreferrer">SQL Server 2005</a>?</p>
</section>
<section id="answer-accepted-score-3307" class="level4">
<h4>Answer accepted (score 3307)</h4>
<h5>
Syntax:
</h2>
<div class="sourceCode" id="cb28"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> {TABLENAME} </span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="kw">ADD</span> {COLUMNNAME} {<span class="kw">TYPE</span>} {<span class="kw">NULL</span>|<span class="kw">NOT</span> <span class="kw">NULL</span>} </span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="kw">CONSTRAINT</span> {CONSTRAINT_NAME} <span class="kw">DEFAULT</span> {DEFAULT_VALUE}</span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="kw">WITH</span> <span class="kw">VALUES</span></span></code></pre></div>
<h5>
Example:
</h2>
<div class="sourceCode" id="cb29"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> SomeTable</span>
<span id="cb29-2"><a href="#cb29-2"></a>        <span class="kw">ADD</span> SomeCol Bit <span class="kw">NULL</span> <span class="co">--Or NOT NULL.</span></span>
<span id="cb29-3"><a href="#cb29-3"></a> <span class="kw">CONSTRAINT</span> D_SomeTable_SomeCol <span class="co">--When Omitted a Default-Constraint Name is autogenerated.</span></span>
<span id="cb29-4"><a href="#cb29-4"></a>    <span class="kw">DEFAULT</span> (<span class="dv">0</span>)<span class="co">--Optional Default-Constraint.</span></span>
<span id="cb29-5"><a href="#cb29-5"></a><span class="kw">WITH</span> <span class="kw">VALUES</span> <span class="co">--Add if Column is Nullable and you want the Default Value for Existing Records.</span></span></code></pre></div>
<h5>
Notes:
</h2>
<p>
<strong>Optional Constraint Name:</strong><br /> If you leave out <code>CONSTRAINT D_SomeTable_SomeCol</code> then SQL Server will autogenerate<br />     a Default-Contraint with a funny Name like: <code>DF__SomeTa__SomeC__4FB7FEF6</code><br />
</p>
<p>
<strong>Optional With-Values Statement:</strong><br /> The <code>WITH VALUES</code> is only needed when your Column is Nullable<br />     and you want the Default Value used for Existing Records.<br /> If your Column is <code>NOT NULL</code>, then it will automatically use the Default Value<br />     for all Existing Records, whether you specify <code>WITH VALUES</code> or not.
</p>
<p>
<strong>How Inserts work with a Default-Constraint:</strong><br /> If you insert a Record into <code>SomeTable</code> and do <strong><em>not</em></strong> Specify <code>SomeCol</code>’s value, then it will Default to <code>0</code>.<br /> If you insert a Record <strong><em>and</em></strong> Specify <code>SomeCol</code>’s value as <code>NULL</code> (and your column allows nulls),<br />     then the Default-Constraint will <strong><em>not</em></strong> be used and <code>NULL</code> will be inserted as the Value.<br />
</p>
<p>
Notes were based on everyone’s great feedback below.<br /> Special Thanks to:<br />     <span class="citation" data-cites="Yatrix">@Yatrix</span>, <span class="citation" data-cites="WalterStabosz">@WalterStabosz</span>, <span class="citation" data-cites="YahooSerious">@YahooSerious</span>, and <span class="citation" data-cites="StackMan">@StackMan</span> for their Comments.
</p>
</section>
<section id="answer-2-score-957" class="level4">
<h4>Answer 2 (score 957)</h4>
<div class="sourceCode" id="cb30"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb30-1"><a href="#cb30-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> Protocols</span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="kw">ADD</span> ProtocolTypeID <span class="dt">int</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span>(<span class="dv">1</span>)</span>
<span id="cb30-3"><a href="#cb30-3"></a>GO</span></code></pre></div>
<p>The inclusion of the <strong>DEFAULT</strong> fills the column in <strong>existing</strong> rows with the default value, so the NOT NULL constraint is not violated.</p>
</section>
<section id="answer-3-score-224" class="level4">
<h4>Answer 3 (score 224)</h4>
<p>When adding a <em>nullable column</em>, <code>WITH VALUES</code> will ensure that the specific DEFAULT value is applied to existing rows:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb31-1"><a href="#cb31-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> <span class="kw">table</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="kw">ADD</span> <span class="kw">column</span> BIT     <span class="co">-- Demonstration with NULL-able column added</span></span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="kw">CONSTRAINT</span> Constraint_name <span class="kw">DEFAULT</span> <span class="dv">0</span> <span class="kw">WITH</span> <span class="kw">VALUES</span></span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-to-return-only-the-date-from-a-sql-server-datetime-datatype-score-2620097-in-2017" class="level3">
<h3>6: How to return only the Date from a SQL Server DateTime datatype (score <a href="https://stackoverflow.com/q/113045.html">2620097</a> in 2017)</h3>
<section id="question-5" class="level4">
<h4>Question</h4>
<div class="sourceCode" id="cb32"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb32-1"><a href="#cb32-1"></a><span class="kw">SELECT</span> GETDATE()</span></code></pre></div>
<p>Returns: <code>2008-09-22 15:24:13.790</code></p>
<p>I want that date part without the time part: <code>2008-09-22 00:00:00.000</code></p>
<p>How can I get that?</p>
</section>
<section id="answer-accepted-score-2379" class="level4">
<h4>Answer accepted (score 2379)</h4>
<p>On <code>SQL Server 2008</code> and higher, you should <code>CONVERT</code> to date:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb33-1"><a href="#cb33-1"></a><span class="kw">SELECT</span> <span class="fu">CONVERT</span>(<span class="dt">date</span>, getdate())</span></code></pre></div>
<p>On older versions, you can do the following:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb34-1"><a href="#cb34-1"></a><span class="kw">SELECT</span> DATEADD(dd, <span class="dv">0</span>, DATEDIFF(dd, <span class="dv">0</span>, @your_date))</span></code></pre></div>
<p>for example</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb35-1"><a href="#cb35-1"></a><span class="kw">SELECT</span> DATEADD(dd, <span class="dv">0</span>, DATEDIFF(dd, <span class="dv">0</span>, GETDATE()))</span></code></pre></div>
<p>gives me</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb36-1"><a href="#cb36-1"></a><span class="dv">2008</span><span class="op">-</span><span class="dv">09</span><span class="op">-</span><span class="dv">22</span> <span class="dv">00</span><span class="ch">:00:00</span><span class="fl">.000</span></span></code></pre></div>
<p>Pros:</p>
<ul>
<li>
No <code>varchar</code>&lt;-&gt;<code>datetime</code> conversions required
</li>
<li>
No need to think about <code>locale</code>
</li>
</ul>
<hr/>
<p>As suggested by <a href="https://stackoverflow.com/users/241211/michael">Michael</a></p>
<p>Use this variant: <code>SELECT DATEADD(dd, 0, DATEDIFF(dd, 0, getdate()))</code></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb37-1"><a href="#cb37-1"></a><span class="kw">select</span> getdate()</span>
<span id="cb37-2"><a href="#cb37-2"></a></span>
<span id="cb37-3"><a href="#cb37-3"></a><span class="kw">SELECT</span> DATEADD(hh, DATEDIFF(hh, <span class="dv">0</span>, getdate()), <span class="dv">0</span>)</span>
<span id="cb37-4"><a href="#cb37-4"></a><span class="kw">SELECT</span> DATEADD(hh, <span class="dv">0</span>, DATEDIFF(hh, <span class="dv">0</span>, getdate()))</span>
<span id="cb37-5"><a href="#cb37-5"></a></span>
<span id="cb37-6"><a href="#cb37-6"></a><span class="kw">SELECT</span> DATEADD(dd, DATEDIFF(dd, <span class="dv">0</span>, getdate()), <span class="dv">0</span>)</span>
<span id="cb37-7"><a href="#cb37-7"></a><span class="kw">SELECT</span> DATEADD(dd, <span class="dv">0</span>, DATEDIFF(dd, <span class="dv">0</span>, getdate()))</span>
<span id="cb37-8"><a href="#cb37-8"></a></span>
<span id="cb37-9"><a href="#cb37-9"></a><span class="kw">SELECT</span> DATEADD(mm, DATEDIFF(mm, <span class="dv">0</span>, getdate()), <span class="dv">0</span>)</span>
<span id="cb37-10"><a href="#cb37-10"></a><span class="kw">SELECT</span> DATEADD(mm, <span class="dv">0</span>, DATEDIFF(mm, <span class="dv">0</span>, getdate()))</span>
<span id="cb37-11"><a href="#cb37-11"></a></span>
<span id="cb37-12"><a href="#cb37-12"></a><span class="kw">SELECT</span> DATEADD(yy, DATEDIFF(yy, <span class="dv">0</span>, getdate()), <span class="dv">0</span>)</span>
<span id="cb37-13"><a href="#cb37-13"></a><span class="kw">SELECT</span> DATEADD(yy, <span class="dv">0</span>, DATEDIFF(yy, <span class="dv">0</span>, getdate()))</span></code></pre></div>
<p>Output:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb38-1"><a href="#cb38-1"></a><span class="dv">2019</span><span class="op">-</span><span class="dv">04</span><span class="op">-</span><span class="dv">19</span> <span class="dv">08</span><span class="ch">:09:35</span><span class="fl">.557</span></span>
<span id="cb38-2"><a href="#cb38-2"></a></span>
<span id="cb38-3"><a href="#cb38-3"></a><span class="dv">2019</span><span class="op">-</span><span class="dv">04</span><span class="op">-</span><span class="dv">19</span> <span class="dv">08</span><span class="ch">:00:00</span><span class="fl">.000</span></span>
<span id="cb38-4"><a href="#cb38-4"></a><span class="dv">4763</span><span class="op">-</span><span class="dv">02</span><span class="op">-</span><span class="dv">17</span> <span class="dv">00</span><span class="ch">:00:00</span><span class="fl">.000</span></span>
<span id="cb38-5"><a href="#cb38-5"></a></span>
<span id="cb38-6"><a href="#cb38-6"></a><span class="dv">2019</span><span class="op">-</span><span class="dv">04</span><span class="op">-</span><span class="dv">19</span> <span class="dv">00</span><span class="ch">:00:00</span><span class="fl">.000</span></span>
<span id="cb38-7"><a href="#cb38-7"></a><span class="dv">2019</span><span class="op">-</span><span class="dv">04</span><span class="op">-</span><span class="dv">19</span> <span class="dv">00</span><span class="ch">:00:00</span><span class="fl">.000</span></span>
<span id="cb38-8"><a href="#cb38-8"></a></span>
<span id="cb38-9"><a href="#cb38-9"></a><span class="dv">2019</span><span class="op">-</span><span class="dv">04</span><span class="op">-</span><span class="dv">01</span> <span class="dv">00</span><span class="ch">:00:00</span><span class="fl">.000</span></span>
<span id="cb38-10"><a href="#cb38-10"></a><span class="dv">1903</span><span class="op">-</span><span class="dv">12</span><span class="op">-</span><span class="dv">03</span> <span class="dv">00</span><span class="ch">:00:00</span><span class="fl">.000</span></span>
<span id="cb38-11"><a href="#cb38-11"></a></span>
<span id="cb38-12"><a href="#cb38-12"></a><span class="dv">2019</span><span class="op">-</span><span class="dv">01</span><span class="op">-</span><span class="dv">01</span> <span class="dv">00</span><span class="ch">:00:00</span><span class="fl">.000</span></span>
<span id="cb38-13"><a href="#cb38-13"></a><span class="dv">1900</span><span class="op">-</span><span class="dv">04</span><span class="op">-</span><span class="dv">30</span> <span class="dv">00</span><span class="ch">:00:00</span><span class="fl">.000</span></span></code></pre></div>
</section>
<section id="answer-2-score-703" class="level4">
<h4>Answer 2 (score 703)</h4>
<p>SQLServer 2008 now has a ‘date’ data type which contains only a date with no time component. Anyone using SQLServer 2008 and beyond can do the following:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb39-1"><a href="#cb39-1"></a><span class="kw">SELECT</span> <span class="fu">CONVERT</span>(<span class="dt">date</span>, GETDATE())</span></code></pre></div>
</section>
<section id="answer-3-score-159" class="level4">
<h4>Answer 3 (score 159)</h4>
<p>If using SQL 2008 and above:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb40-1"><a href="#cb40-1"></a><span class="kw">select</span> <span class="fu">cast</span>(getdate() <span class="kw">as</span> <span class="dt">date</span>)</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="finding-duplicate-values-in-a-sql-table-score-2602064-in-2019" class="level3">
<h3>7: Finding duplicate values in a SQL table (score <a href="https://stackoverflow.com/q/2594829.html">2602064</a> in 2019)</h3>
<section id="question-6" class="level4">
<h4>Question</h4>
<p>It’s easy to find duplicates with one field:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb41-1"><a href="#cb41-1"></a><span class="kw">SELECT</span> name, <span class="fu">COUNT</span>(email) </span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="kw">FROM</span> users</span>
<span id="cb41-3"><a href="#cb41-3"></a><span class="kw">GROUP</span> <span class="kw">BY</span> email</span>
<span id="cb41-4"><a href="#cb41-4"></a><span class="kw">HAVING</span> <span class="fu">COUNT</span>(email) <span class="op">&gt;</span> <span class="dv">1</span></span></code></pre></div>
<p>So if we have a table</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb42-1"><a href="#cb42-1"></a><span class="kw">ID</span>   NAME   EMAIL</span>
<span id="cb42-2"><a href="#cb42-2"></a><span class="dv">1</span>    John   asd@asd.com</span>
<span id="cb42-3"><a href="#cb42-3"></a><span class="dv">2</span>    Sam    asd@asd.com</span>
<span id="cb42-4"><a href="#cb42-4"></a><span class="dv">3</span>    Tom    asd@asd.com</span>
<span id="cb42-5"><a href="#cb42-5"></a><span class="dv">4</span>    Bob    bob@asd.com</span>
<span id="cb42-6"><a href="#cb42-6"></a><span class="dv">5</span>    Tom    asd@asd.com</span></code></pre></div>
<p>This query will give us John, Sam, Tom, Tom because they all have the same <code>email</code>.</p>
<p>However, what I want is to get duplicates with the same <code>email</code> <strong>and</strong> <code>name</code>.</p>
<p>That is, I want to get “Tom”, “Tom”.</p>
<p>The reason I need this: I made a mistake, and allowed to insert duplicate <code>name</code> and <code>email</code> values. Now I need to remove/change the duplicates, so I need to <em>find</em> them first.</p>
</section>
<section id="answer-accepted-score-2777" class="level4">
<h4>Answer accepted (score 2777)</h4>
<div class="sourceCode" id="cb43"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb43-1"><a href="#cb43-1"></a><span class="kw">SELECT</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>    name, email, <span class="fu">COUNT</span>(<span class="op">*</span>)</span>
<span id="cb43-3"><a href="#cb43-3"></a><span class="kw">FROM</span></span>
<span id="cb43-4"><a href="#cb43-4"></a>    users</span>
<span id="cb43-5"><a href="#cb43-5"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb43-6"><a href="#cb43-6"></a>    name, email</span>
<span id="cb43-7"><a href="#cb43-7"></a><span class="kw">HAVING</span> </span>
<span id="cb43-8"><a href="#cb43-8"></a>    <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="op">&gt;</span> <span class="dv">1</span></span></code></pre></div>
<p>Simply group on both of the columns.</p>
<p>Note: the older ANSI standard is to have all non-aggregated columns in the GROUP BY but this has changed with the idea of <a href="https://blog.jooq.org/2015/12/10/sql-group-by-and-functional-dependencies-a-very-useful-feature/" rel="noreferrer">“functional dependency”</a>:</p>
<blockquote>
In relational database theory, a functional dependency is a constraint between two sets of attributes in a relation from a database. In other words, functional dependency is a constraint that describes the relationship between attributes in a relation.
</blockquote>
<p>Support is not consistent:</p>
<ul>
<li>
Recent PostgreSQL <a href="https://www.postgresql.org/docs/current/static/sql-select.html#SQL-GROUPBY" rel="noreferrer">supports it</a>.
</li>
<li>
SQL Server (as at SQL Server 2017) still requires all non-aggregated columns in the GROUP BY.
</li>
<li>
<p>MySQL is unpredictable and you need <code>sql_mode=only_full_group_by</code>:</p>
<ul>
<li>
<a href="https://stackoverflow.com/q/10894820/27535">GROUP BY lname ORDER BY showing wrong results</a>;
</li>
<li>
<a href="https://stackoverflow.com/questions/6060241/which-is-the-least-expensive-aggregate-function-in-the-absence-of-any/6060414#6060414">Which is the least expensive aggregate function in the absence of ANY()</a> (see comments in accepted answer).
</li>
</ul>
</li>
<li>
Oracle isn’t mainstream enough (warning: humour, I don’t know about Oracle).
</li>
</ul>
</section>
<section id="answer-2-score-346" class="level4">
<h4>Answer 2 (score 346)</h4>
<p>try this:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb44-1"><a href="#cb44-1"></a><span class="kw">declare</span> @YourTable <span class="kw">table</span> (<span class="kw">id</span> <span class="dt">int</span>, name <span class="dt">varchar</span>(<span class="dv">10</span>), email <span class="dt">varchar</span>(<span class="dv">50</span>))</span>
<span id="cb44-2"><a href="#cb44-2"></a></span>
<span id="cb44-3"><a href="#cb44-3"></a><span class="kw">INSERT</span> @YourTable <span class="kw">VALUES</span> (<span class="dv">1</span>,<span class="st">&#39;John&#39;</span>,<span class="st">&#39;John-email&#39;</span>)</span>
<span id="cb44-4"><a href="#cb44-4"></a><span class="kw">INSERT</span> @YourTable <span class="kw">VALUES</span> (<span class="dv">2</span>,<span class="st">&#39;John&#39;</span>,<span class="st">&#39;John-email&#39;</span>)</span>
<span id="cb44-5"><a href="#cb44-5"></a><span class="kw">INSERT</span> @YourTable <span class="kw">VALUES</span> (<span class="dv">3</span>,<span class="st">&#39;fred&#39;</span>,<span class="st">&#39;John-email&#39;</span>)</span>
<span id="cb44-6"><a href="#cb44-6"></a><span class="kw">INSERT</span> @YourTable <span class="kw">VALUES</span> (<span class="dv">4</span>,<span class="st">&#39;fred&#39;</span>,<span class="st">&#39;fred-email&#39;</span>)</span>
<span id="cb44-7"><a href="#cb44-7"></a><span class="kw">INSERT</span> @YourTable <span class="kw">VALUES</span> (<span class="dv">5</span>,<span class="st">&#39;sam&#39;</span>,<span class="st">&#39;sam-email&#39;</span>)</span>
<span id="cb44-8"><a href="#cb44-8"></a><span class="kw">INSERT</span> @YourTable <span class="kw">VALUES</span> (<span class="dv">6</span>,<span class="st">&#39;sam&#39;</span>,<span class="st">&#39;sam-email&#39;</span>)</span>
<span id="cb44-9"><a href="#cb44-9"></a></span>
<span id="cb44-10"><a href="#cb44-10"></a><span class="kw">SELECT</span></span>
<span id="cb44-11"><a href="#cb44-11"></a>    name,email, <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> CountOf</span>
<span id="cb44-12"><a href="#cb44-12"></a>    <span class="kw">FROM</span> @YourTable</span>
<span id="cb44-13"><a href="#cb44-13"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span> name,email</span>
<span id="cb44-14"><a href="#cb44-14"></a>    <span class="kw">HAVING</span> <span class="fu">COUNT</span>(<span class="op">*</span>)<span class="op">&gt;</span><span class="dv">1</span></span></code></pre></div>
<p>OUTPUT:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb45-1"><a href="#cb45-1"></a>name       email       CountOf</span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="co">---------- ----------- -----------</span></span>
<span id="cb45-3"><a href="#cb45-3"></a>John       John<span class="op">-</span>email  <span class="dv">2</span></span>
<span id="cb45-4"><a href="#cb45-4"></a>sam        sam<span class="op">-</span>email   <span class="dv">2</span></span>
<span id="cb45-5"><a href="#cb45-5"></a></span>
<span id="cb45-6"><a href="#cb45-6"></a>(<span class="dv">2</span> <span class="kw">row</span>(s) affected)</span></code></pre></div>
<p>if you want the IDs of the dups use this:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb46-1"><a href="#cb46-1"></a><span class="kw">SELECT</span></span>
<span id="cb46-2"><a href="#cb46-2"></a>    y.<span class="kw">id</span>,y.name,y.email</span>
<span id="cb46-3"><a href="#cb46-3"></a>    <span class="kw">FROM</span> @YourTable y</span>
<span id="cb46-4"><a href="#cb46-4"></a>        <span class="kw">INNER</span> <span class="kw">JOIN</span> (<span class="kw">SELECT</span></span>
<span id="cb46-5"><a href="#cb46-5"></a>                        name,email, <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> CountOf</span>
<span id="cb46-6"><a href="#cb46-6"></a>                        <span class="kw">FROM</span> @YourTable</span>
<span id="cb46-7"><a href="#cb46-7"></a>                        <span class="kw">GROUP</span> <span class="kw">BY</span> name,email</span>
<span id="cb46-8"><a href="#cb46-8"></a>                        <span class="kw">HAVING</span> <span class="fu">COUNT</span>(<span class="op">*</span>)<span class="op">&gt;</span><span class="dv">1</span></span>
<span id="cb46-9"><a href="#cb46-9"></a>                    ) dt <span class="kw">ON</span> y.name<span class="op">=</span>dt.name <span class="kw">AND</span> y.email<span class="op">=</span>dt.email</span></code></pre></div>
<p>OUTPUT:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb47-1"><a href="#cb47-1"></a><span class="kw">id</span>          name       email</span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="co">----------- ---------- ------------</span></span>
<span id="cb47-3"><a href="#cb47-3"></a><span class="dv">1</span>           John       John<span class="op">-</span>email</span>
<span id="cb47-4"><a href="#cb47-4"></a><span class="dv">2</span>           John       John<span class="op">-</span>email</span>
<span id="cb47-5"><a href="#cb47-5"></a><span class="dv">5</span>           sam        sam<span class="op">-</span>email</span>
<span id="cb47-6"><a href="#cb47-6"></a><span class="dv">6</span>           sam        sam<span class="op">-</span>email</span>
<span id="cb47-7"><a href="#cb47-7"></a></span>
<span id="cb47-8"><a href="#cb47-8"></a>(<span class="dv">4</span> <span class="kw">row</span>(s) affected)</span></code></pre></div>
<p>to delete the duplicates try:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb48-1"><a href="#cb48-1"></a><span class="kw">DELETE</span> d</span>
<span id="cb48-2"><a href="#cb48-2"></a>    <span class="kw">FROM</span> @YourTable d</span>
<span id="cb48-3"><a href="#cb48-3"></a>        <span class="kw">INNER</span> <span class="kw">JOIN</span> (<span class="kw">SELECT</span></span>
<span id="cb48-4"><a href="#cb48-4"></a>                        y.<span class="kw">id</span>,y.name,y.email,<span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span>(<span class="kw">PARTITION</span> <span class="kw">BY</span> y.name,y.email <span class="kw">ORDER</span> <span class="kw">BY</span> y.name,y.email,y.<span class="kw">id</span>) <span class="kw">AS</span> RowRank</span>
<span id="cb48-5"><a href="#cb48-5"></a>                        <span class="kw">FROM</span> @YourTable y</span>
<span id="cb48-6"><a href="#cb48-6"></a>                            <span class="kw">INNER</span> <span class="kw">JOIN</span> (<span class="kw">SELECT</span></span>
<span id="cb48-7"><a href="#cb48-7"></a>                                            name,email, <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> CountOf</span>
<span id="cb48-8"><a href="#cb48-8"></a>                                            <span class="kw">FROM</span> @YourTable</span>
<span id="cb48-9"><a href="#cb48-9"></a>                                            <span class="kw">GROUP</span> <span class="kw">BY</span> name,email</span>
<span id="cb48-10"><a href="#cb48-10"></a>                                            <span class="kw">HAVING</span> <span class="fu">COUNT</span>(<span class="op">*</span>)<span class="op">&gt;</span><span class="dv">1</span></span>
<span id="cb48-11"><a href="#cb48-11"></a>                                        ) dt <span class="kw">ON</span> y.name<span class="op">=</span>dt.name <span class="kw">AND</span> y.email<span class="op">=</span>dt.email</span>
<span id="cb48-12"><a href="#cb48-12"></a>                   ) dt2 <span class="kw">ON</span> d.<span class="kw">id</span><span class="op">=</span>dt2.<span class="kw">id</span></span>
<span id="cb48-13"><a href="#cb48-13"></a>        <span class="kw">WHERE</span> dt2.RowRank<span class="op">!=</span><span class="dv">1</span></span>
<span id="cb48-14"><a href="#cb48-14"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> @YourTable</span></code></pre></div>
<p>OUTPUT:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb49-1"><a href="#cb49-1"></a><span class="kw">id</span>          name       email</span>
<span id="cb49-2"><a href="#cb49-2"></a><span class="co">----------- ---------- --------------</span></span>
<span id="cb49-3"><a href="#cb49-3"></a><span class="dv">1</span>           John       John<span class="op">-</span>email</span>
<span id="cb49-4"><a href="#cb49-4"></a><span class="dv">3</span>           fred       John<span class="op">-</span>email</span>
<span id="cb49-5"><a href="#cb49-5"></a><span class="dv">4</span>           fred       fred<span class="op">-</span>email</span>
<span id="cb49-6"><a href="#cb49-6"></a><span class="dv">5</span>           sam        sam<span class="op">-</span>email</span>
<span id="cb49-7"><a href="#cb49-7"></a></span>
<span id="cb49-8"><a href="#cb49-8"></a>(<span class="dv">4</span> <span class="kw">row</span>(s) affected)</span></code></pre></div>
</section>
<section id="answer-3-score-109" class="level4">
<h4>Answer 3 (score 109)</h4>
<p>Try this:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb50-1"><a href="#cb50-1"></a><span class="kw">SELECT</span> name, email</span>
<span id="cb50-2"><a href="#cb50-2"></a><span class="kw">FROM</span> users</span>
<span id="cb50-3"><a href="#cb50-3"></a><span class="kw">GROUP</span> <span class="kw">BY</span> name, email</span>
<span id="cb50-4"><a href="#cb50-4"></a><span class="kw">HAVING</span> ( <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="op">&gt;</span> <span class="dv">1</span> )</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="inserting-multiple-rows-in-a-single-sql-query-score-2497025-in-2019" class="level3">
<h3>8: Inserting multiple rows in a single SQL query? (score <a href="https://stackoverflow.com/q/452859.html">2497025</a> in 2019)</h3>
<section id="question-7" class="level4">
<h4>Question</h4>
<p>I have multiple set of data to insert at once, say 4 rows. My table has three columns: <code>Person</code>, <code>Id</code> and <code>Office</code>.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb51-1"><a href="#cb51-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> MyTable <span class="kw">VALUES</span> (<span class="ot">&quot;John&quot;</span>, <span class="dv">123</span>, <span class="ot">&quot;Lloyds Office&quot;</span>);</span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> MyTable <span class="kw">VALUES</span> (<span class="ot">&quot;Jane&quot;</span>, <span class="dv">124</span>, <span class="ot">&quot;Lloyds Office&quot;</span>);</span>
<span id="cb51-3"><a href="#cb51-3"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> MyTable <span class="kw">VALUES</span> (<span class="ot">&quot;Billy&quot;</span>, <span class="dv">125</span>, <span class="ot">&quot;London Office&quot;</span>);</span>
<span id="cb51-4"><a href="#cb51-4"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> MyTable <span class="kw">VALUES</span> (<span class="ot">&quot;Miranda&quot;</span>, <span class="dv">126</span>, <span class="ot">&quot;Bristol Office&quot;</span>);</span></code></pre></div>
<p>Can I insert all 4 rows in a single SQL statement?</p>
</section>
<section id="answer-2-score-2131" class="level4">
<h4>Answer 2 (score 2131)</h4>
<p>In SQL Server 2008 you can insert multiple rows using a single SQL INSERT statement.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb52-1"><a href="#cb52-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> MyTable ( Column1, Column2 ) <span class="kw">VALUES</span></span>
<span id="cb52-2"><a href="#cb52-2"></a>( Value1, Value2 ), ( Value1, Value2 )</span></code></pre></div>
<p>For reference to this have a look at MOC Course 2778A - Writing SQL Queries in SQL Server 2008.</p>
<p>For example:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb53-1"><a href="#cb53-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> MyTable</span>
<span id="cb53-2"><a href="#cb53-2"></a>  ( Column1, Column2, Column3 )</span>
<span id="cb53-3"><a href="#cb53-3"></a><span class="kw">VALUES</span></span>
<span id="cb53-4"><a href="#cb53-4"></a>  (<span class="st">&#39;John&#39;</span>, <span class="dv">123</span>, <span class="st">&#39;Lloyds Office&#39;</span>), </span>
<span id="cb53-5"><a href="#cb53-5"></a>  (<span class="st">&#39;Jane&#39;</span>, <span class="dv">124</span>, <span class="st">&#39;Lloyds Office&#39;</span>), </span>
<span id="cb53-6"><a href="#cb53-6"></a>  (<span class="st">&#39;Billy&#39;</span>, <span class="dv">125</span>, <span class="st">&#39;London Office&#39;</span>),</span>
<span id="cb53-7"><a href="#cb53-7"></a>  (<span class="st">&#39;Miranda&#39;</span>, <span class="dv">126</span>, <span class="st">&#39;Bristol Office&#39;</span>);</span></code></pre></div>
</section>
<section id="answer-3-score-780" class="level4">
<h4>Answer 3 (score 780)</h4>
<p>If you are inserting into a single table, you can write your query like this (maybe only in MySQL):</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb54-1"><a href="#cb54-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> table1 (<span class="fu">First</span>, <span class="fu">Last</span>)</span>
<span id="cb54-2"><a href="#cb54-2"></a><span class="kw">VALUES</span></span>
<span id="cb54-3"><a href="#cb54-3"></a>    (<span class="st">&#39;Fred&#39;</span>, <span class="st">&#39;Smith&#39;</span>),</span>
<span id="cb54-4"><a href="#cb54-4"></a>    (<span class="st">&#39;John&#39;</span>, <span class="st">&#39;Smith&#39;</span>),</span>
<span id="cb54-5"><a href="#cb54-5"></a>    (<span class="st">&#39;Michael&#39;</span>, <span class="st">&#39;Smith&#39;</span>),</span>
<span id="cb54-6"><a href="#cb54-6"></a>    (<span class="st">&#39;Robert&#39;</span>, <span class="st">&#39;Smith&#39;</span>);</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="insert-into-values-select-from-score-2393511-in-2018" class="level3">
<h3>9: Insert into … values ( SELECT … FROM … ) (score <a href="https://stackoverflow.com/q/25969.html">2393511</a> in 2018)</h3>
<section id="question-8" class="level4">
<h4>Question</h4>
<p>I am trying to <code>INSERT INTO</code> a table using the input from another table. Although this is entirely feasible for many database engines, I always seem to struggle to remember the correct syntax for the <code>SQL</code> engine of the day (<a href="http://en.wikipedia.org/wiki/MySQL" rel="noreferrer">MySQL</a>, <a href="http://en.wikipedia.org/wiki/Oracle_Database" rel="noreferrer">Oracle</a>, <a href="http://en.wikipedia.org/wiki/Microsoft_SQL_Server" rel="noreferrer">SQL Server</a>, <a href="http://en.wikipedia.org/wiki/IBM_Informix" rel="noreferrer">Informix</a>, and <a href="http://en.wikipedia.org/wiki/IBM_DB2" rel="noreferrer">DB2</a>).</p>
<p>Is there a silver-bullet syntax coming from an SQL standard (for example, <a href="http://en.wikipedia.org/wiki/SQL-92" rel="noreferrer">SQL-92</a>) that would allow me to insert the values without worrying about the underlying database?</p>
</section>
<section id="answer-accepted-score-1522" class="level4">
<h4>Answer accepted (score 1522)</h4>
<p>Try:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb55-1"><a href="#cb55-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> table1 ( column1 )</span>
<span id="cb55-2"><a href="#cb55-2"></a><span class="kw">SELECT</span>  col1</span>
<span id="cb55-3"><a href="#cb55-3"></a><span class="kw">FROM</span>    table2  </span></code></pre></div>
<p>This is standard ANSI SQL and should work on any DBMS</p>
<p>It definitely works for:</p>
<ul>
<li>
Oracle
</li>
<li>
MS SQL Server
</li>
<li>
MySQL
</li>
<li>
Postgres
</li>
<li>
SQLite v3
</li>
<li>
Teradata
</li>
<li>
DB2
</li>
<li>
Sybase
</li>
<li>
Vertica
</li>
<li>
HSQLDB
</li>
<li>
H2
</li>
<li>
AWS RedShift
</li>
<li>
SAP HANA
</li>
</ul>
</section>
<section id="answer-2-score-865" class="level4">
<h4>Answer 2 (score 865)</h4>
<p>@<a href="https://stackoverflow.com/a/25971/282110">Shadow_x99</a>: That should work fine, and you can also have multiple columns and other data as well:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb56-1"><a href="#cb56-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> table1 ( column1, column2, someInt, someVarChar )</span>
<span id="cb56-2"><a href="#cb56-2"></a><span class="kw">SELECT</span>  table2.column1, table2.column2, <span class="dv">8</span>, <span class="st">&#39;some string etc.&#39;</span></span>
<span id="cb56-3"><a href="#cb56-3"></a><span class="kw">FROM</span>    table2</span>
<span id="cb56-4"><a href="#cb56-4"></a><span class="kw">WHERE</span>   table2.<span class="kw">ID</span> <span class="op">=</span> <span class="dv">7</span>;</span></code></pre></div>
<p>Edit: I should mention that I’ve only used this syntax with Access, SQL 2000/2005/Express, MySQL, and PostgreSQL, so those should be covered. A commenter has pointed out that it’ll work with SQLite3.</p>
</section>
<section id="answer-3-score-126" class="level4">
<h4>Answer 3 (score 126)</h4>
<p>To get only one value in a multi value <code>INSERT</code> from another table I did the following in SQLite3:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb57-1"><a href="#cb57-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> column_1 ( val_1, val_from_other_table ) </span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="kw">VALUES</span>(<span class="st">&#39;val_1&#39;</span>, (<span class="kw">SELECT</span>  val_2 <span class="kw">FROM</span> table_2 <span class="kw">WHERE</span> val_2 <span class="op">=</span> something))</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="what-is-the-difference-between-inner-join-and-outer-join-score-2264024-in-2019" class="level3">
<h3>10: What is the difference between “INNER JOIN” and “OUTER JOIN”? (score <a href="https://stackoverflow.com/q/38549.html">2264024</a> in 2019)</h3>
<section id="question-9" class="level4">
<h4>Question</h4>
<p>Also how do <code>LEFT JOIN</code>, <code>RIGHT JOIN</code> and <code>FULL JOIN</code> fit in?</p>
</section>
<section id="answer-accepted-score-5940" class="level4">
<h4>Answer accepted (score 5940)</h4>
<p>Assuming you’re joining on columns with no duplicates, which is a very common case:</p>
<ul>
<li>
<p>
An inner join of A and B gives the result of A intersect B, i.e. the inner part of a <a href="http://en.wikipedia.org/wiki/Venn_diagram" rel="noreferrer">Venn diagram</a> intersection.
</p>
</li>
<li>
<p>
An outer join of A and B gives the results of A union B, i.e. the outer parts of a Venn diagram union.
</p>
</li>
</ul>
<p><strong>Examples</strong></p>
<p>Suppose you have two tables, with a single column each, and data as follows:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb58-1"><a href="#cb58-1"></a>A    B</span>
<span id="cb58-2"><a href="#cb58-2"></a><span class="op">-</span>    <span class="op">-</span></span>
<span id="cb58-3"><a href="#cb58-3"></a><span class="dv">1</span>    <span class="dv">3</span></span>
<span id="cb58-4"><a href="#cb58-4"></a><span class="dv">2</span>    <span class="dv">4</span></span>
<span id="cb58-5"><a href="#cb58-5"></a><span class="dv">3</span>    <span class="dv">5</span></span>
<span id="cb58-6"><a href="#cb58-6"></a><span class="dv">4</span>    <span class="dv">6</span></span></code></pre></div>
<p>Note that (1,2) are unique to A, (3,4) are common, and (5,6) are unique to B.</p>
<p><strong>Inner join</strong></p>
<p>An inner join using either of the equivalent queries gives the intersection of the two tables, i.e. the two rows they have in common.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb59-1"><a href="#cb59-1"></a><span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> a <span class="kw">INNER</span> <span class="kw">JOIN</span> b <span class="kw">on</span> a.a <span class="op">=</span> b.b;</span>
<span id="cb59-2"><a href="#cb59-2"></a><span class="kw">select</span> a.<span class="op">*</span>, b.<span class="op">*</span>  <span class="kw">from</span> a,b <span class="kw">where</span> a.a <span class="op">=</span> b.b;</span>
<span id="cb59-3"><a href="#cb59-3"></a></span>
<span id="cb59-4"><a href="#cb59-4"></a>a | b</span>
<span id="cb59-5"><a href="#cb59-5"></a><span class="co">--+--</span></span>
<span id="cb59-6"><a href="#cb59-6"></a><span class="dv">3</span> | <span class="dv">3</span></span>
<span id="cb59-7"><a href="#cb59-7"></a><span class="dv">4</span> | <span class="dv">4</span></span></code></pre></div>
<p><strong>Left outer join</strong></p>
<p>A left outer join will give all rows in A, plus any common rows in B.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb60-1"><a href="#cb60-1"></a><span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> a <span class="kw">LEFT</span> <span class="kw">OUTER</span> <span class="kw">JOIN</span> b <span class="kw">on</span> a.a <span class="op">=</span> b.b;</span>
<span id="cb60-2"><a href="#cb60-2"></a><span class="kw">select</span> a.<span class="op">*</span>, b.<span class="op">*</span>  <span class="kw">from</span> a,b <span class="kw">where</span> a.a <span class="op">=</span> b.b(<span class="op">+</span>);</span>
<span id="cb60-3"><a href="#cb60-3"></a></span>
<span id="cb60-4"><a href="#cb60-4"></a>a |  b</span>
<span id="cb60-5"><a href="#cb60-5"></a><span class="co">--+-----</span></span>
<span id="cb60-6"><a href="#cb60-6"></a><span class="dv">1</span> | <span class="kw">null</span></span>
<span id="cb60-7"><a href="#cb60-7"></a><span class="dv">2</span> | <span class="kw">null</span></span>
<span id="cb60-8"><a href="#cb60-8"></a><span class="dv">3</span> |    <span class="dv">3</span></span>
<span id="cb60-9"><a href="#cb60-9"></a><span class="dv">4</span> |    <span class="dv">4</span></span></code></pre></div>
<p><strong>Right outer join</strong></p>
<p>A right outer join will give all rows in B, plus any common rows in A.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb61-1"><a href="#cb61-1"></a><span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> a <span class="kw">RIGHT</span> <span class="kw">OUTER</span> <span class="kw">JOIN</span> b <span class="kw">on</span> a.a <span class="op">=</span> b.b;</span>
<span id="cb61-2"><a href="#cb61-2"></a><span class="kw">select</span> a.<span class="op">*</span>, b.<span class="op">*</span>  <span class="kw">from</span> a,b <span class="kw">where</span> a.a(<span class="op">+</span>) <span class="op">=</span> b.b;</span>
<span id="cb61-3"><a href="#cb61-3"></a></span>
<span id="cb61-4"><a href="#cb61-4"></a>a    |  b</span>
<span id="cb61-5"><a href="#cb61-5"></a><span class="co">-----+----</span></span>
<span id="cb61-6"><a href="#cb61-6"></a><span class="dv">3</span>    |  <span class="dv">3</span></span>
<span id="cb61-7"><a href="#cb61-7"></a><span class="dv">4</span>    |  <span class="dv">4</span></span>
<span id="cb61-8"><a href="#cb61-8"></a><span class="kw">null</span> |  <span class="dv">5</span></span>
<span id="cb61-9"><a href="#cb61-9"></a><span class="kw">null</span> |  <span class="dv">6</span></span></code></pre></div>
<p><strong>Full outer join</strong></p>
<p>A full outer join will give you the union of A and B, i.e. all the rows in A and all the rows in B. If something in A doesn’t have a corresponding datum in B, then the B portion is null, and vice versa.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb62-1"><a href="#cb62-1"></a><span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> a <span class="kw">FULL</span> <span class="kw">OUTER</span> <span class="kw">JOIN</span> b <span class="kw">on</span> a.a <span class="op">=</span> b.b;</span>
<span id="cb62-2"><a href="#cb62-2"></a></span>
<span id="cb62-3"><a href="#cb62-3"></a> a   |  b</span>
<span id="cb62-4"><a href="#cb62-4"></a><span class="co">-----+-----</span></span>
<span id="cb62-5"><a href="#cb62-5"></a>   <span class="dv">1</span> | <span class="kw">null</span></span>
<span id="cb62-6"><a href="#cb62-6"></a>   <span class="dv">2</span> | <span class="kw">null</span></span>
<span id="cb62-7"><a href="#cb62-7"></a>   <span class="dv">3</span> |    <span class="dv">3</span></span>
<span id="cb62-8"><a href="#cb62-8"></a>   <span class="dv">4</span> |    <span class="dv">4</span></span>
<span id="cb62-9"><a href="#cb62-9"></a><span class="kw">null</span> |    <span class="dv">6</span></span>
<span id="cb62-10"><a href="#cb62-10"></a><span class="kw">null</span> |    <span class="dv">5</span></span></code></pre></div>
</section>
<section id="answer-2-score-671" class="level4">
<h4>Answer 2 (score 671)</h4>
<p>The Venn diagrams don’t really do it for me.</p>
<p>They don’t show any distinction between a cross join and an inner join, for example, or more generally show any distinction between different types of join predicate or provide a framework for reasoning about how they will operate.</p>
<p>There is no substitute for understanding the logical processing and it is relatively straightforward to grasp anyway.</p>
<ol>
<li>
Imagine a cross join.
</li>
<li>
Evaluate the <code>on</code> clause against all rows from step 1 keeping those where the predicate evaluates to <code>true</code>
</li>
<li>
(For outer joins only) add back in any outer rows that were lost in step 2.
</li>
</ol>
<p>(NB: In practice the query optimiser may find more efficient ways of executing the query than the purely logical description above but the final result must be the same)</p>
<p>I’ll start off with an animated version of a <strong>full outer join</strong>. Further explanation follows.</p>
<p><a href="https://i.stack.imgur.com/VUkfU.gif" rel="noreferrer"><img src="https://i.stack.imgur.com/VUkfU.gif" alt="enter image description here"></a></p>
<hr>
<h5>
Explanation
</h1>
<p><strong>Source Tables</strong></p>
<p><img src="https://i.stack.imgur.com/LVYKx.png" alt="enter link description here"></p>
<p>First start with a <code>CROSS JOIN</code> (AKA Cartesian Product). This does not have an <code>ON</code> clause and simply returns every combination of rows from the two tables.</p>
<p><strong>SELECT A.Colour, B.Colour FROM A CROSS JOIN B</strong></p>
<p><img src="https://i.stack.imgur.com/cv3t6.png" alt="enter link description here"></p>
<p>Inner and Outer joins have an “ON” clause predicate.</p>
<ul>
<li>
<strong>Inner Join.</strong> Evaluate the condition in the “ON” clause for all rows in the cross join result. If true return the joined row. Otherwise discard it.
</li>
<li>
<strong>Left Outer Join.</strong> Same as inner join then for any rows in the left table that did not match anything output these with NULL values for the right table columns.
</li>
<li>
<strong>Right Outer Join.</strong> Same as inner join then for any rows in the right table that did not match anything output these with NULL values for the left table columns.
</li>
<li>
<strong>Full Outer Join.</strong> Same as inner join then preserve left non matched rows as in left outer join and right non matching rows as per right outer join.
</li>
</ul>
<h5>
Some examples
</h1>
<p><strong>SELECT A.Colour, B.Colour FROM A INNER JOIN B ON A.Colour = B.Colour</strong></p>
<p>The above is the classic equi join.</p>
<p><img src="https://i.stack.imgur.com/a8IHd.png" alt="Inner Join"></p>
<h5>
Animated Version
</h2>
<p><a href="https://i.stack.imgur.com/kZcvR.gif" rel="noreferrer"><img src="https://i.stack.imgur.com/kZcvR.gif" alt="enter image description here"></a></p>
<h5>
SELECT A.Colour, B.Colour FROM A INNER JOIN B ON A.Colour NOT IN (‘Green’,‘Blue’)
</h3>
<p>The inner join condition need not necessarily be an equality condition and it need not reference columns from both (or even either) of the tables. Evaluating <code>A.Colour NOT IN ('Green','Blue')</code> on each row of the cross join returns.</p>
<p><img src="https://i.stack.imgur.com/ZwoCi.png" alt="inner 2"></p>
<p><strong>SELECT A.Colour, B.Colour FROM A INNER JOIN B ON 1 =1</strong></p>
<p>The join condition evaluates to true for all rows in the cross join result so this is just the same as a cross join. I won’t repeat the picture of the 16 rows again.</p>
<h5>
SELECT A.Colour, B.Colour FROM A LEFT OUTER JOIN B ON A.Colour = B.Colour
</h3>
<p>Outer Joins are logically evaluated in the same way as inner joins except that if a row from the left table (for a left join) does not join with any rows from the right hand table at all it is preserved in the result with <code>NULL</code> values for the right hand columns.</p>
<p><img src="https://i.stack.imgur.com/4bzv2.png" alt="LOJ"></p>
<h5>
SELECT A.Colour, B.Colour FROM A LEFT OUTER JOIN B ON A.Colour = B.Colour WHERE B.Colour IS NULL
</h3>
<p>This simply restricts the previous result to only return the rows where <code>B.Colour IS NULL</code>. In this particular case these will be the rows that were preserved as they had no match in the right hand table and the query returns the single red row not matched in table <code>B</code>. This is known as an anti semi join.</p>
<p>It is important to select a column for the <code>IS NULL</code> test that is either not nullable or for which the join condition ensures that any <code>NULL</code> values will be excluded in order for this pattern to work correctly and avoid just bringing back rows which happen to have a <code>NULL</code> value for that column in addition to the un matched rows.</p>
<p><img src="https://i.stack.imgur.com/d6CVF.png" alt="loj is null"></p>
<h5>
SELECT A.Colour, B.Colour FROM A RIGHT OUTER JOIN B ON A.Colour = B.Colour
</h3>
<p>Right outer joins act similarly to left outer joins except they preserve non matching rows from the right table and null extend the left hand columns.</p>
<p><img src="https://i.stack.imgur.com/LIOW4.png" alt="ROJ"></p>
<h5>
SELECT A.Colour, B.Colour FROM A FULL OUTER JOIN B ON A.Colour = B.Colour
</h3>
<p>Full outer joins combine the behaviour of left and right joins and preserve the non matching rows from both the left and the right tables.</p>
<p><img src="https://i.stack.imgur.com/iVoqu.png" alt="FOJ"></p>
<h5>
SELECT A.Colour, B.Colour FROM A FULL OUTER JOIN B ON 1 = 0
</h3>
<p>No rows in the cross join match the <code>1=0</code> predicate. All rows from both sides are preserved using normal outer join rules with NULL in the columns from the table on the other side.</p>
<p><img src="https://i.stack.imgur.com/gtIhf.png" alt="FOJ 2"></p>
<h5>
SELECT COALESCE(A.Colour, B.Colour) AS Colour FROM A FULL OUTER JOIN B ON 1 = 0
</h3>
<p>With a minor amend to the preceding query one could simulate a <code>UNION ALL</code> of the two tables.</p>
<p><img src="https://i.stack.imgur.com/WPu9W.png" alt="UNION ALL"></p>
<h5>
SELECT A.Colour, B.Colour FROM A LEFT OUTER JOIN B ON A.Colour = B.Colour WHERE B.Colour = ‘Green’
</h3>
<p>Note that the <code>WHERE</code> clause (if present) logically runs after the join. One common error is to perform a left outer join and then include a WHERE clause with a condition on the right table that ends up excluding the non matching rows. The above ends up performing the outer join…</p>
<p><img src="https://i.stack.imgur.com/4bzv2.png" alt="LOJ"></p>
<p>… And then the “Where” clause runs. <code>NULL= 'Green'</code> does not evaluate to true so the row preserved by the outer join ends up discarded (along with the blue one) effectively converting the join back to an inner one.</p>
<p><img src="https://i.stack.imgur.com/tRHdf.png" alt="LOJtoInner"></p>
<p>If the intention was to include only rows from B where Colour is Green and all rows from A regardless the correct syntax would be</p>
<h5>
SELECT A.Colour, B.Colour FROM A LEFT OUTER JOIN B ON A.Colour = B.Colour AND B.Colour = ‘Green’
</h3>
<p><img src="https://i.stack.imgur.com/cvJ1s.png" alt="enter image description here"></p>
<h5>
SQL Fiddle
</h2>
<p>See these examples <a href="http://sqlfiddle.com/#!17/10d3d/29" rel="noreferrer">run live at SQLFiddle.com</a>.</p>
</section>
<section id="answer-3-score-159-1" class="level4">
<h4>Answer 3 (score 159)</h4>
<p>
<strong>Joins</strong> are used to combine the data from two tables, with the result being a new, temporary table. Joins are performed based on something called a predicate, which specifies the condition to use in order to perform a join. The difference between an inner join and an outer join is that an inner join will return only the rows that actually match based on the join predicate. For eg- Lets consider Employee and Location table:
</p>
<p><img src="https://i.stack.imgur.com/fZ2IZ.png" alt="enter image description here"></p>
<p>
<strong><em>Inner Join:-</em></strong> Inner join creates a new result table by combining column values of two tables (<em>Employee</em> and <em>Location</em>) based upon the join-predicate. The query compares each row of <em>Employee</em> with each row of <em>Location</em> to find all pairs of rows which satisfy the join-predicate. When the join-predicate is satisfied by matching non-NULL values, column values for each matched pair of rows of <em>Employee</em> and <em>Location</em> are combined into a result row. Here’s what the SQL for an inner join will look like:
</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb63-1"><a href="#cb63-1"></a><span class="kw">select</span>  <span class="op">*</span> <span class="kw">from</span> employee <span class="kw">inner</span> <span class="kw">join</span> location <span class="kw">on</span> employee.empID <span class="op">=</span> location.empID</span>
<span id="cb63-2"><a href="#cb63-2"></a><span class="kw">OR</span></span>
<span id="cb63-3"><a href="#cb63-3"></a><span class="kw">select</span>  <span class="op">*</span> <span class="kw">from</span> employee, location <span class="kw">where</span> employee.empID <span class="op">=</span> location.empID</span></code></pre></div>
<p>
Now, here is what the result of running that SQL would look like: <img src="https://i.stack.imgur.com/RmdJE.png" alt="enter image description here"> <a href="https://i.stack.imgur.com/LgreJ.png" rel="noreferrer"><img src="https://i.stack.imgur.com/LgreJ.png" alt="enter image description here"></a>
</p>
<p>
<strong>Outer Join:-</strong> An outer join does not require each record in the two joined tables to have a matching record. The joined table retains each record—even if no other matching record exists. Outer joins subdivide further into left outer joins and right outer joins, depending on which table’s rows are retained (left or right).
</p>
<p>
<strong><em>Left Outer Join:-</em></strong> The result of a left outer join (or simply left join) for tables <em>Employee</em> and <em>Location</em> always contains all records of the “left” table (<em>Employee</em>), even if the join-condition does not find any matching record in the “right” table (<em>Location</em>). Here is what the SQL for a left outer join would look like, using the tables above:
</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb64-1"><a href="#cb64-1"></a><span class="kw">select</span>  <span class="op">*</span> <span class="kw">from</span> employee <span class="kw">left</span> <span class="kw">outer</span> <span class="kw">join</span> location <span class="kw">on</span> employee.empID <span class="op">=</span> location.empID;</span>
<span id="cb64-2"><a href="#cb64-2"></a><span class="op">//</span><span class="kw">Use</span> <span class="kw">of</span> <span class="kw">outer</span> keyword <span class="kw">is</span> optional</span></code></pre></div>
<p>
Now, here is what the result of running this SQL would look like: <img src="https://i.stack.imgur.com/U9lNP.png" alt="enter image description here"> <a href="https://i.stack.imgur.com/drdng.png" rel="noreferrer"><img src="https://i.stack.imgur.com/drdng.png" alt="enter image description here"></a>
</p>
<p>
<strong><em>Right Outer Join:-</em></strong> A right outer join (or right join) closely resembles a left outer join, except with the treatment of the tables reversed. Every row from the “right” table (<em>Location</em>) will appear in the joined table at least once. If no matching row from the “left” table (<em>Employee</em>) exists, NULL will appear in columns from <em>Employee</em> for those records that have no match in <em>Location</em>. This is what the SQL looks like:
</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb65-1"><a href="#cb65-1"></a><span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> employee <span class="kw">right</span> <span class="kw">outer</span> <span class="kw">join</span> location  <span class="kw">on</span> employee.empID <span class="op">=</span> location.empID;</span>
<span id="cb65-2"><a href="#cb65-2"></a><span class="op">//</span><span class="kw">Use</span> <span class="kw">of</span> <span class="kw">outer</span> keyword <span class="kw">is</span> optional</span></code></pre></div>
<p>Using the tables above, we can show what the result set of a right outer join would look like:</p>
<p><img src="https://i.stack.imgur.com/c8Jtn.png" alt="enter image description here"><a href="https://i.stack.imgur.com/buKqD.png" rel="noreferrer"><img src="https://i.stack.imgur.com/buKqD.png" alt="enter image description here"></a></p>
<p>
<strong>Full Outer Joins:-</strong> Full Outer Join or Full Join is to retain the nonmatching information by including nonmatching rows in the results of a join, use a full outer join. It includes all rows from both tables, regardless of whether or not the other table has a matching value. <a href="https://i.stack.imgur.com/23AMx.png" rel="noreferrer"><img src="https://i.stack.imgur.com/23AMx.png" alt="enter image description here"></a>
</p>
<p><a href="http://www.sql-join.com/sql-join-types/" rel="noreferrer">Image Source</a></p>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/join.html" rel="noreferrer">MySQL 8.0 Reference Manual - Join Syntax</a></p>
<p><a href="https://docs.oracle.com/javadb/10.8.3.0/ref/rrefsqlj29840.html" rel="noreferrer">Oracle Join operations</a></p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-to-concatenate-text-from-multiple-rows-into-a-single-text-string-in-sql-server-score-2175107-in-2018" class="level3">
<h3>11: How to concatenate text from multiple rows into a single text string in SQL server? (score <a href="https://stackoverflow.com/q/194852.html">2175107</a> in 2018)</h3>
<section id="question-10" class="level4">
<h4>Question</h4>
<p>Consider a database table holding names, with three rows:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb66-1"><a href="#cb66-1"></a>Peter</span>
<span id="cb66-2"><a href="#cb66-2"></a>Paul</span>
<span id="cb66-3"><a href="#cb66-3"></a>Mary</span></code></pre></div>
<p>Is there an easy way to turn this into a single string of <code>Peter, Paul, Mary</code>?</p>
</section>
<section id="answer-accepted-score-1338" class="level4">
<h4>Answer accepted (score 1338)</h4>
<p>If you are on SQL Server 2017 or Azure, see <a href="https://stackoverflow.com/a/42778050/1178676">Mathieu Renda answer</a>.</p>
<p>I had a similar issue when I was trying to join two tables with one-to-many relationships. In SQL 2005 I found that <code>XML PATH</code> method can handle the concatenation of the rows very easily.</p>
<p>If there is a table called <code>STUDENTS</code></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb67-1"><a href="#cb67-1"></a>SubjectID       StudentName</span>
<span id="cb67-2"><a href="#cb67-2"></a><span class="co">----------      -------------</span></span>
<span id="cb67-3"><a href="#cb67-3"></a><span class="dv">1</span>               Mary</span>
<span id="cb67-4"><a href="#cb67-4"></a><span class="dv">1</span>               John</span>
<span id="cb67-5"><a href="#cb67-5"></a><span class="dv">1</span>               Sam</span>
<span id="cb67-6"><a href="#cb67-6"></a><span class="dv">2</span>               Alaina</span>
<span id="cb67-7"><a href="#cb67-7"></a><span class="dv">2</span>               Edward</span></code></pre></div>
<p>Result I expected was:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb68-1"><a href="#cb68-1"></a>SubjectID       StudentName</span>
<span id="cb68-2"><a href="#cb68-2"></a><span class="co">----------      -------------</span></span>
<span id="cb68-3"><a href="#cb68-3"></a><span class="dv">1</span>               Mary, John, Sam</span>
<span id="cb68-4"><a href="#cb68-4"></a><span class="dv">2</span>               Alaina, Edward</span></code></pre></div>
<p>I used the following <code>T-SQL</code>:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb69-1"><a href="#cb69-1"></a><span class="kw">SELECT</span> Main.SubjectID,</span>
<span id="cb69-2"><a href="#cb69-2"></a>       <span class="kw">LEFT</span>(Main.Students,Len(Main.Students)<span class="op">-</span><span class="dv">1</span>) <span class="kw">As</span> <span class="ot">&quot;Students&quot;</span></span>
<span id="cb69-3"><a href="#cb69-3"></a><span class="kw">FROM</span></span>
<span id="cb69-4"><a href="#cb69-4"></a>    (</span>
<span id="cb69-5"><a href="#cb69-5"></a>        <span class="kw">SELECT</span> <span class="kw">DISTINCT</span> ST2.SubjectID, </span>
<span id="cb69-6"><a href="#cb69-6"></a>            (</span>
<span id="cb69-7"><a href="#cb69-7"></a>                <span class="kw">SELECT</span> ST1.StudentName <span class="op">+</span> <span class="st">&#39;,&#39;</span> <span class="kw">AS</span> [text()]</span>
<span id="cb69-8"><a href="#cb69-8"></a>                <span class="kw">FROM</span> dbo.Students ST1</span>
<span id="cb69-9"><a href="#cb69-9"></a>                <span class="kw">WHERE</span> ST1.SubjectID <span class="op">=</span> ST2.SubjectID</span>
<span id="cb69-10"><a href="#cb69-10"></a>                <span class="kw">ORDER</span> <span class="kw">BY</span> ST1.SubjectID</span>
<span id="cb69-11"><a href="#cb69-11"></a>                <span class="cf">FOR</span> XML PATH (<span class="st">&#39;&#39;</span>)</span>
<span id="cb69-12"><a href="#cb69-12"></a>            ) [Students]</span>
<span id="cb69-13"><a href="#cb69-13"></a>        <span class="kw">FROM</span> dbo.Students ST2</span>
<span id="cb69-14"><a href="#cb69-14"></a>    ) [Main]</span></code></pre></div>
<p>You can do the same thing in a more compact way if you can concat the commas at the beginning and use <code>substring</code> to skip the first one so you don’t need to do a sub-query:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb70-1"><a href="#cb70-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> ST2.SubjectID, </span>
<span id="cb70-2"><a href="#cb70-2"></a>    SUBSTRING(</span>
<span id="cb70-3"><a href="#cb70-3"></a>        (</span>
<span id="cb70-4"><a href="#cb70-4"></a>            <span class="kw">SELECT</span> <span class="st">&#39;,&#39;</span><span class="op">+</span>ST1.StudentName  <span class="kw">AS</span> [text()]</span>
<span id="cb70-5"><a href="#cb70-5"></a>            <span class="kw">FROM</span> dbo.Students ST1</span>
<span id="cb70-6"><a href="#cb70-6"></a>            <span class="kw">WHERE</span> ST1.SubjectID <span class="op">=</span> ST2.SubjectID</span>
<span id="cb70-7"><a href="#cb70-7"></a>            <span class="kw">ORDER</span> <span class="kw">BY</span> ST1.SubjectID</span>
<span id="cb70-8"><a href="#cb70-8"></a>            <span class="cf">FOR</span> XML PATH (<span class="st">&#39;&#39;</span>)</span>
<span id="cb70-9"><a href="#cb70-9"></a>        ), <span class="dv">2</span>, <span class="dv">1000</span>) [Students]</span>
<span id="cb70-10"><a href="#cb70-10"></a><span class="kw">FROM</span> dbo.Students ST2</span></code></pre></div>
</section>
<section id="answer-2-score-976" class="level4">
<h4>Answer 2 (score 976)</h4>
<blockquote>
<strong>This answer may return <a href="https://stackoverflow.com/questions/15138593/nvarchar-concatenation-index-nvarcharmax-inexplicable-behavior/15163136#15163136">unexpected results</a> For consistent results, use one of the FOR XML PATH methods detailed in other answers.</strong>
</blockquote>
<p>Use <code>COALESCE</code>:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb71-1"><a href="#cb71-1"></a><span class="kw">DECLARE</span> @Names <span class="dt">VARCHAR</span>(<span class="dv">8000</span>) </span>
<span id="cb71-2"><a href="#cb71-2"></a><span class="kw">SELECT</span> @Names <span class="op">=</span> <span class="fu">COALESCE</span>(@Names <span class="op">+</span> <span class="st">&#39;, &#39;</span>, <span class="st">&#39;&#39;</span>) <span class="op">+</span> Name </span>
<span id="cb71-3"><a href="#cb71-3"></a><span class="kw">FROM</span> People</span></code></pre></div>
<p>Just some explanation (since this answer seems to get relatively regular views):</p>
<ul>
<li>
Coalesce is really just a helpful cheat that accomplishes two things:
</li>
</ul>
<ol type="1">
<li><p>No need to initialize <code>@Names</code> with an empty string value.</p></li>
<li><p>No need to strip off an extra separator at the end.</p></li>
</ol>
<ul>
<li>
The solution above will give incorrect results if a row has a <em>NULL</em> Name value (if there is a <em>NULL</em>, the <em>NULL</em> will make <code>@Names</code> <em>NULL</em> after that row, and the next row will start over as an empty string again. Easily fixed with one of two solutions:
</li>
</ul>
<div class="sourceCode" id="cb72"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb72-1"><a href="#cb72-1"></a><span class="kw">DECLARE</span> @Names <span class="dt">VARCHAR</span>(<span class="dv">8000</span>) </span>
<span id="cb72-2"><a href="#cb72-2"></a><span class="kw">SELECT</span> @Names <span class="op">=</span> <span class="fu">COALESCE</span>(@Names <span class="op">+</span> <span class="st">&#39;, &#39;</span>, <span class="st">&#39;&#39;</span>) <span class="op">+</span> Name</span>
<span id="cb72-3"><a href="#cb72-3"></a><span class="kw">FROM</span> People</span>
<span id="cb72-4"><a href="#cb72-4"></a><span class="kw">WHERE</span> Name <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span></span></code></pre></div>
<p>or:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb73-1"><a href="#cb73-1"></a><span class="kw">DECLARE</span> @Names <span class="dt">VARCHAR</span>(<span class="dv">8000</span>) </span>
<span id="cb73-2"><a href="#cb73-2"></a><span class="kw">SELECT</span> @Names <span class="op">=</span> <span class="fu">COALESCE</span>(@Names <span class="op">+</span> <span class="st">&#39;, &#39;</span>, <span class="st">&#39;&#39;</span>) <span class="op">+</span> </span>
<span id="cb73-3"><a href="#cb73-3"></a>    ISNULL(Name, <span class="st">&#39;N/A&#39;</span>)</span>
<span id="cb73-4"><a href="#cb73-4"></a><span class="kw">FROM</span> People</span></code></pre></div>
<p>Depending on what behavior you want (the first option just filters <em>NULL</em>s out, the second option keeps them in the list with a marker message [replace ‘N/A’ with whatever is appropriate for you]).</p>
</section>
<section id="answer-3-score-344" class="level4">
<h4>Answer 3 (score 344)</h4>
<h5>
SQL Server 2017+ and SQL Azure: STRING_AGG
</h1>
<p>Starting with the next version of SQL Server, we can finally concatenate across rows without having to resort to any variable or XML witchery.</p>
<p><a href="https://docs.microsoft.com/en-us/sql/t-sql/functions/string-agg-transact-sql" rel="noreferrer">STRING_AGG (Transact-SQL)</a></p>
<p><strong>Without grouping</strong></p>
<div class="sourceCode" id="cb74"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb74-1"><a href="#cb74-1"></a><span class="kw">SELECT</span> STRING_AGG(Name, <span class="st">&#39;, &#39;</span>) <span class="kw">AS</span> Departments</span>
<span id="cb74-2"><a href="#cb74-2"></a><span class="kw">FROM</span> HumanResources.Department;</span></code></pre></div>
<p><strong>With grouping :</strong></p>
<div class="sourceCode" id="cb75"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb75-1"><a href="#cb75-1"></a><span class="kw">SELECT</span> GroupName, STRING_AGG(Name, <span class="st">&#39;, &#39;</span>) <span class="kw">AS</span> Departments</span>
<span id="cb75-2"><a href="#cb75-2"></a><span class="kw">FROM</span> HumanResources.Department</span>
<span id="cb75-3"><a href="#cb75-3"></a><span class="kw">GROUP</span> <span class="kw">BY</span> GroupName;</span></code></pre></div>
<p><strong>With grouping and sub-sorting</strong></p>
<div class="sourceCode" id="cb76"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb76-1"><a href="#cb76-1"></a><span class="kw">SELECT</span> GroupName, STRING_AGG(Name, <span class="st">&#39;, &#39;</span>) WITHIN <span class="kw">GROUP</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> Name <span class="kw">ASC</span>) <span class="kw">AS</span> Departments</span>
<span id="cb76-2"><a href="#cb76-2"></a><span class="kw">FROM</span> HumanResources.Department </span>
<span id="cb76-3"><a href="#cb76-3"></a><span class="kw">GROUP</span> <span class="kw">BY</span> GroupName;</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="get-list-of-all-tables-in-oracle-score-2096870-in-2015" class="level3">
<h3>12: Get list of all tables in Oracle? (score <a href="https://stackoverflow.com/q/205736.html">2096870</a> in 2015)</h3>
<section id="question-11" class="level4">
<h4>Question</h4>
<p>How do I query an Oracle database to display the names of all tables in it?</p>
</section>
<section id="answer-accepted-score-1330" class="level4">
<h4>Answer accepted (score 1330)</h4>
<div class="sourceCode" id="cb77"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb77-1"><a href="#cb77-1"></a><span class="kw">SELECT</span> owner, table_name</span>
<span id="cb77-2"><a href="#cb77-2"></a>  <span class="kw">FROM</span> dba_tables</span></code></pre></div>
<p>This is assuming that you have access to the <code>DBA_TABLES</code> data dictionary view. If you do not have those privileges but need them, you can request that the DBA explicitly grants you privileges on that table, or, that the DBA grants you the <code>SELECT ANY DICTIONARY</code> privilege or the <code>SELECT_CATALOG_ROLE</code> role (either of which would allow you to query any data dictionary table). Of course, you may want to exclude certain schemas like <code>SYS</code> and <code>SYSTEM</code> which have large numbers of Oracle tables that you probably don’t care about.</p>
<p>Alternatively, if you do not have access to <code>DBA_TABLES</code>, you can see all the tables that your account has access to through the <code>ALL_TABLES</code> view:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb78-1"><a href="#cb78-1"></a><span class="kw">SELECT</span> owner, table_name</span>
<span id="cb78-2"><a href="#cb78-2"></a>  <span class="kw">FROM</span> all_tables</span></code></pre></div>
<p>Although, that may be a subset of the tables available in the database (<code>ALL_TABLES</code> shows you the information for all the tables that your user has been granted access to).</p>
<p>If you are only concerned with the tables that you own, not those that you have access to, you could use <code>USER_TABLES</code>:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb79-1"><a href="#cb79-1"></a><span class="kw">SELECT</span> table_name</span>
<span id="cb79-2"><a href="#cb79-2"></a>  <span class="kw">FROM</span> user_tables</span></code></pre></div>
<p>Since <code>USER_TABLES</code> only has information about the tables that you own, it does not have an <code>OWNER</code> column – the owner, by definition, is you.</p>
<p>Oracle also has a number of legacy data dictionary views– <code>TAB</code>, <code>DICT</code>, <code>TABS</code>, and <code>CAT</code> for example– that could be used. In general, I would not suggest using these legacy views unless you absolutely need to backport your scripts to Oracle 6. Oracle has not changed these views in a long time so they often have problems with newer types of objects. For example, the <code>TAB</code> and <code>CAT</code> views both show information about tables that are in the user’s recycle bin while the <code>[DBA|ALL|USER]_TABLES</code> views all filter those out. <code>CAT</code> also shows information about materialized view logs with a <code>TABLE_TYPE</code> of “TABLE” which is unlikely to be what you really want. <code>DICT</code> combines tables and synonyms and doesn’t tell you who owns the object.</p>
</section>
<section id="answer-2-score-176" class="level4">
<h4>Answer 2 (score 176)</h4>
<p>
Querying <code>user_tables</code> and <code>dba_tables</code> didn’t work.<br> This one did:
</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb80-1"><a href="#cb80-1"></a><span class="kw">select</span> table_name <span class="kw">from</span> all_tables  </span></code></pre></div>
</section>
<section id="answer-3-score-65" class="level4">
<h4>Answer 3 (score 65)</h4>
<p>Going one step further, there is another view called cols (all_tab_columns) which can be used to ascertain which tables contain a given column name.</p>
<p>For example:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb81-1"><a href="#cb81-1"></a><span class="kw">SELECT</span> table_name, column_name</span>
<span id="cb81-2"><a href="#cb81-2"></a><span class="kw">FROM</span> cols</span>
<span id="cb81-3"><a href="#cb81-3"></a><span class="kw">WHERE</span> table_name <span class="kw">LIKE</span> <span class="st">&#39;EST%&#39;</span></span>
<span id="cb81-4"><a href="#cb81-4"></a><span class="kw">AND</span> column_name <span class="kw">LIKE</span> <span class="st">&#39;%CALLREF%&#39;</span>;</span></code></pre></div>
<p>to find all tables having a name beginning with EST and columns containing CALLREF anywhere in their names.</p>
<p>This can help when working out what columns you want to join on, for example, depending on your table and column naming conventions.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="find-all-tables-containing-column-with-specified-name---ms-sql-server-score-1904000-in-2018" class="level3">
<h3>13: Find all tables containing column with specified name - MS SQL Server (score <a href="https://stackoverflow.com/q/4849652.html">1904000</a> in 2018)</h3>
<section id="question-12" class="level4">
<h4>Question</h4>
<p>Is it possible to query for table names which contain columns being</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb82-1"><a href="#cb82-1"></a><span class="kw">LIKE</span> <span class="st">&#39;%myName%&#39;</span></span></code></pre></div>
<p>?</p>
</section>
<section id="answer-2-score-1672" class="level4">
<h4>Answer 2 (score 1672)</h4>
<p><strong>Search Tables:</strong></p>
<div class="sourceCode" id="cb83"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb83-1"><a href="#cb83-1"></a><span class="kw">SELECT</span>      c.name  <span class="kw">AS</span> <span class="st">&#39;ColumnName&#39;</span></span>
<span id="cb83-2"><a href="#cb83-2"></a>            ,t.name <span class="kw">AS</span> <span class="st">&#39;TableName&#39;</span></span>
<span id="cb83-3"><a href="#cb83-3"></a><span class="kw">FROM</span>        sys.<span class="kw">columns</span> c</span>
<span id="cb83-4"><a href="#cb83-4"></a><span class="kw">JOIN</span>        sys.<span class="kw">tables</span>  t   <span class="kw">ON</span> c.object_id <span class="op">=</span> t.object_id</span>
<span id="cb83-5"><a href="#cb83-5"></a><span class="kw">WHERE</span>       c.name <span class="kw">LIKE</span> <span class="st">&#39;%MyName%&#39;</span></span>
<span id="cb83-6"><a href="#cb83-6"></a><span class="kw">ORDER</span> <span class="kw">BY</span>    TableName</span>
<span id="cb83-7"><a href="#cb83-7"></a>            ,ColumnName;</span></code></pre></div>
<p><strong>Search Tables &amp; Views:</strong></p>
<div class="sourceCode" id="cb84"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb84-1"><a href="#cb84-1"></a><span class="kw">SELECT</span>      COLUMN_NAME <span class="kw">AS</span> <span class="st">&#39;ColumnName&#39;</span></span>
<span id="cb84-2"><a href="#cb84-2"></a>            ,TABLE_NAME <span class="kw">AS</span>  <span class="st">&#39;TableName&#39;</span></span>
<span id="cb84-3"><a href="#cb84-3"></a><span class="kw">FROM</span>        INFORMATION_SCHEMA.<span class="kw">COLUMNS</span></span>
<span id="cb84-4"><a href="#cb84-4"></a><span class="kw">WHERE</span>       COLUMN_NAME <span class="kw">LIKE</span> <span class="st">&#39;%MyName%&#39;</span></span>
<span id="cb84-5"><a href="#cb84-5"></a><span class="kw">ORDER</span> <span class="kw">BY</span>    TableName</span>
<span id="cb84-6"><a href="#cb84-6"></a>            ,ColumnName;</span></code></pre></div>
</section>
<section id="answer-3-score-290" class="level4">
<h4>Answer 3 (score 290)</h4>
<p>We can also use the following syntax:-</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb85-1"><a href="#cb85-1"></a><span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> INFORMATION_SCHEMA.<span class="kw">COLUMNS</span> </span>
<span id="cb85-2"><a href="#cb85-2"></a><span class="kw">where</span> COLUMN_NAME <span class="kw">like</span> <span class="st">&#39;%clientid%&#39;</span> </span>
<span id="cb85-3"><a href="#cb85-3"></a><span class="kw">order</span> <span class="kw">by</span> TABLE_NAME</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="insert-results-of-a-stored-procedure-into-a-temporary-table-score-1868029-in-2018" class="level3">
<h3>14: Insert results of a stored procedure into a temporary table (score <a href="https://stackoverflow.com/q/653714.html">1868029</a> in 2018)</h3>
<section id="question-13" class="level4">
<h4>Question</h4>
<p>How do I do a <code>SELECT * INTO [temp table] FROM [stored procedure]</code>? Not <code>FROM [Table]</code> and without defining <code>[temp table]</code>?</p>
<p><code>Select</code> all data from <code>BusinessLine</code> into <code>tmpBusLine</code> works fine.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb86-1"><a href="#cb86-1"></a><span class="kw">select</span> <span class="op">*</span></span>
<span id="cb86-2"><a href="#cb86-2"></a><span class="kw">into</span> tmpBusLine</span>
<span id="cb86-3"><a href="#cb86-3"></a><span class="kw">from</span> BusinessLine</span></code></pre></div>
<p>I am trying the same, but using a <code>stored procedure</code> that returns data, is not quite the same.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb87-1"><a href="#cb87-1"></a><span class="kw">select</span> <span class="op">*</span></span>
<span id="cb87-2"><a href="#cb87-2"></a><span class="kw">into</span> tmpBusLine</span>
<span id="cb87-3"><a href="#cb87-3"></a><span class="kw">from</span></span>
<span id="cb87-4"><a href="#cb87-4"></a><span class="kw">exec</span> getBusinessLineHistory <span class="st">&#39;16 Mar 2009&#39;</span></span></code></pre></div>
<p><strong>Output message:</strong></p>
<blockquote>
<p>
Msg 156, Level 15, State 1, Line 2 Incorrect syntax near the keyword ‘exec’.
</p>
</blockquote>
<p>I have read several examples of creating a temporary table with the same structure as the output stored procedure, which works fine, but it would be nice to not supply any columns.</p>
</section>
<section id="answer-2-score-679" class="level4">
<h4>Answer 2 (score 679)</h4>
<p>You can use <a href="http://msdn.microsoft.com/en-us/library/ms190312%28v=sql.100%29.aspx" rel="noreferrer">OPENROWSET</a> for this. Have a look. I’ve also included the sp_configure code to enable Ad Hoc Distributed Queries, in case it isn’t already enabled.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb88-1"><a href="#cb88-1"></a><span class="kw">CREATE</span> PROC getBusinessLineHistory</span>
<span id="cb88-2"><a href="#cb88-2"></a><span class="kw">AS</span></span>
<span id="cb88-3"><a href="#cb88-3"></a><span class="cf">BEGIN</span></span>
<span id="cb88-4"><a href="#cb88-4"></a>    <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> sys.databases</span>
<span id="cb88-5"><a href="#cb88-5"></a><span class="cf">END</span></span>
<span id="cb88-6"><a href="#cb88-6"></a>GO</span>
<span id="cb88-7"><a href="#cb88-7"></a></span>
<span id="cb88-8"><a href="#cb88-8"></a>sp_configure <span class="st">&#39;Show Advanced Options&#39;</span>, <span class="dv">1</span></span>
<span id="cb88-9"><a href="#cb88-9"></a>GO</span>
<span id="cb88-10"><a href="#cb88-10"></a>RECONFIGURE</span>
<span id="cb88-11"><a href="#cb88-11"></a>GO</span>
<span id="cb88-12"><a href="#cb88-12"></a>sp_configure <span class="st">&#39;Ad Hoc Distributed Queries&#39;</span>, <span class="dv">1</span></span>
<span id="cb88-13"><a href="#cb88-13"></a>GO</span>
<span id="cb88-14"><a href="#cb88-14"></a>RECONFIGURE</span>
<span id="cb88-15"><a href="#cb88-15"></a>GO</span>
<span id="cb88-16"><a href="#cb88-16"></a></span>
<span id="cb88-17"><a href="#cb88-17"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">INTO</span> #MyTempTable <span class="kw">FROM</span> OPENROWSET(<span class="st">&#39;SQLNCLI&#39;</span>, <span class="st">&#39;Server=(local)\SQL2008;Trusted_Connection=yes;&#39;</span>,</span>
<span id="cb88-18"><a href="#cb88-18"></a>     <span class="st">&#39;EXEC getBusinessLineHistory&#39;</span>)</span>
<span id="cb88-19"><a href="#cb88-19"></a></span>
<span id="cb88-20"><a href="#cb88-20"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> #MyTempTable</span></code></pre></div>
</section>
<section id="answer-3-score-589" class="level4">
<h4>Answer 3 (score 589)</h4>
<p>If you want to do it without first declaring the temporary table, you could try creating a user-defined function rather than a <a href="http://en.wikipedia.org/wiki/Stored_procedure" rel="noreferrer">stored procedure</a> and make that user-defined function return a table. Alternativly, if you want to use the stored procedure, try something like this:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb89-1"><a href="#cb89-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> #tmpBus</span>
<span id="cb89-2"><a href="#cb89-2"></a>(</span>
<span id="cb89-3"><a href="#cb89-3"></a>   COL1 <span class="dt">INT</span>,</span>
<span id="cb89-4"><a href="#cb89-4"></a>   COL2 <span class="dt">INT</span></span>
<span id="cb89-5"><a href="#cb89-5"></a>)</span>
<span id="cb89-6"><a href="#cb89-6"></a></span>
<span id="cb89-7"><a href="#cb89-7"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> #tmpBus</span>
<span id="cb89-8"><a href="#cb89-8"></a><span class="kw">Exec</span> SpGetRecords <span class="st">&#39;Params&#39;</span></span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="sql-select-where-field-contains-words-score-1644153-in-2017" class="level3">
<h3>15: SQL SELECT WHERE field contains words (score <a href="https://stackoverflow.com/q/14290857.html">1644153</a> in 2017)</h3>
<section id="question-14" class="level4">
<h4>Question</h4>
<p>I need a select which would return results like this:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb90-1"><a href="#cb90-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> MyTable <span class="kw">WHERE</span> Column1 <span class="kw">CONTAINS</span> <span class="st">&#39;word1 word2 word3&#39;</span></span></code></pre></div>
<p>And I need all results, i.e. this includes strings with ‘word2 word3 word1’ or ‘word1 word3 word2’ or any other combination of the three.</p>
<p>All words need to be in the result.</p>
</section>
<section id="answer-accepted-score-705" class="level4">
<h4>Answer accepted (score 705)</h4>
<p>Rather slow, but working method to include <strong>any</strong> of words:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb91-1"><a href="#cb91-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> mytable</span>
<span id="cb91-2"><a href="#cb91-2"></a><span class="kw">WHERE</span> column1 <span class="kw">LIKE</span> <span class="st">&#39;%word1%&#39;</span></span>
<span id="cb91-3"><a href="#cb91-3"></a>   <span class="kw">OR</span> column1 <span class="kw">LIKE</span> <span class="st">&#39;%word2%&#39;</span></span>
<span id="cb91-4"><a href="#cb91-4"></a>   <span class="kw">OR</span> column1 <span class="kw">LIKE</span> <span class="st">&#39;%word3%&#39;</span></span></code></pre></div>
<p>If you need <strong>all</strong> words to be present, use this:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb92-1"><a href="#cb92-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> mytable</span>
<span id="cb92-2"><a href="#cb92-2"></a><span class="kw">WHERE</span> column1 <span class="kw">LIKE</span> <span class="st">&#39;%word1%&#39;</span></span>
<span id="cb92-3"><a href="#cb92-3"></a>  <span class="kw">AND</span> column1 <span class="kw">LIKE</span> <span class="st">&#39;%word2%&#39;</span></span>
<span id="cb92-4"><a href="#cb92-4"></a>  <span class="kw">AND</span> column1 <span class="kw">LIKE</span> <span class="st">&#39;%word3%&#39;</span></span></code></pre></div>
<p>If you want something faster, you need to look into full text search, and this is very specific for each database type.</p>
</section>
<section id="answer-2-score-68" class="level4">
<h4>Answer 2 (score 68)</h4>
<p>Note that if you use <code>LIKE</code> to determine if a string is a substring of another string, you must escape the pattern matching characters in your search string.</p>
<p>If your SQL dialect supports <code>CHARINDEX</code>, it’s a lot easier to use it instead:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb93-1"><a href="#cb93-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> MyTable</span>
<span id="cb93-2"><a href="#cb93-2"></a><span class="kw">WHERE</span> CHARINDEX(<span class="st">&#39;word1&#39;</span>, Column1) <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb93-3"><a href="#cb93-3"></a>  <span class="kw">AND</span> CHARINDEX(<span class="st">&#39;word2&#39;</span>, Column1) <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb93-4"><a href="#cb93-4"></a>  <span class="kw">AND</span> CHARINDEX(<span class="st">&#39;word3&#39;</span>, Column1) <span class="op">&gt;</span> <span class="dv">0</span></span></code></pre></div>
<p>Also, please keep in mind that this and the method in the accepted answer only cover substring matching rather than word matching. So, for example, the string <code>'word1word2word3'</code> would still match.</p>
</section>
<section id="answer-3-score-17" class="level4">
<h4>Answer 3 (score 17)</h4>
<h5>
Function
</h1>
<div class="sourceCode" id="cb94"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb94-1"><a href="#cb94-1"></a> <span class="kw">CREATE</span> <span class="kw">FUNCTION</span> [dbo].[fnSplit] ( @sep <span class="dt">CHAR</span>(<span class="dv">1</span>), @str <span class="dt">VARCHAR</span>(<span class="dv">512</span>) )</span>
<span id="cb94-2"><a href="#cb94-2"></a> RETURNS <span class="kw">TABLE</span> <span class="kw">AS</span></span>
<span id="cb94-3"><a href="#cb94-3"></a> <span class="kw">RETURN</span> (</span>
<span id="cb94-4"><a href="#cb94-4"></a>           <span class="kw">WITH</span> Pieces(pn, <span class="kw">start</span>, <span class="kw">stop</span>) <span class="kw">AS</span> (</span>
<span id="cb94-5"><a href="#cb94-5"></a>           <span class="kw">SELECT</span> <span class="dv">1</span>, <span class="dv">1</span>, CHARINDEX(@sep, @str)</span>
<span id="cb94-6"><a href="#cb94-6"></a>           <span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb94-7"><a href="#cb94-7"></a>           <span class="kw">SELECT</span> pn <span class="op">+</span> <span class="dv">1</span>, <span class="kw">stop</span> <span class="op">+</span> <span class="dv">1</span>, CHARINDEX(@sep, @str, <span class="kw">stop</span> <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb94-8"><a href="#cb94-8"></a>           <span class="kw">FROM</span> Pieces</span>
<span id="cb94-9"><a href="#cb94-9"></a>           <span class="kw">WHERE</span> <span class="kw">stop</span> <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb94-10"><a href="#cb94-10"></a>      )</span>
<span id="cb94-11"><a href="#cb94-11"></a></span>
<span id="cb94-12"><a href="#cb94-12"></a>      <span class="kw">SELECT</span></span>
<span id="cb94-13"><a href="#cb94-13"></a>           pn <span class="kw">AS</span> <span class="kw">Id</span>,</span>
<span id="cb94-14"><a href="#cb94-14"></a>           SUBSTRING(@str, <span class="kw">start</span>, <span class="cf">CASE</span> <span class="cf">WHEN</span> <span class="kw">stop</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">THEN</span> <span class="kw">stop</span> <span class="op">-</span> <span class="kw">start</span> <span class="cf">ELSE</span> <span class="dv">512</span> <span class="cf">END</span>) <span class="kw">AS</span> <span class="kw">Data</span></span>
<span id="cb94-15"><a href="#cb94-15"></a>      <span class="kw">FROM</span></span>
<span id="cb94-16"><a href="#cb94-16"></a>           Pieces</span>
<span id="cb94-17"><a href="#cb94-17"></a> )</span></code></pre></div>
<h5>
Query
</h1>
<div class="sourceCode" id="cb95"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb95-1"><a href="#cb95-1"></a> <span class="kw">DECLARE</span> @FilterTable <span class="kw">TABLE</span> (<span class="kw">Data</span> <span class="dt">VARCHAR</span>(<span class="dv">512</span>))</span>
<span id="cb95-2"><a href="#cb95-2"></a></span>
<span id="cb95-3"><a href="#cb95-3"></a> <span class="kw">INSERT</span> <span class="kw">INTO</span> @FilterTable (<span class="kw">Data</span>)</span>
<span id="cb95-4"><a href="#cb95-4"></a> <span class="kw">SELECT</span> <span class="kw">DISTINCT</span> S.<span class="kw">Data</span></span>
<span id="cb95-5"><a href="#cb95-5"></a> <span class="kw">FROM</span> fnSplit(<span class="st">&#39; &#39;</span>, <span class="st">&#39;word1 word2 word3&#39;</span>) S <span class="co">-- Contains words</span></span>
<span id="cb95-6"><a href="#cb95-6"></a></span>
<span id="cb95-7"><a href="#cb95-7"></a> <span class="kw">SELECT</span> <span class="kw">DISTINCT</span></span>
<span id="cb95-8"><a href="#cb95-8"></a>      T.<span class="op">*</span></span>
<span id="cb95-9"><a href="#cb95-9"></a> <span class="kw">FROM</span></span>
<span id="cb95-10"><a href="#cb95-10"></a>      MyTable T</span>
<span id="cb95-11"><a href="#cb95-11"></a>      <span class="kw">INNER</span> <span class="kw">JOIN</span> @FilterTable F1 <span class="kw">ON</span> T.Column1 <span class="kw">LIKE</span> <span class="st">&#39;%&#39;</span> <span class="op">+</span> F1.<span class="kw">Data</span> <span class="op">+</span> <span class="st">&#39;%&#39;</span></span>
<span id="cb95-12"><a href="#cb95-12"></a>      <span class="kw">LEFT</span> <span class="kw">JOIN</span> @FilterTable F2 <span class="kw">ON</span> T.Column1 <span class="kw">NOT</span> <span class="kw">LIKE</span> <span class="st">&#39;%&#39;</span> <span class="op">+</span> F2.<span class="kw">Data</span> <span class="op">+</span> <span class="st">&#39;%&#39;</span></span>
<span id="cb95-13"><a href="#cb95-13"></a> <span class="kw">WHERE</span></span>
<span id="cb95-14"><a href="#cb95-14"></a>      F2.<span class="kw">Data</span> <span class="kw">IS</span> <span class="kw">NULL</span></span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-can-i-prevent-sql-injection-in-php-score-1643165-in-2016" class="level3">
<h3>16: How can I prevent SQL injection in PHP? (score <a href="https://stackoverflow.com/q/60174.html">1643165</a> in 2016)</h3>
<section id="question-15" class="level4">
<h4>Question</h4>
<p>If user input is inserted without modification into an SQL query, then the application becomes vulnerable to <a href="https://stackoverflow.com/a/332367/">SQL injection</a>, like in the following example:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb96-1"><a href="#cb96-1"></a>$unsafe_variable <span class="op">=</span> $_POST[<span class="st">&#39;user_input&#39;</span>]; </span>
<span id="cb96-2"><a href="#cb96-2"></a></span>
<span id="cb96-3"><a href="#cb96-3"></a>mysql_query(<span class="ot">&quot;INSERT INTO `table` (`column`) VALUES (&#39;$unsafe_variable&#39;)&quot;</span>);</span></code></pre></div>
<p>That’s because the user can input something like <code>value'); DROP TABLE table;--</code>, and the query becomes:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb97-1"><a href="#cb97-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> `table` (`column`) <span class="kw">VALUES</span>(<span class="st">&#39;value&#39;</span>); <span class="kw">DROP</span> <span class="kw">TABLE</span> <span class="kw">table</span>;<span class="co">--&#39;)</span></span></code></pre></div>
<p>What can be done to prevent this from happening?</p>
</section>
<section id="answer-accepted-score-8673" class="level4">
<h4>Answer accepted (score 8673)</h4>
<p><strong>Use prepared statements and parameterized queries.</strong> These are SQL statements that are sent to and parsed by the database server separately from any parameters. This way it is impossible for an attacker to inject malicious SQL.</p>
<p>You basically have two options to achieve this:</p>
<ol>
<li>
<p>
Using <a href="http://php.net/manual/en/book.pdo.php" rel="noreferrer">PDO</a> (for any supported database driver):
</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb98-1"><a href="#cb98-1"></a>$stmt <span class="op">=</span> $pdo<span class="op">-&gt;</span><span class="kw">prepare</span>(<span class="st">&#39;SELECT * FROM employees WHERE name = :name&#39;</span>);</span>
<span id="cb98-2"><a href="#cb98-2"></a></span>
<span id="cb98-3"><a href="#cb98-3"></a>$stmt<span class="op">-&gt;</span><span class="kw">execute</span>(<span class="dt">array</span>(<span class="st">&#39;name&#39;</span> <span class="op">=&gt;</span> $name));</span>
<span id="cb98-4"><a href="#cb98-4"></a></span>
<span id="cb98-5"><a href="#cb98-5"></a>foreach ($stmt <span class="kw">as</span> $row) {</span>
<span id="cb98-6"><a href="#cb98-6"></a>    <span class="op">//</span> Do something <span class="kw">with</span> $row</span>
<span id="cb98-7"><a href="#cb98-7"></a>}</span>
<span id="cb98-8"><a href="#cb98-8"></a>```<span class="op">&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb98-9"><a href="#cb98-9"></a><span class="op">&lt;</span>li<span class="op">&gt;&lt;</span>p<span class="op">&gt;</span><span class="kw">Using</span> <span class="op">&lt;</span>a href<span class="op">=</span><span class="ot">&quot;http://php.net/manual/en/book.mysqli.php&quot;</span> rel<span class="op">=</span><span class="ot">&quot;noreferrer&quot;</span><span class="op">&gt;</span>MySQLi<span class="op">&lt;/</span>a<span class="op">&gt;</span> (<span class="cf">for</span> MySQL):<span class="op">&lt;/</span>p<span class="op">&gt;</span></span>
<span id="cb98-10"><a href="#cb98-10"></a></span>
<span id="cb98-11"><a href="#cb98-11"></a>```sql</span>
<span id="cb98-12"><a href="#cb98-12"></a>$stmt <span class="op">=</span> $dbConnection<span class="op">-&gt;</span><span class="kw">prepare</span>(<span class="st">&#39;SELECT * FROM employees WHERE name = ?&#39;</span>);</span>
<span id="cb98-13"><a href="#cb98-13"></a>$stmt<span class="op">-&gt;</span>bind_param(<span class="st">&#39;s&#39;</span>, $name); <span class="op">//</span> <span class="st">&#39;s&#39;</span> specifies <span class="kw">the</span> variable <span class="kw">type</span> <span class="op">=&gt;</span> <span class="st">&#39;string&#39;</span></span>
<span id="cb98-14"><a href="#cb98-14"></a></span>
<span id="cb98-15"><a href="#cb98-15"></a>$stmt<span class="op">-&gt;</span><span class="kw">execute</span>();</span>
<span id="cb98-16"><a href="#cb98-16"></a></span>
<span id="cb98-17"><a href="#cb98-17"></a>$result <span class="op">=</span> $stmt<span class="op">-&gt;</span>get_result();</span>
<span id="cb98-18"><a href="#cb98-18"></a><span class="cf">while</span> ($row <span class="op">=</span> $result<span class="op">-&gt;</span>fetch_assoc()) {</span>
<span id="cb98-19"><a href="#cb98-19"></a>    <span class="op">//</span> Do something <span class="kw">with</span> $row</span>
<span id="cb98-20"><a href="#cb98-20"></a>}</span>
<span id="cb98-21"><a href="#cb98-21"></a>```<span class="op">&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb98-22"><a href="#cb98-22"></a><span class="op">&lt;/</span>ol<span class="op">&gt;</span></span>
<span id="cb98-23"><a href="#cb98-23"></a></span>
<span id="cb98-24"><a href="#cb98-24"></a><span class="cf">If</span> you<span class="st">&#39;re connecting to a database other than MySQL, there is a driver-specific second option that you can refer to (for example, `pg_prepare()` and `pg_execute()` for PostgreSQL). PDO is the universal option.  </span></span>
<span id="cb98-25"><a href="#cb98-25"></a></span>
<span id="cb98-26"><a href="#cb98-26"></a><span class="st">&lt;h5&gt;Correctly setting up the connection&lt;/h2&gt;</span></span>
<span id="cb98-27"><a href="#cb98-27"></a></span>
<span id="cb98-28"><a href="#cb98-28"></a><span class="st">Note that when using `PDO` to access a MySQL database &lt;em&gt;real&lt;/em&gt; prepared statements are &lt;strong&gt;not used by default&lt;/strong&gt;. To fix this you have to disable the emulation of prepared statements. An example of creating a connection using PDO is:  </span></span>
<span id="cb98-29"><a href="#cb98-29"></a></span>
<span id="cb98-30"><a href="#cb98-30"></a><span class="st">```sql</span></span>
<span id="cb98-31"><a href="#cb98-31"></a><span class="st">$dbConnection = new PDO(&#39;</span>mysql<span class="ch">:dbname</span><span class="op">=</span>dbtest;host<span class="op">=</span><span class="dv">127</span>.<span class="dv">0</span>.<span class="fl">0.1</span>;charset<span class="op">=</span>utf8<span class="st">&#39;, &#39;</span>user<span class="st">&#39;, &#39;</span>password<span class="st">&#39;);</span></span>
<span id="cb98-32"><a href="#cb98-32"></a></span>
<span id="cb98-33"><a href="#cb98-33"></a><span class="st">$dbConnection-&gt;setAttribute(PDO::ATTR_EMULATE_PREPARES, false);</span></span>
<span id="cb98-34"><a href="#cb98-34"></a><span class="st">$dbConnection-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);</span></span></code></pre></div>
<p>In the above example the error mode isn’t strictly necessary, <strong>but it is advised to add it</strong>. This way the script will not stop with a <code>Fatal Error</code> when something goes wrong. And it gives the developer the chance to <code>catch</code> any error(s) which are <code>throw</code>n as <code>PDOException</code>s.</p>
<p>What is <strong>mandatory</strong>, however, is the first <code>setAttribute()</code> line, which tells PDO to disable emulated prepared statements and use <em>real</em> prepared statements. This makes sure the statement and the values aren’t parsed by PHP before sending it to the MySQL server (giving a possible attacker no chance to inject malicious SQL).</p>
<p>Although you can set the <code>charset</code> in the options of the constructor, it’s important to note that ‘older’ versions of PHP (before 5.3.6) <a href="http://php.net/manual/en/ref.pdo-mysql.connection.php" rel="noreferrer">silently ignored the charset parameter</a> in the DSN.</p>
<h5>
Explanation
</h2>
<p>The SQL statement you pass to <code>prepare</code> is parsed and compiled by the database server. By specifying parameters (either a <code>?</code> or a named parameter like <code>:name</code> in the example above) you tell the database engine where you want to filter on. Then when you call <code>execute</code>, the prepared statement is combined with the parameter values you specify.</p>
<p>The important thing here is that the parameter values are combined with the compiled statement, not an SQL string. SQL injection works by tricking the script into including malicious strings when it creates SQL to send to the database. So by sending the actual SQL separately from the parameters, you limit the risk of ending up with something you didn’t intend.</p>
<p>Any parameters you send when using a prepared statement will just be treated as strings (although the database engine may do some optimization so parameters may end up as numbers too, of course). In the example above, if the <code>$name</code> variable contains <code>'Sarah'; DELETE FROM employees</code> the result would simply be a search for the string <code>"'Sarah'; DELETE FROM employees"</code>, and you will not end up with <a href="http://xkcd.com/327/" rel="noreferrer">an empty table</a>.</p>
<p>Another benefit of using prepared statements is that if you execute the same statement many times in the same session it will only be parsed and compiled once, giving you some speed gains.</p>
<p>Oh, and since you asked about how to do it for an insert, here’s an example (using PDO):</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb99-1"><a href="#cb99-1"></a>$preparedStatement <span class="op">=</span> $db<span class="op">-&gt;</span><span class="kw">prepare</span>(<span class="st">&#39;INSERT INTO table (column) VALUES (:column)&#39;</span>);</span>
<span id="cb99-2"><a href="#cb99-2"></a></span>
<span id="cb99-3"><a href="#cb99-3"></a>$preparedStatement<span class="op">-&gt;</span><span class="kw">execute</span>(<span class="dt">array</span>(<span class="st">&#39;column&#39;</span> <span class="op">=&gt;</span> $unsafeValue));</span></code></pre></div>
<h5>
Can prepared statements be used for dynamic queries?
</h2>
<p>While you can still use prepared statements for the query parameters, the structure of the dynamic query itself cannot be parametrized and certain query features cannot be parametrized.</p>
<p>For these specific scenarios, the best thing to do is use a whitelist filter that restricts the possible values.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb100-1"><a href="#cb100-1"></a><span class="op">//</span> <span class="fu">Value</span> whitelist</span>
<span id="cb100-2"><a href="#cb100-2"></a><span class="op">//</span> $dir can <span class="kw">only</span> be <span class="st">&#39;DESC&#39;</span>, otherwise it will be <span class="st">&#39;ASC&#39;</span></span>
<span id="cb100-3"><a href="#cb100-3"></a><span class="cf">if</span> (<span class="kw">empty</span>($dir) <span class="op">||</span> $dir <span class="op">!==</span> <span class="st">&#39;DESC&#39;</span>) {</span>
<span id="cb100-4"><a href="#cb100-4"></a>   $dir <span class="op">=</span> <span class="st">&#39;ASC&#39;</span>;</span>
<span id="cb100-5"><a href="#cb100-5"></a>}</span></code></pre></div>
</section>
<section id="answer-2-score-1616" class="level4">
<h4>Answer 2 (score 1616)</h4>
<blockquote>
<p>
<strong>Deprecated Warning:</strong> This answer’s sample code (like the question’s sample code) uses PHP’s <code>MySQL</code> extension, which was deprecated in PHP 5.5.0 and removed entirely in PHP 7.0.0.
</p>
<strong>Security Warning</strong>: This answer is not in line with security best practices. <a href="https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide" rel="noreferrer">Escaping is inadequate to prevent SQL injection</a>, use <em>prepared statements</em> instead. Use the strategy outlined below at your own risk. (Also, <code>mysql_real_escape_string()</code> was removed in PHP 7.)
</blockquote>
<p>If you’re using a recent version of PHP, the <code>mysql_real_escape_string</code> option outlined below will no longer be available (though <code>mysqli::escape_string</code> is a modern equivalent). These days the <code>mysql_real_escape_string</code> option would only make sense for legacy code on an old version of PHP.</p>
<hr>
<p>You’ve got two options - escaping the special characters in your <code>unsafe_variable</code>, or using a parameterized query. Both would protect you from SQL injection. The parameterized query is considered the better practice but will require changing to a newer MySQL extension in PHP before you can use it.</p>
<p>We’ll cover the lower impact string escaping one first.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb101-1"><a href="#cb101-1"></a><span class="op">//</span><span class="kw">Connect</span></span>
<span id="cb101-2"><a href="#cb101-2"></a></span>
<span id="cb101-3"><a href="#cb101-3"></a>$unsafe_variable <span class="op">=</span> $_POST[<span class="ot">&quot;user-input&quot;</span>];</span>
<span id="cb101-4"><a href="#cb101-4"></a>$safe_variable <span class="op">=</span> mysql_real_escape_string($unsafe_variable);</span>
<span id="cb101-5"><a href="#cb101-5"></a></span>
<span id="cb101-6"><a href="#cb101-6"></a>mysql_query(<span class="ot">&quot;INSERT INTO table (column) VALUES (&#39;&quot;</span> . $safe_variable . <span class="ot">&quot;&#39;)&quot;</span>);</span>
<span id="cb101-7"><a href="#cb101-7"></a></span>
<span id="cb101-8"><a href="#cb101-8"></a><span class="op">//</span><span class="kw">Disconnect</span></span></code></pre></div>
<p>See also, the details of the <a href="http://php.net/mysql_real_escape_string" rel="noreferrer"><code>mysql_real_escape_string</code></a> function.</p>
<p>To use the parameterized query, you need to use <a href="http://php.net/mysqli" rel="noreferrer">MySQLi</a> rather than the <a href="http://php.net/mysql" rel="noreferrer">MySQL</a> functions. To rewrite your example, we would need something like the following.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb102-1"><a href="#cb102-1"></a><span class="op">&lt;</span>?php</span>
<span id="cb102-2"><a href="#cb102-2"></a>    $mysqli <span class="op">=</span> <span class="kw">new</span> mysqli(<span class="ot">&quot;server&quot;</span>, <span class="ot">&quot;username&quot;</span>, <span class="ot">&quot;password&quot;</span>, <span class="ot">&quot;database_name&quot;</span>);</span>
<span id="cb102-3"><a href="#cb102-3"></a></span>
<span id="cb102-4"><a href="#cb102-4"></a>    <span class="op">//</span> TODO <span class="op">-</span> <span class="kw">Check</span> that connection was <span class="kw">successful</span>.</span>
<span id="cb102-5"><a href="#cb102-5"></a></span>
<span id="cb102-6"><a href="#cb102-6"></a>    $unsafe_variable <span class="op">=</span> $_POST[<span class="ot">&quot;user-input&quot;</span>];</span>
<span id="cb102-7"><a href="#cb102-7"></a></span>
<span id="cb102-8"><a href="#cb102-8"></a>    $stmt <span class="op">=</span> $mysqli<span class="op">-&gt;</span><span class="kw">prepare</span>(<span class="ot">&quot;INSERT INTO table (column) VALUES (?)&quot;</span>);</span>
<span id="cb102-9"><a href="#cb102-9"></a></span>
<span id="cb102-10"><a href="#cb102-10"></a>    <span class="op">//</span> TODO <span class="kw">check</span> that $stmt creation succeeded</span>
<span id="cb102-11"><a href="#cb102-11"></a></span>
<span id="cb102-12"><a href="#cb102-12"></a>    <span class="op">//</span> <span class="ot">&quot;s&quot;</span> means <span class="kw">the</span> <span class="kw">database</span> expects a string</span>
<span id="cb102-13"><a href="#cb102-13"></a>    $stmt<span class="op">-&gt;</span>bind_param(<span class="ot">&quot;s&quot;</span>, $unsafe_variable);</span>
<span id="cb102-14"><a href="#cb102-14"></a></span>
<span id="cb102-15"><a href="#cb102-15"></a>    $stmt<span class="op">-&gt;</span><span class="kw">execute</span>();</span>
<span id="cb102-16"><a href="#cb102-16"></a></span>
<span id="cb102-17"><a href="#cb102-17"></a>    $stmt<span class="op">-&gt;</span><span class="kw">close</span>();</span>
<span id="cb102-18"><a href="#cb102-18"></a></span>
<span id="cb102-19"><a href="#cb102-19"></a>    $mysqli<span class="op">-&gt;</span><span class="kw">close</span>();</span>
<span id="cb102-20"><a href="#cb102-20"></a>?<span class="op">&gt;</span></span></code></pre></div>
<p>The key function you’ll want to read up on there would be <a href="http://php.net/mysqli.prepare" rel="noreferrer"><code>mysqli::prepare</code></a>.</p>
<p>Also, as others have suggested, you may find it useful/easier to step up a layer of abstraction with something like <a href="http://php.net/pdo" rel="noreferrer">PDO</a>.</p>
<p>Please note that the case you asked about is a fairly simple one and that more complex cases may require more complex approaches. In particular:</p>
<ul>
<li>
If you want to alter the structure of the SQL based on user input, parameterized queries are not going to help, and the escaping required is not covered by <code>mysql_real_escape_string</code>. In this kind of case, you would be better off passing the user’s input through a whitelist to ensure only ‘safe’ values are allowed through.
</li>
<li>
If you use integers from user input in a condition and take the <code>mysql_real_escape_string</code> approach, you will suffer from the problem described by <a href="https://stackoverflow.com/users/978756/polynomial">Polynomial</a> in the comments below. This case is trickier because integers would not be surrounded by quotes, so you could deal with by validating that the user input contains only digits.
</li>
<li>
There are likely other cases I’m not aware of. You might find <a href="http://webappsec.org/projects/articles/091007.txt" rel="noreferrer">this</a> is a useful resource on some of the more subtle problems you can encounter.
</li>
</ul>
</section>
<section id="answer-3-score-1043" class="level4">
<h4>Answer 3 (score 1043)</h4>
<p>
Every answer here covers only part of the problem. In fact, there are <strong>four</strong> different query parts which we can add to it dynamically: -
</p>
<ul>
<li>
a string
</li>
<li>
a number
</li>
<li>
an identifier
</li>
<li>
a syntax keyword.
</li>
</ul>
<p>And prepared statements cover only two of them.</p>
<p>
But sometimes we have to make our query even more dynamic, adding operators or identifiers as well. So, we will need different protection techniques.
</p>
<p>In general, such a protection approach is based on <em>whitelisting</em>.</p>
<p>
In this case, every dynamic parameter should be hardcoded in your script and chosen from that set. For example, to do dynamic ordering:
</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb103-1"><a href="#cb103-1"></a>$orders  <span class="op">=</span> <span class="dt">array</span>(<span class="ot">&quot;name&quot;</span>, <span class="ot">&quot;price&quot;</span>, <span class="ot">&quot;qty&quot;</span>); <span class="op">//</span> Field names</span>
<span id="cb103-2"><a href="#cb103-2"></a>$key     <span class="op">=</span> array_search($_GET[<span class="st">&#39;sort&#39;</span>], $orders)); <span class="op">//</span> See <span class="cf">if</span> we have such a name</span>
<span id="cb103-3"><a href="#cb103-3"></a>$orderby <span class="op">=</span> $orders[$key]; <span class="op">//</span> <span class="cf">If</span> <span class="kw">not</span>, <span class="fu">first</span> one will be <span class="kw">set</span> automatically. smart enuf :)</span>
<span id="cb103-4"><a href="#cb103-4"></a>$query   <span class="op">=</span> <span class="ot">&quot;SELECT * FROM `table` ORDER BY $orderby&quot;</span>; <span class="op">//</span> <span class="fu">Value</span> <span class="kw">is</span> safe</span></code></pre></div>
<p>However, there is another way to secure identifiers - escaping. As long as you have an identifier quoted, you can escape backticks inside by doubling them.</p>
<p>As a further step, we can borrow a truly brilliant idea of using some placeholder (a proxy to represent the actual value in the query) from the prepared statements and invent a placeholder of another type - an identifier placeholder.</p>
<p>So, to make the long story short: it’s a <strong>placeholder</strong>, not <strong>prepared statement</strong> can be considered as a silver bullet.</p>
<p>
So, a general recommendation may be phrased as <strong>As long as you are adding dynamic parts to the query using placeholders (and these placeholders properly processed of course), you can be sure that your query is safe</strong>.
</p>
<p>Still, there is an issue with SQL syntax keywords (such as <code>AND</code>, <code>DESC</code> and such), but white-listing seems the only approach in this case.</p>
<h5>
Update
</h3>
<p>Although there is a general agreement on the best practices regarding SQL injection protection, there are <strong>still many bad practices as well.</strong> And some of them too deeply rooted in the minds of PHP users. For instance, on this very page there are (although invisible to most visitors) <strong>more than 80 deleted answers</strong> - all removed by the community due to bad quality or promoting bad and outdated practices. Worse yet, some of the bad answers aren’t deleted, but rather prospering.</p>
<p>For example, <a href="https://stackoverflow.com/a/11802479">there(1)</a> <a href="https://stackoverflow.com/a/6381189">are(2)</a> <a href="https://stackoverflow.com/a/60195/">still(3)</a> <a href="https://stackoverflow.com/a/12426697/">many(4)</a> <a href="https://stackoverflow.com/a/21179234">answers(5)</a>, including the <a href="https://stackoverflow.com/a/60442">second most upvoted answer</a> suggesting you manual string escaping - an outdated approach that is proven to be insecure.</p>
<p>Or there is a slightly better answer that suggests just <a href="https://stackoverflow.com/a/12710285">another method of string formatting</a> and even boasts it as the ultimate panacea. While of course, it is not. This method is no better than regular string formatting, yet it keeps all its drawbacks: it is applicable to strings only and, like any other manual formatting, it’s essentially optional, non-obligatory measure, prone to human error of any sort.</p>
<p>I think that all this because of one very old superstition, supported by such authorities like <a href="https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet#Defense_Option_4:_Escaping_All_User_Supplied_Input" rel="noreferrer">OWASP</a> or <a href="http://php.net/manual/en/function.mysql-real-escape-string.php#refsect1-function.mysql-real-escape-string-description" rel="noreferrer">the PHP manual</a>, which proclaims equality between whatever “escaping” and protection from SQL injections.</p>
<p>Regardless of what PHP manual said for ages, <strong><code>*_escape_string</code> by no means makes data safe</strong> and never has been intended to. Besides being useless for any SQL part other than string, manual escaping is wrong, because it is manual as opposite to automated.</p>
<p>And OWASP makes it even worse, stressing on escaping <em>user input</em> which is an utter nonsense: there should be no such words in the context of injection protection. Every variable is potentially dangerous - no matter the source! Or, in other words - every variable has to be properly formatted to be put into a query - no matter the source again. It’s the destination that matters. The moment a developer starts to separate the sheep from the goats (thinking whether some particular variable is “safe” or not) he/she takes his/her first step towards disaster. Not to mention that even the wording suggests bulk escaping at the entry point, resembling the very magic quotes feature - already despised, deprecated and removed.</p>
<p>So, unlike whatever “escaping”, prepared statements <em>is</em> the measure that indeed protects from SQL injection (when applicable).</p>
<p>If you’re still not convinced, here are a step-by-step explanation I wrote, <em><a href="http://phpdelusions.net/sql_injection" rel="noreferrer">The Hitchhiker’s Guide to SQL Injection prevention</a></em>, where I explained all these matters in detail and even compiled a section entirely dedicated to bad practices and their disclosure.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="sql-update-from-one-table-to-another-based-on-a-id-match-score-1639088-in-2018" class="level3">
<h3>17: SQL update from one Table to another based on a ID match (score <a href="https://stackoverflow.com/q/224732.html">1639088</a> in 2018)</h3>
<section id="question-16" class="level4">
<h4>Question</h4>
<p>I have a database with <code>account numbers</code> and <code>card numbers</code>. I match these to a file to <code>update</code> any card numbers to the account number, so that I am only working with account numbers.</p>
<p>I created a view linking the table to the account/card database to return the <code>Table ID</code> and the related account number, and now I need to update those records where the ID matches with the Account Number.</p>
<p>This is the <code>Sales_Import</code> table, where the <code>account number</code> field needs to be updated:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb104-1"><a href="#cb104-1"></a>LeadID  AccountNumber</span>
<span id="cb104-2"><a href="#cb104-2"></a><span class="dv">147</span>         <span class="dv">5807811235</span></span>
<span id="cb104-3"><a href="#cb104-3"></a><span class="dv">150</span>         <span class="dv">5807811326</span></span>
<span id="cb104-4"><a href="#cb104-4"></a><span class="dv">185</span>         <span class="dv">7006100100007267039</span></span></code></pre></div>
<p>And this is the <code>RetrieveAccountNumber</code> table, where I need to update from:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb105-1"><a href="#cb105-1"></a>LeadID  AccountNumber</span>
<span id="cb105-2"><a href="#cb105-2"></a><span class="dv">147</span>         <span class="dv">7006100100007266957</span></span>
<span id="cb105-3"><a href="#cb105-3"></a><span class="dv">150</span>         <span class="dv">7006100100007267039</span></span></code></pre></div>
<p>I tried the below, but no luck so far:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb106-1"><a href="#cb106-1"></a><span class="kw">UPDATE</span> [Sales_Lead].[dbo].[Sales_Import] </span>
<span id="cb106-2"><a href="#cb106-2"></a><span class="kw">SET</span>    [AccountNumber] <span class="op">=</span> (<span class="kw">SELECT</span> RetrieveAccountNumber.AccountNumber </span>
<span id="cb106-3"><a href="#cb106-3"></a>                          <span class="kw">FROM</span>   RetrieveAccountNumber </span>
<span id="cb106-4"><a href="#cb106-4"></a>                          <span class="kw">WHERE</span>  [Sales_Lead].[dbo].[Sales_Import]. LeadID <span class="op">=</span> </span>
<span id="cb106-5"><a href="#cb106-5"></a>                                                RetrieveAccountNumber.LeadID) </span></code></pre></div>
<p>It updates the card numbers to account numbers, but the account numbers gets replaced by <code>NULL</code></p>
</section>
<section id="answer-2-score-1298" class="level4">
<h4>Answer 2 (score 1298)</h4>
<p>I believe an <code>UPDATE FROM</code> with a <code>JOIN</code> will help:</p>
<h5>
MS SQL
</h2>
<div class="sourceCode" id="cb107"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb107-1"><a href="#cb107-1"></a><span class="kw">UPDATE</span></span>
<span id="cb107-2"><a href="#cb107-2"></a>    Sales_Import</span>
<span id="cb107-3"><a href="#cb107-3"></a><span class="kw">SET</span></span>
<span id="cb107-4"><a href="#cb107-4"></a>    Sales_Import.AccountNumber <span class="op">=</span> RAN.AccountNumber</span>
<span id="cb107-5"><a href="#cb107-5"></a><span class="kw">FROM</span></span>
<span id="cb107-6"><a href="#cb107-6"></a>    Sales_Import SI</span>
<span id="cb107-7"><a href="#cb107-7"></a><span class="kw">INNER</span> <span class="kw">JOIN</span></span>
<span id="cb107-8"><a href="#cb107-8"></a>    RetrieveAccountNumber RAN</span>
<span id="cb107-9"><a href="#cb107-9"></a><span class="kw">ON</span> </span>
<span id="cb107-10"><a href="#cb107-10"></a>    SI.LeadID <span class="op">=</span> RAN.LeadID;</span></code></pre></div>
<h5>
MySQL and MariaDB
</h2>
<div class="sourceCode" id="cb108"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb108-1"><a href="#cb108-1"></a><span class="kw">UPDATE</span></span>
<span id="cb108-2"><a href="#cb108-2"></a>    Sales_Import SI,</span>
<span id="cb108-3"><a href="#cb108-3"></a>    RetrieveAccountNumber RAN</span>
<span id="cb108-4"><a href="#cb108-4"></a><span class="kw">SET</span></span>
<span id="cb108-5"><a href="#cb108-5"></a>    SI.AccountNumber <span class="op">=</span> RAN.AccountNumber</span>
<span id="cb108-6"><a href="#cb108-6"></a><span class="kw">WHERE</span></span>
<span id="cb108-7"><a href="#cb108-7"></a>    SI.LeadID <span class="op">=</span> RAN.LeadID;</span></code></pre></div>
</section>
<section id="answer-3-score-278" class="level4">
<h4>Answer 3 (score 278)</h4>
<p>The simple Way to copy the content from one table to other is as follow:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb109-1"><a href="#cb109-1"></a><span class="kw">UPDATE</span> table2 </span>
<span id="cb109-2"><a href="#cb109-2"></a><span class="kw">SET</span> table2.col1 <span class="op">=</span> table1.col1, </span>
<span id="cb109-3"><a href="#cb109-3"></a>table2.col2 <span class="op">=</span> table1.col2,</span>
<span id="cb109-4"><a href="#cb109-4"></a><span class="op">..</span>.</span>
<span id="cb109-5"><a href="#cb109-5"></a><span class="kw">FROM</span> table1, table2 </span>
<span id="cb109-6"><a href="#cb109-6"></a><span class="kw">WHERE</span> table1.memberid <span class="op">=</span> table2.memberid</span></code></pre></div>
<p>You can also add the condition to get the particular data copied.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="sql-query-to-select-dates-between-two-dates-score-1619137-in-2017" class="level3">
<h3>18: SQL query to select dates between two dates (score <a href="https://stackoverflow.com/q/5125076.html">1619137</a> in 2017)</h3>
<section id="question-17" class="level4">
<h4>Question</h4>
<p>I have a <code>start_date</code> and <code>end_date</code>. I want to get the list of dates in between these two dates. Can anyone help me pointing the mistake in my query.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb110-1"><a href="#cb110-1"></a><span class="kw">select</span> <span class="dt">Date</span>,TotalAllowance </span>
<span id="cb110-2"><a href="#cb110-2"></a><span class="kw">from</span> Calculation </span>
<span id="cb110-3"><a href="#cb110-3"></a><span class="kw">where</span> EmployeeId<span class="op">=</span><span class="dv">1</span></span>
<span id="cb110-4"><a href="#cb110-4"></a>  <span class="kw">and</span> <span class="dt">Date</span> <span class="kw">between</span> <span class="dv">2011</span><span class="op">/</span><span class="dv">02</span><span class="op">/</span><span class="dv">25</span> <span class="kw">and</span> <span class="dv">2011</span><span class="op">/</span><span class="dv">02</span><span class="op">/</span><span class="dv">27</span></span></code></pre></div>
<p>Here <code>Date</code> is a <code>datetime</code> variable.</p>
</section>
<section id="answer-accepted-score-435" class="level4">
<h4>Answer accepted (score 435)</h4>
<p>you should put those two dates between single quotes like..</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb111-1"><a href="#cb111-1"></a><span class="kw">select</span> <span class="dt">Date</span>, TotalAllowance <span class="kw">from</span> Calculation <span class="kw">where</span> EmployeeId <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb111-2"><a href="#cb111-2"></a>             <span class="kw">and</span> <span class="dt">Date</span> <span class="kw">between</span> <span class="st">&#39;2011/02/25&#39;</span> <span class="kw">and</span> <span class="st">&#39;2011/02/27&#39;</span></span></code></pre></div>
<p>or can use</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb112-1"><a href="#cb112-1"></a><span class="kw">select</span> <span class="dt">Date</span>, TotalAllowance <span class="kw">from</span> Calculation <span class="kw">where</span> EmployeeId <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb112-2"><a href="#cb112-2"></a>             <span class="kw">and</span> <span class="dt">Date</span> <span class="op">&gt;=</span> <span class="st">&#39;2011/02/25&#39;</span> <span class="kw">and</span> <span class="dt">Date</span> <span class="op">&lt;=</span> <span class="st">&#39;2011/02/27&#39;</span></span></code></pre></div>
</section>
<section id="answer-2-score-113" class="level4">
<h4>Answer 2 (score 113)</h4>
<p>Since a datetime without a specified time segment will have a value of <code>date 00:00:00.000</code>, if you want to be sure you get all the dates in your range, you must either supply the time for your ending date or increase your ending date and use <code>&amp;lt;</code>.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb113-1"><a href="#cb113-1"></a><span class="kw">select</span> <span class="dt">Date</span>,TotalAllowance <span class="kw">from</span> Calculation <span class="kw">where</span> EmployeeId<span class="op">=</span><span class="dv">1</span> </span>
<span id="cb113-2"><a href="#cb113-2"></a><span class="kw">and</span> <span class="dt">Date</span> <span class="kw">between</span> <span class="st">&#39;2011/02/25&#39;</span> <span class="kw">and</span> <span class="st">&#39;2011/02/27 23:59:59.999&#39;</span></span></code></pre></div>
<p>OR</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb114-1"><a href="#cb114-1"></a><span class="kw">select</span> <span class="dt">Date</span>,TotalAllowance <span class="kw">from</span> Calculation <span class="kw">where</span> EmployeeId<span class="op">=</span><span class="dv">1</span> </span>
<span id="cb114-2"><a href="#cb114-2"></a><span class="kw">and</span> <span class="dt">Date</span> <span class="op">&gt;=</span> <span class="st">&#39;2011/02/25&#39;</span> <span class="kw">and</span> <span class="dt">Date</span> <span class="op">&lt;</span> <span class="st">&#39;2011/02/28&#39;</span></span></code></pre></div>
<p>OR</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb115-1"><a href="#cb115-1"></a><span class="kw">select</span> <span class="dt">Date</span>,TotalAllowance <span class="kw">from</span> Calculation <span class="kw">where</span> EmployeeId<span class="op">=</span><span class="dv">1</span> </span>
<span id="cb115-2"><a href="#cb115-2"></a><span class="kw">and</span> <span class="dt">Date</span> <span class="op">&gt;=</span> <span class="st">&#39;2011/02/25&#39;</span> <span class="kw">and</span> <span class="dt">Date</span> <span class="op">&lt;=</span> <span class="st">&#39;2011/02/27 23:59:59.999&#39;</span></span></code></pre></div>
<p>DO NOT use the following, as it could return some records from 2011/02/28 if their times are 00:00:00.000.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb116-1"><a href="#cb116-1"></a><span class="kw">select</span> <span class="dt">Date</span>,TotalAllowance <span class="kw">from</span> Calculation <span class="kw">where</span> EmployeeId<span class="op">=</span><span class="dv">1</span> </span>
<span id="cb116-2"><a href="#cb116-2"></a><span class="kw">and</span> <span class="dt">Date</span> <span class="kw">between</span> <span class="st">&#39;2011/02/25&#39;</span> <span class="kw">and</span> <span class="st">&#39;2011/02/28&#39;</span></span></code></pre></div>
</section>
<section id="answer-3-score-13" class="level4">
<h4>Answer 3 (score 13)</h4>
<p>Try this:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb117-1"><a href="#cb117-1"></a><span class="kw">select</span> <span class="dt">Date</span>,TotalAllowance <span class="kw">from</span> Calculation <span class="kw">where</span> EmployeeId<span class="op">=</span><span class="dv">1</span></span>
<span id="cb117-2"><a href="#cb117-2"></a>             <span class="kw">and</span> [<span class="dt">Date</span>] <span class="kw">between</span> <span class="st">&#39;2011/02/25&#39;</span> <span class="kw">and</span> <span class="st">&#39;2011/02/27&#39;</span></span></code></pre></div>
<p>The date values need to be typed as strings.</p>
<p>To ensure future-proofing your query for SQL Server 2008 and higher, <code>Date</code> should be escaped because it’s a reserved word in later versions.</p>
<p>Bear in mind that the dates without times take midnight as their defaults, so you may not have the correct value there.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-can-i-get-column-names-from-a-table-in-sql-server-score-1538227-in-2017" class="level3">
<h3>19: How can I get column names from a table in SQL Server? (score <a href="https://stackoverflow.com/q/1054984.html">1538227</a> in 2017)</h3>
<section id="question-18" class="level4">
<h4>Question</h4>
<p>I would like to query the name of all columns of a table. I found how to do this in:</p>
<ul>
<li>
<a href="https://stackoverflow.com/q/452464/419956">Oracle</a>
</li>
<li>
<a href="https://stackoverflow.com/q/193780/419956">MySQL</a>
</li>
<li>
<a href="https://dba.stackexchange.com/q/22362/5089">PostgreSQL</a>
</li>
</ul>
<p>But I need to know: <strong>how can this be done in <em>Microsoft SQL Server</em> (2008 in my case)?</strong></p>
</section>
<section id="answer-accepted-score-762" class="level4">
<h4>Answer accepted (score 762)</h4>
<p>You can obtain this information and much, much more by querying the <a href="http://msdn.microsoft.com/en-us/library/aa933204%28SQL.80%29.aspx" rel="noreferrer">Information Schema views</a>.</p>
<p>This sample query:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb118-1"><a href="#cb118-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb118-2"><a href="#cb118-2"></a><span class="kw">FROM</span> INFORMATION_SCHEMA.<span class="kw">COLUMNS</span></span>
<span id="cb118-3"><a href="#cb118-3"></a><span class="kw">WHERE</span> TABLE_NAME <span class="op">=</span> N<span class="st">&#39;Customers&#39;</span></span></code></pre></div>
<p>Can be made over all these DB objects:</p>
<ul>
<li>
<a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/check-constraints-transact-sql" rel="noreferrer">CHECK_CONSTRAINTS</a>
</li>
<li>
<a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/column-domain-usage-transact-sql" rel="noreferrer">COLUMN_DOMAIN_USAGE</a>
</li>
<li>
<a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/column-privileges-transact-sql" rel="noreferrer">COLUMN_PRIVILEGES</a>
</li>
<li>
<a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/columns-transact-sql" rel="noreferrer">COLUMNS</a>
</li>
<li>
<a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/constraint-column-usage-transact-sql" rel="noreferrer">CONSTRAINT_COLUMN_USAGE</a>
</li>
<li>
<a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/constraint-table-usage-transact-sql" rel="noreferrer">CONSTRAINT_TABLE_USAGE</a>
</li>
<li>
<a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/domain-constraints-transact-sql" rel="noreferrer">DOMAIN_CONSTRAINTS</a>
</li>
<li>
<a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/domains-transact-sql" rel="noreferrer">DOMAINS</a>
</li>
<li>
<a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/key-column-usage-transact-sql" rel="noreferrer">KEY_COLUMN_USAGE</a>
</li>
<li>
<a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/parameters-transact-sql" rel="noreferrer">PARAMETERS</a>
</li>
<li>
<a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/referential-constraints-transact-sql" rel="noreferrer">REFERENTIAL_CONSTRAINTS</a>
</li>
<li>
<a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/routines-transact-sql" rel="noreferrer">ROUTINES</a>
</li>
<li>
<a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/routine-columns-transact-sql" rel="noreferrer">ROUTINE_COLUMNS</a>
</li>
<li>
<a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/schemata-transact-sql" rel="noreferrer">SCHEMATA</a>
</li>
<li>
<a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/table-constraints-transact-sql" rel="noreferrer">TABLE_CONSTRAINTS</a>
</li>
<li>
<a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/table-privileges-transact-sql" rel="noreferrer">TABLE_PRIVILEGES</a>
</li>
<li>
<a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/tables-transact-sql" rel="noreferrer">TABLES</a>
</li>
<li>
<a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/view-column-usage-transact-sql" rel="noreferrer">VIEW_COLUMN_USAGE</a>
</li>
<li>
<a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/view-table-usage-transact-sql" rel="noreferrer">VIEW_TABLE_USAGE</a>
</li>
<li>
<a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-information-schema-views/views-transact-sql" rel="noreferrer">VIEWS</a>
</li>
</ul>
</section>
<section id="answer-2-score-187" class="level4">
<h4>Answer 2 (score 187)</h4>
<p>You can use the stored procedure sp_columns which would return information pertaining to all columns for a given table. More info can be found here <a href="http://msdn.microsoft.com/en-us/library/ms176077.aspx" rel="noreferrer">http://msdn.microsoft.com/en-us/library/ms176077.aspx</a></p>
<p>You can also do it by a SQL query. Some thing like this should help:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb119-1"><a href="#cb119-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> sys.<span class="kw">columns</span> <span class="kw">WHERE</span> object_id <span class="op">=</span> OBJECT_ID(<span class="st">&#39;dbo.yourTableName&#39;</span>) </span></code></pre></div>
<p>Or a variation would be:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb120-1"><a href="#cb120-1"></a><span class="kw">SELECT</span>   o.Name, c.Name</span>
<span id="cb120-2"><a href="#cb120-2"></a><span class="kw">FROM</span>     sys.<span class="kw">columns</span> c </span>
<span id="cb120-3"><a href="#cb120-3"></a>         <span class="kw">JOIN</span> sys.objects o <span class="kw">ON</span> o.object_id <span class="op">=</span> c.object_id </span>
<span id="cb120-4"><a href="#cb120-4"></a><span class="kw">WHERE</span>    o.<span class="kw">type</span> <span class="op">=</span> <span class="st">&#39;U&#39;</span> </span>
<span id="cb120-5"><a href="#cb120-5"></a><span class="kw">ORDER</span> <span class="kw">BY</span> o.Name, c.Name</span></code></pre></div>
<p>This gets all columns from all tables, ordered by table name and then on column name.</p>
</section>
<section id="answer-3-score-141" class="level4">
<h4>Answer 3 (score 141)</h4>
<div class="sourceCode" id="cb121"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb121-1"><a href="#cb121-1"></a><span class="kw">select</span> <span class="op">*</span></span>
<span id="cb121-2"><a href="#cb121-2"></a><span class="kw">from</span> INFORMATION_SCHEMA.<span class="kw">COLUMNS</span></span>
<span id="cb121-3"><a href="#cb121-3"></a><span class="kw">where</span> TABLE_NAME<span class="op">=</span><span class="st">&#39;tableName&#39;</span></span></code></pre></div>
<p>This is better than getting from <code>sys.columns</code> because it shows <code>DATA_TYPE</code> directly.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-can-i-do-an-update-statement-with-join-in-sql-score-1502329-in-2018" class="level3">
<h3>20: How can I do an UPDATE statement with JOIN in SQL? (score <a href="https://stackoverflow.com/q/1293330.html">1502329</a> in 2018)</h3>
<section id="question-19" class="level4">
<h4>Question</h4>
<p>I need to update this table in <strong>SQL Server 2005</strong> with data from its ‘parent’ table, see below:</p>
<p><strong>sale</strong></p>
<div class="sourceCode" id="cb122"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb122-1"><a href="#cb122-1"></a><span class="kw">id</span> (<span class="dt">int</span>)</span>
<span id="cb122-2"><a href="#cb122-2"></a>udid (<span class="dt">int</span>)</span>
<span id="cb122-3"><a href="#cb122-3"></a>assid (<span class="dt">int</span>)</span></code></pre></div>
<p><strong>ud</strong></p>
<div class="sourceCode" id="cb123"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb123-1"><a href="#cb123-1"></a><span class="kw">id</span>  (<span class="dt">int</span>)</span>
<span id="cb123-2"><a href="#cb123-2"></a>assid  (<span class="dt">int</span>)</span></code></pre></div>
<p><code>sale.assid</code> contains the correct value to update <code>ud.assid</code>.</p>
<p>What query will do this? I’m thinking a <code>join</code> but I’m not sure if it’s possible.</p>
</section>
<section id="answer-accepted-score-2284" class="level4">
<h4>Answer accepted (score 2284)</h4>
<p>Syntax strictly depends on which SQL DBMS you’re using. Here are some ways to do it in ANSI/ISO (aka should work on any SQL DBMS), MySQL, SQL Server, and Oracle. Be advised that my suggested ANSI/ISO method will typically be much slower than the other two methods, but if you’re using a SQL DBMS other than MySQL, SQL Server, or Oracle, then it may be the only way to go (e.g. if your SQL DBMS doesn’t support <code>MERGE</code>):</p>
<p>ANSI/ISO:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb124-1"><a href="#cb124-1"></a><span class="kw">update</span> ud </span>
<span id="cb124-2"><a href="#cb124-2"></a>     <span class="kw">set</span> assid <span class="op">=</span> (</span>
<span id="cb124-3"><a href="#cb124-3"></a>          <span class="kw">select</span> sale.assid </span>
<span id="cb124-4"><a href="#cb124-4"></a>          <span class="kw">from</span> sale </span>
<span id="cb124-5"><a href="#cb124-5"></a>          <span class="kw">where</span> sale.udid <span class="op">=</span> ud.<span class="kw">id</span></span>
<span id="cb124-6"><a href="#cb124-6"></a>     )</span>
<span id="cb124-7"><a href="#cb124-7"></a> <span class="kw">where</span> <span class="kw">exists</span> (</span>
<span id="cb124-8"><a href="#cb124-8"></a>      <span class="kw">select</span> <span class="op">*</span> </span>
<span id="cb124-9"><a href="#cb124-9"></a>      <span class="kw">from</span> sale </span>
<span id="cb124-10"><a href="#cb124-10"></a>      <span class="kw">where</span> sale.udid <span class="op">=</span> ud.<span class="kw">id</span></span>
<span id="cb124-11"><a href="#cb124-11"></a> );</span></code></pre></div>
<p>MySQL:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb125-1"><a href="#cb125-1"></a><span class="kw">update</span> ud u</span>
<span id="cb125-2"><a href="#cb125-2"></a><span class="kw">inner</span> <span class="kw">join</span> sale s <span class="kw">on</span></span>
<span id="cb125-3"><a href="#cb125-3"></a>    u.<span class="kw">id</span> <span class="op">=</span> s.udid</span>
<span id="cb125-4"><a href="#cb125-4"></a><span class="kw">set</span> u.assid <span class="op">=</span> s.assid</span></code></pre></div>
<p>SQL Server:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb126-1"><a href="#cb126-1"></a><span class="kw">update</span> u</span>
<span id="cb126-2"><a href="#cb126-2"></a><span class="kw">set</span> u.assid <span class="op">=</span> s.assid</span>
<span id="cb126-3"><a href="#cb126-3"></a><span class="kw">from</span> ud u</span>
<span id="cb126-4"><a href="#cb126-4"></a>    <span class="kw">inner</span> <span class="kw">join</span> sale s <span class="kw">on</span></span>
<span id="cb126-5"><a href="#cb126-5"></a>        u.<span class="kw">id</span> <span class="op">=</span> s.udid</span></code></pre></div>
<p>PostgreSQL:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb127-1"><a href="#cb127-1"></a><span class="kw">update</span> ud</span>
<span id="cb127-2"><a href="#cb127-2"></a>  <span class="kw">set</span> ud.assid <span class="op">=</span> s.assid</span>
<span id="cb127-3"><a href="#cb127-3"></a><span class="kw">from</span> sale s </span>
<span id="cb127-4"><a href="#cb127-4"></a><span class="kw">where</span> ud.<span class="kw">id</span> <span class="op">=</span> s.udid;</span></code></pre></div>
<p>Note that the target table must not be repeated in the <code>FROM</code> clause for Postgres.</p>
<p>Oracle:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb128-1"><a href="#cb128-1"></a><span class="kw">update</span></span>
<span id="cb128-2"><a href="#cb128-2"></a>    (<span class="kw">select</span></span>
<span id="cb128-3"><a href="#cb128-3"></a>        u.assid <span class="kw">as</span> new_assid,</span>
<span id="cb128-4"><a href="#cb128-4"></a>        s.assid <span class="kw">as</span> old_assid</span>
<span id="cb128-5"><a href="#cb128-5"></a>    <span class="kw">from</span> ud u</span>
<span id="cb128-6"><a href="#cb128-6"></a>        <span class="kw">inner</span> <span class="kw">join</span> sale s <span class="kw">on</span></span>
<span id="cb128-7"><a href="#cb128-7"></a>            u.<span class="kw">id</span> <span class="op">=</span> s.udid) up</span>
<span id="cb128-8"><a href="#cb128-8"></a><span class="kw">set</span> up.new_assid <span class="op">=</span> up.old_assid</span></code></pre></div>
<p>SQLite:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb129-1"><a href="#cb129-1"></a><span class="kw">update</span> ud </span>
<span id="cb129-2"><a href="#cb129-2"></a>     <span class="kw">set</span> assid <span class="op">=</span> (</span>
<span id="cb129-3"><a href="#cb129-3"></a>          <span class="kw">select</span> sale.assid </span>
<span id="cb129-4"><a href="#cb129-4"></a>          <span class="kw">from</span> sale </span>
<span id="cb129-5"><a href="#cb129-5"></a>          <span class="kw">where</span> sale.udid <span class="op">=</span> ud.<span class="kw">id</span></span>
<span id="cb129-6"><a href="#cb129-6"></a>     )</span>
<span id="cb129-7"><a href="#cb129-7"></a> <span class="kw">where</span> <span class="dt">RowID</span> <span class="kw">in</span> (</span>
<span id="cb129-8"><a href="#cb129-8"></a>      <span class="kw">select</span> <span class="dt">RowID</span> </span>
<span id="cb129-9"><a href="#cb129-9"></a>      <span class="kw">from</span> ud </span>
<span id="cb129-10"><a href="#cb129-10"></a>      <span class="kw">where</span> sale.udid <span class="op">=</span> ud.<span class="kw">id</span></span>
<span id="cb129-11"><a href="#cb129-11"></a> );</span></code></pre></div>
</section>
<section id="answer-2-score-139" class="level4">
<h4>Answer 2 (score 139)</h4>
<p>This should work in SQL Server:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb130-1"><a href="#cb130-1"></a><span class="kw">update</span> ud </span>
<span id="cb130-2"><a href="#cb130-2"></a><span class="kw">set</span> assid <span class="op">=</span> sale.assid</span>
<span id="cb130-3"><a href="#cb130-3"></a><span class="kw">from</span> sale</span>
<span id="cb130-4"><a href="#cb130-4"></a><span class="kw">where</span> sale.udid <span class="op">=</span> <span class="kw">id</span></span></code></pre></div>
</section>
<section id="answer-3-score-93" class="level4">
<h4>Answer 3 (score 93)</h4>
<p>postgres</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb131-1"><a href="#cb131-1"></a><span class="kw">UPDATE</span> table1</span>
<span id="cb131-2"><a href="#cb131-2"></a><span class="kw">SET</span>    <span class="kw">COLUMN</span> <span class="op">=</span> <span class="fu">value</span></span>
<span id="cb131-3"><a href="#cb131-3"></a><span class="kw">FROM</span>   table2,</span>
<span id="cb131-4"><a href="#cb131-4"></a>       table3</span>
<span id="cb131-5"><a href="#cb131-5"></a><span class="kw">WHERE</span>  table1.column_id <span class="op">=</span> table2.<span class="kw">id</span></span>
<span id="cb131-6"><a href="#cb131-6"></a>       <span class="kw">AND</span> table1.column_id <span class="op">=</span> table3.<span class="kw">id</span></span>
<span id="cb131-7"><a href="#cb131-7"></a>       <span class="kw">AND</span> table1.<span class="kw">COLUMN</span> <span class="op">=</span> <span class="fu">value</span></span>
<span id="cb131-8"><a href="#cb131-8"></a>       <span class="kw">AND</span> table2.<span class="kw">COLUMN</span> <span class="op">=</span> <span class="fu">value</span></span>
<span id="cb131-9"><a href="#cb131-9"></a>       <span class="kw">AND</span> table3.<span class="kw">COLUMN</span> <span class="op">=</span> <span class="fu">value</span> </span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-can-i-select-rows-with-maxcolumn-value-distinct-by-another-column-in-sql-score-1406300-in-2018" class="level3">
<h3>21: How can I SELECT rows with MAX(Column value), DISTINCT by another column in SQL? (score <a href="https://stackoverflow.com/q/612231.html">1406300</a> in 2018)</h3>
<section id="question-20" class="level4">
<h4>Question</h4>
<p><strong>My table is:</strong></p>
<div class="sourceCode" id="cb132"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb132-1"><a href="#cb132-1"></a><span class="kw">id</span>  home  datetime     player   <span class="kw">resource</span></span>
<span id="cb132-2"><a href="#cb132-2"></a><span class="co">---|-----|------------|--------|---------</span></span>
<span id="cb132-3"><a href="#cb132-3"></a><span class="dv">1</span>  | <span class="dv">10</span>  | <span class="dv">04</span><span class="op">/</span><span class="dv">03</span><span class="op">/</span><span class="dv">2009</span> | john   | <span class="dv">399</span> </span>
<span id="cb132-4"><a href="#cb132-4"></a><span class="dv">2</span>  | <span class="dv">11</span>  | <span class="dv">04</span><span class="op">/</span><span class="dv">03</span><span class="op">/</span><span class="dv">2009</span> | juliet | <span class="dv">244</span></span>
<span id="cb132-5"><a href="#cb132-5"></a><span class="dv">5</span>  | <span class="dv">12</span>  | <span class="dv">04</span><span class="op">/</span><span class="dv">03</span><span class="op">/</span><span class="dv">2009</span> | borat  | <span class="dv">555</span></span>
<span id="cb132-6"><a href="#cb132-6"></a><span class="dv">3</span>  | <span class="dv">10</span>  | <span class="dv">03</span><span class="op">/</span><span class="dv">03</span><span class="op">/</span><span class="dv">2009</span> | john   | <span class="dv">300</span></span>
<span id="cb132-7"><a href="#cb132-7"></a><span class="dv">4</span>  | <span class="dv">11</span>  | <span class="dv">03</span><span class="op">/</span><span class="dv">03</span><span class="op">/</span><span class="dv">2009</span> | juliet | <span class="dv">200</span></span>
<span id="cb132-8"><a href="#cb132-8"></a><span class="dv">6</span>  | <span class="dv">12</span>  | <span class="dv">03</span><span class="op">/</span><span class="dv">03</span><span class="op">/</span><span class="dv">2009</span> | borat  | <span class="dv">500</span></span>
<span id="cb132-9"><a href="#cb132-9"></a><span class="dv">7</span>  | <span class="dv">13</span>  | <span class="dv">24</span><span class="op">/</span><span class="dv">12</span><span class="op">/</span><span class="dv">2008</span> | borat  | <span class="dv">600</span></span>
<span id="cb132-10"><a href="#cb132-10"></a><span class="dv">8</span>  | <span class="dv">13</span>  | <span class="dv">01</span><span class="op">/</span><span class="dv">01</span><span class="op">/</span><span class="dv">2009</span> | borat  | <span class="dv">700</span></span></code></pre></div>
<p>I need to select each distinct <code>home</code> holding the maximum value of <code>datetime</code>.</p>
<p><strong>Result would be:</strong></p>
<div class="sourceCode" id="cb133"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb133-1"><a href="#cb133-1"></a><span class="kw">id</span>  home  datetime     player   <span class="kw">resource</span> </span>
<span id="cb133-2"><a href="#cb133-2"></a><span class="co">---|-----|------------|--------|---------</span></span>
<span id="cb133-3"><a href="#cb133-3"></a><span class="dv">1</span>  | <span class="dv">10</span>  | <span class="dv">04</span><span class="op">/</span><span class="dv">03</span><span class="op">/</span><span class="dv">2009</span> | john   | <span class="dv">399</span></span>
<span id="cb133-4"><a href="#cb133-4"></a><span class="dv">2</span>  | <span class="dv">11</span>  | <span class="dv">04</span><span class="op">/</span><span class="dv">03</span><span class="op">/</span><span class="dv">2009</span> | juliet | <span class="dv">244</span></span>
<span id="cb133-5"><a href="#cb133-5"></a><span class="dv">5</span>  | <span class="dv">12</span>  | <span class="dv">04</span><span class="op">/</span><span class="dv">03</span><span class="op">/</span><span class="dv">2009</span> | borat  | <span class="dv">555</span></span>
<span id="cb133-6"><a href="#cb133-6"></a><span class="dv">8</span>  | <span class="dv">13</span>  | <span class="dv">01</span><span class="op">/</span><span class="dv">01</span><span class="op">/</span><span class="dv">2009</span> | borat  | <span class="dv">700</span></span></code></pre></div>
<p><strong>I have tried:</strong></p>
<div class="sourceCode" id="cb134"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb134-1"><a href="#cb134-1"></a><span class="co">-- 1 ..by the MySQL manual: </span></span>
<span id="cb134-2"><a href="#cb134-2"></a></span>
<span id="cb134-3"><a href="#cb134-3"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span></span>
<span id="cb134-4"><a href="#cb134-4"></a>  home,</span>
<span id="cb134-5"><a href="#cb134-5"></a>  <span class="kw">id</span>,</span>
<span id="cb134-6"><a href="#cb134-6"></a>  datetime <span class="kw">AS</span> dt,</span>
<span id="cb134-7"><a href="#cb134-7"></a>  player,</span>
<span id="cb134-8"><a href="#cb134-8"></a>  <span class="kw">resource</span></span>
<span id="cb134-9"><a href="#cb134-9"></a><span class="kw">FROM</span> topten t1</span>
<span id="cb134-10"><a href="#cb134-10"></a><span class="kw">WHERE</span> datetime <span class="op">=</span> (<span class="kw">SELECT</span></span>
<span id="cb134-11"><a href="#cb134-11"></a>  <span class="fu">MAX</span>(t2.datetime)</span>
<span id="cb134-12"><a href="#cb134-12"></a><span class="kw">FROM</span> topten t2</span>
<span id="cb134-13"><a href="#cb134-13"></a><span class="kw">GROUP</span> <span class="kw">BY</span> home)</span>
<span id="cb134-14"><a href="#cb134-14"></a><span class="kw">GROUP</span> <span class="kw">BY</span> datetime</span>
<span id="cb134-15"><a href="#cb134-15"></a><span class="kw">ORDER</span> <span class="kw">BY</span> datetime <span class="kw">DESC</span></span></code></pre></div>
<p>
Doesn’t work. Result-set has 130 rows although database holds 187. Result includes some duplicates of <code>home</code>.
</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb135-1"><a href="#cb135-1"></a><span class="co">-- 2 ..join</span></span>
<span id="cb135-2"><a href="#cb135-2"></a></span>
<span id="cb135-3"><a href="#cb135-3"></a><span class="kw">SELECT</span></span>
<span id="cb135-4"><a href="#cb135-4"></a>  s1.<span class="kw">id</span>,</span>
<span id="cb135-5"><a href="#cb135-5"></a>  s1.home,</span>
<span id="cb135-6"><a href="#cb135-6"></a>  s1.datetime,</span>
<span id="cb135-7"><a href="#cb135-7"></a>  s1.player,</span>
<span id="cb135-8"><a href="#cb135-8"></a>  s1.<span class="kw">resource</span></span>
<span id="cb135-9"><a href="#cb135-9"></a><span class="kw">FROM</span> topten s1</span>
<span id="cb135-10"><a href="#cb135-10"></a><span class="kw">JOIN</span> (<span class="kw">SELECT</span></span>
<span id="cb135-11"><a href="#cb135-11"></a>  <span class="kw">id</span>,</span>
<span id="cb135-12"><a href="#cb135-12"></a>  <span class="fu">MAX</span>(datetime) <span class="kw">AS</span> dt</span>
<span id="cb135-13"><a href="#cb135-13"></a><span class="kw">FROM</span> topten</span>
<span id="cb135-14"><a href="#cb135-14"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="kw">id</span>) <span class="kw">AS</span> s2</span>
<span id="cb135-15"><a href="#cb135-15"></a>  <span class="kw">ON</span> s1.<span class="kw">id</span> <span class="op">=</span> s2.<span class="kw">id</span></span>
<span id="cb135-16"><a href="#cb135-16"></a><span class="kw">ORDER</span> <span class="kw">BY</span> datetime </span></code></pre></div>
<p>Nope. Gives all the records.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb136-1"><a href="#cb136-1"></a><span class="co">-- 3 ..something exotic: </span></span></code></pre></div>
<p>With various results.</p>
</section>
<section id="answer-accepted-score-880" class="level4">
<h4>Answer accepted (score 880)</h4>
<p>You are so close! All you need to do is select BOTH the home and its max date time, then join back to the <code>topten</code> table on BOTH fields:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb137-1"><a href="#cb137-1"></a><span class="kw">SELECT</span> tt.<span class="op">*</span></span>
<span id="cb137-2"><a href="#cb137-2"></a><span class="kw">FROM</span> topten tt</span>
<span id="cb137-3"><a href="#cb137-3"></a><span class="kw">INNER</span> <span class="kw">JOIN</span></span>
<span id="cb137-4"><a href="#cb137-4"></a>    (<span class="kw">SELECT</span> home, <span class="fu">MAX</span>(datetime) <span class="kw">AS</span> MaxDateTime</span>
<span id="cb137-5"><a href="#cb137-5"></a>    <span class="kw">FROM</span> topten</span>
<span id="cb137-6"><a href="#cb137-6"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span> home) groupedtt </span>
<span id="cb137-7"><a href="#cb137-7"></a><span class="kw">ON</span> tt.home <span class="op">=</span> groupedtt.home </span>
<span id="cb137-8"><a href="#cb137-8"></a><span class="kw">AND</span> tt.datetime <span class="op">=</span> groupedtt.MaxDateTime</span></code></pre></div>
</section>
<section id="answer-2-score-71" class="level4">
<h4>Answer 2 (score 71)</h4>
<p>Here goes <strong>T-SQL</strong> version:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb138-1"><a href="#cb138-1"></a><span class="co">-- Test data</span></span>
<span id="cb138-2"><a href="#cb138-2"></a><span class="kw">DECLARE</span> @TestTable <span class="kw">TABLE</span> (<span class="kw">id</span> <span class="dt">INT</span>, home <span class="dt">INT</span>, <span class="dt">date</span> DATETIME, </span>
<span id="cb138-3"><a href="#cb138-3"></a>  player <span class="dt">VARCHAR</span>(<span class="dv">20</span>), <span class="kw">resource</span> <span class="dt">INT</span>)</span>
<span id="cb138-4"><a href="#cb138-4"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> @TestTable</span>
<span id="cb138-5"><a href="#cb138-5"></a><span class="kw">SELECT</span> <span class="dv">1</span>, <span class="dv">10</span>, <span class="st">&#39;2009-03-04&#39;</span>, <span class="st">&#39;john&#39;</span>, <span class="dv">399</span> <span class="kw">UNION</span></span>
<span id="cb138-6"><a href="#cb138-6"></a><span class="kw">SELECT</span> <span class="dv">2</span>, <span class="dv">11</span>, <span class="st">&#39;2009-03-04&#39;</span>, <span class="st">&#39;juliet&#39;</span>, <span class="dv">244</span> <span class="kw">UNION</span></span>
<span id="cb138-7"><a href="#cb138-7"></a><span class="kw">SELECT</span> <span class="dv">5</span>, <span class="dv">12</span>, <span class="st">&#39;2009-03-04&#39;</span>, <span class="st">&#39;borat&#39;</span>, <span class="dv">555</span> <span class="kw">UNION</span></span>
<span id="cb138-8"><a href="#cb138-8"></a><span class="kw">SELECT</span> <span class="dv">3</span>, <span class="dv">10</span>, <span class="st">&#39;2009-03-03&#39;</span>, <span class="st">&#39;john&#39;</span>, <span class="dv">300</span> <span class="kw">UNION</span></span>
<span id="cb138-9"><a href="#cb138-9"></a><span class="kw">SELECT</span> <span class="dv">4</span>, <span class="dv">11</span>, <span class="st">&#39;2009-03-03&#39;</span>, <span class="st">&#39;juliet&#39;</span>, <span class="dv">200</span> <span class="kw">UNION</span></span>
<span id="cb138-10"><a href="#cb138-10"></a><span class="kw">SELECT</span> <span class="dv">6</span>, <span class="dv">12</span>, <span class="st">&#39;2009-03-03&#39;</span>, <span class="st">&#39;borat&#39;</span>, <span class="dv">500</span> <span class="kw">UNION</span></span>
<span id="cb138-11"><a href="#cb138-11"></a><span class="kw">SELECT</span> <span class="dv">7</span>, <span class="dv">13</span>, <span class="st">&#39;2008-12-24&#39;</span>, <span class="st">&#39;borat&#39;</span>, <span class="dv">600</span> <span class="kw">UNION</span></span>
<span id="cb138-12"><a href="#cb138-12"></a><span class="kw">SELECT</span> <span class="dv">8</span>, <span class="dv">13</span>, <span class="st">&#39;2009-01-01&#39;</span>, <span class="st">&#39;borat&#39;</span>, <span class="dv">700</span></span>
<span id="cb138-13"><a href="#cb138-13"></a></span>
<span id="cb138-14"><a href="#cb138-14"></a><span class="co">-- Answer</span></span>
<span id="cb138-15"><a href="#cb138-15"></a><span class="kw">SELECT</span> <span class="kw">id</span>, home, <span class="dt">date</span>, player, <span class="kw">resource</span> </span>
<span id="cb138-16"><a href="#cb138-16"></a><span class="kw">FROM</span> (<span class="kw">SELECT</span> <span class="kw">id</span>, home, <span class="dt">date</span>, player, <span class="kw">resource</span>, </span>
<span id="cb138-17"><a href="#cb138-17"></a>    <span class="fu">RANK</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> home <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dt">date</span> <span class="kw">DESC</span>) N</span>
<span id="cb138-18"><a href="#cb138-18"></a>    <span class="kw">FROM</span> @TestTable</span>
<span id="cb138-19"><a href="#cb138-19"></a>)M <span class="kw">WHERE</span> N <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb138-20"><a href="#cb138-20"></a></span>
<span id="cb138-21"><a href="#cb138-21"></a><span class="co">-- and if you really want only home with max date</span></span>
<span id="cb138-22"><a href="#cb138-22"></a><span class="kw">SELECT</span> T.<span class="kw">id</span>, T.home, T.<span class="dt">date</span>, T.player, T.<span class="kw">resource</span> </span>
<span id="cb138-23"><a href="#cb138-23"></a>    <span class="kw">FROM</span> @TestTable T</span>
<span id="cb138-24"><a href="#cb138-24"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> </span>
<span id="cb138-25"><a href="#cb138-25"></a>(   <span class="kw">SELECT</span> TI.<span class="kw">id</span>, TI.home, TI.<span class="dt">date</span>, </span>
<span id="cb138-26"><a href="#cb138-26"></a>        <span class="fu">RANK</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> TI.home <span class="kw">ORDER</span> <span class="kw">BY</span> TI.<span class="dt">date</span>) N</span>
<span id="cb138-27"><a href="#cb138-27"></a>    <span class="kw">FROM</span> @TestTable TI</span>
<span id="cb138-28"><a href="#cb138-28"></a>    <span class="kw">WHERE</span> TI.<span class="dt">date</span> <span class="kw">IN</span> (<span class="kw">SELECT</span> <span class="fu">MAX</span>(TM.<span class="dt">date</span>) <span class="kw">FROM</span> @TestTable TM)</span>
<span id="cb138-29"><a href="#cb138-29"></a>)TJ <span class="kw">ON</span> TJ.N <span class="op">=</span> <span class="dv">1</span> <span class="kw">AND</span> T.<span class="kw">id</span> <span class="op">=</span> TJ.<span class="kw">id</span></span></code></pre></div>
<p>
<strong>EDIT</strong><br> Unfortunately, there are no RANK() OVER function in MySQL.<br> But it can be emulated, see <a href="http://www.oreillynet.com/pub/a/mysql/2007/03/29/emulating-analytic-aka-ranking-functions-with-mysql.html?page=3" rel="noreferrer">Emulating Analytic (AKA Ranking) Functions with MySQL</a>.<br> So this is <strong>MySQL</strong> version:
</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb139-1"><a href="#cb139-1"></a><span class="kw">SELECT</span> <span class="kw">id</span>, home, <span class="dt">date</span>, player, <span class="kw">resource</span> </span>
<span id="cb139-2"><a href="#cb139-2"></a><span class="kw">FROM</span> TestTable <span class="kw">AS</span> t1 </span>
<span id="cb139-3"><a href="#cb139-3"></a><span class="kw">WHERE</span> </span>
<span id="cb139-4"><a href="#cb139-4"></a>    (<span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) </span>
<span id="cb139-5"><a href="#cb139-5"></a>            <span class="kw">FROM</span> TestTable <span class="kw">AS</span> t2 </span>
<span id="cb139-6"><a href="#cb139-6"></a>            <span class="kw">WHERE</span> t2.home <span class="op">=</span> t1.home <span class="kw">AND</span> t2.<span class="dt">date</span> <span class="op">&gt;</span> t1.<span class="dt">date</span></span>
<span id="cb139-7"><a href="#cb139-7"></a>    ) <span class="op">=</span> <span class="dv">0</span></span></code></pre></div>
</section>
<section id="answer-3-score-68" class="level4">
<h4>Answer 3 (score 68)</h4>
<p>The fastest <code>MySQL</code> solution, without inner queries and without <code>GROUP BY</code>:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb140-1"><a href="#cb140-1"></a><span class="kw">SELECT</span> m.<span class="op">*</span>                    <span class="co">-- get the row that contains the max value</span></span>
<span id="cb140-2"><a href="#cb140-2"></a><span class="kw">FROM</span> topten m                 <span class="co">-- &quot;m&quot; from &quot;max&quot;</span></span>
<span id="cb140-3"><a href="#cb140-3"></a>    <span class="kw">LEFT</span> <span class="kw">JOIN</span> topten b        <span class="co">-- &quot;b&quot; from &quot;bigger&quot;</span></span>
<span id="cb140-4"><a href="#cb140-4"></a>        <span class="kw">ON</span> m.home <span class="op">=</span> b.home    <span class="co">-- match &quot;max&quot; row with &quot;bigger&quot; row by `home`</span></span>
<span id="cb140-5"><a href="#cb140-5"></a>        <span class="kw">AND</span> m.datetime <span class="op">&lt;</span> b.datetime           <span class="co">-- want &quot;bigger&quot; than &quot;max&quot;</span></span>
<span id="cb140-6"><a href="#cb140-6"></a><span class="kw">WHERE</span> b.datetime <span class="kw">IS</span> <span class="kw">NULL</span>      <span class="co">-- keep only if there is no bigger than max</span></span></code></pre></div>
<p><strong>Explanation</strong>:</p>
<p>Join the table with itself using the <code>home</code> column. The use of <code>LEFT JOIN</code> ensures all the rows from table <code>m</code> appear in the result set. Those that don’t have a match in table <code>b</code> will have <code>NULL</code>s for the columns of <code>b</code>.</p>
<p>The other condition on the <code>JOIN</code> asks to match only the rows from <code>b</code> that have bigger value on the <code>datetime</code> column than the row from <code>m</code>.</p>
<p>Using the data posted in the question, the <code>LEFT JOIN</code> will produce this pairs:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb141-1"><a href="#cb141-1"></a><span class="op">+</span><span class="co">------------------------------------------+--------------------------------+</span></span>
<span id="cb141-2"><a href="#cb141-2"></a>|              <span class="kw">the</span> <span class="kw">row</span> <span class="kw">from</span> `m`            |    <span class="kw">the</span> matching <span class="kw">row</span> <span class="kw">from</span> `b`   |</span>
<span id="cb141-3"><a href="#cb141-3"></a>|<span class="co">------------------------------------------|--------------------------------|</span></span>
<span id="cb141-4"><a href="#cb141-4"></a>| <span class="kw">id</span>  home  datetime     player   <span class="kw">resource</span> | <span class="kw">id</span>    home   datetime      <span class="op">..</span>. |</span>
<span id="cb141-5"><a href="#cb141-5"></a>|<span class="co">----|-----|------------|--------|---------|------|------|------------|-----|</span></span>
<span id="cb141-6"><a href="#cb141-6"></a>| <span class="dv">1</span>  | <span class="dv">10</span>  | <span class="dv">04</span><span class="op">/</span><span class="dv">03</span><span class="op">/</span><span class="dv">2009</span> | john   | <span class="dv">399</span>     | <span class="kw">NULL</span> | <span class="kw">NULL</span> | <span class="kw">NULL</span>       | <span class="op">..</span>. | <span class="op">*</span></span>
<span id="cb141-7"><a href="#cb141-7"></a>| <span class="dv">2</span>  | <span class="dv">11</span>  | <span class="dv">04</span><span class="op">/</span><span class="dv">03</span><span class="op">/</span><span class="dv">2009</span> | juliet | <span class="dv">244</span>     | <span class="kw">NULL</span> | <span class="kw">NULL</span> | <span class="kw">NULL</span>       | <span class="op">..</span>. | <span class="op">*</span></span>
<span id="cb141-8"><a href="#cb141-8"></a>| <span class="dv">5</span>  | <span class="dv">12</span>  | <span class="dv">04</span><span class="op">/</span><span class="dv">03</span><span class="op">/</span><span class="dv">2009</span> | borat  | <span class="dv">555</span>     | <span class="kw">NULL</span> | <span class="kw">NULL</span> | <span class="kw">NULL</span>       | <span class="op">..</span>. | <span class="op">*</span></span>
<span id="cb141-9"><a href="#cb141-9"></a>| <span class="dv">3</span>  | <span class="dv">10</span>  | <span class="dv">03</span><span class="op">/</span><span class="dv">03</span><span class="op">/</span><span class="dv">2009</span> | john   | <span class="dv">300</span>     | <span class="dv">1</span>    | <span class="dv">10</span>   | <span class="dv">04</span><span class="op">/</span><span class="dv">03</span><span class="op">/</span><span class="dv">2009</span> | <span class="op">..</span>. |</span>
<span id="cb141-10"><a href="#cb141-10"></a>| <span class="dv">4</span>  | <span class="dv">11</span>  | <span class="dv">03</span><span class="op">/</span><span class="dv">03</span><span class="op">/</span><span class="dv">2009</span> | juliet | <span class="dv">200</span>     | <span class="dv">2</span>    | <span class="dv">11</span>   | <span class="dv">04</span><span class="op">/</span><span class="dv">03</span><span class="op">/</span><span class="dv">2009</span> | <span class="op">..</span>. |</span>
<span id="cb141-11"><a href="#cb141-11"></a>| <span class="dv">6</span>  | <span class="dv">12</span>  | <span class="dv">03</span><span class="op">/</span><span class="dv">03</span><span class="op">/</span><span class="dv">2009</span> | borat  | <span class="dv">500</span>     | <span class="dv">5</span>    | <span class="dv">12</span>   | <span class="dv">04</span><span class="op">/</span><span class="dv">03</span><span class="op">/</span><span class="dv">2009</span> | <span class="op">..</span>. |</span>
<span id="cb141-12"><a href="#cb141-12"></a>| <span class="dv">7</span>  | <span class="dv">13</span>  | <span class="dv">24</span><span class="op">/</span><span class="dv">12</span><span class="op">/</span><span class="dv">2008</span> | borat  | <span class="dv">600</span>     | <span class="dv">8</span>    | <span class="dv">13</span>   | <span class="dv">01</span><span class="op">/</span><span class="dv">01</span><span class="op">/</span><span class="dv">2009</span> | <span class="op">..</span>. |</span>
<span id="cb141-13"><a href="#cb141-13"></a>| <span class="dv">8</span>  | <span class="dv">13</span>  | <span class="dv">01</span><span class="op">/</span><span class="dv">01</span><span class="op">/</span><span class="dv">2009</span> | borat  | <span class="dv">700</span>     | <span class="kw">NULL</span> | <span class="kw">NULL</span> | <span class="kw">NULL</span>       | <span class="op">..</span>. | <span class="op">*</span></span>
<span id="cb141-14"><a href="#cb141-14"></a><span class="op">+</span><span class="co">------------------------------------------+--------------------------------+</span></span></code></pre></div>
<p>Finally, the <code>WHERE</code> clause keeps only the pairs that have <code>NULL</code>s in the columns of <code>b</code> (they are marked with <code>*</code> in the table above); this means, due to the second condition from the <code>JOIN</code> clause, the row selected from <code>m</code> has the biggest value in column <code>datetime</code>.</p>
<p>Read the <a href="https://pragprog.com/book/bksqla/sql-antipatterns" rel="noreferrer">SQL Antipatterns: Avoiding the Pitfalls of Database Programming</a> book for other SQL tips.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-to-convert-datetime-to-varchar-score-1396857-in-2015" class="level3">
<h3>22: How to convert DateTime to VarChar (score <a href="https://stackoverflow.com/q/74385.html">1396857</a> in 2015)</h3>
<section id="question-21" class="level4">
<h4>Question</h4>
<p>I am working on a query in Sql Server 2005 where I need to convert a value in <code>DateTime</code> variable into a <code>varchar</code> variable in <code>yyyy-mm-dd</code> format (without time part). How do I do that?</p>
</section>
<section id="answer-accepted-score-254" class="level4">
<h4>Answer accepted (score 254)</h4>
<p>With Microsoft Sql Server:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb142-1"><a href="#cb142-1"></a><span class="co">--</span></span>
<span id="cb142-2"><a href="#cb142-2"></a><span class="co">-- Create test case</span></span>
<span id="cb142-3"><a href="#cb142-3"></a><span class="co">--</span></span>
<span id="cb142-4"><a href="#cb142-4"></a><span class="kw">DECLARE</span> @myDateTime DATETIME</span>
<span id="cb142-5"><a href="#cb142-5"></a><span class="kw">SET</span> @myDateTime <span class="op">=</span> <span class="st">&#39;2008-05-03&#39;</span></span>
<span id="cb142-6"><a href="#cb142-6"></a></span>
<span id="cb142-7"><a href="#cb142-7"></a><span class="co">--</span></span>
<span id="cb142-8"><a href="#cb142-8"></a><span class="co">-- Convert string</span></span>
<span id="cb142-9"><a href="#cb142-9"></a><span class="co">--</span></span>
<span id="cb142-10"><a href="#cb142-10"></a><span class="kw">SELECT</span> <span class="kw">LEFT</span>(<span class="fu">CONVERT</span>(<span class="dt">VARCHAR</span>, @myDateTime, <span class="dv">120</span>), <span class="dv">10</span>)</span></code></pre></div>
</section>
<section id="answer-2-score-363" class="level4">
<h4>Answer 2 (score 363)</h4>
<p>Here’s some test sql for all the styles.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb143-1"><a href="#cb143-1"></a><span class="kw">DECLARE</span> @now datetime</span>
<span id="cb143-2"><a href="#cb143-2"></a><span class="kw">SET</span> @now <span class="op">=</span> GETDATE()</span>
<span id="cb143-3"><a href="#cb143-3"></a><span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">0</span>) <span class="kw">as</span> output, <span class="dv">0</span> <span class="kw">as</span> style </span>
<span id="cb143-4"><a href="#cb143-4"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">1</span>), <span class="dv">1</span></span>
<span id="cb143-5"><a href="#cb143-5"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">2</span>), <span class="dv">2</span></span>
<span id="cb143-6"><a href="#cb143-6"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">3</span>), <span class="dv">3</span></span>
<span id="cb143-7"><a href="#cb143-7"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">4</span>), <span class="dv">4</span></span>
<span id="cb143-8"><a href="#cb143-8"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">5</span>), <span class="dv">5</span></span>
<span id="cb143-9"><a href="#cb143-9"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">6</span>), <span class="dv">6</span></span>
<span id="cb143-10"><a href="#cb143-10"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">7</span>), <span class="dv">7</span></span>
<span id="cb143-11"><a href="#cb143-11"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">8</span>), <span class="dv">8</span></span>
<span id="cb143-12"><a href="#cb143-12"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">9</span>), <span class="dv">9</span></span>
<span id="cb143-13"><a href="#cb143-13"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">10</span>), <span class="dv">10</span></span>
<span id="cb143-14"><a href="#cb143-14"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">11</span>), <span class="dv">11</span></span>
<span id="cb143-15"><a href="#cb143-15"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">12</span>), <span class="dv">12</span></span>
<span id="cb143-16"><a href="#cb143-16"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">13</span>), <span class="dv">13</span></span>
<span id="cb143-17"><a href="#cb143-17"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">14</span>), <span class="dv">14</span></span>
<span id="cb143-18"><a href="#cb143-18"></a><span class="co">--15 to 19 not valid</span></span>
<span id="cb143-19"><a href="#cb143-19"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">20</span>), <span class="dv">20</span></span>
<span id="cb143-20"><a href="#cb143-20"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">21</span>), <span class="dv">21</span></span>
<span id="cb143-21"><a href="#cb143-21"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">22</span>), <span class="dv">22</span></span>
<span id="cb143-22"><a href="#cb143-22"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">23</span>), <span class="dv">23</span></span>
<span id="cb143-23"><a href="#cb143-23"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">24</span>), <span class="dv">24</span></span>
<span id="cb143-24"><a href="#cb143-24"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">25</span>), <span class="dv">25</span></span>
<span id="cb143-25"><a href="#cb143-25"></a><span class="co">--26 to 99 not valid</span></span>
<span id="cb143-26"><a href="#cb143-26"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">100</span>), <span class="dv">100</span></span>
<span id="cb143-27"><a href="#cb143-27"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">101</span>), <span class="dv">101</span></span>
<span id="cb143-28"><a href="#cb143-28"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">102</span>), <span class="dv">102</span></span>
<span id="cb143-29"><a href="#cb143-29"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">103</span>), <span class="dv">103</span></span>
<span id="cb143-30"><a href="#cb143-30"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">104</span>), <span class="dv">104</span></span>
<span id="cb143-31"><a href="#cb143-31"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">105</span>), <span class="dv">105</span></span>
<span id="cb143-32"><a href="#cb143-32"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">106</span>), <span class="dv">106</span></span>
<span id="cb143-33"><a href="#cb143-33"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">107</span>), <span class="dv">107</span></span>
<span id="cb143-34"><a href="#cb143-34"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">108</span>), <span class="dv">108</span></span>
<span id="cb143-35"><a href="#cb143-35"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">109</span>), <span class="dv">109</span></span>
<span id="cb143-36"><a href="#cb143-36"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">110</span>), <span class="dv">110</span></span>
<span id="cb143-37"><a href="#cb143-37"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">111</span>), <span class="dv">111</span></span>
<span id="cb143-38"><a href="#cb143-38"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">112</span>), <span class="dv">112</span></span>
<span id="cb143-39"><a href="#cb143-39"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">113</span>), <span class="dv">113</span></span>
<span id="cb143-40"><a href="#cb143-40"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">114</span>), <span class="dv">114</span></span>
<span id="cb143-41"><a href="#cb143-41"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">120</span>), <span class="dv">120</span></span>
<span id="cb143-42"><a href="#cb143-42"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">121</span>), <span class="dv">121</span></span>
<span id="cb143-43"><a href="#cb143-43"></a><span class="co">--122 to 125 not valid</span></span>
<span id="cb143-44"><a href="#cb143-44"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">126</span>), <span class="dv">126</span></span>
<span id="cb143-45"><a href="#cb143-45"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">127</span>), <span class="dv">127</span></span>
<span id="cb143-46"><a href="#cb143-46"></a><span class="co">--128, 129 not valid</span></span>
<span id="cb143-47"><a href="#cb143-47"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">130</span>), <span class="dv">130</span></span>
<span id="cb143-48"><a href="#cb143-48"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">MAX</span>), @now, <span class="dv">131</span>), <span class="dv">131</span></span>
<span id="cb143-49"><a href="#cb143-49"></a><span class="co">--132 not valid</span></span>
<span id="cb143-50"><a href="#cb143-50"></a><span class="kw">order</span> <span class="kw">BY</span> style</span></code></pre></div>
<p>Here’s the result</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb144-1"><a href="#cb144-1"></a>output                   style</span>
<span id="cb144-2"><a href="#cb144-2"></a>Apr <span class="dv">28</span> <span class="dv">2014</span>  <span class="dv">9</span><span class="ch">:31AM</span>          <span class="dv">0</span></span>
<span id="cb144-3"><a href="#cb144-3"></a><span class="dv">04</span><span class="op">/</span><span class="dv">28</span><span class="op">/</span><span class="dv">14</span>                     <span class="dv">1</span></span>
<span id="cb144-4"><a href="#cb144-4"></a><span class="dv">14</span>.<span class="fl">04.28</span>                     <span class="dv">2</span></span>
<span id="cb144-5"><a href="#cb144-5"></a><span class="dv">28</span><span class="op">/</span><span class="dv">04</span><span class="op">/</span><span class="dv">14</span>                     <span class="dv">3</span></span>
<span id="cb144-6"><a href="#cb144-6"></a><span class="dv">28</span>.<span class="fl">04.14</span>                     <span class="dv">4</span></span>
<span id="cb144-7"><a href="#cb144-7"></a><span class="dv">28</span><span class="op">-</span><span class="dv">04</span><span class="op">-</span><span class="dv">14</span>                     <span class="dv">5</span></span>
<span id="cb144-8"><a href="#cb144-8"></a><span class="dv">28</span> Apr <span class="dv">14</span>                    <span class="dv">6</span></span>
<span id="cb144-9"><a href="#cb144-9"></a>Apr <span class="dv">28</span>, <span class="dv">14</span>                   <span class="dv">7</span></span>
<span id="cb144-10"><a href="#cb144-10"></a><span class="dv">09</span><span class="ch">:31:28</span>                     <span class="dv">8</span></span>
<span id="cb144-11"><a href="#cb144-11"></a>Apr <span class="dv">28</span> <span class="dv">2014</span>  <span class="dv">9</span><span class="ch">:31:28:580AM</span>   <span class="dv">9</span></span>
<span id="cb144-12"><a href="#cb144-12"></a><span class="dv">04</span><span class="op">-</span><span class="dv">28</span><span class="op">-</span><span class="dv">14</span>                     <span class="dv">10</span></span>
<span id="cb144-13"><a href="#cb144-13"></a><span class="dv">14</span><span class="op">/</span><span class="dv">04</span><span class="op">/</span><span class="dv">28</span>                     <span class="dv">11</span></span>
<span id="cb144-14"><a href="#cb144-14"></a><span class="dv">140428</span>                       <span class="dv">12</span></span>
<span id="cb144-15"><a href="#cb144-15"></a><span class="dv">28</span> Apr <span class="dv">2014</span> <span class="dv">09</span><span class="ch">:31:28:580</span>     <span class="dv">13</span></span>
<span id="cb144-16"><a href="#cb144-16"></a><span class="dv">09</span><span class="ch">:31:28:580</span>                 <span class="dv">14</span></span>
<span id="cb144-17"><a href="#cb144-17"></a><span class="dv">2014</span><span class="op">-</span><span class="dv">04</span><span class="op">-</span><span class="dv">28</span> <span class="dv">09</span><span class="ch">:31:28</span>          <span class="dv">20</span></span>
<span id="cb144-18"><a href="#cb144-18"></a><span class="dv">2014</span><span class="op">-</span><span class="dv">04</span><span class="op">-</span><span class="dv">28</span> <span class="dv">09</span><span class="ch">:31:28</span><span class="fl">.580</span>      <span class="dv">21</span></span>
<span id="cb144-19"><a href="#cb144-19"></a><span class="dv">04</span><span class="op">/</span><span class="dv">28</span><span class="op">/</span><span class="dv">14</span>  <span class="dv">9</span><span class="ch">:31:28</span> AM         <span class="dv">22</span></span>
<span id="cb144-20"><a href="#cb144-20"></a><span class="dv">2014</span><span class="op">-</span><span class="dv">04</span><span class="op">-</span><span class="dv">28</span>                   <span class="dv">23</span></span>
<span id="cb144-21"><a href="#cb144-21"></a><span class="dv">09</span><span class="ch">:31:28</span>                     <span class="dv">24</span></span>
<span id="cb144-22"><a href="#cb144-22"></a><span class="dv">2014</span><span class="op">-</span><span class="dv">04</span><span class="op">-</span><span class="dv">28</span> <span class="dv">09</span><span class="ch">:31:28</span><span class="fl">.580</span>      <span class="dv">25</span></span>
<span id="cb144-23"><a href="#cb144-23"></a>Apr <span class="dv">28</span> <span class="dv">2014</span>  <span class="dv">9</span><span class="ch">:31AM</span>          <span class="dv">100</span></span>
<span id="cb144-24"><a href="#cb144-24"></a><span class="dv">04</span><span class="op">/</span><span class="dv">28</span><span class="op">/</span><span class="dv">2014</span>                   <span class="dv">101</span></span>
<span id="cb144-25"><a href="#cb144-25"></a><span class="dv">2014</span>.<span class="fl">04.28</span>                   <span class="dv">102</span></span>
<span id="cb144-26"><a href="#cb144-26"></a><span class="dv">28</span><span class="op">/</span><span class="dv">04</span><span class="op">/</span><span class="dv">2014</span>                   <span class="dv">103</span></span>
<span id="cb144-27"><a href="#cb144-27"></a><span class="dv">28</span>.<span class="fl">04.2014</span>                   <span class="dv">104</span></span>
<span id="cb144-28"><a href="#cb144-28"></a><span class="dv">28</span><span class="op">-</span><span class="dv">04</span><span class="op">-</span><span class="dv">2014</span>                   <span class="dv">105</span></span>
<span id="cb144-29"><a href="#cb144-29"></a><span class="dv">28</span> Apr <span class="dv">2014</span>                  <span class="dv">106</span></span>
<span id="cb144-30"><a href="#cb144-30"></a>Apr <span class="dv">28</span>, <span class="dv">2014</span>                 <span class="dv">107</span></span>
<span id="cb144-31"><a href="#cb144-31"></a><span class="dv">09</span><span class="ch">:31:28</span>                     <span class="dv">108</span></span>
<span id="cb144-32"><a href="#cb144-32"></a>Apr <span class="dv">28</span> <span class="dv">2014</span>  <span class="dv">9</span><span class="ch">:31:28:580AM</span>   <span class="dv">109</span></span>
<span id="cb144-33"><a href="#cb144-33"></a><span class="dv">04</span><span class="op">-</span><span class="dv">28</span><span class="op">-</span><span class="dv">2014</span>                   <span class="dv">110</span></span>
<span id="cb144-34"><a href="#cb144-34"></a><span class="dv">2014</span><span class="op">/</span><span class="dv">04</span><span class="op">/</span><span class="dv">28</span>                   <span class="dv">111</span></span>
<span id="cb144-35"><a href="#cb144-35"></a><span class="dv">20140428</span>                     <span class="dv">112</span></span>
<span id="cb144-36"><a href="#cb144-36"></a><span class="dv">28</span> Apr <span class="dv">2014</span> <span class="dv">09</span><span class="ch">:31:28:580</span>     <span class="dv">113</span></span>
<span id="cb144-37"><a href="#cb144-37"></a><span class="dv">09</span><span class="ch">:31:28:580</span>                 <span class="dv">114</span></span>
<span id="cb144-38"><a href="#cb144-38"></a><span class="dv">2014</span><span class="op">-</span><span class="dv">04</span><span class="op">-</span><span class="dv">28</span> <span class="dv">09</span><span class="ch">:31:28</span>          <span class="dv">120</span></span>
<span id="cb144-39"><a href="#cb144-39"></a><span class="dv">2014</span><span class="op">-</span><span class="dv">04</span><span class="op">-</span><span class="dv">28</span> <span class="dv">09</span><span class="ch">:31:28</span><span class="fl">.580</span>      <span class="dv">121</span></span>
<span id="cb144-40"><a href="#cb144-40"></a><span class="dv">2014</span><span class="op">-</span><span class="dv">04</span><span class="op">-</span>28T09<span class="ch">:31:28</span><span class="fl">.580</span>      <span class="dv">126</span></span>
<span id="cb144-41"><a href="#cb144-41"></a><span class="dv">2014</span><span class="op">-</span><span class="dv">04</span><span class="op">-</span>28T09<span class="ch">:31:28</span><span class="fl">.580</span>      <span class="dv">127</span></span>
<span id="cb144-42"><a href="#cb144-42"></a><span class="dv">28</span> جمادى الثانية <span class="dv">1435</span>  <span class="dv">9</span><span class="ch">:31:28:580AM</span>    <span class="dv">130</span></span>
<span id="cb144-43"><a href="#cb144-43"></a><span class="dv">28</span><span class="op">/</span><span class="dv">06</span><span class="op">/</span><span class="dv">1435</span>  <span class="dv">9</span><span class="ch">:31:28:580AM</span>    <span class="dv">131</span></span></code></pre></div>
<p>Make <code>nvarchar(max)</code> shorter to trim the time. For example:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb145-1"><a href="#cb145-1"></a><span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="dv">11</span>), GETDATE(), <span class="dv">0</span>)</span>
<span id="cb145-2"><a href="#cb145-2"></a><span class="kw">union</span> <span class="kw">select</span> <span class="fu">convert</span>(<span class="dt">nvarchar</span>(<span class="fu">max</span>), GETDATE(), <span class="dv">0</span>)</span></code></pre></div>
<p>outputs:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb146-1"><a href="#cb146-1"></a>May <span class="dv">18</span> <span class="dv">2018</span></span>
<span id="cb146-2"><a href="#cb146-2"></a>May <span class="dv">18</span> <span class="dv">2018</span>  <span class="dv">9</span><span class="ch">:57AM</span></span></code></pre></div>
</section>
<section id="answer-3-score-184" class="level4">
<h4>Answer 3 (score 184)</h4>
<p>Try the following:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb147-1"><a href="#cb147-1"></a><span class="fu">CONVERT</span>(<span class="dt">varchar</span>(<span class="dv">10</span>), [MyDateTimecolumn], <span class="dv">20</span>)</span></code></pre></div>
<p>For a full date time and not just date do:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb148-1"><a href="#cb148-1"></a><span class="fu">CONVERT</span>(<span class="dt">varchar</span>(<span class="dv">23</span>), [MyDateTimecolumn], <span class="dv">121</span>)</span></code></pre></div>
<p>See this page for convert styles:</p>
<p>
<a href="http://msdn.microsoft.com/en-us/library/ms187928.aspx" rel="noreferrer">http://msdn.microsoft.com/en-us/library/ms187928.aspx</a><br> OR<br> <a href="http://www.w3schools.com/sql/func_convert.asp" rel="noreferrer">SQL Server CONVERT() Function</a>
</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="not-in-vs-not-exists-score-1367238-in-2012" class="level3">
<h3>23: NOT IN vs NOT EXISTS (score <a href="https://stackoverflow.com/q/173041.html">1367238</a> in 2012)</h3>
<section id="question-22" class="level4">
<h4>Question</h4>
<p>Which of these queries is the faster?</p>
<p>NOT EXISTS:</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb149-1"><a href="#cb149-1"></a><span class="kw">SELECT</span> ProductID, ProductName </span>
<span id="cb149-2"><a href="#cb149-2"></a><span class="kw">FROM</span> Northwind<span class="op">..</span>Products p</span>
<span id="cb149-3"><a href="#cb149-3"></a><span class="kw">WHERE</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> (</span>
<span id="cb149-4"><a href="#cb149-4"></a>    <span class="kw">SELECT</span> <span class="dv">1</span> </span>
<span id="cb149-5"><a href="#cb149-5"></a>    <span class="kw">FROM</span> Northwind<span class="op">..</span>[<span class="kw">Order</span> Details] od </span>
<span id="cb149-6"><a href="#cb149-6"></a>    <span class="kw">WHERE</span> p.ProductId <span class="op">=</span> od.ProductId)</span></code></pre></div>
<p>Or NOT IN:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb150-1"><a href="#cb150-1"></a><span class="kw">SELECT</span> ProductID, ProductName </span>
<span id="cb150-2"><a href="#cb150-2"></a><span class="kw">FROM</span> Northwind<span class="op">..</span>Products p</span>
<span id="cb150-3"><a href="#cb150-3"></a><span class="kw">WHERE</span> p.ProductID <span class="kw">NOT</span> <span class="kw">IN</span> (</span>
<span id="cb150-4"><a href="#cb150-4"></a>    <span class="kw">SELECT</span> ProductID </span>
<span id="cb150-5"><a href="#cb150-5"></a>    <span class="kw">FROM</span> Northwind<span class="op">..</span>[<span class="kw">Order</span> Details])</span></code></pre></div>
<p>The query execution plan says they both do the same thing. If that is the case, which is the recommended form?</p>
<p>This is based on the NorthWind database.</p>
<p>[Edit]</p>
<p>
Just found this helpful article: <a href="http://weblogs.sqlteam.com/mladenp/archive/2007/05/18/60210.aspx" rel="noreferrer">http://weblogs.sqlteam.com/mladenp/archive/2007/05/18/60210.aspx</a>
</p>
<p>I think I’ll stick with NOT EXISTS.</p>
</section>
<section id="answer-accepted-score-657" class="level4">
<h4>Answer accepted (score 657)</h4>
<p>I always default to <code>NOT EXISTS</code>.</p>
<p>The execution plans may be the same at the moment but if either column is altered in the future to allow <code>NULL</code>s the <code>NOT IN</code> version will need to do more work (even if no <code>NULL</code>s are actually present in the data) and the semantics of <code>NOT IN</code> if <code>NULL</code>s <em>are</em> present are unlikely to be the ones you want anyway.</p>
<p>When neither <code>Products.ProductID</code> or <code>[Order Details].ProductID</code> allow <code>NULL</code>s the <code>NOT IN</code> will be treated identically to the following query.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb151-1"><a href="#cb151-1"></a><span class="kw">SELECT</span> ProductID,</span>
<span id="cb151-2"><a href="#cb151-2"></a>       ProductName</span>
<span id="cb151-3"><a href="#cb151-3"></a><span class="kw">FROM</span>   Products p</span>
<span id="cb151-4"><a href="#cb151-4"></a><span class="kw">WHERE</span>  <span class="kw">NOT</span> <span class="kw">EXISTS</span> (<span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb151-5"><a href="#cb151-5"></a>                   <span class="kw">FROM</span>   [<span class="kw">Order</span> Details] od</span>
<span id="cb151-6"><a href="#cb151-6"></a>                   <span class="kw">WHERE</span>  p.ProductId <span class="op">=</span> od.ProductId) </span></code></pre></div>
<p>The exact plan may vary but for my example data I get the following.</p>
<p><img src="https://i.stack.imgur.com/lCTsG.png" alt="Neither NULL"></p>
<p>A reasonably common misconception seems to be that correlated sub queries are always “bad” compared to joins. They certainly can be when they force a nested loops plan (sub query evaluated row by row) but this plan includes an anti semi join logical operator. Anti semi joins are not restricted to nested loops but can use hash or merge (as in this example) joins too.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb152-1"><a href="#cb152-1"></a><span class="co">/*Not valid syntax but better reflects the plan*/</span> </span>
<span id="cb152-2"><a href="#cb152-2"></a><span class="kw">SELECT</span> p.ProductID,</span>
<span id="cb152-3"><a href="#cb152-3"></a>       p.ProductName</span>
<span id="cb152-4"><a href="#cb152-4"></a><span class="kw">FROM</span>   Products p</span>
<span id="cb152-5"><a href="#cb152-5"></a>       <span class="kw">LEFT</span> ANTI SEMI <span class="kw">JOIN</span> [<span class="kw">Order</span> Details] od</span>
<span id="cb152-6"><a href="#cb152-6"></a>         <span class="kw">ON</span> p.ProductId <span class="op">=</span> od.ProductId </span></code></pre></div>
<p>If <code>[Order Details].ProductID</code> is <code>NULL</code>-able the query then becomes</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb153-1"><a href="#cb153-1"></a><span class="kw">SELECT</span> ProductID,</span>
<span id="cb153-2"><a href="#cb153-2"></a>       ProductName</span>
<span id="cb153-3"><a href="#cb153-3"></a><span class="kw">FROM</span>   Products p</span>
<span id="cb153-4"><a href="#cb153-4"></a><span class="kw">WHERE</span>  <span class="kw">NOT</span> <span class="kw">EXISTS</span> (<span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb153-5"><a href="#cb153-5"></a>                   <span class="kw">FROM</span>   [<span class="kw">Order</span> Details] od</span>
<span id="cb153-6"><a href="#cb153-6"></a>                   <span class="kw">WHERE</span>  p.ProductId <span class="op">=</span> od.ProductId)</span>
<span id="cb153-7"><a href="#cb153-7"></a>       <span class="kw">AND</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> (<span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb153-8"><a href="#cb153-8"></a>                       <span class="kw">FROM</span>   [<span class="kw">Order</span> Details]</span>
<span id="cb153-9"><a href="#cb153-9"></a>                       <span class="kw">WHERE</span>  ProductId <span class="kw">IS</span> <span class="kw">NULL</span>) </span></code></pre></div>
<p>The reason for this is that the correct semantics if <code>[Order Details]</code> contains any <code>NULL</code> <code>ProductId</code>s is to return no results. See the extra anti semi join and row count spool to verify this that is added to the plan.</p>
<p><img src="https://i.stack.imgur.com/mPYhd.png" alt="One NULL"></p>
<p>If <code>Products.ProductID</code> is also changed to become <code>NULL</code>-able the query then becomes</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb154-1"><a href="#cb154-1"></a><span class="kw">SELECT</span> ProductID,</span>
<span id="cb154-2"><a href="#cb154-2"></a>       ProductName</span>
<span id="cb154-3"><a href="#cb154-3"></a><span class="kw">FROM</span>   Products p</span>
<span id="cb154-4"><a href="#cb154-4"></a><span class="kw">WHERE</span>  <span class="kw">NOT</span> <span class="kw">EXISTS</span> (<span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb154-5"><a href="#cb154-5"></a>                   <span class="kw">FROM</span>   [<span class="kw">Order</span> Details] od</span>
<span id="cb154-6"><a href="#cb154-6"></a>                   <span class="kw">WHERE</span>  p.ProductId <span class="op">=</span> od.ProductId)</span>
<span id="cb154-7"><a href="#cb154-7"></a>       <span class="kw">AND</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> (<span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb154-8"><a href="#cb154-8"></a>                       <span class="kw">FROM</span>   [<span class="kw">Order</span> Details]</span>
<span id="cb154-9"><a href="#cb154-9"></a>                       <span class="kw">WHERE</span>  ProductId <span class="kw">IS</span> <span class="kw">NULL</span>)</span>
<span id="cb154-10"><a href="#cb154-10"></a>       <span class="kw">AND</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> (<span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb154-11"><a href="#cb154-11"></a>                       <span class="kw">FROM</span>   (<span class="kw">SELECT</span> TOP <span class="dv">1</span> <span class="op">*</span></span>
<span id="cb154-12"><a href="#cb154-12"></a>                               <span class="kw">FROM</span>   [<span class="kw">Order</span> Details]) S</span>
<span id="cb154-13"><a href="#cb154-13"></a>                       <span class="kw">WHERE</span>  p.ProductID <span class="kw">IS</span> <span class="kw">NULL</span>) </span></code></pre></div>
<p>The reason for that one is because a <code>NULL</code> <code>Products.ProductId</code> should not be returned in the results <strong>except</strong> if the <code>NOT IN</code> sub query were to return no results at all (i.e. the <code>[Order Details]</code> table is empty). In which case it should. In the plan for my sample data this is implemented by adding another anti semi join as below.</p>
<p><img src="https://i.stack.imgur.com/8XAh1.png" alt="Both NULL"></p>
<p>The effect of this is shown in <a href="http://sqlinthewild.co.za/index.php/2010/02/18/not-exists-vs-not-in/" rel="noreferrer">the blog post already linked by Buckley</a>. In the example there the number of logical reads increase from around 400 to 500,000.</p>
<p>Additionally the fact that a single <code>NULL</code> can reduce the row count to zero makes cardinality estimation very difficult. If SQL Server assumes that this will happen but in fact there were no <code>NULL</code> rows in the data the rest of the execution plan may be catastrophically worse, if this is just part of a larger query, <a href="https://dba.stackexchange.com/q/117306/3690">with inappropriate nested loops causing repeated execution of an expensive sub tree for example</a>.</p>
<p>This is not the only possible execution plan for a <code>NOT IN</code> on a <code>NULL</code>-able column however. <a href="http://bradsruminations.blogspot.co.uk/2011/10/t-sql-tuesday-023-flip-side-of-join.html" rel="noreferrer">This article shows another one</a> for a query against the <code>AdventureWorks2008</code> database.</p>
<p>For the <code>NOT IN</code> on a <code>NOT NULL</code> column or the <code>NOT EXISTS</code> against either a nullable or non nullable column it gives the following plan.</p>
<p><img src="https://i.stack.imgur.com/nahUD.png" alt="Not EXists"></p>
<p>When the column changes to <code>NULL</code>-able the <code>NOT IN</code> plan now looks like</p>
<p><img src="https://i.stack.imgur.com/8o9PQ.png" alt="Not In - Null"></p>
<p>It adds an extra inner join operator to the plan. This apparatus is <a href="https://dba.stackexchange.com/a/14812/3690">explained here</a>. It is all there to convert the previous single correlated index seek on <code>Sales.SalesOrderDetail.ProductID = &amp;lt;correlated_product_id&amp;gt;</code> to two seeks per outer row. The additional one is on <code>WHERE Sales.SalesOrderDetail.ProductID IS NULL</code>.</p>
<p>As this is under an anti semi join if that one returns any rows the second seek will not occur. However if <code>Sales.SalesOrderDetail</code> does not contain any <code>NULL</code> <code>ProductID</code>s it will double the number of seek operations required.</p>
</section>
<section id="answer-2-score-78" class="level4">
<h4>Answer 2 (score 78)</h4>
<p>Also be aware that NOT IN is not equivalent to NOT EXISTS when it comes to null.</p>
<p>This post explains it very well</p>
<p><a href="http://sqlinthewild.co.za/index.php/2010/02/18/not-exists-vs-not-in/">http://sqlinthewild.co.za/index.php/2010/02/18/not-exists-vs-not-in/</a></p>
<blockquote>
<p>
When the subquery returns even one null, NOT IN will not match any rows.
</p>
<p>
The reason for this can be found by looking at the details of what the NOT IN operation actually means.
</p>
<p>
Let’s say, for illustration purposes that there are 4 rows in the table called t, there’s a column called ID with values 1..4
</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb155-1"><a href="#cb155-1"></a><span class="kw">WHERE</span> SomeValue <span class="kw">NOT</span> <span class="kw">IN</span> (<span class="kw">SELECT</span> AVal <span class="kw">FROM</span> t)</span></code></pre></div>
<p>is equivalent to</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb156-1"><a href="#cb156-1"></a><span class="kw">WHERE</span> SomeValue <span class="op">!=</span> (<span class="kw">SELECT</span> AVal <span class="kw">FROM</span> t <span class="kw">WHERE</span> <span class="kw">ID</span><span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb156-2"><a href="#cb156-2"></a><span class="kw">AND</span> SomeValue <span class="op">!=</span> (<span class="kw">SELECT</span> AVal <span class="kw">FROM</span> t <span class="kw">WHERE</span> <span class="kw">ID</span><span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb156-3"><a href="#cb156-3"></a><span class="kw">AND</span> SomeValue <span class="op">!=</span> (<span class="kw">SELECT</span> AVal <span class="kw">FROM</span> t <span class="kw">WHERE</span> <span class="kw">ID</span><span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb156-4"><a href="#cb156-4"></a><span class="kw">AND</span> SomeValue <span class="op">!=</span> (<span class="kw">SELECT</span> AVal <span class="kw">FROM</span> t <span class="kw">WHERE</span> <span class="kw">ID</span><span class="op">=</span><span class="dv">4</span>)</span></code></pre></div>
<p>
Let’s further say that AVal is NULL where ID = 4. Hence that != comparison returns UNKNOWN. The logical truth table for AND states that UNKNOWN and TRUE is UNKNOWN, UNKNOWN and FALSE is FALSE. There is no value that can be AND’d with UNKNOWN to produce the result TRUE
</p>
<p>
Hence, if any row of that subquery returns NULL, the entire NOT IN operator will evaluate to either FALSE or NULL and no records will be returned
</p>
</blockquote>
</section>
<section id="answer-3-score-23" class="level4">
<h4>Answer 3 (score 23)</h4>
<p>If the execution planner says they’re the same, they’re the same. Use whichever one will make your intention more obvious – in this case, the second.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="if-in-select-statement---choose-output-value-based-on-column-values-score-1331519-in-2015" class="level3">
<h3>24: ‘IF’ in ‘SELECT’ statement - choose output value based on column values (score <a href="https://stackoverflow.com/q/5951157.html">1331519</a> in 2015)</h3>
<section id="question-23" class="level4">
<h4>Question</h4>
<div class="sourceCode" id="cb157"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb157-1"><a href="#cb157-1"></a><span class="kw">SELECT</span> <span class="kw">id</span>, amount <span class="kw">FROM</span> report</span></code></pre></div>
<p>I need <code>amount</code> to be <code>amount</code> if <code>report.type='P'</code> and <code>-amount</code> if <code>report.type='N'</code>. How do I add this to the above query?</p>
</section>
<section id="answer-accepted-score-997" class="level4">
<h4>Answer accepted (score 997)</h4>
<div class="sourceCode" id="cb158"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb158-1"><a href="#cb158-1"></a><span class="kw">SELECT</span> <span class="kw">id</span>, </span>
<span id="cb158-2"><a href="#cb158-2"></a>       <span class="cf">IF</span>(<span class="kw">type</span> <span class="op">=</span> <span class="st">&#39;P&#39;</span>, amount, amount <span class="op">*</span> <span class="op">-</span><span class="dv">1</span>) <span class="kw">as</span> amount</span>
<span id="cb158-3"><a href="#cb158-3"></a><span class="kw">FROM</span> report</span></code></pre></div>
<p>See <a href="http://dev.mysql.com/doc/refman/5.0/en/control-flow-functions.html" rel="noreferrer">http://dev.mysql.com/doc/refman/5.0/en/control-flow-functions.html</a>.</p>
<p>Additionally, you could handle when the condition is null. In the case of a null amount:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb159-1"><a href="#cb159-1"></a><span class="kw">SELECT</span> <span class="kw">id</span>, </span>
<span id="cb159-2"><a href="#cb159-2"></a>       <span class="cf">IF</span>(<span class="kw">type</span> <span class="op">=</span> <span class="st">&#39;P&#39;</span>, IFNULL(amount,<span class="dv">0</span>), IFNULL(amount,<span class="dv">0</span>) <span class="op">*</span> <span class="op">-</span><span class="dv">1</span>) <span class="kw">as</span> amount</span>
<span id="cb159-3"><a href="#cb159-3"></a><span class="kw">FROM</span> report</span></code></pre></div>
<p>The part <code>IFNULL(amount,0)</code> means <em>when amount is not null return amount else return 0</em>.</p>
</section>
<section id="answer-2-score-243-1" class="level4">
<h4>Answer 2 (score 243)</h4>
<p>Use a <code>case</code> statement:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb160-1"><a href="#cb160-1"></a><span class="kw">select</span> <span class="kw">id</span>,</span>
<span id="cb160-2"><a href="#cb160-2"></a>    <span class="cf">case</span> report.<span class="kw">type</span></span>
<span id="cb160-3"><a href="#cb160-3"></a>        <span class="cf">when</span> <span class="st">&#39;P&#39;</span> <span class="cf">then</span> amount</span>
<span id="cb160-4"><a href="#cb160-4"></a>        <span class="cf">when</span> <span class="st">&#39;N&#39;</span> <span class="cf">then</span> <span class="op">-</span>amount</span>
<span id="cb160-5"><a href="#cb160-5"></a>    <span class="cf">end</span> <span class="kw">as</span> amount</span>
<span id="cb160-6"><a href="#cb160-6"></a><span class="kw">from</span></span>
<span id="cb160-7"><a href="#cb160-7"></a>    `report`</span></code></pre></div>
</section>
<section id="answer-3-score-93-1" class="level4">
<h4>Answer 3 (score 93)</h4>
<div class="sourceCode" id="cb161"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb161-1"><a href="#cb161-1"></a><span class="kw">SELECT</span> CompanyName, </span>
<span id="cb161-2"><a href="#cb161-2"></a>    <span class="cf">CASE</span> <span class="cf">WHEN</span> Country <span class="kw">IN</span> (<span class="st">&#39;USA&#39;</span>, <span class="st">&#39;Canada&#39;</span>) <span class="cf">THEN</span> <span class="st">&#39;North America&#39;</span></span>
<span id="cb161-3"><a href="#cb161-3"></a>         <span class="cf">WHEN</span> Country <span class="op">=</span> <span class="st">&#39;Brazil&#39;</span> <span class="cf">THEN</span> <span class="st">&#39;South America&#39;</span></span>
<span id="cb161-4"><a href="#cb161-4"></a>         <span class="cf">ELSE</span> <span class="st">&#39;Europe&#39;</span> <span class="cf">END</span> <span class="kw">AS</span> Continent</span>
<span id="cb161-5"><a href="#cb161-5"></a><span class="kw">FROM</span> Suppliers</span>
<span id="cb161-6"><a href="#cb161-6"></a><span class="kw">ORDER</span> <span class="kw">BY</span> CompanyName;</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="whats-the-difference-between-inner-join-left-join-right-join-and-full-join-score-1324680-in-2018" class="level3">
<h3>25: What’s the difference between INNER JOIN, LEFT JOIN, RIGHT JOIN and FULL JOIN? (score <a href="https://stackoverflow.com/q/5706437.html">1324680</a> in 2018)</h3>
<section id="question-24" class="level4">
<h4>Question</h4>
<p>
What’s the difference between <code>INNER JOIN</code>, <code>LEFT JOIN</code>, <code>RIGHT JOIN</code> and <code>FULL JOIN</code> in <strong><em>MySQL</em></strong>?
</p>
</section>
<section id="answer-accepted-score-3088" class="level4">
<h4>Answer accepted (score 3088)</h4>
<p>Reading this original article on <strong>The Code Project</strong> will help you a lot: <a href="http://www.codeproject.com/KB/database/Visual_SQL_Joins.aspx" rel="noreferrer">Visual Representation of SQL Joins</a>.</p>
<p><img src="https://i.stack.imgur.com/VQ5XP.png" alt="alt text"></p>
<p>Also check this post: <a href="http://blog.sqlauthority.com/2008/04/22/sql-server-better-performance-left-join-or-not-in/" rel="noreferrer">SQL SERVER – Better Performance – LEFT JOIN or NOT IN?</a>.</p>
<p>Find original one at: <a href="https://stackoverflow.com/questions/3308122/how-do-i-decide-when-to-use-right-joins-left-joins-or-inner-joins-or-how-to-dete/3308153#3308153">Difference between JOIN and OUTER JOIN in MySQL</a>.</p>
</section>
<section id="answer-2-score-674" class="level4">
<h4>Answer 2 (score 674)</h4>
<p><strong>INNER JOIN</strong> gets all records that are common between both tables based on the supplied ON clause.</p>
<p><strong>LEFT JOIN</strong> gets all records from the LEFT linked table but if you have selected some columns from the RIGHT table, if there is no related records, these columns will contain NULL.</p>
<p><strong>RIGHT JOIN</strong> is like the above but gets all records in the RIGHT table.</p>
<p><strong>FULL JOIN</strong> gets all records from both tables and puts NULL in the columns where related records do not exist in the opposite table.</p>
</section>
<section id="answer-3-score-646" class="level4">
<h4>Answer 3 (score 646)</h4>
<blockquote>
<p>
An SQL JOIN clause is used to combine rows from two or more tables, based on a common field between them.
</p>
</blockquote>
<p>There are different types of joins available in SQL:</p>
<p><strong>INNER JOIN</strong>: returns rows when there is a match in both tables.</p>
<p><strong>LEFT JOIN</strong>: returns all rows from the left table, even if there are no matches in the right table.</p>
<p><strong>RIGHT JOIN</strong>: returns all rows from the right table, even if there are no matches in the left table.</p>
<p><strong>FULL JOIN</strong>: It combines the results of both left and right outer joins.</p>
<p>The joined table will contain all records from both the tables and fill in NULLs for missing matches on either side.</p>
<p><strong>SELF JOIN</strong>: is used to join a table to itself as if the table were two tables, temporarily renaming at least one table in the SQL statement.</p>
<p><strong>CARTESIAN JOIN</strong>: returns the Cartesian product of the sets of records from the two or more joined tables.</p>
<p>WE can take each first four joins in Details :</p>
<p>We have two tables with the following values.</p>
<p><strong>TableA</strong></p>
<div class="sourceCode" id="cb162"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb162-1"><a href="#cb162-1"></a><span class="kw">id</span>  firstName                  lastName</span>
<span id="cb162-2"><a href="#cb162-2"></a><span class="op">......................................</span>.</span>
<span id="cb162-3"><a href="#cb162-3"></a><span class="dv">1</span>   arun                        prasanth                 </span>
<span id="cb162-4"><a href="#cb162-4"></a><span class="dv">2</span>   ann                         antony                   </span>
<span id="cb162-5"><a href="#cb162-5"></a><span class="dv">3</span>   sruthy                      abc                      </span>
<span id="cb162-6"><a href="#cb162-6"></a><span class="dv">6</span>   <span class="kw">new</span>                         abc                                           </span></code></pre></div>
<p><strong>TableB</strong></p>
<div class="sourceCode" id="cb163"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb163-1"><a href="#cb163-1"></a>id2 age Place</span>
<span id="cb163-2"><a href="#cb163-2"></a><span class="op">................</span></span>
<span id="cb163-3"><a href="#cb163-3"></a><span class="dv">1</span>   <span class="dv">24</span>  kerala</span>
<span id="cb163-4"><a href="#cb163-4"></a><span class="dv">2</span>   <span class="dv">24</span>  usa</span>
<span id="cb163-5"><a href="#cb163-5"></a><span class="dv">3</span>   <span class="dv">25</span>  ekm</span>
<span id="cb163-6"><a href="#cb163-6"></a><span class="dv">5</span>   <span class="dv">24</span>  chennai</span></code></pre></div>
<p>…………………………………………………………..</p>
<p><strong>INNER JOIN</strong></p>
<p><strong>Note</strong> :it gives the intersection of the two tables, i.e. rows they have common in TableA and TableB</p>
<p>Syntax</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb164-1"><a href="#cb164-1"></a><span class="kw">SELECT</span> table1.column1, table2.column2<span class="op">..</span>.</span>
<span id="cb164-2"><a href="#cb164-2"></a>  <span class="kw">FROM</span> table1</span>
<span id="cb164-3"><a href="#cb164-3"></a> <span class="kw">INNER</span> <span class="kw">JOIN</span> table2</span>
<span id="cb164-4"><a href="#cb164-4"></a>    <span class="kw">ON</span> table1.common_field <span class="op">=</span> table2.common_field;</span></code></pre></div>
<p>Apply it in our sample table :</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb165-1"><a href="#cb165-1"></a><span class="kw">SELECT</span> TableA.firstName,TableA.lastName,TableB.age,TableB.Place</span>
<span id="cb165-2"><a href="#cb165-2"></a>  <span class="kw">FROM</span> TableA</span>
<span id="cb165-3"><a href="#cb165-3"></a> <span class="kw">INNER</span> <span class="kw">JOIN</span> TableB</span>
<span id="cb165-4"><a href="#cb165-4"></a>    <span class="kw">ON</span> TableA.<span class="kw">id</span> <span class="op">=</span> TableB.id2;</span></code></pre></div>
<p>Result Will Be</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb166-1"><a href="#cb166-1"></a>firstName       lastName       age  Place</span>
<span id="cb166-2"><a href="#cb166-2"></a><span class="op">..............................................</span></span>
<span id="cb166-3"><a href="#cb166-3"></a>arun            prasanth        <span class="dv">24</span>  kerala</span>
<span id="cb166-4"><a href="#cb166-4"></a>ann             antony          <span class="dv">24</span>  usa</span>
<span id="cb166-5"><a href="#cb166-5"></a>sruthy          abc             <span class="dv">25</span>  ekm</span></code></pre></div>
<p><strong>LEFT JOIN</strong></p>
<p><strong>Note</strong> : will give all selected rows in TableA, plus any common selected rows in TableB.</p>
<p>Syntax</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb167-1"><a href="#cb167-1"></a><span class="kw">SELECT</span> table1.column1, table2.column2<span class="op">..</span>.</span>
<span id="cb167-2"><a href="#cb167-2"></a>  <span class="kw">FROM</span> table1</span>
<span id="cb167-3"><a href="#cb167-3"></a>  <span class="kw">LEFT</span> <span class="kw">JOIN</span> table2</span>
<span id="cb167-4"><a href="#cb167-4"></a>    <span class="kw">ON</span> table1.common_field <span class="op">=</span> table2.common_field;</span></code></pre></div>
<p>Apply it in our sample table :</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb168-1"><a href="#cb168-1"></a><span class="kw">SELECT</span> TableA.firstName,TableA.lastName,TableB.age,TableB.Place</span>
<span id="cb168-2"><a href="#cb168-2"></a>  <span class="kw">FROM</span> TableA</span>
<span id="cb168-3"><a href="#cb168-3"></a>  <span class="kw">LEFT</span> <span class="kw">JOIN</span> TableB</span>
<span id="cb168-4"><a href="#cb168-4"></a>    <span class="kw">ON</span> TableA.<span class="kw">id</span> <span class="op">=</span> TableB.id2;</span></code></pre></div>
<p>Result</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb169-1"><a href="#cb169-1"></a>firstName                   lastName                    age   Place</span>
<span id="cb169-2"><a href="#cb169-2"></a><span class="op">..............................................................................</span>.</span>
<span id="cb169-3"><a href="#cb169-3"></a>arun                        prasanth                    <span class="dv">24</span>    kerala</span>
<span id="cb169-4"><a href="#cb169-4"></a>ann                         antony                      <span class="dv">24</span>    usa</span>
<span id="cb169-5"><a href="#cb169-5"></a>sruthy                      abc                         <span class="dv">25</span>    ekm</span>
<span id="cb169-6"><a href="#cb169-6"></a><span class="kw">new</span>                         abc                         <span class="kw">NULL</span>  <span class="kw">NULL</span></span></code></pre></div>
<p><strong>RIGHT JOIN</strong></p>
<p><strong>Note</strong> : will give all selected rows in TableB, plus any common selected rows in TableA.</p>
<p>Syntax</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb170-1"><a href="#cb170-1"></a><span class="kw">SELECT</span> table1.column1, table2.column2<span class="op">..</span>.</span>
<span id="cb170-2"><a href="#cb170-2"></a>  <span class="kw">FROM</span> table1</span>
<span id="cb170-3"><a href="#cb170-3"></a> <span class="kw">RIGHT</span> <span class="kw">JOIN</span> table2</span>
<span id="cb170-4"><a href="#cb170-4"></a>    <span class="kw">ON</span> table1.common_field <span class="op">=</span> table2.common_field;</span></code></pre></div>
<p>Apply it in our sample table :</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb171-1"><a href="#cb171-1"></a><span class="kw">SELECT</span> TableA.firstName,TableA.lastName,TableB.age,TableB.Place</span>
<span id="cb171-2"><a href="#cb171-2"></a>  <span class="kw">FROM</span> TableA</span>
<span id="cb171-3"><a href="#cb171-3"></a> <span class="kw">RIGHT</span> <span class="kw">JOIN</span> TableB</span>
<span id="cb171-4"><a href="#cb171-4"></a>    <span class="kw">ON</span> TableA.<span class="kw">id</span> <span class="op">=</span> TableB.id2;</span></code></pre></div>
<p>Result</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb172-1"><a href="#cb172-1"></a>firstName                   lastName                    age     Place</span>
<span id="cb172-2"><a href="#cb172-2"></a><span class="op">..............................................................................</span>.</span>
<span id="cb172-3"><a href="#cb172-3"></a>arun                        prasanth                    <span class="dv">24</span>     kerala</span>
<span id="cb172-4"><a href="#cb172-4"></a>ann                         antony                      <span class="dv">24</span>     usa</span>
<span id="cb172-5"><a href="#cb172-5"></a>sruthy                      abc                         <span class="dv">25</span>     ekm</span>
<span id="cb172-6"><a href="#cb172-6"></a><span class="kw">NULL</span>                        <span class="kw">NULL</span>                        <span class="dv">24</span>     chennai</span></code></pre></div>
<p><strong>FULL JOIN</strong></p>
<p><strong>Note</strong> :It will return all selected values from both tables.</p>
<p>Syntax</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb173-1"><a href="#cb173-1"></a><span class="kw">SELECT</span> table1.column1, table2.column2<span class="op">..</span>.</span>
<span id="cb173-2"><a href="#cb173-2"></a>  <span class="kw">FROM</span> table1</span>
<span id="cb173-3"><a href="#cb173-3"></a>  <span class="kw">FULL</span> <span class="kw">JOIN</span> table2</span>
<span id="cb173-4"><a href="#cb173-4"></a>    <span class="kw">ON</span> table1.common_field <span class="op">=</span> table2.common_field;</span></code></pre></div>
<p>Apply it in our sample table :</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb174-1"><a href="#cb174-1"></a><span class="kw">SELECT</span> TableA.firstName,TableA.lastName,TableB.age,TableB.Place</span>
<span id="cb174-2"><a href="#cb174-2"></a>  <span class="kw">FROM</span> TableA</span>
<span id="cb174-3"><a href="#cb174-3"></a>  <span class="kw">FULL</span> <span class="kw">JOIN</span> TableB</span>
<span id="cb174-4"><a href="#cb174-4"></a>    <span class="kw">ON</span> TableA.<span class="kw">id</span> <span class="op">=</span> TableB.id2;</span></code></pre></div>
<p>Result</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb175-1"><a href="#cb175-1"></a>firstName                   lastName                    age    Place</span>
<span id="cb175-2"><a href="#cb175-2"></a><span class="op">..............................................................................</span>.</span>
<span id="cb175-3"><a href="#cb175-3"></a>arun                        prasanth                    <span class="dv">24</span>    kerala</span>
<span id="cb175-4"><a href="#cb175-4"></a>ann                         antony                      <span class="dv">24</span>    usa</span>
<span id="cb175-5"><a href="#cb175-5"></a>sruthy                      abc                         <span class="dv">25</span>    ekm</span>
<span id="cb175-6"><a href="#cb175-6"></a><span class="kw">new</span>                         abc                         <span class="kw">NULL</span>  <span class="kw">NULL</span></span>
<span id="cb175-7"><a href="#cb175-7"></a><span class="kw">NULL</span>                        <span class="kw">NULL</span>                        <span class="dv">24</span>    chennai</span></code></pre></div>
<p><strong>Interesting Fact</strong></p>
<p>For INNER joins the order doesn’t matter</p>
<p>For (LEFT, RIGHT or FULL) OUTER joins,the order matter</p>
<p>Better to go check this <strong><a href="https://stackoverflow.com/questions/9614922/does-the-join-order-matter-in-sql">Link</a></strong> it will give you interesting details about join order</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-do-i-limit-the-number-of-rows-returned-by-an-oracle-query-after-ordering-score-1310688-in-2018" class="level3">
<h3>26: How do I limit the number of rows returned by an Oracle query after ordering? (score <a href="https://stackoverflow.com/q/470542.html">1310688</a> in 2018)</h3>
<section id="question-25" class="level4">
<h4>Question</h4>
<p>Is there a way to make an <code>Oracle</code> query behave like it contains a <code>MySQL limit</code> clause?</p>
<p>In <code>MySQL</code>, I can do this:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb176-1"><a href="#cb176-1"></a><span class="kw">select</span> <span class="op">*</span> </span>
<span id="cb176-2"><a href="#cb176-2"></a><span class="kw">from</span> sometable</span>
<span id="cb176-3"><a href="#cb176-3"></a><span class="kw">order</span> <span class="kw">by</span> name</span>
<span id="cb176-4"><a href="#cb176-4"></a><span class="kw">limit</span> <span class="dv">20</span>,<span class="dv">10</span></span></code></pre></div>
<p>to get the 21st to the 30th rows (skip the first 20, give the next 10). The rows are selected after the <code>order by</code>, so it really starts on the 20th name alphabetically.</p>
<p>In <code>Oracle</code>, the only thing people mention is the <code>rownum</code> pseudo-column, but it is evaluated <em>before</em> <code>order by</code>, which means this:</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb177-1"><a href="#cb177-1"></a><span class="kw">select</span> <span class="op">*</span> </span>
<span id="cb177-2"><a href="#cb177-2"></a><span class="kw">from</span> sometable</span>
<span id="cb177-3"><a href="#cb177-3"></a><span class="kw">where</span> <span class="kw">rownum</span> <span class="op">&lt;=</span> <span class="dv">10</span></span>
<span id="cb177-4"><a href="#cb177-4"></a><span class="kw">order</span> <span class="kw">by</span> name</span></code></pre></div>
<p>will return a random set of ten rows ordered by name, which is not usually what I want. It also doesn’t allow for specifying an offset.</p>
</section>
<section id="answer-accepted-score-515" class="level4">
<h4>Answer accepted (score 515)</h4>
<p>Starting from Oracle 12c R1 (12.1), there <em>is</em> a <a href="http://www.oracle-base.com/articles/12c/row-limiting-clause-for-top-n-queries-12cr1.php" rel="noreferrer">row limiting clause</a>. It does not use familiar <code>LIMIT</code> syntax, but it can do the job better with more options. You can find the <a href="http://docs.oracle.com/database/121/SQLRF/statements_10002.htm#BABBADDD" rel="noreferrer">full syntax here</a>.</p>
<p>To answer the original question, here’s the query:</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb178-1"><a href="#cb178-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb178-2"><a href="#cb178-2"></a><span class="kw">FROM</span>   sometable</span>
<span id="cb178-3"><a href="#cb178-3"></a><span class="kw">ORDER</span> <span class="kw">BY</span> name</span>
<span id="cb178-4"><a href="#cb178-4"></a>OFFSET <span class="dv">20</span> <span class="kw">ROWS</span> FETCH <span class="kw">NEXT</span> <span class="dv">10</span> <span class="kw">ROWS</span> <span class="kw">ONLY</span>;</span></code></pre></div>
<p>(For earlier Oracle versions, please refer to other answers in this question)</p>
<hr>
<h5>
Examples:
</h2>
<p>Following examples were quoted from <a href="http://www.oracle-base.com/articles/12c/row-limiting-clause-for-top-n-queries-12cr1.php" rel="noreferrer">linked page</a>, in the hope of preventing link rot.</p>
<h5>
Setup
</h3>
<div class="sourceCode" id="cb179"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb179-1"><a href="#cb179-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> rownum_order_test (</span>
<span id="cb179-2"><a href="#cb179-2"></a>  val  <span class="dt">NUMBER</span></span>
<span id="cb179-3"><a href="#cb179-3"></a>);</span>
<span id="cb179-4"><a href="#cb179-4"></a></span>
<span id="cb179-5"><a href="#cb179-5"></a><span class="kw">INSERT</span> <span class="kw">ALL</span></span>
<span id="cb179-6"><a href="#cb179-6"></a>  <span class="kw">INTO</span> rownum_order_test</span>
<span id="cb179-7"><a href="#cb179-7"></a><span class="kw">SELECT</span> <span class="kw">level</span></span>
<span id="cb179-8"><a href="#cb179-8"></a><span class="kw">FROM</span>   dual</span>
<span id="cb179-9"><a href="#cb179-9"></a><span class="kw">CONNECT</span> <span class="kw">BY</span> <span class="kw">level</span> <span class="op">&lt;=</span> <span class="dv">10</span>;</span>
<span id="cb179-10"><a href="#cb179-10"></a></span>
<span id="cb179-11"><a href="#cb179-11"></a><span class="kw">COMMIT</span>;</span></code></pre></div>
<h5>
What’s in the table?
</h3>
<div class="sourceCode" id="cb180"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb180-1"><a href="#cb180-1"></a><span class="kw">SELECT</span> val</span>
<span id="cb180-2"><a href="#cb180-2"></a><span class="kw">FROM</span>   rownum_order_test</span>
<span id="cb180-3"><a href="#cb180-3"></a><span class="kw">ORDER</span> <span class="kw">BY</span> val;</span>
<span id="cb180-4"><a href="#cb180-4"></a></span>
<span id="cb180-5"><a href="#cb180-5"></a>       VAL</span>
<span id="cb180-6"><a href="#cb180-6"></a><span class="co">----------</span></span>
<span id="cb180-7"><a href="#cb180-7"></a>         <span class="dv">1</span></span>
<span id="cb180-8"><a href="#cb180-8"></a>         <span class="dv">1</span></span>
<span id="cb180-9"><a href="#cb180-9"></a>         <span class="dv">2</span></span>
<span id="cb180-10"><a href="#cb180-10"></a>         <span class="dv">2</span></span>
<span id="cb180-11"><a href="#cb180-11"></a>         <span class="dv">3</span></span>
<span id="cb180-12"><a href="#cb180-12"></a>         <span class="dv">3</span></span>
<span id="cb180-13"><a href="#cb180-13"></a>         <span class="dv">4</span></span>
<span id="cb180-14"><a href="#cb180-14"></a>         <span class="dv">4</span></span>
<span id="cb180-15"><a href="#cb180-15"></a>         <span class="dv">5</span></span>
<span id="cb180-16"><a href="#cb180-16"></a>         <span class="dv">5</span></span>
<span id="cb180-17"><a href="#cb180-17"></a>         <span class="dv">6</span></span>
<span id="cb180-18"><a href="#cb180-18"></a>         <span class="dv">6</span></span>
<span id="cb180-19"><a href="#cb180-19"></a>         <span class="dv">7</span></span>
<span id="cb180-20"><a href="#cb180-20"></a>         <span class="dv">7</span></span>
<span id="cb180-21"><a href="#cb180-21"></a>         <span class="dv">8</span></span>
<span id="cb180-22"><a href="#cb180-22"></a>         <span class="dv">8</span></span>
<span id="cb180-23"><a href="#cb180-23"></a>         <span class="dv">9</span></span>
<span id="cb180-24"><a href="#cb180-24"></a>         <span class="dv">9</span></span>
<span id="cb180-25"><a href="#cb180-25"></a>        <span class="dv">10</span></span>
<span id="cb180-26"><a href="#cb180-26"></a>        <span class="dv">10</span></span>
<span id="cb180-27"><a href="#cb180-27"></a></span>
<span id="cb180-28"><a href="#cb180-28"></a><span class="dv">20</span> <span class="kw">rows</span> selected.</span></code></pre></div>
<h5>
Get first <code>N</code> rows
</h3>
<div class="sourceCode" id="cb181"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb181-1"><a href="#cb181-1"></a><span class="kw">SELECT</span> val</span>
<span id="cb181-2"><a href="#cb181-2"></a><span class="kw">FROM</span>   rownum_order_test</span>
<span id="cb181-3"><a href="#cb181-3"></a><span class="kw">ORDER</span> <span class="kw">BY</span> val <span class="kw">DESC</span></span>
<span id="cb181-4"><a href="#cb181-4"></a>FETCH <span class="fu">FIRST</span> <span class="dv">5</span> <span class="kw">ROWS</span> <span class="kw">ONLY</span>;</span>
<span id="cb181-5"><a href="#cb181-5"></a></span>
<span id="cb181-6"><a href="#cb181-6"></a>       VAL</span>
<span id="cb181-7"><a href="#cb181-7"></a><span class="co">----------</span></span>
<span id="cb181-8"><a href="#cb181-8"></a>        <span class="dv">10</span></span>
<span id="cb181-9"><a href="#cb181-9"></a>        <span class="dv">10</span></span>
<span id="cb181-10"><a href="#cb181-10"></a>         <span class="dv">9</span></span>
<span id="cb181-11"><a href="#cb181-11"></a>         <span class="dv">9</span></span>
<span id="cb181-12"><a href="#cb181-12"></a>         <span class="dv">8</span></span>
<span id="cb181-13"><a href="#cb181-13"></a></span>
<span id="cb181-14"><a href="#cb181-14"></a><span class="dv">5</span> <span class="kw">rows</span> selected.</span></code></pre></div>
<h5>
Get first <code>N</code> rows, if <code>N</code><sup>th</sup> row has ties, get all the tied rows
</h3>
<div class="sourceCode" id="cb182"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb182-1"><a href="#cb182-1"></a><span class="kw">SELECT</span> val</span>
<span id="cb182-2"><a href="#cb182-2"></a><span class="kw">FROM</span>   rownum_order_test</span>
<span id="cb182-3"><a href="#cb182-3"></a><span class="kw">ORDER</span> <span class="kw">BY</span> val <span class="kw">DESC</span></span>
<span id="cb182-4"><a href="#cb182-4"></a>FETCH <span class="fu">FIRST</span> <span class="dv">5</span> <span class="kw">ROWS</span> <span class="kw">WITH</span> TIES;</span>
<span id="cb182-5"><a href="#cb182-5"></a></span>
<span id="cb182-6"><a href="#cb182-6"></a>       VAL</span>
<span id="cb182-7"><a href="#cb182-7"></a><span class="co">----------</span></span>
<span id="cb182-8"><a href="#cb182-8"></a>        <span class="dv">10</span></span>
<span id="cb182-9"><a href="#cb182-9"></a>        <span class="dv">10</span></span>
<span id="cb182-10"><a href="#cb182-10"></a>         <span class="dv">9</span></span>
<span id="cb182-11"><a href="#cb182-11"></a>         <span class="dv">9</span></span>
<span id="cb182-12"><a href="#cb182-12"></a>         <span class="dv">8</span></span>
<span id="cb182-13"><a href="#cb182-13"></a>         <span class="dv">8</span></span>
<span id="cb182-14"><a href="#cb182-14"></a></span>
<span id="cb182-15"><a href="#cb182-15"></a><span class="dv">6</span> <span class="kw">rows</span> selected.</span></code></pre></div>
<h5>
Top <code>x</code>% of rows
</h3>
<div class="sourceCode" id="cb183"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb183-1"><a href="#cb183-1"></a><span class="kw">SELECT</span> val</span>
<span id="cb183-2"><a href="#cb183-2"></a><span class="kw">FROM</span>   rownum_order_test</span>
<span id="cb183-3"><a href="#cb183-3"></a><span class="kw">ORDER</span> <span class="kw">BY</span> val</span>
<span id="cb183-4"><a href="#cb183-4"></a>FETCH <span class="fu">FIRST</span> <span class="dv">20</span> <span class="kw">PERCENT</span> <span class="kw">ROWS</span> <span class="kw">ONLY</span>;</span>
<span id="cb183-5"><a href="#cb183-5"></a></span>
<span id="cb183-6"><a href="#cb183-6"></a>       VAL</span>
<span id="cb183-7"><a href="#cb183-7"></a><span class="co">----------</span></span>
<span id="cb183-8"><a href="#cb183-8"></a>         <span class="dv">1</span></span>
<span id="cb183-9"><a href="#cb183-9"></a>         <span class="dv">1</span></span>
<span id="cb183-10"><a href="#cb183-10"></a>         <span class="dv">2</span></span>
<span id="cb183-11"><a href="#cb183-11"></a>         <span class="dv">2</span></span>
<span id="cb183-12"><a href="#cb183-12"></a></span>
<span id="cb183-13"><a href="#cb183-13"></a><span class="dv">4</span> <span class="kw">rows</span> selected.</span></code></pre></div>
<h5>
Using an offset, very useful for pagination
</h3>
<div class="sourceCode" id="cb184"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb184-1"><a href="#cb184-1"></a><span class="kw">SELECT</span> val</span>
<span id="cb184-2"><a href="#cb184-2"></a><span class="kw">FROM</span>   rownum_order_test</span>
<span id="cb184-3"><a href="#cb184-3"></a><span class="kw">ORDER</span> <span class="kw">BY</span> val</span>
<span id="cb184-4"><a href="#cb184-4"></a>OFFSET <span class="dv">4</span> <span class="kw">ROWS</span> FETCH <span class="kw">NEXT</span> <span class="dv">4</span> <span class="kw">ROWS</span> <span class="kw">ONLY</span>;</span>
<span id="cb184-5"><a href="#cb184-5"></a></span>
<span id="cb184-6"><a href="#cb184-6"></a>       VAL</span>
<span id="cb184-7"><a href="#cb184-7"></a><span class="co">----------</span></span>
<span id="cb184-8"><a href="#cb184-8"></a>         <span class="dv">3</span></span>
<span id="cb184-9"><a href="#cb184-9"></a>         <span class="dv">3</span></span>
<span id="cb184-10"><a href="#cb184-10"></a>         <span class="dv">4</span></span>
<span id="cb184-11"><a href="#cb184-11"></a>         <span class="dv">4</span></span>
<span id="cb184-12"><a href="#cb184-12"></a></span>
<span id="cb184-13"><a href="#cb184-13"></a><span class="dv">4</span> <span class="kw">rows</span> selected.</span></code></pre></div>
<h5>
You can combine offset with percentages
</h3>
<div class="sourceCode" id="cb185"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb185-1"><a href="#cb185-1"></a><span class="kw">SELECT</span> val</span>
<span id="cb185-2"><a href="#cb185-2"></a><span class="kw">FROM</span>   rownum_order_test</span>
<span id="cb185-3"><a href="#cb185-3"></a><span class="kw">ORDER</span> <span class="kw">BY</span> val</span>
<span id="cb185-4"><a href="#cb185-4"></a>OFFSET <span class="dv">4</span> <span class="kw">ROWS</span> FETCH <span class="kw">NEXT</span> <span class="dv">20</span> <span class="kw">PERCENT</span> <span class="kw">ROWS</span> <span class="kw">ONLY</span>;</span>
<span id="cb185-5"><a href="#cb185-5"></a></span>
<span id="cb185-6"><a href="#cb185-6"></a>       VAL</span>
<span id="cb185-7"><a href="#cb185-7"></a><span class="co">----------</span></span>
<span id="cb185-8"><a href="#cb185-8"></a>         <span class="dv">3</span></span>
<span id="cb185-9"><a href="#cb185-9"></a>         <span class="dv">3</span></span>
<span id="cb185-10"><a href="#cb185-10"></a>         <span class="dv">4</span></span>
<span id="cb185-11"><a href="#cb185-11"></a>         <span class="dv">4</span></span>
<span id="cb185-12"><a href="#cb185-12"></a></span>
<span id="cb185-13"><a href="#cb185-13"></a><span class="dv">4</span> <span class="kw">rows</span> selected.</span></code></pre></div>
</section>
<section id="answer-2-score-767" class="level4">
<h4>Answer 2 (score 767)</h4>
<p>You can use a subquery for this like</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb186-1"><a href="#cb186-1"></a><span class="kw">select</span> <span class="op">*</span></span>
<span id="cb186-2"><a href="#cb186-2"></a><span class="kw">from</span>  </span>
<span id="cb186-3"><a href="#cb186-3"></a>( <span class="kw">select</span> <span class="op">*</span> </span>
<span id="cb186-4"><a href="#cb186-4"></a>  <span class="kw">from</span> emp </span>
<span id="cb186-5"><a href="#cb186-5"></a>  <span class="kw">order</span> <span class="kw">by</span> sal <span class="kw">desc</span> ) </span>
<span id="cb186-6"><a href="#cb186-6"></a><span class="kw">where</span> <span class="kw">ROWNUM</span> <span class="op">&lt;=</span> <span class="dv">5</span>;</span></code></pre></div>
<p>Have also a look at the topic <a href="http://www.oracle.com/technetwork/issue-archive/2006/06-sep/o56asktom-086197.html" rel="noreferrer">On ROWNUM and limiting results</a> at Oracle/AskTom for more information.</p>
<p>
<strong>Update</strong>: To limit the result with both lower and upper bounds things get a bit more bloated with
</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb187-1"><a href="#cb187-1"></a><span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> </span>
<span id="cb187-2"><a href="#cb187-2"></a>( <span class="kw">select</span> a.<span class="op">*</span>, <span class="kw">ROWNUM</span> rnum <span class="kw">from</span> </span>
<span id="cb187-3"><a href="#cb187-3"></a>  ( <span class="op">&lt;</span>your_query_goes_here, <span class="kw">with</span> <span class="kw">order</span> <span class="kw">by</span><span class="op">&gt;</span> ) a </span>
<span id="cb187-4"><a href="#cb187-4"></a>  <span class="kw">where</span> <span class="kw">ROWNUM</span> <span class="op">&lt;=</span> <span class="ch">:MAX_ROW_TO_FETCH</span> )</span>
<span id="cb187-5"><a href="#cb187-5"></a><span class="kw">where</span> rnum  <span class="op">&gt;=</span> <span class="ch">:MIN_ROW_TO_FETCH</span>;</span></code></pre></div>
<p>(Copied from specified AskTom-article)</p>
<p>
<strong>Update 2</strong>: Starting with Oracle 12c (12.1) there is a syntax available to limit rows or start at offsets.
</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb188-1"><a href="#cb188-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb188-2"><a href="#cb188-2"></a><span class="kw">FROM</span>   sometable</span>
<span id="cb188-3"><a href="#cb188-3"></a><span class="kw">ORDER</span> <span class="kw">BY</span> name</span>
<span id="cb188-4"><a href="#cb188-4"></a>OFFSET <span class="dv">20</span> <span class="kw">ROWS</span> FETCH <span class="kw">NEXT</span> <span class="dv">10</span> <span class="kw">ROWS</span> <span class="kw">ONLY</span>;</span></code></pre></div>
<p>See <a href="https://stackoverflow.com/a/26051830/57601">this answer</a> for more examples. Thanks to Krumia for the hint.</p>
</section>
<section id="answer-3-score-178" class="level4">
<h4>Answer 3 (score 178)</h4>
<p>I did some performance testing for the following approaches:</p>
<h5>
Asktom
</h3>
<div class="sourceCode" id="cb189"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb189-1"><a href="#cb189-1"></a><span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> (</span>
<span id="cb189-2"><a href="#cb189-2"></a>  <span class="kw">select</span> a.<span class="op">*</span>, <span class="kw">ROWNUM</span> rnum <span class="kw">from</span> (</span>
<span id="cb189-3"><a href="#cb189-3"></a>    <span class="op">&lt;</span><span class="kw">select</span> statement <span class="kw">with</span> <span class="kw">order</span> <span class="kw">by</span> clause<span class="op">&gt;</span></span>
<span id="cb189-4"><a href="#cb189-4"></a>  ) a <span class="kw">where</span> <span class="kw">rownum</span> <span class="op">&lt;=</span> MAX_ROW</span>
<span id="cb189-5"><a href="#cb189-5"></a>) <span class="kw">where</span> rnum <span class="op">&gt;=</span> MIN_ROW</span></code></pre></div>
<h5>
Analytical
</h3>
<div class="sourceCode" id="cb190"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb190-1"><a href="#cb190-1"></a><span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> (</span>
<span id="cb190-2"><a href="#cb190-2"></a>  <span class="op">&lt;</span><span class="kw">select</span> statement <span class="kw">with</span> <span class="kw">order</span> <span class="kw">by</span> clause<span class="op">&gt;</span></span>
<span id="cb190-3"><a href="#cb190-3"></a>) <span class="kw">where</span> myrow <span class="kw">between</span> MIN_ROW <span class="kw">and</span> MAX_ROW</span></code></pre></div>
<h5>
Short Alternative
</h3>
<div class="sourceCode" id="cb191"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb191-1"><a href="#cb191-1"></a><span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> (</span>
<span id="cb191-2"><a href="#cb191-2"></a>  <span class="kw">select</span> statement, <span class="kw">rownum</span> <span class="kw">as</span> RN <span class="kw">with</span> <span class="kw">order</span> <span class="kw">by</span> clause</span>
<span id="cb191-3"><a href="#cb191-3"></a>) <span class="kw">where</span> a.rn <span class="op">&gt;=</span> MIN_ROW <span class="kw">and</span> a.rn <span class="op">&lt;=</span> MAX_ROW</span></code></pre></div>
<h5>
Results
</h1>
<p>Table had 10 million records, sort was on an unindexed datetime row:</p>
<ul>
<li>
Explain plan showed same value for all three selects (323168)
</li>
<li>
But the winner is AskTom (with analytic following close behind)
</li>
</ul>
<p>Selecting first 10 rows took:</p>
<ul>
<li>
AskTom: 28-30 seconds
</li>
<li>
Analytical: 33-37 seconds
</li>
<li>
Short alternative: 110-140 seconds
</li>
</ul>
<p>Selecting rows between 100,000 and 100,010:</p>
<ul>
<li>
AskTom: 60 seconds
</li>
<li>
Analytical: 100 seconds
</li>
</ul>
<p>Selecting rows between 9,000,000 and 9,000,010:</p>
<ul>
<li>
AskTom: 130 seconds
</li>
<li>
Analytical: 150 seconds
</li>
</ul>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="what-is-the-difference-between-union-and-union-all-score-1265525-in-2018" class="level3">
<h3>27: What is the difference between UNION and UNION ALL? (score <a href="https://stackoverflow.com/q/49925.html">1265525</a> in 2018)</h3>
<section id="question-26" class="level4">
<h4>Question</h4>
<p>What is the difference between <code>UNION</code> and <code>UNION ALL</code>?</p>
</section>
<section id="answer-accepted-score-1641" class="level4">
<h4>Answer accepted (score 1641)</h4>
<p><code>UNION</code> removes duplicate records (where all columns in the results are the same), <code>UNION ALL</code> does not.</p>
<p>There is a performance hit when using <code>UNION</code> instead of <code>UNION ALL</code>, since the database server must do additional work to remove the duplicate rows, but usually you do not want the duplicates (especially when developing reports).</p>
<h5>
UNION Example:
</h1>
<div class="sourceCode" id="cb192"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb192-1"><a href="#cb192-1"></a><span class="kw">SELECT</span> <span class="st">&#39;foo&#39;</span> <span class="kw">AS</span> bar <span class="kw">UNION</span> <span class="kw">SELECT</span> <span class="st">&#39;foo&#39;</span> <span class="kw">AS</span> bar</span></code></pre></div>
<p><strong>Result:</strong></p>
<div class="sourceCode" id="cb193"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb193-1"><a href="#cb193-1"></a><span class="op">+</span><span class="co">-----+</span></span>
<span id="cb193-2"><a href="#cb193-2"></a>| bar |</span>
<span id="cb193-3"><a href="#cb193-3"></a><span class="op">+</span><span class="co">-----+</span></span>
<span id="cb193-4"><a href="#cb193-4"></a>| foo |</span>
<span id="cb193-5"><a href="#cb193-5"></a><span class="op">+</span><span class="co">-----+</span></span>
<span id="cb193-6"><a href="#cb193-6"></a><span class="dv">1</span> <span class="kw">row</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<h5>
UNION ALL example:
</h1>
<div class="sourceCode" id="cb194"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb194-1"><a href="#cb194-1"></a><span class="kw">SELECT</span> <span class="st">&#39;foo&#39;</span> <span class="kw">AS</span> bar <span class="kw">UNION</span> <span class="kw">ALL</span> <span class="kw">SELECT</span> <span class="st">&#39;foo&#39;</span> <span class="kw">AS</span> bar</span></code></pre></div>
<p><strong>Result:</strong></p>
<div class="sourceCode" id="cb195"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb195-1"><a href="#cb195-1"></a><span class="op">+</span><span class="co">-----+</span></span>
<span id="cb195-2"><a href="#cb195-2"></a>| bar |</span>
<span id="cb195-3"><a href="#cb195-3"></a><span class="op">+</span><span class="co">-----+</span></span>
<span id="cb195-4"><a href="#cb195-4"></a>| foo |</span>
<span id="cb195-5"><a href="#cb195-5"></a>| foo |</span>
<span id="cb195-6"><a href="#cb195-6"></a><span class="op">+</span><span class="co">-----+</span></span>
<span id="cb195-7"><a href="#cb195-7"></a><span class="dv">2</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
</section>
<section id="answer-2-score-268" class="level4">
<h4>Answer 2 (score 268)</h4>
<p>Both UNION and UNION ALL concatenate the result of two different SQLs. They differ in the way they handle duplicates.</p>
<ul>
<li>
<p>
UNION performs a DISTINCT on the result set, eliminating any duplicate rows.
</p>
</li>
<li>
<p>
UNION ALL does not remove duplicates, and it therefore faster than UNION.
</p>
</li>
</ul>
<blockquote>
<strong>Note:</strong> While using this commands all selected columns need to be of the same data type.
</blockquote>
<p>Example: If we have two tables, 1) Employee and 2) Customer</p>
<ol>
<li>
Employee table data:
</li>
</ol>
<p><img src="https://i.stack.imgur.com/huYEL.png" alt="enter image description here"></p>
<ol start="2">
<li>
Customer table data:
</li>
</ol>
<p><img src="https://i.stack.imgur.com/FEaKe.png" alt="enter image description here"></p>
<ol start="3">
<li>
UNION Example (It removes all duplicate records):
</li>
</ol>
<p><img src="https://i.stack.imgur.com/lLiS1.png" alt="enter image description here"></p>
<ol start="4">
<li>
UNION ALL Example (It just concatenate records, not eliminate duplicates, so it is faster than UNION):
</li>
</ol>
<p><img src="https://i.stack.imgur.com/n5gvq.png" alt="enter image description here"></p>
</section>
<section id="answer-3-score-46" class="level4">
<h4>Answer 3 (score 46)</h4>
<p><code>UNION</code> removes duplicates, whereas <code>UNION ALL</code> does not.</p>
<p>In order to remove duplicates the result set must be sorted, and this <em>may</em> have an impact on the performance of the UNION, depending on the volume of data being sorted, and the settings of various RDBMS parameters ( For Oracle <code>PGA_AGGREGATE_TARGET</code> with <code>WORKAREA_SIZE_POLICY=AUTO</code> or <code>SORT_AREA_SIZE</code> and <code>SOR_AREA_RETAINED_SIZE</code> if <code>WORKAREA_SIZE_POLICY=MANUAL</code> ).</p>
<p>Basically, the sort is faster if it can be carried out in memory, but the same caveat about the volume of data applies.</p>
<p>Of course, if you need data returned without duplicates then you <em>must</em> use UNION, depending on the source of your data.</p>
<p>I would have commented on the first post to qualify the “is much less performant” comment, but have insufficient reputation (points) to do so.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="search-text-in-stored-procedure-in-sql-server-score-1248594-in-2018" class="level3">
<h3>28: Search text in stored procedure in SQL Server (score <a href="https://stackoverflow.com/q/14704105.html">1248594</a> in 2018)</h3>
<section id="question-27" class="level4">
<h4>Question</h4>
<p>I want to search a text from all my database stored procedures. I use the below SQL:</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb196-1"><a href="#cb196-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span></span>
<span id="cb196-2"><a href="#cb196-2"></a>       o.name <span class="kw">AS</span> Object_Name,</span>
<span id="cb196-3"><a href="#cb196-3"></a>       o.type_desc</span>
<span id="cb196-4"><a href="#cb196-4"></a>  <span class="kw">FROM</span> sys.sql_modules m</span>
<span id="cb196-5"><a href="#cb196-5"></a>       <span class="kw">INNER</span> <span class="kw">JOIN</span></span>
<span id="cb196-6"><a href="#cb196-6"></a>       sys.objects o</span>
<span id="cb196-7"><a href="#cb196-7"></a>         <span class="kw">ON</span> m.object_id <span class="op">=</span> o.object_id</span>
<span id="cb196-8"><a href="#cb196-8"></a> <span class="kw">WHERE</span> m.definition <span class="kw">Like</span> <span class="st">&#39;%[ABD]%&#39;</span>;</span></code></pre></div>
<p>I want to search for <code>[ABD]</code> in all stored procedures including square brackets, but it’s not giving the proper result. How can I change my query to achieve this?</p>
</section>
<section id="answer-accepted-score-528" class="level4">
<h4>Answer accepted (score 528)</h4>
<p>Escape the square brackets:</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb197-1"><a href="#cb197-1"></a><span class="op">..</span>.</span>
<span id="cb197-2"><a href="#cb197-2"></a><span class="kw">WHERE</span> m.definition <span class="kw">Like</span> <span class="st">&#39;%\[ABD\]%&#39;</span> <span class="kw">ESCAPE</span> <span class="st">&#39;\&#39;</span></span></code></pre></div>
<p>Then the square brackets will be treated as a string literals not as wild cards.</p>
</section>
<section id="answer-2-score-297" class="level4">
<h4>Answer 2 (score 297)</h4>
<p>Try this request:</p>
<p><strong>Query</strong></p>
<div class="sourceCode" id="cb198"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb198-1"><a href="#cb198-1"></a><span class="kw">SELECT</span> name</span>
<span id="cb198-2"><a href="#cb198-2"></a><span class="kw">FROM</span>   sys.procedures</span>
<span id="cb198-3"><a href="#cb198-3"></a><span class="kw">WHERE</span>  Object_definition(object_id) <span class="kw">LIKE</span> <span class="st">&#39;%strHell%&#39;</span></span></code></pre></div>
</section>
<section id="answer-3-score-54" class="level4">
<h4>Answer 3 (score 54)</h4>
<p>Have you tried using some of the third party tools to do the search? There are several available out there that are free and that saved me a ton of time in the past.</p>
<p>Below are two SSMS Addins I used with good success.</p>
<p><a href="http://www.apexsql.com/sql_tools_search.aspx">ApexSQL Search</a> – Searches both schema and data in databases and has additional features such as dependency tracking and more…</p>
<p><a href="http://www.ssmstoolspack.com/">SSMS Tools pack</a> – Has same search functionality as previous one and several other cool features. Not free for SQL Server 2012 but still very affordable.</p>
<p>I know this answer is not 100% related to the questions (which was more specific) but hopefully others will find this useful.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-to-delete-using-inner-join-with-sql-server-score-1236813-in-2018" class="level3">
<h3>29: How to Delete using INNER JOIN with SQL Server? (score <a href="https://stackoverflow.com/q/16481379.html">1236813</a> in 2018)</h3>
<section id="question-28" class="level4">
<h4>Question</h4>
<p>I want to delete using <code>INNER JOIN</code> in <strong>SQL Server 2008</strong>.</p>
<p>But I get this error:</p>
<blockquote>
<p>
Msg 156, Level 15, State 1, Line 15<br> Incorrect syntax near the keyword ‘INNER’.
</p>
</blockquote>
<p>My code:</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb199-1"><a href="#cb199-1"></a><span class="kw">DELETE</span> <span class="kw">FROM</span> WorkRecord2 </span>
<span id="cb199-2"><a href="#cb199-2"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> Employee <span class="kw">ON</span> EmployeeRun<span class="op">=</span>EmployeeNo</span>
<span id="cb199-3"><a href="#cb199-3"></a><span class="kw">WHERE</span> Company <span class="op">=</span> <span class="st">&#39;1&#39;</span> <span class="kw">AND</span> <span class="dt">Date</span> <span class="op">=</span> <span class="st">&#39;2013-05-06&#39;</span></span></code></pre></div>
</section>
<section id="answer-accepted-score-2033" class="level4">
<h4>Answer accepted (score 2033)</h4>
<p>You need to specify what table you are deleting from, here is a version with an alias:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb200-1"><a href="#cb200-1"></a><span class="kw">DELETE</span> w</span>
<span id="cb200-2"><a href="#cb200-2"></a><span class="kw">FROM</span> WorkRecord2 w</span>
<span id="cb200-3"><a href="#cb200-3"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> Employee e</span>
<span id="cb200-4"><a href="#cb200-4"></a>  <span class="kw">ON</span> EmployeeRun<span class="op">=</span>EmployeeNo</span>
<span id="cb200-5"><a href="#cb200-5"></a><span class="kw">WHERE</span> Company <span class="op">=</span> <span class="st">&#39;1&#39;</span> <span class="kw">AND</span> <span class="dt">Date</span> <span class="op">=</span> <span class="st">&#39;2013-05-06&#39;</span></span></code></pre></div>
</section>
<section id="answer-2-score-131" class="level4">
<h4>Answer 2 (score 131)</h4>
<p>Just add the name of the table between <code>DELETE</code> and <code>FROM</code> from where you want to delete records because we have to specify the table to delete. Also remove <code>ORDER BY</code> clause because there is nothing to order while deleting records.</p>
<p>So your final query should be like this:</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb201-1"><a href="#cb201-1"></a>    <span class="kw">DELETE</span> WorkRecord2 </span>
<span id="cb201-2"><a href="#cb201-2"></a>      <span class="kw">FROM</span> WorkRecord2 </span>
<span id="cb201-3"><a href="#cb201-3"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> Employee </span>
<span id="cb201-4"><a href="#cb201-4"></a>        <span class="kw">ON</span> EmployeeRun<span class="op">=</span>EmployeeNo</span>
<span id="cb201-5"><a href="#cb201-5"></a>     <span class="kw">WHERE</span> Company <span class="op">=</span> <span class="st">&#39;1&#39;</span> </span>
<span id="cb201-6"><a href="#cb201-6"></a>       <span class="kw">AND</span> <span class="dt">Date</span> <span class="op">=</span> <span class="st">&#39;2013-05-06&#39;</span>;</span></code></pre></div>
</section>
<section id="answer-3-score-28" class="level4">
<h4>Answer 3 (score 28)</h4>
<p>Possible this be helpful for you -</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb202-1"><a href="#cb202-1"></a><span class="kw">DELETE</span> <span class="kw">FROM</span> dbo.WorkRecord2 </span>
<span id="cb202-2"><a href="#cb202-2"></a><span class="kw">WHERE</span> EmployeeRun <span class="kw">IN</span> (</span>
<span id="cb202-3"><a href="#cb202-3"></a>    <span class="kw">SELECT</span> e.EmployeeNo</span>
<span id="cb202-4"><a href="#cb202-4"></a>    <span class="kw">FROM</span> dbo.Employee e</span>
<span id="cb202-5"><a href="#cb202-5"></a>    <span class="kw">WHERE</span> <span class="op">..</span>.</span>
<span id="cb202-6"><a href="#cb202-6"></a>)</span></code></pre></div>
<p>Or try this -</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb203-1"><a href="#cb203-1"></a><span class="kw">DELETE</span> <span class="kw">FROM</span> dbo.WorkRecord2 </span>
<span id="cb203-2"><a href="#cb203-2"></a><span class="kw">WHERE</span> <span class="kw">EXISTS</span>(</span>
<span id="cb203-3"><a href="#cb203-3"></a>    <span class="kw">SELECT</span> <span class="dv">1</span></span>
<span id="cb203-4"><a href="#cb203-4"></a>    <span class="kw">FROM</span> dbo.Employee e</span>
<span id="cb203-5"><a href="#cb203-5"></a>    <span class="kw">WHERE</span> EmployeeRun <span class="op">=</span> e.EmployeeNo</span>
<span id="cb203-6"><a href="#cb203-6"></a>        <span class="kw">AND</span> <span class="op">....</span></span>
<span id="cb203-7"><a href="#cb203-7"></a>)</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="sql-inner-join-with-3-tables-score-1220486-in-2019" class="level3">
<h3>30: SQL Inner-join with 3 tables? (score <a href="https://stackoverflow.com/q/10195451.html">1220486</a> in 2019)</h3>
<section id="question-29" class="level4">
<h4>Question</h4>
<p>I’m trying to join 3 tables in a view; here is the situation:</p>
<p>I have a table that contains information of students who are applying to live on this College Campus. I have another table that lists the Hall Preferences (3 of them) for each Student. But each of these preferences are merely an ID Number, and the ID Number has a corresponding Hall Name in a third table (did not design this database…).</p>
<p>Pretty much, I have <code>INNER JOIN</code> on the table with their preferences, and their information, the result is something like…</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb204-1"><a href="#cb204-1"></a> John Doe | <span class="dv">923423</span> | Incoming Student | <span class="dv">005</span></span></code></pre></div>
<p>Where <code>005</code> would be the <code>HallID</code>. So Now I want to match that <code>HallID</code> to a third table, where this table contains a <code>HallID</code> and <code>HallName</code>.</p>
<p>So pretty much, I want my result to be like…</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb205-1"><a href="#cb205-1"></a> John Doe | <span class="dv">923423</span> | Incoming Student | Foley Hall <span class="op">&lt;</span><span class="co">---(INSTEAD OF 005)</span></span></code></pre></div>
<p>Here is what I currently have:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb206-1"><a href="#cb206-1"></a><span class="kw">SELECT</span></span>
<span id="cb206-2"><a href="#cb206-2"></a>  s.StudentID, s.FName, </span>
<span id="cb206-3"><a href="#cb206-3"></a>  s.LName, s.Gender, s.BirthDate, s.Email, </span>
<span id="cb206-4"><a href="#cb206-4"></a>  r.HallPref1, r.HallPref2, r.HallPref3</span>
<span id="cb206-5"><a href="#cb206-5"></a><span class="kw">FROM</span></span>
<span id="cb206-6"><a href="#cb206-6"></a>  dbo.StudentSignUp <span class="kw">AS</span> s </span>
<span id="cb206-7"><a href="#cb206-7"></a>  <span class="kw">INNER</span> <span class="kw">JOIN</span> RoomSignUp.dbo.Incoming_Applications_Current <span class="kw">AS</span> r </span>
<span id="cb206-8"><a href="#cb206-8"></a>    <span class="kw">ON</span> s.StudentID <span class="op">=</span> r.StudentID </span>
<span id="cb206-9"><a href="#cb206-9"></a>  <span class="kw">INNER</span> <span class="kw">JOIN</span> HallData.dbo.Halls <span class="kw">AS</span> h </span>
<span id="cb206-10"><a href="#cb206-10"></a>    <span class="kw">ON</span> r.HallPref1 <span class="op">=</span> h.HallID</span></code></pre></div>
</section>
<section id="answer-accepted-score-465" class="level4">
<h4>Answer accepted (score 465)</h4>
<p>You can do the following (I guessed on table fields,etc)</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb207-1"><a href="#cb207-1"></a><span class="kw">SELECT</span> s.studentname</span>
<span id="cb207-2"><a href="#cb207-2"></a>    , s.studentid</span>
<span id="cb207-3"><a href="#cb207-3"></a>    , s.studentdesc</span>
<span id="cb207-4"><a href="#cb207-4"></a>    , h.hallname</span>
<span id="cb207-5"><a href="#cb207-5"></a><span class="kw">FROM</span> students s</span>
<span id="cb207-6"><a href="#cb207-6"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> hallprefs hp</span>
<span id="cb207-7"><a href="#cb207-7"></a>    <span class="kw">on</span> s.studentid <span class="op">=</span> hp.studentid</span>
<span id="cb207-8"><a href="#cb207-8"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> halls h</span>
<span id="cb207-9"><a href="#cb207-9"></a>    <span class="kw">on</span> hp.hallid <span class="op">=</span> h.hallid</span></code></pre></div>
<p>Based on your request for multiple halls you could do it this way. You just join on your Hall table multiple times for each room pref id:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb208-1"><a href="#cb208-1"></a><span class="kw">SELECT</span>     s.StudentID</span>
<span id="cb208-2"><a href="#cb208-2"></a>    , s.FName</span>
<span id="cb208-3"><a href="#cb208-3"></a>    , s.LName</span>
<span id="cb208-4"><a href="#cb208-4"></a>    , s.Gender</span>
<span id="cb208-5"><a href="#cb208-5"></a>    , s.BirthDate</span>
<span id="cb208-6"><a href="#cb208-6"></a>    , s.Email</span>
<span id="cb208-7"><a href="#cb208-7"></a>    , r.HallPref1</span>
<span id="cb208-8"><a href="#cb208-8"></a>    , h1.hallName <span class="kw">as</span> Pref1HallName</span>
<span id="cb208-9"><a href="#cb208-9"></a>    , r.HallPref2 </span>
<span id="cb208-10"><a href="#cb208-10"></a>    , h2.hallName <span class="kw">as</span> Pref2HallName</span>
<span id="cb208-11"><a href="#cb208-11"></a>    , r.HallPref3</span>
<span id="cb208-12"><a href="#cb208-12"></a>    , h3.hallName <span class="kw">as</span> Pref3HallName</span>
<span id="cb208-13"><a href="#cb208-13"></a><span class="kw">FROM</span>  dbo.StudentSignUp <span class="kw">AS</span> s </span>
<span id="cb208-14"><a href="#cb208-14"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> RoomSignUp.dbo.Incoming_Applications_Current <span class="kw">AS</span> r </span>
<span id="cb208-15"><a href="#cb208-15"></a>    <span class="kw">ON</span> s.StudentID <span class="op">=</span> r.StudentID </span>
<span id="cb208-16"><a href="#cb208-16"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> HallData.dbo.Halls <span class="kw">AS</span> h1 </span>
<span id="cb208-17"><a href="#cb208-17"></a>    <span class="kw">ON</span> r.HallPref1 <span class="op">=</span> h1.HallID</span>
<span id="cb208-18"><a href="#cb208-18"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> HallData.dbo.Halls <span class="kw">AS</span> h2</span>
<span id="cb208-19"><a href="#cb208-19"></a>    <span class="kw">ON</span> r.HallPref2 <span class="op">=</span> h2.HallID</span>
<span id="cb208-20"><a href="#cb208-20"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> HallData.dbo.Halls <span class="kw">AS</span> h3</span>
<span id="cb208-21"><a href="#cb208-21"></a>    <span class="kw">ON</span> r.HallPref3 <span class="op">=</span> h3.HallID</span></code></pre></div>
</section>
<section id="answer-2-score-44" class="level4">
<h4>Answer 2 (score 44)</h4>
<div class="sourceCode" id="cb209"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb209-1"><a href="#cb209-1"></a><span class="kw">SELECT</span> column_Name1,column_name2,<span class="op">......</span></span>
<span id="cb209-2"><a href="#cb209-2"></a>  <span class="kw">From</span> tbl_name1,tbl_name2,tbl_name3</span>
<span id="cb209-3"><a href="#cb209-3"></a>  <span class="kw">where</span> tbl_name1.column_name <span class="op">=</span> tbl_name2.column_name </span>
<span id="cb209-4"><a href="#cb209-4"></a>  <span class="kw">and</span> tbl_name2.column_name <span class="op">=</span> tbl_name3.column_name</span></code></pre></div>
</section>
<section id="answer-3-score-38" class="level4">
<h4>Answer 3 (score 38)</h4>
<p>If you have 3 tables with the same <code>ID</code> to be joined, I think it would be like this:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb210-1"><a href="#cb210-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> table1 a</span>
<span id="cb210-2"><a href="#cb210-2"></a><span class="kw">JOIN</span> table2 b <span class="kw">ON</span> a.<span class="kw">ID</span> <span class="op">=</span> b.<span class="kw">ID</span></span>
<span id="cb210-3"><a href="#cb210-3"></a><span class="kw">JOIN</span> table3 c <span class="kw">ON</span> a.<span class="kw">ID</span> <span class="op">=</span> c.<span class="kw">ID</span></span></code></pre></div>
<p>Just replace <code>*</code> with what you want to get from the tables.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-to-reset-auto_increment-in-mysql-score-1163265-in-2018" class="level3">
<h3>31: How to reset AUTO_INCREMENT in MySQL? (score <a href="https://stackoverflow.com/q/8923114.html">1163265</a> in 2018)</h3>
<section id="question-30" class="level4">
<h4>Question</h4>
<p>How can I <strong><em>reset</em></strong> the <code>AUTO_INCREMENT</code> of a field? I want it to start counting from <code>1</code> again.</p>
</section>
<section id="answer-accepted-score-1883" class="level4">
<h4>Answer accepted (score 1883)</h4>
<p>You can reset the counter with:</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb211-1"><a href="#cb211-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> tablename AUTO_INCREMENT <span class="op">=</span> <span class="dv">1</span></span></code></pre></div>
<p>For InnoDB you cannot set the <code>auto_increment</code> value lower or equal to the highest current index. (quote from <a href="http://viralpatel.net/blogs/reseting-mysql-autoincrement-column/" rel="noreferrer">ViralPatel</a>):</p>
<blockquote>
<p>
Note that you cannot reset the counter to a value less than or equal to any that have already been used. For MyISAM, if the value is less than or equal to the maximum value currently in the AUTO_INCREMENT column, the value is reset to the current maximum plus one. For InnoDB, if the value is less than the current maximum value in the column, no error occurs and the current sequence value is not changed.
</p>
</blockquote>
<p>See <em><a href="https://stackoverflow.com/q/2410689/367456">How to Reset an MySQL AutoIncrement using a MAX value from another table?</a></em> on how to dynamically get an acceptable value.</p>
</section>
<section id="answer-2-score-146" class="level4">
<h4>Answer 2 (score 146)</h4>
<div class="sourceCode" id="cb212"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb212-1"><a href="#cb212-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> tablename AUTO_INCREMENT <span class="op">=</span> <span class="dv">1</span></span></code></pre></div>
</section>
<section id="answer-3-score-72" class="level4">
<h4>Answer 3 (score 72)</h4>
<div class="sourceCode" id="cb213"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb213-1"><a href="#cb213-1"></a><span class="kw">SET</span>  @num <span class="op">:=</span> <span class="dv">0</span>;</span>
<span id="cb213-2"><a href="#cb213-2"></a></span>
<span id="cb213-3"><a href="#cb213-3"></a><span class="kw">UPDATE</span> your_table <span class="kw">SET</span> <span class="kw">id</span> <span class="op">=</span> @num <span class="op">:=</span> (@num<span class="op">+</span><span class="dv">1</span>);</span>
<span id="cb213-4"><a href="#cb213-4"></a></span>
<span id="cb213-5"><a href="#cb213-5"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> your_table AUTO_INCREMENT <span class="op">=</span><span class="dv">1</span>;</span></code></pre></div>
<p>I think this will do it</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="convert-int-to-varchar-sql-score-1158597-in-2015" class="level3">
<h3>32: Convert INT to VARCHAR SQL (score <a href="https://stackoverflow.com/q/19979532.html">1158597</a> in 2015)</h3>
<section id="question-31" class="level4">
<h4>Question</h4>
<p>I am using Sybase and I am doing a select which returns me a column called “iftype”, but its type is int and I need to convert into varchar. When I try to do the select without the convert function I get this error:</p>
<blockquote>
Error code 257, SQL state 37000: Implicit conversion from datatype ‘VARCHAR’ to ‘INT’ is not allowed. Use the CONVERT function to run this query.
</blockquote>
<p>I dont know how to implement the function <code>CONVERT</code>. Can anyone help me, please ?</p>
</section>
<section id="answer-accepted-score-556" class="level4">
<h4>Answer accepted (score 556)</h4>
<p>Use the convert function.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb214-1"><a href="#cb214-1"></a><span class="kw">SELECT</span> <span class="fu">CONVERT</span>(<span class="dt">varchar</span>(<span class="dv">10</span>), field_name) <span class="kw">FROM</span> table_name</span></code></pre></div>
</section>
<section id="answer-2-score-88" class="level4">
<h4>Answer 2 (score 88)</h4>
<p>Use the <code>STR</code> function:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb215-1"><a href="#cb215-1"></a><span class="kw">SELECT</span> STR(field_name) <span class="kw">FROM</span> table_name</span></code></pre></div>
<hr>
<h5>
<strong>Arguments</strong>
</h2>
<p><strong>float_expression</strong></p>
<p>Is an expression of approximate numeric (float) data type with a decimal point.</p>
<p><strong>length</strong></p>
<p>Is the total length. This includes decimal point, sign, digits, and spaces. The default is 10.</p>
<p><strong>decimal</strong></p>
<p>Is the number of places to the right of the decimal point. decimal must be less than or equal to 16. If decimal is more than 16 then the result is truncated to sixteen places to the right of the decimal point.</p>
<p>source: <a href="https://msdn.microsoft.com/en-us/library/ms189527.aspx" rel="noreferrer">https://msdn.microsoft.com/en-us/library/ms189527.aspx</a></p>
</section>
<section id="answer-3-score-23-1" class="level4">
<h4>Answer 3 (score 23)</h4>
<p>You can use <code>CAST</code> function:</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb216-1"><a href="#cb216-1"></a><span class="kw">SELECT</span> <span class="fu">CAST</span>(your_column_name <span class="kw">AS</span> <span class="dt">varchar</span>(<span class="dv">10</span>)) <span class="kw">FROM</span> your_table_name</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-to-create-temp-table-with-select-into-temptable-from-cte-query-score-1073684-in-2013" class="level3">
<h3>33: How to create Temp table with SELECT * INTO tempTable FROM CTE Query (score <a href="https://stackoverflow.com/q/11491240.html">1073684</a> in 2013)</h3>
<section id="question-32" class="level4">
<h4>Question</h4>
<p>I have a MS SQL CTE query from which I want to create a temporary table. I am not sure how to do it as it gives an <code>Invalid Object name</code> error.</p>
<p>Below is the whole query for reference</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb217-1"><a href="#cb217-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">INTO</span> TEMPBLOCKEDDATES <span class="kw">FROM</span> </span>
<span id="cb217-2"><a href="#cb217-2"></a>;<span class="kw">with</span> Calendar <span class="kw">as</span> (</span>
<span id="cb217-3"><a href="#cb217-3"></a>    <span class="kw">select</span> EventID, EventTitle, EventStartDate, EventEndDate, EventEnumDays,EventStartTime,EventEndTime, EventRecurring, EventStartDate <span class="kw">as</span> PlannedDate</span>
<span id="cb217-4"><a href="#cb217-4"></a>    ,EventType <span class="kw">from</span> EventCalender</span>
<span id="cb217-5"><a href="#cb217-5"></a>    <span class="kw">where</span> EventActive <span class="op">=</span> <span class="dv">1</span> <span class="kw">AND</span> LanguageID <span class="op">=</span><span class="dv">1</span> <span class="kw">AND</span> EventBlockDate <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb217-6"><a href="#cb217-6"></a>    <span class="kw">union</span> <span class="kw">all</span></span>
<span id="cb217-7"><a href="#cb217-7"></a>    <span class="kw">select</span> EventID, EventTitle, EventStartDate, EventEndDate, EventEnumDays,EventStartTime,EventEndTime, EventRecurring, dateadd(dd, <span class="dv">1</span>, PlannedDate)</span>
<span id="cb217-8"><a href="#cb217-8"></a>    ,EventType <span class="kw">from</span> Calendar</span>
<span id="cb217-9"><a href="#cb217-9"></a>    <span class="kw">where</span> EventRecurring <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb217-10"><a href="#cb217-10"></a>        <span class="kw">and</span> dateadd(dd, <span class="dv">1</span>, PlannedDate) <span class="op">&lt;=</span> EventEndDate </span>
<span id="cb217-11"><a href="#cb217-11"></a>)</span>
<span id="cb217-12"><a href="#cb217-12"></a><span class="kw">select</span> EventID, EventStartDate, EventEndDate, PlannedDate <span class="kw">as</span> [EventDates], <span class="fu">Cast</span>(PlannedDate <span class="kw">As</span> datetime) <span class="kw">AS</span> DT, <span class="fu">Cast</span>(EventStartTime <span class="kw">As</span> <span class="dt">time</span>) <span class="kw">AS</span> ST,<span class="fu">Cast</span>(EventEndTime <span class="kw">As</span> <span class="dt">time</span>) <span class="kw">AS</span> ET, EventTitle</span>
<span id="cb217-13"><a href="#cb217-13"></a>,EventType <span class="kw">from</span> Calendar</span>
<span id="cb217-14"><a href="#cb217-14"></a><span class="kw">where</span> (PlannedDate <span class="op">&gt;=</span> GETDATE()) <span class="kw">AND</span> <span class="st">&#39;,&#39;</span> <span class="op">+</span> EventEnumDays <span class="op">+</span> <span class="st">&#39;,&#39;</span> <span class="kw">like</span> <span class="st">&#39;%,&#39;</span> <span class="op">+</span> <span class="fu">cast</span>(datepart(dw, PlannedDate) <span class="kw">as</span> <span class="dt">char</span>(<span class="dv">1</span>)) <span class="op">+</span> <span class="st">&#39;,%&#39;</span></span>
<span id="cb217-15"><a href="#cb217-15"></a>    <span class="kw">or</span> EventEnumDays <span class="kw">is</span> <span class="kw">null</span></span>
<span id="cb217-16"><a href="#cb217-16"></a><span class="kw">order</span> <span class="kw">by</span> EventID, PlannedDate</span>
<span id="cb217-17"><a href="#cb217-17"></a><span class="kw">option</span> (maxrecursion <span class="dv">0</span>)</span></code></pre></div>
<p>I would appreciate a point in the right direction or if I can create a temporary table from this CTE query</p>
</section>
<section id="answer-accepted-score-208" class="level4">
<h4>Answer accepted (score 208)</h4>
<h5>
Sample DDL
</h2>
<div class="sourceCode" id="cb218"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb218-1"><a href="#cb218-1"></a><span class="kw">create</span> <span class="kw">table</span> #Temp</span>
<span id="cb218-2"><a href="#cb218-2"></a>(</span>
<span id="cb218-3"><a href="#cb218-3"></a>    EventID <span class="dt">int</span>, </span>
<span id="cb218-4"><a href="#cb218-4"></a>    EventTitle <span class="dt">Varchar</span>(<span class="dv">50</span>), </span>
<span id="cb218-5"><a href="#cb218-5"></a>    EventStartDate DateTime, </span>
<span id="cb218-6"><a href="#cb218-6"></a>    EventEndDate DatetIme, </span>
<span id="cb218-7"><a href="#cb218-7"></a>    EventEnumDays <span class="dt">int</span>,</span>
<span id="cb218-8"><a href="#cb218-8"></a>    EventStartTime Datetime,</span>
<span id="cb218-9"><a href="#cb218-9"></a>    EventEndTime DateTime, </span>
<span id="cb218-10"><a href="#cb218-10"></a>    EventRecurring Bit, </span>
<span id="cb218-11"><a href="#cb218-11"></a>    EventType <span class="dt">int</span></span>
<span id="cb218-12"><a href="#cb218-12"></a>)</span></code></pre></div>
<hr>
<div class="sourceCode" id="cb219"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb219-1"><a href="#cb219-1"></a>;<span class="kw">WITH</span> Calendar</span>
<span id="cb219-2"><a href="#cb219-2"></a><span class="kw">AS</span> (<span class="kw">SELECT</span> <span class="co">/*...*/</span>)</span>
<span id="cb219-3"><a href="#cb219-3"></a></span>
<span id="cb219-4"><a href="#cb219-4"></a><span class="kw">Insert</span> <span class="kw">Into</span> #Temp</span>
<span id="cb219-5"><a href="#cb219-5"></a><span class="kw">Select</span> EventID, EventStartDate, EventEndDate, PlannedDate <span class="kw">as</span> [EventDates], <span class="fu">Cast</span>(PlannedDate <span class="kw">As</span> datetime) <span class="kw">AS</span> DT, <span class="fu">Cast</span>(EventStartTime <span class="kw">As</span> <span class="dt">time</span>) <span class="kw">AS</span> ST,<span class="fu">Cast</span>(EventEndTime <span class="kw">As</span> <span class="dt">time</span>) <span class="kw">AS</span> ET, EventTitle</span>
<span id="cb219-6"><a href="#cb219-6"></a>,EventType <span class="kw">from</span> Calendar</span>
<span id="cb219-7"><a href="#cb219-7"></a><span class="kw">where</span> (PlannedDate <span class="op">&gt;=</span> GETDATE()) <span class="kw">AND</span> <span class="st">&#39;,&#39;</span> <span class="op">+</span> EventEnumDays <span class="op">+</span> <span class="st">&#39;,&#39;</span> <span class="kw">like</span> <span class="st">&#39;%,&#39;</span> <span class="op">+</span> <span class="fu">cast</span>(datepart(dw, PlannedDate) <span class="kw">as</span> <span class="dt">char</span>(<span class="dv">1</span>)) <span class="op">+</span> <span class="st">&#39;,%&#39;</span></span>
<span id="cb219-8"><a href="#cb219-8"></a>    <span class="kw">or</span> EventEnumDays <span class="kw">is</span> <span class="kw">null</span></span></code></pre></div>
<hr>
<p>Make sure that the table is deleted after use</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb220-1"><a href="#cb220-1"></a><span class="cf">If</span>(OBJECT_ID(<span class="st">&#39;tempdb..#temp&#39;</span>) <span class="kw">Is</span> <span class="kw">Not</span> <span class="kw">Null</span>)</span>
<span id="cb220-2"><a href="#cb220-2"></a><span class="cf">Begin</span></span>
<span id="cb220-3"><a href="#cb220-3"></a>    <span class="kw">Drop</span> <span class="kw">Table</span> #Temp</span>
<span id="cb220-4"><a href="#cb220-4"></a><span class="cf">End</span></span></code></pre></div>
</section>
<section id="answer-2-score-126" class="level4">
<h4>Answer 2 (score 126)</h4>
<p>Really the format can be quite simple - sometimes there’s no need to predefine a temp table - it will be created from results of the select.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb221-1"><a href="#cb221-1"></a><span class="kw">Select</span> FieldA<span class="op">..</span>.FieldN </span>
<span id="cb221-2"><a href="#cb221-2"></a><span class="kw">into</span> #MyTempTable </span>
<span id="cb221-3"><a href="#cb221-3"></a><span class="kw">from</span> MyTable</span></code></pre></div>
<p>So unless you want different types or are very strict on definition, keep things simple. Note also that any temporary table created inside a stored procedure is automatically dropped when the stored procedure finishes executing. If stored procedure A creates a temp table and calls stored procedure B, then B will be able to use the temporary table that A created.</p>
<p>However, it’s generally considered good coding practice to explicitly drop every temporary table you create anyway.</p>
</section>
<section id="answer-3-score-22" class="level4">
<h4>Answer 3 (score 22)</h4>
<p>The <code>SELECT ... INTO</code> needs to be in the select from the CTE.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb222-1"><a href="#cb222-1"></a>;<span class="kw">WITH</span> Calendar</span>
<span id="cb222-2"><a href="#cb222-2"></a>     <span class="kw">AS</span> (<span class="kw">SELECT</span> <span class="co">/*... Rest of CTE definition removed for clarity*/</span>)</span>
<span id="cb222-3"><a href="#cb222-3"></a><span class="kw">SELECT</span> EventID,</span>
<span id="cb222-4"><a href="#cb222-4"></a>       EventStartDate,</span>
<span id="cb222-5"><a href="#cb222-5"></a>       EventEndDate,</span>
<span id="cb222-6"><a href="#cb222-6"></a>       PlannedDate                   <span class="kw">AS</span> [EventDates],</span>
<span id="cb222-7"><a href="#cb222-7"></a>       <span class="fu">Cast</span>(PlannedDate <span class="kw">AS</span> DATETIME) <span class="kw">AS</span> DT,</span>
<span id="cb222-8"><a href="#cb222-8"></a>       <span class="fu">Cast</span>(EventStartTime <span class="kw">AS</span> <span class="dt">TIME</span>)  <span class="kw">AS</span> ST,</span>
<span id="cb222-9"><a href="#cb222-9"></a>       <span class="fu">Cast</span>(EventEndTime <span class="kw">AS</span> <span class="dt">TIME</span>)    <span class="kw">AS</span> ET,</span>
<span id="cb222-10"><a href="#cb222-10"></a>       EventTitle,</span>
<span id="cb222-11"><a href="#cb222-11"></a>       EventType</span>
<span id="cb222-12"><a href="#cb222-12"></a><span class="kw">INTO</span> TEMPBLOCKEDDATES <span class="co">/* &lt;---- INTO goes here*/</span>        </span>
<span id="cb222-13"><a href="#cb222-13"></a><span class="kw">FROM</span>   Calendar</span>
<span id="cb222-14"><a href="#cb222-14"></a><span class="kw">WHERE</span>  ( PlannedDate <span class="op">&gt;=</span> Getdate() )</span>
<span id="cb222-15"><a href="#cb222-15"></a>       <span class="kw">AND</span> <span class="st">&#39;,&#39;</span> <span class="op">+</span> EventEnumDays <span class="op">+</span> <span class="st">&#39;,&#39;</span> <span class="kw">LIKE</span> <span class="st">&#39;%,&#39;</span> <span class="op">+</span> <span class="fu">Cast</span>(Datepart(dw, PlannedDate) <span class="kw">AS</span> <span class="dt">CHAR</span>(<span class="dv">1</span>)) <span class="op">+</span> <span class="st">&#39;,%&#39;</span></span>
<span id="cb222-16"><a href="#cb222-16"></a>        <span class="kw">OR</span> EventEnumDays <span class="kw">IS</span> <span class="kw">NULL</span></span>
<span id="cb222-17"><a href="#cb222-17"></a><span class="kw">ORDER</span>  <span class="kw">BY</span> EventID,</span>
<span id="cb222-18"><a href="#cb222-18"></a>          PlannedDate</span>
<span id="cb222-19"><a href="#cb222-19"></a><span class="kw">OPTION</span> (maxrecursion <span class="dv">0</span>) </span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="rename-column-sql-server-2008-score-1064792-in-2018" class="level3">
<h3>34: Rename column SQL Server 2008 (score <a href="https://stackoverflow.com/q/16296622.html">1064792</a> in 2018)</h3>
<section id="question-33" class="level4">
<h4>Question</h4>
<p>I am using SQL Server 2008 and Navicat. I need to rename a column in a table using SQL.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb223-1"><a href="#cb223-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> table_name <span class="kw">RENAME</span> <span class="kw">COLUMN</span> old_name <span class="kw">to</span> new_name;</span></code></pre></div>
<p>This statement doesn’t work.</p>
</section>
<section id="answer-accepted-score-1116" class="level4">
<h4>Answer accepted (score 1116)</h4>
<p>Use <code>sp_rename</code></p>
<div class="sourceCode" id="cb224"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb224-1"><a href="#cb224-1"></a><span class="kw">EXEC</span> sp_RENAME <span class="st">&#39;TableName.OldColumnName&#39;</span> , <span class="st">&#39;NewColumnName&#39;</span>, <span class="st">&#39;COLUMN&#39;</span></span></code></pre></div>
<p>See: <a href="http://blog.sqlauthority.com/2008/08/26/sql-server-how-to-rename-a-column-name-or-table-name/" rel="noreferrer">SQL SERVER – How to Rename a Column Name or Table Name</a></p>
<p>Documentation: <a href="https://docs.microsoft.com/de-de/sql/relational-databases/system-stored-procedures/sp-rename-transact-sql" rel="noreferrer"><strong>sp_rename</strong> (Transact-SQL)</a></p>
<p>For your case it would be:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb225-1"><a href="#cb225-1"></a><span class="kw">EXEC</span> sp_RENAME <span class="st">&#39;table_name.old_name&#39;</span>, <span class="st">&#39;new_name&#39;</span>, <span class="st">&#39;COLUMN&#39;</span></span></code></pre></div>
<p>Remember to use single quotes to enclose your values.</p>
</section>
<section id="answer-2-score-95" class="level4">
<h4>Answer 2 (score 95)</h4>
<p>Alternatively to <code>SQL</code>, you can do this in Microsoft SQL Server Management Studio. Here are a few quick ways using the GUI:</p>
<h5>
First Way
</h3>
<p>Slow double-click on the column. The column name will become an editable text box.</p>
<hr>
<h5>
Second Way
</h3>
<p>Right click on column and choose Rename from the context menu.</p>
<p>For example:</p>
<p><img src="https://i.stack.imgur.com/zygEz.jpg" alt="To Rename column name"></p>
<hr>
<h5>
Third Way
</h3>
<p><em>This way is preferable for when you need to rename multiple columns in one go.</em></p>
<ol>
<li>
Right-click on the table that contains the column that needs renaming.
</li>
<li>
Click <em>Design</em>.
</li>
<li>
In the table design panel, click and edit the textbox of the column name you want to alter.
</li>
</ol>
<p>
For example: <img src="https://i.stack.imgur.com/UwVU4.png" alt="MSSMS Table Design Example">
</p>
<p><sub><strong>NOTE:</strong> I know OP specifically asked for SQL solution, thought this might help others :)</sub></p>
</section>
<section id="answer-3-score-57-1" class="level4">
<h4>Answer 3 (score 57)</h4>
<p>Try:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb226-1"><a href="#cb226-1"></a><span class="kw">EXEC</span> sp_rename <span class="st">&#39;TableName.OldName&#39;</span>, <span class="st">&#39;NewName&#39;</span>, <span class="st">&#39;COLUMN&#39;</span></span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="get-all-table-names-of-a-particular-database-by-sql-query-score-1044124-in-2016" class="level3">
<h3>35: Get all table names of a particular database by SQL query? (score <a href="https://stackoverflow.com/q/3913620.html">1044124</a> in 2016)</h3>
<section id="question-34" class="level4">
<h4>Question</h4>
<p>I am working on application which can deal with multiple database servers like “MySQL” and “MS SQL Server”.</p>
<p>I want to get tables’ names of a particular database using a general query which should suitable for all database types. I have tried following:</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb227-1"><a href="#cb227-1"></a><span class="kw">SELECT</span> TABLE_NAME <span class="kw">FROM</span> INFORMATION_SCHEMA.<span class="kw">TABLES</span> <span class="kw">WHERE</span> TABLE_TYPE<span class="op">=</span><span class="st">&#39;BASE TABLE&#39;</span></span></code></pre></div>
<p>But it is giving table names of all databases of a particular server but I want to get tables names of selected database only. How can I restrict this query to get tables of a particular database?</p>
</section>
<section id="answer-accepted-score-454" class="level4">
<h4>Answer accepted (score 454)</h4>
<p>Probably due to the way different sql dbms deal with schemas.</p>
<p>Try the following</p>
<p>For SQL Server:</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb228-1"><a href="#cb228-1"></a><span class="kw">SELECT</span> TABLE_NAME</span>
<span id="cb228-2"><a href="#cb228-2"></a><span class="kw">FROM</span> INFORMATION_SCHEMA.<span class="kw">TABLES</span></span>
<span id="cb228-3"><a href="#cb228-3"></a><span class="kw">WHERE</span> TABLE_TYPE <span class="op">=</span> <span class="st">&#39;BASE TABLE&#39;</span> <span class="kw">AND</span> TABLE_CATALOG<span class="op">=</span><span class="st">&#39;dbName&#39;</span></span></code></pre></div>
<p>For MySQL:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb229-1"><a href="#cb229-1"></a><span class="kw">SELECT</span> TABLE_NAME </span>
<span id="cb229-2"><a href="#cb229-2"></a><span class="kw">FROM</span> INFORMATION_SCHEMA.<span class="kw">TABLES</span></span>
<span id="cb229-3"><a href="#cb229-3"></a><span class="kw">WHERE</span> TABLE_TYPE <span class="op">=</span> <span class="st">&#39;BASE TABLE&#39;</span> <span class="kw">AND</span> TABLE_SCHEMA<span class="op">=</span><span class="st">&#39;dbName&#39;</span> </span></code></pre></div>
<p>For Oracle I think the equivalent would be to use <code>DBA_TABLES</code>.</p>
</section>
<section id="answer-2-score-77" class="level4">
<h4>Answer 2 (score 77)</h4>
<p>Stolen from <a href="http://blog.sqlauthority.com/2007/06/26/sql-server-2005-list-all-tables-of-database/" rel="noreferrer">here</a>:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb230-1"><a href="#cb230-1"></a><span class="kw">USE</span> YOURDBNAME</span>
<span id="cb230-2"><a href="#cb230-2"></a>GO </span>
<span id="cb230-3"><a href="#cb230-3"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb230-4"><a href="#cb230-4"></a><span class="kw">FROM</span> sys.<span class="kw">Tables</span></span>
<span id="cb230-5"><a href="#cb230-5"></a>GO</span></code></pre></div>
</section>
<section id="answer-3-score-26" class="level4">
<h4>Answer 3 (score 26)</h4>
<p>The following query will select all of the <code>Tables</code> in the database named <code>DBName</code>:</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb231-1"><a href="#cb231-1"></a><span class="kw">USE</span> DBName</span>
<span id="cb231-2"><a href="#cb231-2"></a>GO </span>
<span id="cb231-3"><a href="#cb231-3"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb231-4"><a href="#cb231-4"></a><span class="kw">FROM</span> sys.<span class="kw">Tables</span></span>
<span id="cb231-5"><a href="#cb231-5"></a>GO</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="sql-select-only-rows-with-max-value-on-a-column-score-1041887-in-2019" class="level3">
<h3>36: SQL select only rows with max value on a column (score <a href="https://stackoverflow.com/q/7745609.html">1041887</a> in 2019)</h3>
<section id="question-35" class="level4">
<h4>Question</h4>
<p>I have this table for documents (simplified version here):</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb232-1"><a href="#cb232-1"></a><span class="op">+</span><span class="co">------+-------+--------------------------------------+</span></span>
<span id="cb232-2"><a href="#cb232-2"></a>| <span class="kw">id</span>   | rev   | content                              |</span>
<span id="cb232-3"><a href="#cb232-3"></a><span class="op">+</span><span class="co">------+-------+--------------------------------------+</span></span>
<span id="cb232-4"><a href="#cb232-4"></a>| <span class="dv">1</span>    | <span class="dv">1</span>     | <span class="op">..</span>.                                  |</span>
<span id="cb232-5"><a href="#cb232-5"></a>| <span class="dv">2</span>    | <span class="dv">1</span>     | <span class="op">..</span>.                                  |</span>
<span id="cb232-6"><a href="#cb232-6"></a>| <span class="dv">1</span>    | <span class="dv">2</span>     | <span class="op">..</span>.                                  |</span>
<span id="cb232-7"><a href="#cb232-7"></a>| <span class="dv">1</span>    | <span class="dv">3</span>     | <span class="op">..</span>.                                  |</span>
<span id="cb232-8"><a href="#cb232-8"></a><span class="op">+</span><span class="co">------+-------+--------------------------------------+</span></span></code></pre></div>
<p>
How do I select one row per id and only the greatest rev?<br> With the above data, the result should contain two rows: <code>[1, 3, ...]</code> and <code>[2, 1, ..]</code>. I’m using <strong><em>MySQL</em></strong>.
</p>
<p>Currently I use checks in the <code>while</code> loop to detect and over-write old revs from the resultset. But is this the only method to achieve the result? Isn’t there a <strong>SQL</strong> solution?</p>
<p>
<strong>Update</strong><br> As the answers suggest, there <em>is</em> a SQL solution, and <a href="http://sqlfiddle.com/#!9/3d74dc/1" rel="noreferrer">here a sqlfiddle demo</a>.
</p>
<p>
<strong>Update 2</strong><br> I noticed after adding the above <em>sqlfiddle</em>, the rate at which the question is upvoted has surpassed the upvote rate of the answers. That has not been the intention! The fiddle is based on the answers, especially the accepted answer.
</p>
</section>
<section id="answer-accepted-score-1743" class="level4">
<h4>Answer accepted (score 1743)</h4>
<h5>
At first glance…
</h2>
<p>All you need is a <code>GROUP BY</code> clause with the <code>MAX</code> aggregate function:</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb233-1"><a href="#cb233-1"></a><span class="kw">SELECT</span> <span class="kw">id</span>, <span class="fu">MAX</span>(rev)</span>
<span id="cb233-2"><a href="#cb233-2"></a><span class="kw">FROM</span> YourTable</span>
<span id="cb233-3"><a href="#cb233-3"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="kw">id</span></span></code></pre></div>
<h5>
It’s never that simple, is it?
</h2>
<p>I just noticed you need the <code>content</code> column as well.</p>
<p>This is a very common question in SQL: find the whole data for the row with some max value in a column per some group identifier. I heard that a lot during my career. Actually, it was one the questions I answered in my current job’s technical interview.</p>
<p>It is, actually, so common that StackOverflow community has created a single tag just to deal with questions like that: <a href="/questions/tagged/greatest-n-per-group" class="post-tag" title="show questions tagged &#39;greatest-n-per-group&#39;" rel="tag">greatest-n-per-group</a>.</p>
<p>Basically, you have two approaches to solve that problem:</p>
<h5>
Joining with simple <code>group-identifier, max-value-in-group</code> Sub-query
</h2>
<p>In this approach, you first find the <code>group-identifier, max-value-in-group</code> (already solved above) in a sub-query. Then you join your table to the sub-query with equality on both <code>group-identifier</code> and <code>max-value-in-group</code>:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb234-1"><a href="#cb234-1"></a><span class="kw">SELECT</span> a.<span class="kw">id</span>, a.rev, a.<span class="kw">contents</span></span>
<span id="cb234-2"><a href="#cb234-2"></a><span class="kw">FROM</span> YourTable a</span>
<span id="cb234-3"><a href="#cb234-3"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> (</span>
<span id="cb234-4"><a href="#cb234-4"></a>    <span class="kw">SELECT</span> <span class="kw">id</span>, <span class="fu">MAX</span>(rev) rev</span>
<span id="cb234-5"><a href="#cb234-5"></a>    <span class="kw">FROM</span> YourTable</span>
<span id="cb234-6"><a href="#cb234-6"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span> <span class="kw">id</span></span>
<span id="cb234-7"><a href="#cb234-7"></a>) b <span class="kw">ON</span> a.<span class="kw">id</span> <span class="op">=</span> b.<span class="kw">id</span> <span class="kw">AND</span> a.rev <span class="op">=</span> b.rev</span></code></pre></div>
<h5>
Left Joining with self, tweaking join conditions and filters
</h2>
<p>In this approach, you left join the table with itself. Equality, of course, goes in the <code>group-identifier</code>. Then, 2 smart moves:</p>
<ol>
<li>
The second join condition is having left side value less than right value
</li>
<li>
When you do step 1, the row(s) that actually have the max value will have <code>NULL</code> in the right side (it’s a <code>LEFT JOIN</code>, remember?). Then, we filter the joined result, showing only the rows where the right side is <code>NULL</code>.
</li>
</ol>
<p>So you end up with:</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb235-1"><a href="#cb235-1"></a><span class="kw">SELECT</span> a.<span class="op">*</span></span>
<span id="cb235-2"><a href="#cb235-2"></a><span class="kw">FROM</span> YourTable a</span>
<span id="cb235-3"><a href="#cb235-3"></a><span class="kw">LEFT</span> <span class="kw">OUTER</span> <span class="kw">JOIN</span> YourTable b</span>
<span id="cb235-4"><a href="#cb235-4"></a>    <span class="kw">ON</span> a.<span class="kw">id</span> <span class="op">=</span> b.<span class="kw">id</span> <span class="kw">AND</span> a.rev <span class="op">&lt;</span> b.rev</span>
<span id="cb235-5"><a href="#cb235-5"></a><span class="kw">WHERE</span> b.<span class="kw">id</span> <span class="kw">IS</span> <span class="kw">NULL</span>;</span></code></pre></div>
<h5>
Conclusion
</h2>
<p>Both approaches bring the exact same result.</p>
<p>If you have two rows with <code>max-value-in-group</code> for <code>group-identifier</code>, both rows will be in the result in both approaches.</p>
<p>Both approaches are SQL ANSI compatible, thus, will work with your favorite RDBMS, regardless of its “flavor”.</p>
<p>Both approaches are also performance friendly, however your mileage may vary (RDBMS, DB Structure, Indexes, etc.). So when you pick one approach over the other, <em>benchmark</em>. And make sure you pick the one which make most of sense to you.</p>
</section>
<section id="answer-2-score-227" class="level4">
<h4>Answer 2 (score 227)</h4>
<p>My preference is to use as little code as possible…</p>
<p>
You can do it using <code>IN</code> try this:
</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb236-1"><a href="#cb236-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb236-2"><a href="#cb236-2"></a><span class="kw">FROM</span> t1 <span class="kw">WHERE</span> (<span class="kw">id</span>,rev) <span class="kw">IN</span> </span>
<span id="cb236-3"><a href="#cb236-3"></a>( <span class="kw">SELECT</span> <span class="kw">id</span>, <span class="fu">MAX</span>(rev)</span>
<span id="cb236-4"><a href="#cb236-4"></a>  <span class="kw">FROM</span> t1</span>
<span id="cb236-5"><a href="#cb236-5"></a>  <span class="kw">GROUP</span> <span class="kw">BY</span> <span class="kw">id</span></span>
<span id="cb236-6"><a href="#cb236-6"></a>)</span></code></pre></div>
<p>to my mind it is less complicated… easier to read and maintain.</p>
</section>
<section id="answer-3-score-75" class="level4">
<h4>Answer 3 (score 75)</h4>
<p>Yet another solution is to use a correlated subquery:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb237-1"><a href="#cb237-1"></a><span class="kw">select</span> yt.<span class="kw">id</span>, yt.rev, yt.<span class="kw">contents</span></span>
<span id="cb237-2"><a href="#cb237-2"></a>    <span class="kw">from</span> YourTable yt</span>
<span id="cb237-3"><a href="#cb237-3"></a>    <span class="kw">where</span> rev <span class="op">=</span> </span>
<span id="cb237-4"><a href="#cb237-4"></a>        (<span class="kw">select</span> <span class="fu">max</span>(rev) <span class="kw">from</span> YourTable st <span class="kw">where</span> yt.<span class="kw">id</span><span class="op">=</span>st.<span class="kw">id</span>)</span></code></pre></div>
<p>Having an index on (id,rev) renders the subquery almost as a simple lookup…</p>
<p>Following are comparisons to the solutions in <span class="citation" data-cites="AdrianCarneiro">@AdrianCarneiro</span>’s answer (subquery, leftjoin), based on MySQL measurements with InnoDB table of ~1million records, group size being: 1-3.</p>
<p>While for full table scans subquery/leftjoin/correlated timings relate to each other as 6/8/9, when it comes to direct lookups or batch (<code>id in (1,2,3)</code>), subquery is much slower then the others (Due to rerunning the subquery). However I couldnt differentiate between leftjoin and correlated solutions in speed.</p>
<p>One final note, as leftjoin creates n*(n+1)/2 joins in groups, its performance can be heavily affected by the size of groups…</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="should-i-use-or-for-not-equal-in-t-sql-score-1016642-in-2018" class="level3">
<h3>37: Should I use != or &lt;&gt; for not equal in T-SQL? (score <a href="https://stackoverflow.com/q/723195.html">1016642</a> in 2018)</h3>
<section id="question-36" class="level4">
<h4>Question</h4>
<p>I have seen <code>SQL</code> that uses both <code>!=</code> and <code>&amp;lt;&amp;gt;</code> for <strong><em>not equal</em></strong>. What is the preferred syntax and why?</p>
<p>I like <code>!=</code>, because <code>&amp;lt;&amp;gt;</code> reminds me of <code>Visual Basic</code>.</p>
</section>
<section id="answer-accepted-score-520" class="level4">
<h4>Answer accepted (score 520)</h4>
<p>Technically they function the same if you’re using SQL Server AKA T-SQL. If you’re using it in stored procedures there is no performance reason to use one over the other. It then comes down to personal preference. I prefer to use &lt;&gt; as it is ANSI compliant.</p>
<p>You can find links to the various ANSI standards at…</p>
<p><a href="http://en.wikipedia.org/wiki/SQL" rel="noreferrer">http://en.wikipedia.org/wiki/SQL</a></p>
</section>
<section id="answer-2-score-705" class="level4">
<h4>Answer 2 (score 705)</h4>
<p>Most databases support <code>!=</code> (popular programming languages) and <code>&amp;lt;&amp;gt;</code> (ANSI).</p>
<p>Databases that support both <code>!=</code> and <code>&amp;lt;&amp;gt;</code>:</p>
<ul>
<li>
MySQL 5.1: <a href="http://dev.mysql.com/doc/refman/5.1/en/comparison-operators.html#operator_not-equal" rel="noreferrer"><code>!=</code> and <code>&amp;lt;&amp;gt;</code></a>
</li>
<li>
PostgreSQL 8.3: <a href="http://www.postgresql.org/docs/current/static/functions-comparison.html#FUNCTIONS-COMPARISON-TABLE" rel="noreferrer"><code>!=</code> and <code>&amp;lt;&amp;gt;</code></a>
</li>
<li>
SQLite: <a href="http://www.sqlite.org/lang_expr.html#binaryops" rel="noreferrer"><code>!=</code> and <code>&amp;lt;&amp;gt;</code></a>
</li>
<li>
Oracle 10g: <a href="http://download-west.oracle.com/docs/cd/B19306_01/server.102/b14200/conditions002.htm#CJAGAABC" rel="noreferrer"><code>!=</code> and <code>&amp;lt;&amp;gt;</code></a>
</li>
<li>
Microsoft SQL Server 2000/2005/2008/2012/2016: <a href="http://msdn.microsoft.com/en-us/library/ms190296.aspx" rel="noreferrer"><code>!=</code></a> and <a href="http://msdn.microsoft.com/en-us/library/ms176020.aspx" rel="noreferrer"><code>&amp;lt;&amp;gt;</code></a>
</li>
<li>
IBM Informix Dynamic Server 10: <a href="http://publib.boulder.ibm.com/infocenter/idshelp/v10/index.jsp?topic=/com.ibm.sqlt.doc/sqltmst46.htm" rel="noreferrer"><code>!=</code> and <code>&amp;lt;&amp;gt;</code></a>
</li>
<li>
InterBase/Firebird: <a href="http://www.ibphoenix.com/main.nfs?a=ibphoenix&amp;s=1239054922:316459&amp;page=ibp_60_sqlref" rel="noreferrer"><code>!=</code> and <code>&amp;lt;&amp;gt;</code></a>
</li>
<li>
Apache Derby 10.6: <a href="http://db.apache.org/derby/docs/10.6/ref/rrefsqlj23075.html" rel="noreferrer"><code>!=</code> and <code>&amp;lt;&amp;gt;</code></a>
</li>
<li>
Sybase Adaptive Server Enterprise 11.0: <a href="http://infocenter.sybase.com/help/index.jsp?topic=/com.sybase.help.sqlanywhere.11.0.0/dbreference_en11/coco.html" rel="noreferrer"><code>!=</code> and <code>&amp;lt;&amp;gt;</code></a>
</li>
</ul>
<p>Databases that support the ANSI standard operator, <strong>exclusively</strong>:</p>
<ul>
<li>
IBM DB2 UDB 9.5: <a href="http://publib.boulder.ibm.com/infocenter/iseries/v5r3/topic/db2/rbafzmstch2pred.htm" rel="noreferrer"><code>&amp;lt;&amp;gt;</code></a>
</li>
<li>
Microsoft Access 2010: <a href="http://office.microsoft.com/en-us/access-help/table-of-operators-HA010235862.aspx" rel="noreferrer"><code>&amp;lt;&amp;gt;</code></a>
</li>
</ul>
</section>
<section id="answer-3-score-105" class="level4">
<h4>Answer 3 (score 105)</h4>
<p><code>'&amp;lt;&amp;gt;'</code> is from the <a href="http://www.contrib.andrew.cmu.edu/~shadow/sql/sql1992.txt" rel="noreferrer">SQL-92 standard</a> and <code>'!='</code> is a <a href="http://msdn.microsoft.com/en-us/library/ms188074(SQL.90).aspx" rel="noreferrer">proprietary</a> T-SQL operator. It’s available in other databases as well, but since it isn’t standard you have to take it on a case-by-case basis.</p>
<p>In most cases, you’ll know what database you’re connecting to so this isn’t really an issue. At worst you might have to do a search and replace in your SQL.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-do-i-escape-a-single-quote-in-sql-server-score-1006028-in-2019" class="level3">
<h3>38: How do I escape a single quote in SQL Server? (score <a href="https://stackoverflow.com/q/1586560.html">1006028</a> in 2019)</h3>
<section id="question-37" class="level4">
<h4>Question</h4>
<p>I’m trying to <code>insert</code> some text data into a table in <code>SQL Server</code> 9.</p>
<p>The text includes a single quote(’).</p>
<p>How do I escape that?</p>
<p>I tried using two single quotes, but it threw me some errors.</p>
<p>eg. <code>insert into my_table values('hi, my name''s tim.');</code></p>
</section>
<section id="answer-accepted-score-1258" class="level4">
<h4>Answer accepted (score 1258)</h4>
<p><strong>Single quotes are escaped by doubling them up</strong>, just as you’ve shown us in your example. The following SQL illustrates this functionality. I tested it on SQL Server 2008:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb238-1"><a href="#cb238-1"></a><span class="kw">DECLARE</span> @my_table <span class="kw">TABLE</span> (</span>
<span id="cb238-2"><a href="#cb238-2"></a>    [<span class="fu">value</span>] <span class="dt">VARCHAR</span>(<span class="dv">200</span>)</span>
<span id="cb238-3"><a href="#cb238-3"></a>)</span>
<span id="cb238-4"><a href="#cb238-4"></a></span>
<span id="cb238-5"><a href="#cb238-5"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> @my_table <span class="kw">VALUES</span> (<span class="st">&#39;hi, my name</span><span class="ch">&#39;&#39;</span><span class="st">s tim.&#39;</span>)</span>
<span id="cb238-6"><a href="#cb238-6"></a></span>
<span id="cb238-7"><a href="#cb238-7"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> @my_table</span></code></pre></div>
<h5>
Results
</h3>
<div class="sourceCode" id="cb239"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb239-1"><a href="#cb239-1"></a><span class="fu">value</span></span>
<span id="cb239-2"><a href="#cb239-2"></a><span class="op">==================</span></span>
<span id="cb239-3"><a href="#cb239-3"></a>hi, my name<span class="st">&#39;s tim.</span></span></code></pre></div>
</section>
<section id="answer-2-score-64" class="level4">
<h4>Answer 2 (score 64)</h4>
<p>If escaping your single quote with another single quote isn’t working for you (like it didn’t for one of my recent <code>REPLACE()</code> queries), you can use <code>SET QUOTED_IDENTIFIER OFF</code> before your query, then <code>SET QUOTED_IDENTIFIER ON</code> after your query.</p>
<p>For example</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb240-1"><a href="#cb240-1"></a><span class="kw">SET</span> QUOTED_IDENTIFIER <span class="kw">OFF</span>;</span>
<span id="cb240-2"><a href="#cb240-2"></a></span>
<span id="cb240-3"><a href="#cb240-3"></a><span class="kw">UPDATE</span> <span class="kw">TABLE</span> <span class="kw">SET</span> NAME <span class="op">=</span> <span class="kw">REPLACE</span>(NAME, <span class="ot">&quot;&#39;S&quot;</span>, <span class="ot">&quot;S&quot;</span>);</span>
<span id="cb240-4"><a href="#cb240-4"></a></span>
<span id="cb240-5"><a href="#cb240-5"></a><span class="kw">SET</span> QUOTED_IDENTIFIER <span class="kw">ON</span>;</span>
<span id="cb240-6"><a href="#cb240-6"></a><span class="co">-- set OFF then ON again</span></span></code></pre></div>
</section>
<section id="answer-3-score-41" class="level4">
<h4>Answer 3 (score 41)</h4>
<p>How about:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb241-1"><a href="#cb241-1"></a><span class="kw">insert</span> <span class="kw">into</span> my_table <span class="kw">values</span>(<span class="st">&#39;hi, my name&#39;</span><span class="op">+</span><span class="dt">char</span>(<span class="dv">39</span>)<span class="op">+</span><span class="st">&#39;s tim.&#39;</span>)</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-do-i-query-for-all-dates-greater-than-a-certain-date-in-sql-server-score-968312-in-2018" class="level3">
<h3>39: How do I query for all dates greater than a certain date in SQL Server? (score <a href="https://stackoverflow.com/q/10643379.html">968312</a> in 2018)</h3>
<section id="question-38" class="level4">
<h4>Question</h4>
<p>I’m trying:</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb242-1"><a href="#cb242-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb242-2"><a href="#cb242-2"></a><span class="kw">FROM</span> dbo.March2010 A</span>
<span id="cb242-3"><a href="#cb242-3"></a><span class="kw">WHERE</span> A.<span class="dt">Date</span> <span class="op">&gt;=</span> <span class="dv">2010</span><span class="op">-</span><span class="dv">04</span><span class="op">-</span><span class="dv">01</span>;</span></code></pre></div>
<p><code>A.Date</code> looks like: <code>2010-03-04 00:00:00.000</code></p>
<p>However, this is not working.</p>
<p>Can anyone provide a reference for why?</p>
</section>
<section id="answer-accepted-score-428" class="level4">
<h4>Answer accepted (score 428)</h4>
<div class="sourceCode" id="cb243"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb243-1"><a href="#cb243-1"></a><span class="kw">select</span> <span class="op">*</span>  </span>
<span id="cb243-2"><a href="#cb243-2"></a><span class="kw">from</span> dbo.March2010 A </span>
<span id="cb243-3"><a href="#cb243-3"></a><span class="kw">where</span> A.<span class="dt">Date</span> <span class="op">&gt;=</span> <span class="fu">Convert</span>(datetime, <span class="st">&#39;2010-04-01&#39;</span> )</span></code></pre></div>
<p>In your query, <code>2010-4-01</code> is treated as a mathematical expression, so in essence it read</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb244-1"><a href="#cb244-1"></a><span class="kw">select</span> <span class="op">*</span>  </span>
<span id="cb244-2"><a href="#cb244-2"></a><span class="kw">from</span> dbo.March2010 A </span>
<span id="cb244-3"><a href="#cb244-3"></a><span class="kw">where</span> A.<span class="dt">Date</span> <span class="op">&gt;=</span> <span class="dv">2005</span>; </span></code></pre></div>
<p>
(<code>2010 minus 4 minus 1 is 2005</code> Converting it to a proper <code>datetime</code>, and using single quotes will fix this issue.)
</p>
<p>Technically, the parser might allow you to get away with</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb245-1"><a href="#cb245-1"></a><span class="kw">select</span> <span class="op">*</span>  </span>
<span id="cb245-2"><a href="#cb245-2"></a><span class="kw">from</span> dbo.March2010 A </span>
<span id="cb245-3"><a href="#cb245-3"></a><span class="kw">where</span> A.<span class="dt">Date</span> <span class="op">&gt;=</span> <span class="st">&#39;2010-04-01&#39;</span></span></code></pre></div>
<p>it will do the conversion for you, but in my opinion it is less readable than explicitly converting to a <code>DateTime</code> for the maintenance programmer that will come after you.</p>
</section>
<section id="answer-2-score-51" class="level4">
<h4>Answer 2 (score 51)</h4>
<p>Try enclosing your date into a character string.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb246-1"><a href="#cb246-1"></a> <span class="kw">select</span> <span class="op">*</span> </span>
<span id="cb246-2"><a href="#cb246-2"></a> <span class="kw">from</span> dbo.March2010 A</span>
<span id="cb246-3"><a href="#cb246-3"></a> <span class="kw">where</span> A.<span class="dt">Date</span> <span class="op">&gt;=</span> <span class="st">&#39;2010-04-01&#39;</span>;</span></code></pre></div>
</section>
<section id="answer-3-score-13-1" class="level4">
<h4>Answer 3 (score 13)</h4>
<p>We can use like below as well</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb247-1"><a href="#cb247-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb247-2"><a href="#cb247-2"></a><span class="kw">FROM</span> dbo.March2010 A</span>
<span id="cb247-3"><a href="#cb247-3"></a><span class="kw">WHERE</span> <span class="fu">CAST</span>(A.<span class="dt">Date</span> <span class="kw">AS</span> <span class="dt">Date</span>) <span class="op">&gt;=</span> <span class="st">&#39;2017-03-22&#39;</span>;</span>
<span id="cb247-4"><a href="#cb247-4"></a></span>
<span id="cb247-5"><a href="#cb247-5"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb247-6"><a href="#cb247-6"></a>    <span class="kw">FROM</span> dbo.March2010 A</span>
<span id="cb247-7"><a href="#cb247-7"></a>    <span class="kw">WHERE</span> <span class="fu">CAST</span>(A.<span class="dt">Date</span> <span class="kw">AS</span> Datetime) <span class="op">&gt;=</span> <span class="st">&#39;2017-03-22 06:49:53.840&#39;</span>;</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="using-group-by-on-multiple-columns-score-950952-in-2018" class="level3">
<h3>40: Using group by on multiple columns (score <a href="https://stackoverflow.com/q/2421388.html">950952</a> in 2018)</h3>
<section id="question-39" class="level4">
<h4>Question</h4>
<p>I understand the point of <code>GROUP BY x</code></p>
<p>But how does <code>GROUP BY x, y</code> work, and what does it mean?</p>
</section>
<section id="answer-accepted-score-1894" class="level4">
<h4>Answer accepted (score 1894)</h4>
<p><code>Group By X</code> means <strong>put all those with the same value for X in the one group</strong>.</p>
<p><code>Group By X, Y</code> means <strong>put all those with the same values for both X and Y in the one group</strong>.</p>
<p>To illustrate using an example, let’s say we have the following table, to do with who is attending what subject at a university:</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb248-1"><a href="#cb248-1"></a><span class="kw">Table</span>: Subject_Selection</span>
<span id="cb248-2"><a href="#cb248-2"></a></span>
<span id="cb248-3"><a href="#cb248-3"></a>Subject   Semester   Attendee</span>
<span id="cb248-4"><a href="#cb248-4"></a><span class="co">---------------------------------</span></span>
<span id="cb248-5"><a href="#cb248-5"></a>ITB001    <span class="dv">1</span>          John</span>
<span id="cb248-6"><a href="#cb248-6"></a>ITB001    <span class="dv">1</span>          Bob</span>
<span id="cb248-7"><a href="#cb248-7"></a>ITB001    <span class="dv">1</span>          Mickey</span>
<span id="cb248-8"><a href="#cb248-8"></a>ITB001    <span class="dv">2</span>          Jenny</span>
<span id="cb248-9"><a href="#cb248-9"></a>ITB001    <span class="dv">2</span>          James</span>
<span id="cb248-10"><a href="#cb248-10"></a>MKB114    <span class="dv">1</span>          John</span>
<span id="cb248-11"><a href="#cb248-11"></a>MKB114    <span class="dv">1</span>          Erica</span></code></pre></div>
<p>When you use a <code>group by</code> on the subject column only; say:</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb249-1"><a href="#cb249-1"></a><span class="kw">select</span> Subject, <span class="fu">Count</span>(<span class="op">*</span>)</span>
<span id="cb249-2"><a href="#cb249-2"></a><span class="kw">from</span> Subject_Selection</span>
<span id="cb249-3"><a href="#cb249-3"></a><span class="kw">group</span> <span class="kw">by</span> Subject</span></code></pre></div>
<p>You will get something like:</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb250-1"><a href="#cb250-1"></a>Subject    <span class="fu">Count</span></span>
<span id="cb250-2"><a href="#cb250-2"></a><span class="co">------------------------------</span></span>
<span id="cb250-3"><a href="#cb250-3"></a>ITB001     <span class="dv">5</span></span>
<span id="cb250-4"><a href="#cb250-4"></a>MKB114     <span class="dv">2</span></span></code></pre></div>
<p>…because there are 5 entries for ITB001, and 2 for MKB114</p>
<p>If we were to <code>group by</code> two columns:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb251-1"><a href="#cb251-1"></a><span class="kw">select</span> Subject, Semester, <span class="fu">Count</span>(<span class="op">*</span>)</span>
<span id="cb251-2"><a href="#cb251-2"></a><span class="kw">from</span> Subject_Selection</span>
<span id="cb251-3"><a href="#cb251-3"></a><span class="kw">group</span> <span class="kw">by</span> Subject, Semester</span></code></pre></div>
<p>we would get this:</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb252-1"><a href="#cb252-1"></a>Subject    Semester   <span class="fu">Count</span></span>
<span id="cb252-2"><a href="#cb252-2"></a><span class="co">------------------------------</span></span>
<span id="cb252-3"><a href="#cb252-3"></a>ITB001     <span class="dv">1</span>          <span class="dv">3</span></span>
<span id="cb252-4"><a href="#cb252-4"></a>ITB001     <span class="dv">2</span>          <span class="dv">2</span></span>
<span id="cb252-5"><a href="#cb252-5"></a>MKB114     <span class="dv">1</span>          <span class="dv">2</span></span></code></pre></div>
<p>This is because, when we group by two columns, it is saying <strong>“Group them so that all of those with the same Subject and Semester are in the same group, and then calculate all the aggregate functions</strong> (Count, Sum, Average, etc.) <strong>for each of those groups”</strong>. In this example, this is demonstrated by the fact that, when we count them, there are <strong>three</strong> people doing ITB001 in semester 1, and <strong>two</strong> doing it in semester 2. Both of the people doing MKB114 are in semester 1, so there is no row for semester 2 (no data fits into the group “MKB114, Semester 2”)</p>
<p>Hopefully that makes sense.</p>
</section>
<section id="answer-2-score-26" class="level4">
<h4>Answer 2 (score 26)</h4>
<p>The <code>GROUP BY</code> clause is used in conjunction with the aggregate functions to group the result-set by one or more columns. e.g.:</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb253-1"><a href="#cb253-1"></a><span class="kw">SELECT</span> column_name, aggregate_function(column_name)</span>
<span id="cb253-2"><a href="#cb253-2"></a><span class="kw">FROM</span> table_name</span>
<span id="cb253-3"><a href="#cb253-3"></a><span class="kw">WHERE</span> column_name <span class="kw">operator</span> <span class="fu">value</span></span>
<span id="cb253-4"><a href="#cb253-4"></a><span class="kw">GROUP</span> <span class="kw">BY</span> column_name;</span></code></pre></div>
<p>Remember this order:</p>
<blockquote>
<ol type="1">
<li><p>SELECT (is used to select data from a database)</p></li>
<li><p>FROM (clause is used to list the tables)</p></li>
<li><p>WHERE (clause is used to filter records)</p></li>
</ol>
<p>
<ol start="4" type="1">
<li>GROUP BY (clause can be used in a SELECT statement to collect data across multiple records and group the results by one or more columns)
</p></li>
</ol>
<p>
<ol start="5" type="1">
<li>HAVING (clause is used in combination with the GROUP BY clause to restrict the groups of returned rows to only those whose the condition is TRUE)
</p></li>
<li>ORDER BY (keyword is used to sort the result-set)<br />

</blockquote></li>
</ol>
<p>You can use all of these if you are using aggregate functions, and this is the order that they must be set, otherwise you can get an error.</p>
<p>Aggregate Functions are:</p>
<blockquote>
<p>MIN returns the smallest value in a given column</p>
<p>SUM returns the sum of the numeric values in a given column</p>
<p>AVG returns the average value of a given column</p>
<p>COUNT returns the total number of values in a given column</p>
COUNT(*) returns the number of rows in a table
</blockquote>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-to-list-the-tables-in-a-sqlite-database-file-that-was-opened-with-attach-score-950088-in-2019" class="level3">
<h3>41: How to list the tables in a SQLite database file that was opened with ATTACH? (score <a href="https://stackoverflow.com/q/82875.html">950088</a> in 2019)</h3>
<section id="question-40" class="level4">
<h4>Question</h4>
<p>What SQL can be used to list the tables, and the rows within those tables in a SQLite database file - once I have attached it with the <code>ATTACH</code> command on the SQLite 3 command line tool?</p>
</section>
<section id="answer-accepted-score-549" class="level4">
<h4>Answer accepted (score 549)</h4>
<p>The <code>.tables</code>, and <code>.schema</code> “helper” functions don’t look into ATTACHed databases: they just query the <code>SQLITE_MASTER</code> table for the “main” database. Consequently, if you used</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb254-1"><a href="#cb254-1"></a>ATTACH some_file.db <span class="kw">AS</span> my_db;</span></code></pre></div>
<p>then you need to do</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb255-1"><a href="#cb255-1"></a><span class="kw">SELECT</span> name <span class="kw">FROM</span> my_db.sqlite_master <span class="kw">WHERE</span> <span class="kw">type</span><span class="op">=</span><span class="st">&#39;table&#39;</span>;</span></code></pre></div>
<p>Note that temporary tables don’t show up with <code>.tables</code> either: you have to list <code>sqlite_temp_master</code> for that:</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb256-1"><a href="#cb256-1"></a><span class="kw">SELECT</span> name <span class="kw">FROM</span> sqlite_temp_master <span class="kw">WHERE</span> <span class="kw">type</span><span class="op">=</span><span class="st">&#39;table&#39;</span>;</span></code></pre></div>
</section>
<section id="answer-2-score-1250" class="level4">
<h4>Answer 2 (score 1250)</h4>
<p>There are a few steps to see the tables in an SQLite database:</p>
<ol>
<li>
<p>
List the tables in your database:
</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb257-1"><a href="#cb257-1"></a>.<span class="kw">tables</span></span>
<span id="cb257-2"><a href="#cb257-2"></a>```<span class="op">&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb257-3"><a href="#cb257-3"></a><span class="op">&lt;</span>li<span class="op">&gt;&lt;</span>p<span class="op">&gt;</span><span class="kw">List</span> how <span class="kw">the</span> <span class="kw">table</span> looks:<span class="op">&lt;/</span>p<span class="op">&gt;</span></span>
<span id="cb257-4"><a href="#cb257-4"></a></span>
<span id="cb257-5"><a href="#cb257-5"></a>```sql</span>
<span id="cb257-6"><a href="#cb257-6"></a>.<span class="kw">schema</span> tablename</span>
<span id="cb257-7"><a href="#cb257-7"></a>```<span class="op">&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb257-8"><a href="#cb257-8"></a><span class="op">&lt;</span>li<span class="op">&gt;&lt;</span>p<span class="op">&gt;</span>Print <span class="kw">the</span> entire <span class="kw">table</span>:<span class="op">&lt;/</span>p<span class="op">&gt;</span></span>
<span id="cb257-9"><a href="#cb257-9"></a></span>
<span id="cb257-10"><a href="#cb257-10"></a>```sql</span>
<span id="cb257-11"><a href="#cb257-11"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> tablename;</span>
<span id="cb257-12"><a href="#cb257-12"></a>```<span class="op">&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb257-13"><a href="#cb257-13"></a><span class="op">&lt;</span>li<span class="op">&gt;&lt;</span>p<span class="op">&gt;</span><span class="kw">List</span> <span class="kw">all</span> <span class="kw">of</span> <span class="kw">the</span> available SQLite prompt commands:<span class="op">&lt;/</span>p<span class="op">&gt;</span></span>
<span id="cb257-14"><a href="#cb257-14"></a></span>
<span id="cb257-15"><a href="#cb257-15"></a>```sql</span>
<span id="cb257-16"><a href="#cb257-16"></a>.help</span>
<span id="cb257-17"><a href="#cb257-17"></a>```<span class="op">&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb257-18"><a href="#cb257-18"></a><span class="op">&lt;/</span>ol<span class="op">&gt;</span></span>
<span id="cb257-19"><a href="#cb257-19"></a></span>
<span id="cb257-20"><a href="#cb257-20"></a>#### Answer <span class="dv">3</span> (score <span class="dv">438</span>)</span>
<span id="cb257-21"><a href="#cb257-21"></a>It appears you need <span class="kw">to</span> go <span class="kw">through</span> <span class="kw">the</span> <span class="op">&lt;</span>strong<span class="op">&gt;</span>sqlite_master<span class="op">&lt;/</span>strong<span class="op">&gt;</span> <span class="kw">table</span>, <span class="kw">like</span> this:  </span>
<span id="cb257-22"><a href="#cb257-22"></a></span>
<span id="cb257-23"><a href="#cb257-23"></a>```sql</span>
<span id="cb257-24"><a href="#cb257-24"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> dbname.sqlite_master <span class="kw">WHERE</span> <span class="kw">type</span><span class="op">=</span><span class="st">&#39;table&#39;</span>;</span></code></pre></div>
<p>And then manually go through each table with a <code>SELECT</code> or similar to look at the rows.</p>
<p>The <code>.DUMP</code> and <code>.SCHEMA</code> commands doesn’t appear to see the database at all.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="convert-month-number-to-month-name-function-in-sql-score-931125-in-2012" class="level3">
<h3>42: Convert Month Number to Month Name Function in SQL (score <a href="https://stackoverflow.com/q/185520.html">931125</a> in 2012)</h3>
<section id="question-41" class="level4">
<h4>Question</h4>
<p>I have months stored in SQL Server as 1,2,3,4,…12. I would like to display them as January,February etc. Is there a function in SQL Server like MonthName(1) = January? I am trying to avoid a CASE statement, if possible.</p>
</section>
<section id="answer-accepted-score-151" class="level4">
<h4>Answer accepted (score 151)</h4>
<p>A little hacky but should work:</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb258-1"><a href="#cb258-1"></a><span class="kw">SELECT</span> DATENAME(<span class="dt">month</span>, DATEADD(<span class="dt">month</span>, @mydate<span class="op">-</span><span class="dv">1</span>, <span class="fu">CAST</span>(<span class="st">&#39;2008-01-01&#39;</span> <span class="kw">AS</span> datetime)))</span></code></pre></div>
</section>
<section id="answer-2-score-255" class="level4">
<h4>Answer 2 (score 255)</h4>
<p>I think this is the best way to get the <strong>month name</strong> when you have the <strong>month number</strong></p>
<div class="sourceCode" id="cb259"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb259-1"><a href="#cb259-1"></a><span class="kw">Select</span> DateName( <span class="dt">month</span> , DateAdd( <span class="dt">month</span> , @MonthNumber , <span class="dv">0</span> ) <span class="op">-</span> <span class="dv">1</span> )</span></code></pre></div>
<p>Or</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb260-1"><a href="#cb260-1"></a><span class="kw">Select</span> DateName( <span class="dt">month</span> , DateAdd( <span class="dt">month</span> , @MonthNumber , <span class="op">-</span><span class="dv">1</span> ) )</span></code></pre></div>
</section>
<section id="answer-3-score-90" class="level4">
<h4>Answer 3 (score 90)</h4>
<div class="sourceCode" id="cb261"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb261-1"><a href="#cb261-1"></a><span class="kw">SELECT</span> DATENAME(<span class="dt">month</span>, GETDATE()) <span class="kw">AS</span> <span class="st">&#39;Month Name&#39;</span></span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="select-first-row-in-each-group-by-group-score-921853-in-2018" class="level3">
<h3>43: Select first row in each GROUP BY group? (score <a href="https://stackoverflow.com/q/3800551.html">921853</a> in 2018)</h3>
<section id="question-42" class="level4">
<h4>Question</h4>
<p>As the title suggests, I’d like to select the first row of each set of rows grouped with a <code>GROUP BY</code>.</p>
<p>Specifically, if I’ve got a <code>purchases</code> table that looks like this:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb262-1"><a href="#cb262-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> purchases;</span></code></pre></div>
<p><strong>My Output:</strong></p>
<pre>
id | customer | total
---+----------+------
 1 | Joe      | 5
 2 | Sally    | 3
 3 | Joe      | 2
 4 | Sally    | 1
</pre>
<p>I’d like to query for the <code>id</code> of the largest purchase (<code>total</code>) made by each <code>customer</code>. Something like this:</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb263-1"><a href="#cb263-1"></a><span class="kw">SELECT</span> <span class="fu">FIRST</span>(<span class="kw">id</span>), customer, <span class="fu">FIRST</span>(total)</span>
<span id="cb263-2"><a href="#cb263-2"></a><span class="kw">FROM</span>  purchases</span>
<span id="cb263-3"><a href="#cb263-3"></a><span class="kw">GROUP</span> <span class="kw">BY</span> customer</span>
<span id="cb263-4"><a href="#cb263-4"></a><span class="kw">ORDER</span> <span class="kw">BY</span> total <span class="kw">DESC</span>;</span></code></pre></div>
<p><strong>Expected Output:</strong></p>
<pre>
FIRST(id) | customer | FIRST(total)
----------+----------+-------------
        1 | Joe      | 5
        2 | Sally    | 3
</pre>
</section>
<section id="answer-accepted-score-997-1" class="level4">
<h4>Answer accepted (score 997)</h4>
<h5>
On Oracle 9.2+ (not 8i+ as originally stated), SQL Server 2005+, PostgreSQL 8.4+, DB2, Firebird 3.0+, Teradata, Sybase, Vertica:
</h2>
<div class="sourceCode" id="cb264"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb264-1"><a href="#cb264-1"></a><span class="kw">WITH</span> <span class="kw">summary</span> <span class="kw">AS</span> (</span>
<span id="cb264-2"><a href="#cb264-2"></a>    <span class="kw">SELECT</span> p.<span class="kw">id</span>, </span>
<span id="cb264-3"><a href="#cb264-3"></a>           p.customer, </span>
<span id="cb264-4"><a href="#cb264-4"></a>           p.total, </span>
<span id="cb264-5"><a href="#cb264-5"></a>           <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span>(<span class="kw">PARTITION</span> <span class="kw">BY</span> p.customer </span>
<span id="cb264-6"><a href="#cb264-6"></a>                                 <span class="kw">ORDER</span> <span class="kw">BY</span> p.total <span class="kw">DESC</span>) <span class="kw">AS</span> rk</span>
<span id="cb264-7"><a href="#cb264-7"></a>      <span class="kw">FROM</span> PURCHASES p)</span>
<span id="cb264-8"><a href="#cb264-8"></a><span class="kw">SELECT</span> s.<span class="op">*</span></span>
<span id="cb264-9"><a href="#cb264-9"></a>  <span class="kw">FROM</span> <span class="kw">summary</span> s</span>
<span id="cb264-10"><a href="#cb264-10"></a> <span class="kw">WHERE</span> s.rk <span class="op">=</span> <span class="dv">1</span></span></code></pre></div>
<h5>
Supported by any database:
</h2>
<p>But you need to add logic to break ties:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb265-1"><a href="#cb265-1"></a>  <span class="kw">SELECT</span> <span class="fu">MIN</span>(x.<span class="kw">id</span>),  <span class="co">-- change to MAX if you want the highest</span></span>
<span id="cb265-2"><a href="#cb265-2"></a>         x.customer, </span>
<span id="cb265-3"><a href="#cb265-3"></a>         x.total</span>
<span id="cb265-4"><a href="#cb265-4"></a>    <span class="kw">FROM</span> PURCHASES x</span>
<span id="cb265-5"><a href="#cb265-5"></a>    <span class="kw">JOIN</span> (<span class="kw">SELECT</span> p.customer,</span>
<span id="cb265-6"><a href="#cb265-6"></a>                 <span class="fu">MAX</span>(total) <span class="kw">AS</span> max_total</span>
<span id="cb265-7"><a href="#cb265-7"></a>            <span class="kw">FROM</span> PURCHASES p</span>
<span id="cb265-8"><a href="#cb265-8"></a>        <span class="kw">GROUP</span> <span class="kw">BY</span> p.customer) y <span class="kw">ON</span> y.customer <span class="op">=</span> x.customer</span>
<span id="cb265-9"><a href="#cb265-9"></a>                              <span class="kw">AND</span> y.max_total <span class="op">=</span> x.total</span>
<span id="cb265-10"><a href="#cb265-10"></a><span class="kw">GROUP</span> <span class="kw">BY</span> x.customer, x.total</span></code></pre></div>
</section>
<section id="answer-2-score-1027" class="level4">
<h4>Answer 2 (score 1027)</h4>
<p>In <strong>PostgreSQL</strong> this is typically <strong>simpler and faster</strong> (more performance optimization below):</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb266-1"><a href="#cb266-1"></a><span class="kw">SELECT</span> <span class="op">&lt;</span>b<span class="op">&gt;</span><span class="kw">DISTINCT</span> <span class="kw">ON</span><span class="op">&lt;/</span>b<span class="op">&gt;</span> (customer)</span>
<span id="cb266-2"><a href="#cb266-2"></a>       <span class="kw">id</span>, customer, total</span>
<span id="cb266-3"><a href="#cb266-3"></a><span class="kw">FROM</span>   purchases</span>
<span id="cb266-4"><a href="#cb266-4"></a><span class="kw">ORDER</span>  <span class="kw">BY</span> customer, total <span class="kw">DESC</span>, <span class="kw">id</span>;```</span>
<span id="cb266-5"><a href="#cb266-5"></a></span>
<span id="cb266-6"><a href="#cb266-6"></a><span class="kw">Or</span> shorter (<span class="cf">if</span> <span class="kw">not</span> <span class="kw">as</span> <span class="kw">clear</span>) <span class="kw">with</span> ordinal numbers <span class="kw">of</span> output <span class="kw">columns</span>:  </span>
<span id="cb266-7"><a href="#cb266-7"></a></span>
<span id="cb266-8"><a href="#cb266-8"></a>```sql</span>
<span id="cb266-9"><a href="#cb266-9"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> <span class="kw">ON</span> (<span class="dv">2</span>)</span>
<span id="cb266-10"><a href="#cb266-10"></a>       <span class="kw">id</span>, customer, total</span>
<span id="cb266-11"><a href="#cb266-11"></a><span class="kw">FROM</span>   purchases</span>
<span id="cb266-12"><a href="#cb266-12"></a><span class="kw">ORDER</span>  <span class="kw">BY</span> <span class="dv">2</span>, <span class="dv">3</span> <span class="kw">DESC</span>, <span class="dv">1</span>;</span></code></pre></div>
<p>If <code>total</code> can be NULL (won’t hurt either way, but you’ll want to match existing indexes):</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb267-1"><a href="#cb267-1"></a><span class="op">..</span>.</span>
<span id="cb267-2"><a href="#cb267-2"></a><span class="kw">ORDER</span>  <span class="kw">BY</span> customer, total <span class="kw">DESC</span> <span class="op">&lt;</span>b<span class="op">&gt;</span><span class="kw">NULLS</span> <span class="fu">LAST</span><span class="op">&lt;/</span>b<span class="op">&gt;</span>, <span class="kw">id</span>;```</span>
<span id="cb267-3"><a href="#cb267-3"></a></span>
<span id="cb267-4"><a href="#cb267-4"></a><span class="op">&lt;</span>h5<span class="op">&gt;</span>Major points<span class="op">&lt;/</span>h3<span class="op">&gt;</span></span>
<span id="cb267-5"><a href="#cb267-5"></a></span>
<span id="cb267-6"><a href="#cb267-6"></a><span class="op">&lt;</span>ul<span class="op">&gt;</span></span>
<span id="cb267-7"><a href="#cb267-7"></a><span class="op">&lt;</span>li<span class="op">&gt;&lt;</span>p<span class="op">&gt;&lt;</span>a href<span class="op">=</span><span class="ot">&quot;https://www.postgresql.org/docs/current/sql-select.html#SQL-DISTINCT&quot;</span> rel<span class="op">=</span><span class="ot">&quot;noreferrer&quot;</span><span class="op">&gt;&lt;</span>strong<span class="op">&gt;</span>`DISTINCT ON`<span class="op">&lt;/</span>strong<span class="op">&gt;&lt;/</span>a<span class="op">&gt;</span> <span class="kw">is</span> a PostgreSQL extension <span class="kw">of</span> <span class="kw">the</span> standard (<span class="kw">where</span> <span class="kw">only</span> `DISTINCT` <span class="kw">on</span> <span class="kw">the</span> whole `SELECT` <span class="kw">list</span> <span class="kw">is</span> defined).<span class="op">&lt;/</span>p<span class="op">&gt;&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb267-8"><a href="#cb267-8"></a><span class="op">&lt;</span>li<span class="op">&gt;&lt;</span>p<span class="op">&gt;</span><span class="kw">List</span> <span class="kw">any</span> <span class="dt">number</span> <span class="kw">of</span> expressions <span class="kw">in</span> <span class="kw">the</span> `DISTINCT ON` clause, <span class="kw">the</span> combined <span class="kw">row</span> <span class="fu">value</span> defines duplicates. <span class="op">&lt;</span>a href<span class="op">=</span><span class="ot">&quot;https://www.postgresql.org/docs/current/queries-select-lists.html#QUERIES-DISTINCT&quot;</span> rel<span class="op">=</span><span class="ot">&quot;noreferrer&quot;</span><span class="op">&gt;</span><span class="kw">The</span> manual:<span class="op">&lt;/</span>a<span class="op">&gt;&lt;/</span>p<span class="op">&gt;</span></span>
<span id="cb267-9"><a href="#cb267-9"></a></span>
<span id="cb267-10"><a href="#cb267-10"></a><span class="op">&lt;</span>blockquote<span class="op">&gt;</span></span>
<span id="cb267-11"><a href="#cb267-11"></a>  <span class="op">&lt;</span>p<span class="op">&gt;</span>Obviously, two <span class="kw">rows</span> are considered <span class="kw">distinct</span> <span class="cf">if</span> they differ <span class="kw">in</span> <span class="kw">at</span> <span class="fu">least</span></span>
<span id="cb267-12"><a href="#cb267-12"></a>  one <span class="kw">column</span> <span class="fu">value</span>. <span class="op">&lt;</span>strong<span class="op">&gt;</span><span class="kw">Null</span> <span class="kw">values</span> are considered equal <span class="kw">in</span> this comparison.<span class="op">&lt;/</span>strong<span class="op">&gt;&lt;/</span>p<span class="op">&gt;</span></span>
<span id="cb267-13"><a href="#cb267-13"></a><span class="op">&lt;/</span>blockquote<span class="op">&gt;</span></span>
<span id="cb267-14"><a href="#cb267-14"></a></span>
<span id="cb267-15"><a href="#cb267-15"></a>Bold emphasis mine.  <span class="op">&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb267-16"><a href="#cb267-16"></a><span class="op">&lt;</span>li<span class="op">&gt;&lt;</span>p<span class="op">&gt;</span>`DISTINCT ON` can be combined <span class="kw">with</span> <span class="op">&lt;</span>strong<span class="op">&gt;</span>`ORDER BY`<span class="op">&lt;/</span>strong<span class="op">&gt;</span>. <span class="kw">Leading</span> expressions have <span class="kw">to</span> match <span class="kw">leading</span> `DISTINCT ON` expressions <span class="kw">in</span> <span class="kw">the</span> same <span class="kw">order</span>. You can <span class="kw">add</span> <span class="op">&lt;</span>em<span class="op">&gt;</span>additional<span class="op">&lt;/</span>em<span class="op">&gt;</span> expressions <span class="kw">to</span> `ORDER BY` <span class="kw">to</span> pick a particular <span class="kw">row</span> <span class="kw">from</span> <span class="kw">each</span> <span class="kw">group</span> <span class="kw">of</span> peers. I added `id` <span class="kw">as</span> <span class="fu">last</span> item <span class="kw">to</span> <span class="kw">break</span> ties:<span class="op">&lt;/</span>p<span class="op">&gt;</span></span>
<span id="cb267-17"><a href="#cb267-17"></a></span>
<span id="cb267-18"><a href="#cb267-18"></a><span class="op">&lt;</span>em<span class="op">&gt;</span><span class="ot">&quot;Pick the row with the smallest `id` from each group sharing the highest `total`.&quot;</span><span class="op">&lt;/</span>em<span class="op">&gt;</span>  </span>
<span id="cb267-19"><a href="#cb267-19"></a></span>
<span id="cb267-20"><a href="#cb267-20"></a><span class="kw">To</span> <span class="kw">order</span> results <span class="kw">in</span> a way that disagrees <span class="kw">with</span> <span class="kw">the</span> <span class="kw">sort</span> <span class="kw">order</span> determining <span class="kw">the</span> <span class="fu">first</span> per <span class="kw">group</span>, you can nest above <span class="kw">query</span> <span class="kw">in</span> an <span class="kw">outer</span> <span class="kw">query</span> <span class="kw">with</span> another `ORDER BY`. <span class="kw">Like</span>:  </span>
<span id="cb267-21"><a href="#cb267-21"></a></span>
<span id="cb267-22"><a href="#cb267-22"></a><span class="op">&lt;</span>ul<span class="op">&gt;</span></span>
<span id="cb267-23"><a href="#cb267-23"></a><span class="op">&lt;</span>li<span class="op">&gt;&lt;</span>a href<span class="op">=</span><span class="ot">&quot;https://stackoverflow.com/questions/9795660/postgresql-distinct-on-with-different-order-by/9796104#9796104&quot;</span><span class="op">&gt;</span>PostgreSQL <span class="kw">DISTINCT</span> <span class="kw">ON</span> <span class="kw">with</span> different <span class="kw">ORDER</span> <span class="kw">BY</span><span class="op">&lt;/</span>a<span class="op">&gt;&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb267-24"><a href="#cb267-24"></a><span class="op">&lt;/</span>ul<span class="op">&gt;&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb267-25"><a href="#cb267-25"></a><span class="op">&lt;</span>li<span class="op">&gt;&lt;</span>p<span class="op">&gt;</span><span class="cf">If</span> `total` can be <span class="kw">NULL</span>, you <span class="op">&lt;</span>em<span class="op">&gt;</span>most probably<span class="op">&lt;/</span>em<span class="op">&gt;</span> want <span class="kw">the</span> <span class="kw">row</span> <span class="kw">with</span> <span class="kw">the</span> <span class="fu">greatest</span> non<span class="op">-</span><span class="kw">null</span> <span class="fu">value</span>. <span class="kw">Add</span> <span class="op">&lt;</span>strong<span class="op">&gt;</span>`NULLS LAST`<span class="op">&lt;/</span>strong<span class="op">&gt;</span> <span class="kw">like</span> demonstrated. Details:<span class="op">&lt;/</span>p<span class="op">&gt;</span></span>
<span id="cb267-26"><a href="#cb267-26"></a></span>
<span id="cb267-27"><a href="#cb267-27"></a><span class="op">&lt;</span>ul<span class="op">&gt;</span></span>
<span id="cb267-28"><a href="#cb267-28"></a><span class="op">&lt;</span>li<span class="op">&gt;&lt;</span>a href<span class="op">=</span><span class="ot">&quot;https://stackoverflow.com/questions/9510509/postgresql-sort-by-datetime-asc-null-first/9511492#9511492&quot;</span><span class="op">&gt;</span>PostgreSQL <span class="kw">sort</span> <span class="kw">by</span> datetime <span class="kw">asc</span>, <span class="kw">null</span> <span class="fu">first</span>?<span class="op">&lt;/</span>a<span class="op">&gt;&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb267-29"><a href="#cb267-29"></a><span class="op">&lt;/</span>ul<span class="op">&gt;&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb267-30"><a href="#cb267-30"></a><span class="op">&lt;</span>li<span class="op">&gt;&lt;</span>p<span class="op">&gt;&lt;</span>strong<span class="op">&gt;</span><span class="kw">The</span> `SELECT` <span class="kw">list</span><span class="op">&lt;/</span>strong<span class="op">&gt;</span> <span class="kw">is</span> <span class="kw">not</span> constrained <span class="kw">by</span> expressions <span class="kw">in</span> `DISTINCT ON` <span class="kw">or</span> `ORDER BY` <span class="kw">in</span> <span class="kw">any</span> way. (<span class="kw">Not</span> <span class="kw">needed</span> <span class="kw">in</span> <span class="kw">the</span> simple <span class="cf">case</span> above):<span class="op">&lt;/</span>p<span class="op">&gt;</span></span>
<span id="cb267-31"><a href="#cb267-31"></a></span>
<span id="cb267-32"><a href="#cb267-32"></a><span class="op">&lt;</span>ul<span class="op">&gt;</span></span>
<span id="cb267-33"><a href="#cb267-33"></a><span class="op">&lt;</span>li<span class="op">&gt;&lt;</span>p<span class="op">&gt;</span>You <span class="op">&lt;</span>em<span class="op">&gt;</span>don<span class="st">&#39;t have to&lt;/em&gt; include any of the expressions in `DISTINCT ON` or `ORDER BY`.&lt;/p&gt;&lt;/li&gt;</span></span>
<span id="cb267-34"><a href="#cb267-34"></a><span class="st">&lt;li&gt;&lt;p&gt;You &lt;em&gt;can&lt;/em&gt; include any other expression in the `SELECT` list. This is instrumental for replacing much more complex queries with subqueries and aggregate / window functions.&lt;/p&gt;&lt;/li&gt;</span></span>
<span id="cb267-35"><a href="#cb267-35"></a><span class="st">&lt;/ul&gt;&lt;/li&gt;</span></span>
<span id="cb267-36"><a href="#cb267-36"></a><span class="st">&lt;li&gt;&lt;p&gt;I tested with Postgres versions 8.3 – 12. But the feature has been there at least since version 7.1, so basically always.&lt;/p&gt;&lt;/li&gt;</span></span>
<span id="cb267-37"><a href="#cb267-37"></a><span class="st">&lt;/ul&gt;</span></span>
<span id="cb267-38"><a href="#cb267-38"></a></span>
<span id="cb267-39"><a href="#cb267-39"></a><span class="st">&lt;h5&gt;Index&lt;/h2&gt;</span></span>
<span id="cb267-40"><a href="#cb267-40"></a></span>
<span id="cb267-41"><a href="#cb267-41"></a><span class="st">The &lt;em&gt;perfect&lt;/em&gt; index for the above query would be a &lt;a href=&quot;https://www.postgresql.org/docs/current/indexes-multicolumn.html&quot; rel=&quot;noreferrer&quot;&gt;multi-column index&lt;/a&gt; spanning all three columns in matching sequence and with matching sort order:  </span></span>
<span id="cb267-42"><a href="#cb267-42"></a></span>
<span id="cb267-43"><a href="#cb267-43"></a><span class="st">```sql</span></span>
<span id="cb267-44"><a href="#cb267-44"></a><span class="st">CREATE INDEX purchases_3c_idx ON purchases (customer, total DESC, id);</span></span></code></pre></div>
<p>May be too specialized. But use it if read performance for the particular query is crucial. If you have <code>DESC NULLS LAST</code> in the query, use the same in the index so that sort order matches and the index is applicable.</p>
<h5>
Effectiveness / Performance optimization
</h2>
<p>Weigh cost and benefit before creating tailored indexes for each query. The potential of above index largely depends on <strong>data distribution</strong>.</p>
<p>The index is used because it delivers pre-sorted data. In Postgres 9.2 or later the query can also benefit from an <strong><a href="https://www.postgresql.org/docs/current/indexes-index-only-scans.html" rel="noreferrer">index only scan</a></strong> if the index is smaller than the underlying table. The index has to be scanned in its entirety, though.</p>
<ul>
<li>
<p>
For <strong><em>few</em> rows per customer</strong> (high cardinality in column <code>customer</code>), this is very efficient. Even more so if you need sorted output anyway. The benefit shrinks with a growing number of rows per customer.<br> Ideally, you have enough <a href="https://www.postgresql.org/docs/current/runtime-config-resource.html#GUC-WORK-MEM" rel="noreferrer"><strong><code>work_mem</code></strong></a> to process the involved sort step in RAM and not spill to disk. But generally setting <code>work_mem</code> <em>too</em> high can have adverse effects. Consider <code>SET LOCAL</code> for exceptionally big queries. Find how much you need with <code>EXPLAIN ANALYZE</code>. Mention of “<em>Disk:</em>” in the sort step indicates the need for more:
</p>
<ul>
<li>
<a href="https://stackoverflow.com/questions/8106181/configuration-parameter-work-mem-in-postgresql-on-linux/8108807#8108807">Configuration parameter work_mem in PostgreSQL on Linux</a>
</li>
<li>
<a href="https://dba.stackexchange.com/questions/48630/optimize-simple-query-using-order-by-date-and-text/48633#48633">Optimize simple query using ORDER BY date and text</a>
</li>
</ul>
</li>
<li>
<p>
For <strong><em>many</em> rows per customer</strong> (low cardinality in column <code>customer</code>), a <a href="https://wiki.postgresql.org/wiki/Loose_indexscan" rel="noreferrer"><strong>loose index scan</strong></a> (a.k.a. “skip scan”) would be (much) more efficient, but that’s not implemented up to Postgres 12. (An implementation for index-only scans is in development for Postgres 13. See <a href="https://commitfest.postgresql.org/19/1741/" rel="noreferrer">here</a> and <a href="https://www.postgresql.org/message-id/flat/707b6f68-16fa-7aa7-96e5-eeb4865e6a30@redhat.com" rel="noreferrer">here</a>.)<br> For now, there are <strong>faster query techniques</strong> to substitute for this. In particular if you have a separate table holding unique customers, which is the typical use case. But also if you don’t:
</p>
<ul>
<li>
<strong><a href="https://stackoverflow.com/questions/25536422/optimize-group-by-query-to-retrieve-latest-record-per-user/25536748#25536748">Optimize GROUP BY query to retrieve latest row per user</a></strong>
</li>
<li>
<a href="https://stackoverflow.com/questions/24244026/optimize-groupwise-maximum-query/24377356#24377356">Optimize groupwise maximum query</a>
</li>
<li>
<a href="https://stackoverflow.com/questions/25957558/querying-last-n-related-records-in-postgres/25965393#25965393">Query last N related rows per row</a>
</li>
</ul>
</li>
</ul>
<h5>
Benchmark
</h2>
<p>I had a simple benchmark here which is outdated by now. I replaced it with a <a href="https://stackoverflow.com/a/34715134/939860"><strong>detailed benchmark in this separate answer</strong></a>.</p>
</section>
<section id="answer-3-score-119" class="level4">
<h4>Answer 3 (score 119)</h4>
<h5>
Benchmark
</h1>
<p>Testing the most interesting candidates with Postgres <strong>9.4</strong> and <strong>9.5</strong> with a halfway realistic table of <strong>200k rows</strong> in <code>purchases</code> and <strong>10k distinct <code>customer_id</code></strong> (<em>avg. 20 rows per customer</em>).</p>
<p>For Postgres 9.5 I ran a 2nd test with effectively 86446 distinct customers. See below (<em>avg. 2.3 rows per customer</em>).</p>
<h5>
Setup
</h3>
<p>Main table</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb268-1"><a href="#cb268-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> purchases (</span>
<span id="cb268-2"><a href="#cb268-2"></a>  <span class="kw">id</span>          serial</span>
<span id="cb268-3"><a href="#cb268-3"></a>, customer_id <span class="dt">int</span>  <span class="co">-- REFERENCES customer</span></span>
<span id="cb268-4"><a href="#cb268-4"></a>, total       <span class="dt">int</span>  <span class="co">-- could be amount of money in Cent</span></span>
<span id="cb268-5"><a href="#cb268-5"></a>, some_column text <span class="co">-- to make the row bigger, more realistic</span></span>
<span id="cb268-6"><a href="#cb268-6"></a>);</span></code></pre></div>
<p>I use a <code>serial</code> (PK constraint added below) and an integer <code>customer_id</code> since that’s a more typical setup. Also added <code>some_column</code> to make up for typically more columns.</p>
<p>Dummy data, PK, index - a typical table also has some dead tuples:</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb269-1"><a href="#cb269-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> purchases (customer_id, total, some_column)    <span class="co">-- insert 200k rows</span></span>
<span id="cb269-2"><a href="#cb269-2"></a><span class="kw">SELECT</span> (<span class="kw">random</span>() <span class="op">*</span> <span class="dv">10000</span>):<span class="ch">:int</span>             <span class="kw">AS</span> customer_id  <span class="co">-- 10k customers</span></span>
<span id="cb269-3"><a href="#cb269-3"></a>     , (<span class="kw">random</span>() <span class="op">*</span> <span class="kw">random</span>() <span class="op">*</span> <span class="dv">100000</span>):<span class="ch">:int</span> <span class="kw">AS</span> total     </span>
<span id="cb269-4"><a href="#cb269-4"></a>     , <span class="st">&#39;note: &#39;</span> <span class="op">||</span> repeat(<span class="st">&#39;x&#39;</span>, (<span class="kw">random</span>()^<span class="dv">2</span> <span class="op">*</span> <span class="kw">random</span>() <span class="op">*</span> <span class="kw">random</span>() <span class="op">*</span> <span class="dv">500</span>):<span class="ch">:int</span>)</span>
<span id="cb269-5"><a href="#cb269-5"></a><span class="kw">FROM</span>   generate_series(<span class="dv">1</span>,<span class="dv">200000</span>) g;</span>
<span id="cb269-6"><a href="#cb269-6"></a></span>
<span id="cb269-7"><a href="#cb269-7"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> purchases <span class="kw">ADD</span> <span class="kw">CONSTRAINT</span> purchases_id_pkey <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (<span class="kw">id</span>);</span>
<span id="cb269-8"><a href="#cb269-8"></a></span>
<span id="cb269-9"><a href="#cb269-9"></a><span class="kw">DELETE</span> <span class="kw">FROM</span> purchases <span class="kw">WHERE</span> <span class="kw">random</span>() <span class="op">&gt;</span> <span class="fl">0.9</span>; <span class="co">-- some dead rows</span></span>
<span id="cb269-10"><a href="#cb269-10"></a></span>
<span id="cb269-11"><a href="#cb269-11"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> purchases (customer_id, total, some_column)</span>
<span id="cb269-12"><a href="#cb269-12"></a><span class="kw">SELECT</span> (<span class="kw">random</span>() <span class="op">*</span> <span class="dv">10000</span>):<span class="ch">:int</span>             <span class="kw">AS</span> customer_id  <span class="co">-- 10k customers</span></span>
<span id="cb269-13"><a href="#cb269-13"></a>     , (<span class="kw">random</span>() <span class="op">*</span> <span class="kw">random</span>() <span class="op">*</span> <span class="dv">100000</span>):<span class="ch">:int</span> <span class="kw">AS</span> total     </span>
<span id="cb269-14"><a href="#cb269-14"></a>     , <span class="st">&#39;note: &#39;</span> <span class="op">||</span> repeat(<span class="st">&#39;x&#39;</span>, (<span class="kw">random</span>()^<span class="dv">2</span> <span class="op">*</span> <span class="kw">random</span>() <span class="op">*</span> <span class="kw">random</span>() <span class="op">*</span> <span class="dv">500</span>):<span class="ch">:int</span>)</span>
<span id="cb269-15"><a href="#cb269-15"></a><span class="kw">FROM</span>   generate_series(<span class="dv">1</span>,<span class="dv">20000</span>) g;  <span class="co">-- add 20k to make it ~ 200k</span></span>
<span id="cb269-16"><a href="#cb269-16"></a></span>
<span id="cb269-17"><a href="#cb269-17"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> purchases_3c_idx <span class="kw">ON</span> purchases (customer_id, total <span class="kw">DESC</span>, <span class="kw">id</span>);</span>
<span id="cb269-18"><a href="#cb269-18"></a></span>
<span id="cb269-19"><a href="#cb269-19"></a>VACUUM <span class="kw">ANALYZE</span> purchases;</span></code></pre></div>
<p><code>customer</code> table - for superior query</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb270-1"><a href="#cb270-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> customer <span class="kw">AS</span></span>
<span id="cb270-2"><a href="#cb270-2"></a><span class="kw">SELECT</span> customer_id, <span class="st">&#39;customer_&#39;</span> <span class="op">||</span> customer_id <span class="kw">AS</span> customer</span>
<span id="cb270-3"><a href="#cb270-3"></a><span class="kw">FROM</span>   purchases</span>
<span id="cb270-4"><a href="#cb270-4"></a><span class="kw">GROUP</span>  <span class="kw">BY</span> <span class="dv">1</span></span>
<span id="cb270-5"><a href="#cb270-5"></a><span class="kw">ORDER</span>  <span class="kw">BY</span> <span class="dv">1</span>;</span>
<span id="cb270-6"><a href="#cb270-6"></a></span>
<span id="cb270-7"><a href="#cb270-7"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> customer <span class="kw">ADD</span> <span class="kw">CONSTRAINT</span> customer_customer_id_pkey <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (customer_id);</span>
<span id="cb270-8"><a href="#cb270-8"></a></span>
<span id="cb270-9"><a href="#cb270-9"></a>VACUUM <span class="kw">ANALYZE</span> customer;</span></code></pre></div>
<p>In my <strong>second test</strong> for 9.5 I used the same setup, but with <code>random() * 100000</code> to generate <code>customer_id</code> to get only few rows per <code>customer_id</code>.</p>
<h5>
Object sizes for table <code>purchases</code>
</h3>
<p>Generated with <a href="https://dba.stackexchange.com/questions/23879/measure-the-size-of-a-postgresql-table-row/23933#23933">this query</a>.</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb271-1"><a href="#cb271-1"></a>               what                | bytes<span class="op">/</span>ct | bytes_pretty | bytes_per_row</span>
<span id="cb271-2"><a href="#cb271-2"></a><span class="co">-----------------------------------+----------+--------------+---------------</span></span>
<span id="cb271-3"><a href="#cb271-3"></a> core_relation_size                | <span class="dv">20496384</span> | <span class="dv">20</span> MB        |           <span class="dv">102</span></span>
<span id="cb271-4"><a href="#cb271-4"></a> visibility_map                    |        <span class="dv">0</span> | <span class="dv">0</span> bytes      |             <span class="dv">0</span></span>
<span id="cb271-5"><a href="#cb271-5"></a> free_space_map                    |    <span class="dv">24576</span> | <span class="dv">24</span> kB        |             <span class="dv">0</span></span>
<span id="cb271-6"><a href="#cb271-6"></a> table_size_incl_toast             | <span class="dv">20529152</span> | <span class="dv">20</span> MB        |           <span class="dv">102</span></span>
<span id="cb271-7"><a href="#cb271-7"></a> indexes_size                      | <span class="dv">10977280</span> | <span class="dv">10</span> MB        |            <span class="dv">54</span></span>
<span id="cb271-8"><a href="#cb271-8"></a> total_size_incl_toast_and_indexes | <span class="dv">31506432</span> | <span class="dv">30</span> MB        |           <span class="dv">157</span></span>
<span id="cb271-9"><a href="#cb271-9"></a> live_rows_in_text_representation  | <span class="dv">13729802</span> | <span class="dv">13</span> MB        |            <span class="dv">68</span></span>
<span id="cb271-10"><a href="#cb271-10"></a> <span class="co">------------------------------    |          |              |</span></span>
<span id="cb271-11"><a href="#cb271-11"></a> row_count                         |   <span class="dv">200045</span> |              |</span>
<span id="cb271-12"><a href="#cb271-12"></a> live_tuples                       |   <span class="dv">200045</span> |              |</span>
<span id="cb271-13"><a href="#cb271-13"></a> dead_tuples                       |    <span class="dv">19955</span> |              |</span></code></pre></div>
<h5>
Queries
</h1>
<h5>
<ol type="1">
<li><code>row_number()</code> in CTE, (<a href="https://stackoverflow.com/a/3800572/939860">see other answer</a>)
</h3></li>
</ol>
<div class="sourceCode" id="cb272"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb272-1"><a href="#cb272-1"></a><span class="kw">WITH</span> cte <span class="kw">AS</span> (</span>
<span id="cb272-2"><a href="#cb272-2"></a>   <span class="kw">SELECT</span> <span class="kw">id</span>, customer_id, total</span>
<span id="cb272-3"><a href="#cb272-3"></a>        , <span class="fu">row_number</span>() <span class="kw">OVER</span>(<span class="kw">PARTITION</span> <span class="kw">BY</span> customer_id <span class="kw">ORDER</span> <span class="kw">BY</span> total <span class="kw">DESC</span>) <span class="kw">AS</span> rn</span>
<span id="cb272-4"><a href="#cb272-4"></a>   <span class="kw">FROM</span>   purchases</span>
<span id="cb272-5"><a href="#cb272-5"></a>   )</span>
<span id="cb272-6"><a href="#cb272-6"></a><span class="kw">SELECT</span> <span class="kw">id</span>, customer_id, total</span>
<span id="cb272-7"><a href="#cb272-7"></a><span class="kw">FROM</span>   cte</span>
<span id="cb272-8"><a href="#cb272-8"></a><span class="kw">WHERE</span>  rn <span class="op">=</span> <span class="dv">1</span>;</span></code></pre></div>
<h5>
<ol start="2" type="1">
<li><code>row_number()</code> in subquery (my optimization)
</h3></li>
</ol>
<div class="sourceCode" id="cb273"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb273-1"><a href="#cb273-1"></a><span class="kw">SELECT</span> <span class="kw">id</span>, customer_id, total</span>
<span id="cb273-2"><a href="#cb273-2"></a><span class="kw">FROM</span>   (</span>
<span id="cb273-3"><a href="#cb273-3"></a>   <span class="kw">SELECT</span> <span class="kw">id</span>, customer_id, total</span>
<span id="cb273-4"><a href="#cb273-4"></a>        , <span class="fu">row_number</span>() <span class="kw">OVER</span>(<span class="kw">PARTITION</span> <span class="kw">BY</span> customer_id <span class="kw">ORDER</span> <span class="kw">BY</span> total <span class="kw">DESC</span>) <span class="kw">AS</span> rn</span>
<span id="cb273-5"><a href="#cb273-5"></a>   <span class="kw">FROM</span>   purchases</span>
<span id="cb273-6"><a href="#cb273-6"></a>   ) sub</span>
<span id="cb273-7"><a href="#cb273-7"></a><span class="kw">WHERE</span>  rn <span class="op">=</span> <span class="dv">1</span>;</span></code></pre></div>
<h5>
<ol start="3" type="1">
<li><code>DISTINCT ON</code> (<a href="https://stackoverflow.com/a/7630564/939860">see other answer</a>)
</h3></li>
</ol>
<div class="sourceCode" id="cb274"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb274-1"><a href="#cb274-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> <span class="kw">ON</span> (customer_id)</span>
<span id="cb274-2"><a href="#cb274-2"></a>       <span class="kw">id</span>, customer_id, total</span>
<span id="cb274-3"><a href="#cb274-3"></a><span class="kw">FROM</span>   purchases</span>
<span id="cb274-4"><a href="#cb274-4"></a><span class="kw">ORDER</span>  <span class="kw">BY</span> customer_id, total <span class="kw">DESC</span>, <span class="kw">id</span>;</span></code></pre></div>
<h5>
<ol start="4" type="1">
<li>rCTE with <code>LATERAL</code> subquery (<a href="https://stackoverflow.com/a/25536748/939860">see here</a>)
</h3></li>
</ol>
<div class="sourceCode" id="cb275"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb275-1"><a href="#cb275-1"></a><span class="kw">WITH</span> RECURSIVE cte <span class="kw">AS</span> (</span>
<span id="cb275-2"><a href="#cb275-2"></a>   (  <span class="co">-- parentheses required</span></span>
<span id="cb275-3"><a href="#cb275-3"></a>   <span class="kw">SELECT</span> <span class="kw">id</span>, customer_id, total</span>
<span id="cb275-4"><a href="#cb275-4"></a>   <span class="kw">FROM</span>   purchases</span>
<span id="cb275-5"><a href="#cb275-5"></a>   <span class="kw">ORDER</span>  <span class="kw">BY</span> customer_id, total <span class="kw">DESC</span></span>
<span id="cb275-6"><a href="#cb275-6"></a>   <span class="kw">LIMIT</span>  <span class="dv">1</span></span>
<span id="cb275-7"><a href="#cb275-7"></a>   )</span>
<span id="cb275-8"><a href="#cb275-8"></a>   <span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb275-9"><a href="#cb275-9"></a>   <span class="kw">SELECT</span> u.<span class="op">*</span></span>
<span id="cb275-10"><a href="#cb275-10"></a>   <span class="kw">FROM</span>   cte c</span>
<span id="cb275-11"><a href="#cb275-11"></a>   ,      LATERAL (</span>
<span id="cb275-12"><a href="#cb275-12"></a>      <span class="kw">SELECT</span> <span class="kw">id</span>, customer_id, total</span>
<span id="cb275-13"><a href="#cb275-13"></a>      <span class="kw">FROM</span>   purchases</span>
<span id="cb275-14"><a href="#cb275-14"></a>      <span class="kw">WHERE</span>  customer_id <span class="op">&gt;</span> c.customer_id  <span class="co">-- lateral reference</span></span>
<span id="cb275-15"><a href="#cb275-15"></a>      <span class="kw">ORDER</span>  <span class="kw">BY</span> customer_id, total <span class="kw">DESC</span></span>
<span id="cb275-16"><a href="#cb275-16"></a>      <span class="kw">LIMIT</span>  <span class="dv">1</span></span>
<span id="cb275-17"><a href="#cb275-17"></a>      ) u</span>
<span id="cb275-18"><a href="#cb275-18"></a>   )</span>
<span id="cb275-19"><a href="#cb275-19"></a><span class="kw">SELECT</span> <span class="kw">id</span>, customer_id, total</span>
<span id="cb275-20"><a href="#cb275-20"></a><span class="kw">FROM</span>   cte</span>
<span id="cb275-21"><a href="#cb275-21"></a><span class="kw">ORDER</span>  <span class="kw">BY</span> customer_id;</span></code></pre></div>
<h5>
<ol start="5" type="1">
<li><code>customer</code> table with <code>LATERAL</code> (<a href="https://stackoverflow.com/a/25536748/939860">see here</a>)
</h3></li>
</ol>
<div class="sourceCode" id="cb276"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb276-1"><a href="#cb276-1"></a><span class="kw">SELECT</span> l.<span class="op">*</span></span>
<span id="cb276-2"><a href="#cb276-2"></a><span class="kw">FROM</span>   customer c</span>
<span id="cb276-3"><a href="#cb276-3"></a>,      LATERAL (</span>
<span id="cb276-4"><a href="#cb276-4"></a>   <span class="kw">SELECT</span> <span class="kw">id</span>, customer_id, total</span>
<span id="cb276-5"><a href="#cb276-5"></a>   <span class="kw">FROM</span>   purchases</span>
<span id="cb276-6"><a href="#cb276-6"></a>   <span class="kw">WHERE</span>  customer_id <span class="op">=</span> c.customer_id  <span class="co">-- lateral reference</span></span>
<span id="cb276-7"><a href="#cb276-7"></a>   <span class="kw">ORDER</span>  <span class="kw">BY</span> total <span class="kw">DESC</span></span>
<span id="cb276-8"><a href="#cb276-8"></a>   <span class="kw">LIMIT</span>  <span class="dv">1</span></span>
<span id="cb276-9"><a href="#cb276-9"></a>   ) l;</span></code></pre></div>
<h5>
<ol start="6" type="1">
<li><code>array_agg()</code> with <code>ORDER BY</code> (<a href="https://stackoverflow.com/a/25534279/939860">see other answer</a>)
</h3></li>
</ol>
<div class="sourceCode" id="cb277"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb277-1"><a href="#cb277-1"></a><span class="kw">SELECT</span> (array_agg(<span class="kw">id</span> <span class="kw">ORDER</span> <span class="kw">BY</span> total <span class="kw">DESC</span>))[<span class="dv">1</span>] <span class="kw">AS</span> <span class="kw">id</span></span>
<span id="cb277-2"><a href="#cb277-2"></a>     , customer_id</span>
<span id="cb277-3"><a href="#cb277-3"></a>     , <span class="fu">max</span>(total) <span class="kw">AS</span> total</span>
<span id="cb277-4"><a href="#cb277-4"></a><span class="kw">FROM</span>   purchases</span>
<span id="cb277-5"><a href="#cb277-5"></a><span class="kw">GROUP</span>  <span class="kw">BY</span> customer_id;</span></code></pre></div>
<h5>
Results
</h1>
<p>Execution time for above queries with <code>EXPLAIN ANALYZE</code> (and all options <em>off</em>), <em>best of 5 runs</em>.</p>
<p><em>All</em> queries used an <strong>Index Only Scan</strong> on <code>purchases2_3c_idx</code> (among other steps). Some of them just for the smaller size of the index, others more effectively.</p>
<h5>
A. Postgres 9.4 with 200k rows and ~ 20 per <code>customer_id</code>
</h3>
<div class="sourceCode" id="cb278"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb278-1"><a href="#cb278-1"></a><span class="fl">1.</span> <span class="fl">273.274</span> ms  </span>
<span id="cb278-2"><a href="#cb278-2"></a><span class="fl">2.</span> <span class="fl">194.572</span> ms  </span>
<span id="cb278-3"><a href="#cb278-3"></a><span class="fl">3.</span> <span class="fl">111.067</span> ms  </span>
<span id="cb278-4"><a href="#cb278-4"></a><span class="fl">4.</span>  <span class="fl">92.922</span> ms  </span>
<span id="cb278-5"><a href="#cb278-5"></a><span class="fl">5.</span>  <span class="fl">37.679</span> ms  <span class="co">-- winner</span></span>
<span id="cb278-6"><a href="#cb278-6"></a><span class="fl">6.</span> <span class="fl">189.495</span> ms</span></code></pre></div>
<h5>
B. The same with Postgres 9.5
</h3>
<div class="sourceCode" id="cb279"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb279-1"><a href="#cb279-1"></a><span class="fl">1.</span> <span class="fl">288.006</span> ms</span>
<span id="cb279-2"><a href="#cb279-2"></a><span class="fl">2.</span> <span class="fl">223.032</span> ms  </span>
<span id="cb279-3"><a href="#cb279-3"></a><span class="fl">3.</span> <span class="fl">107.074</span> ms  </span>
<span id="cb279-4"><a href="#cb279-4"></a><span class="fl">4.</span>  <span class="fl">78.032</span> ms  </span>
<span id="cb279-5"><a href="#cb279-5"></a><span class="fl">5.</span>  <span class="fl">33.944</span> ms  <span class="co">-- winner</span></span>
<span id="cb279-6"><a href="#cb279-6"></a><span class="fl">6.</span> <span class="fl">211.540</span> ms  </span></code></pre></div>
<h5>
C. Same as B., but with ~ 2.3 rows per <code>customer_id</code>
</h3>
<div class="sourceCode" id="cb280"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb280-1"><a href="#cb280-1"></a><span class="fl">1.</span> <span class="fl">381.573</span> ms</span>
<span id="cb280-2"><a href="#cb280-2"></a><span class="fl">2.</span> <span class="fl">311.976</span> ms</span>
<span id="cb280-3"><a href="#cb280-3"></a><span class="fl">3.</span> <span class="fl">124.074</span> ms  <span class="co">-- winner</span></span>
<span id="cb280-4"><a href="#cb280-4"></a><span class="fl">4.</span> <span class="fl">710.631</span> ms</span>
<span id="cb280-5"><a href="#cb280-5"></a><span class="fl">5.</span> <span class="fl">311.976</span> ms</span>
<span id="cb280-6"><a href="#cb280-6"></a><span class="fl">6.</span> <span class="fl">421.679</span> ms</span></code></pre></div>
<hr>
<h5>
Related benchmarks
</h2>
<p>Here is a new one by “ogr” testing with <strong>10M rows and 60k unique “customers”</strong> on <strong>Postgres 11.5</strong> (current as of Sep. 2019). Results are still in line with what we have seen so far:</p>
<ul>
<li>
<a href="https://stackoverflow.com/questions/57893251/proper-way-to-access-latest-row-for-each-individual-identifier/57975451#57975451">Proper way to access latest row for each individual identifier?</a>
</li>
</ul>
<h5>
Original (outdated) benchmark from 2011
</h3>
<p>
I ran three tests with PostgreSQL <strong>9.1</strong> on a real life table of 65579 rows and single-column btree indexes on each of the three columns involved and took the best <em>execution time</em> of 5 runs.<br> Comparing <a href="https://stackoverflow.com/a/3800572/939860"><span class="citation" data-cites="OMGPonies">@OMGPonies</span>’</a> first query (<strong><code>A</code></strong>) to the <a href="https://stackoverflow.com/a/7630564/939860">above <code>DISTINCT ON</code> solution</a> (<strong><code>B</code></strong>):
</p>
<ol>
<li>
<p>
Select the whole table, results in 5958 rows in this case.
</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb281-1"><a href="#cb281-1"></a>A: <span class="fl">567.218</span> ms</span>
<span id="cb281-2"><a href="#cb281-2"></a>B: <span class="fl">386.673</span> ms</span>
<span id="cb281-3"><a href="#cb281-3"></a>```<span class="op">&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb281-4"><a href="#cb281-4"></a><span class="op">&lt;</span>li<span class="op">&gt;&lt;</span>p<span class="op">&gt;</span><span class="kw">Use</span> condition `WHERE customer <span class="kw">BETWEEN</span> x <span class="kw">AND</span> y` resulting <span class="kw">in</span> <span class="dv">1000</span> <span class="kw">rows</span>.<span class="op">&lt;/</span>p<span class="op">&gt;</span></span>
<span id="cb281-5"><a href="#cb281-5"></a></span>
<span id="cb281-6"><a href="#cb281-6"></a>```sql</span>
<span id="cb281-7"><a href="#cb281-7"></a>A: <span class="fl">249.136</span> ms</span>
<span id="cb281-8"><a href="#cb281-8"></a>B:  <span class="fl">55.111</span> ms</span>
<span id="cb281-9"><a href="#cb281-9"></a>```<span class="op">&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb281-10"><a href="#cb281-10"></a><span class="op">&lt;</span>li<span class="op">&gt;&lt;</span>p<span class="op">&gt;</span><span class="kw">Select</span> a <span class="dt">single</span> customer <span class="kw">with</span> `WHERE customer <span class="op">=</span> x`.<span class="op">&lt;/</span>p<span class="op">&gt;</span></span>
<span id="cb281-11"><a href="#cb281-11"></a></span>
<span id="cb281-12"><a href="#cb281-12"></a>```sql</span>
<span id="cb281-13"><a href="#cb281-13"></a>A:   <span class="fl">0.143</span> ms</span>
<span id="cb281-14"><a href="#cb281-14"></a>B:   <span class="fl">0.072</span> ms</span>
<span id="cb281-15"><a href="#cb281-15"></a>```<span class="op">&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb281-16"><a href="#cb281-16"></a><span class="op">&lt;/</span>ol<span class="op">&gt;</span></span>
<span id="cb281-17"><a href="#cb281-17"></a></span>
<span id="cb281-18"><a href="#cb281-18"></a>Same test repeated <span class="kw">with</span> <span class="kw">the</span> <span class="kw">index</span> described <span class="kw">in</span> <span class="kw">the</span> other answer  </span>
<span id="cb281-19"><a href="#cb281-19"></a></span>
<span id="cb281-20"><a href="#cb281-20"></a>```sql</span>
<span id="cb281-21"><a href="#cb281-21"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> purchases_3c_idx <span class="kw">ON</span> purchases (customer, total <span class="kw">DESC</span>, <span class="kw">id</span>);</span></code></pre></div>
</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb282-1"><a href="#cb282-1"></a>1A: <span class="fl">277.953</span> ms  </span>
<span id="cb282-2"><a href="#cb282-2"></a>1B: <span class="fl">193.547</span> ms</span>
<span id="cb282-3"><a href="#cb282-3"></a></span>
<span id="cb282-4"><a href="#cb282-4"></a>2A: <span class="fl">249.796</span> ms <span class="co">-- special index not used  </span></span>
<span id="cb282-5"><a href="#cb282-5"></a>2B:  <span class="fl">28.679</span> ms</span>
<span id="cb282-6"><a href="#cb282-6"></a></span>
<span id="cb282-7"><a href="#cb282-7"></a>3A:   <span class="fl">0.120</span> ms  </span>
<span id="cb282-8"><a href="#cb282-8"></a>3B:   <span class="fl">0.048</span> ms</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-to-insert-a-line-break-in-a-sql-server-varcharnvarchar-string-score-920209-in-2013" class="level3">
<h3>44: How to insert a line break in a SQL Server VARCHAR/NVARCHAR string (score <a href="https://stackoverflow.com/q/31057.html">920209</a> in 2013)</h3>
<section id="question-43" class="level4">
<h4>Question</h4>
<p>I didn’t see any similar questions asked on this topic, and I had to research this for something I’m working on right now. Thought I would post the answer for it in case anyone else had the same question.</p>
</section>
<section id="answer-accepted-score-260" class="level4">
<h4>Answer accepted (score 260)</h4>
<p>I found the answer here: <a href="http://blog.sqlauthority.com/2007/08/22/sql-server-t-sql-script-to-insert-carriage-return-and-new-line-feed-in-code/" rel="noreferrer">http://blog.sqlauthority.com/2007/08/22/sql-server-t-sql-script-to-insert-carriage-return-and-new-line-feed-in-code/</a></p>
<p>You just concatenate the string and insert a <code>CHAR(13)</code> where you want your line break.</p>
<p>Example:</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb283-1"><a href="#cb283-1"></a><span class="kw">DECLARE</span> @text <span class="dt">NVARCHAR</span>(<span class="dv">100</span>)</span>
<span id="cb283-2"><a href="#cb283-2"></a><span class="kw">SET</span> @text <span class="op">=</span> <span class="st">&#39;This is line 1.&#39;</span> <span class="op">+</span> <span class="dt">CHAR</span>(<span class="dv">13</span>) <span class="op">+</span> <span class="st">&#39;This is line 2.&#39;</span></span>
<span id="cb283-3"><a href="#cb283-3"></a><span class="kw">SELECT</span> @text</span></code></pre></div>
<p>This prints out the following:</p>
<blockquote>
<p>
This is line 1.<br> This is line 2.
</p>
</blockquote>
</section>
<section id="answer-2-score-559" class="level4">
<h4>Answer 2 (score 559)</h4>
<p><code>char(13)</code> is <code>CR</code>. For DOS-/Windows-style <code>CRLF</code> linebreaks, you want <code>char(13)+char(10)</code>, like:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb284-1"><a href="#cb284-1"></a><span class="st">&#39;This is line 1.&#39;</span> <span class="op">+</span> <span class="dt">CHAR</span>(<span class="dv">13</span>)<span class="op">+</span><span class="dt">CHAR</span>(<span class="dv">10</span>) <span class="op">+</span> <span class="st">&#39;This is line 2.&#39;</span></span></code></pre></div>
</section>
<section id="answer-3-score-80" class="level4">
<h4>Answer 3 (score 80)</h4>
<p>Another way to do this is as such:</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb285-1"><a href="#cb285-1"></a><span class="kw">INSERT</span> CRLF <span class="kw">SELECT</span> <span class="st">&#39;fox </span></span>
<span id="cb285-2"><a href="#cb285-2"></a><span class="st">jumped&#39;</span></span></code></pre></div>
<p>That is, simply inserting a line break in your query while writing it will add the like break to the database. This works in SQL server Management studio and Query Analyzer. I believe this will also work in C# if you use the @ sign on strings.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb286-1"><a href="#cb286-1"></a>string str <span class="op">=</span> @<span class="ot">&quot;INSERT CRLF SELECT &#39;fox </span></span>
<span id="cb286-2"><a href="#cb286-2"></a>    jumped<span class="st">&#39;&quot;</span></span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-do-i-see-active-sql-server-connections-score-917310-in-2019" class="level3">
<h3>45: How do I see active SQL Server connections? (score <a href="https://stackoverflow.com/q/1248423.html">917310</a> in 2019)</h3>
<section id="question-44" class="level4">
<h4>Question</h4>
<p>I am using SQL Server 2008 Enterprise. I want to see any active SQL Server connections, and the related information of all the connections, like from which IP address, connect to which database or something.</p>
<p>Are there existing commands to solve this issue?</p>
</section>
<section id="answer-accepted-score-329" class="level4">
<h4>Answer accepted (score 329)</h4>
<p>You can use the <a href="http://msdn.microsoft.com/en-us/library/ms174313.aspx" rel="noreferrer"><code>sp_who</code></a> stored procedure.</p>
<blockquote>
Provides information about current users, sessions, and processes in an instance of the Microsoft SQL Server Database Engine. The information can be filtered to return only those processes that are not idle, that belong to a specific user, or that belong to a specific session.
</blockquote>
</section>
<section id="answer-2-score-313" class="level4">
<h4>Answer 2 (score 313)</h4>
<div class="sourceCode" id="cb287"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb287-1"><a href="#cb287-1"></a><span class="kw">SELECT</span> </span>
<span id="cb287-2"><a href="#cb287-2"></a>    DB_NAME(dbid) <span class="kw">as</span> DBName, </span>
<span id="cb287-3"><a href="#cb287-3"></a>    <span class="fu">COUNT</span>(dbid) <span class="kw">as</span> NumberOfConnections,</span>
<span id="cb287-4"><a href="#cb287-4"></a>    loginame <span class="kw">as</span> LoginName</span>
<span id="cb287-5"><a href="#cb287-5"></a><span class="kw">FROM</span></span>
<span id="cb287-6"><a href="#cb287-6"></a>    sys.sysprocesses</span>
<span id="cb287-7"><a href="#cb287-7"></a><span class="kw">WHERE</span> </span>
<span id="cb287-8"><a href="#cb287-8"></a>    dbid <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb287-9"><a href="#cb287-9"></a><span class="kw">GROUP</span> <span class="kw">BY</span> </span>
<span id="cb287-10"><a href="#cb287-10"></a>    dbid, loginame</span>
<span id="cb287-11"><a href="#cb287-11"></a>;</span></code></pre></div>
<p>See also the Microsoft documentation for <a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-compatibility-views/sys-sysprocesses-transact-sql" rel="noreferrer">sys.sysprocesses</a>.</p>
</section>
<section id="answer-3-score-51" class="level4">
<h4>Answer 3 (score 51)</h4>
<p>Apart from <code>sp_who</code>, you can also use the “undocumented” <code>sp_who2</code> system stored procedure which gives you more detailed information. See <em><a href="http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=100099" rel="noreferrer">Difference between sp_who and sp_who2</a></em>.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="getting-only-month-and-year-from-sql-date-score-894623-in-2018" class="level3">
<h3>46: Getting only Month and Year from SQL DATE (score <a href="https://stackoverflow.com/q/1781946.html">894623</a> in 2018)</h3>
<section id="question-45" class="level4">
<h4>Question</h4>
<p>I need to access only Month.Year from Date field in SQL Server.</p>
</section>
<section id="answer-accepted-score-157" class="level4">
<h4>Answer accepted (score 157)</h4>
<p>
As well as the suggestions given already, there is one other possiblity I can infer from your question:<br> - You still want the result to be a date<br> - But you want to ‘discard’ the Days, Hours, etc<br> - Leaving a year/month only date field
</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb288-1"><a href="#cb288-1"></a><span class="kw">SELECT</span></span>
<span id="cb288-2"><a href="#cb288-2"></a>   DATEADD(<span class="dt">MONTH</span>, DATEDIFF(<span class="dt">MONTH</span>, <span class="dv">0</span>, <span class="op">&lt;</span>dateField<span class="op">&gt;</span>), <span class="dv">0</span>) <span class="kw">AS</span> [year_month_date_field]</span>
<span id="cb288-3"><a href="#cb288-3"></a><span class="kw">FROM</span></span>
<span id="cb288-4"><a href="#cb288-4"></a>   <span class="op">&lt;</span>your_table<span class="op">&gt;</span></span></code></pre></div>
<p>This gets the number of whole months from a base date (0) and then adds them to that base date. Thus rounding Down to the month in which the date is in.</p>
<p>
NOTE: In SQL Server 2008, You will still have the TIME attached as 00:00:00.000 This is not exactly the same as “removing” any notation of day and time altogether. Also the DAY set to the first. e.g. 2009-10-01 00:00:00.000
</p>
</section>
<section id="answer-2-score-120" class="level4">
<h4>Answer 2 (score 120)</h4>
<div class="sourceCode" id="cb289"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb289-1"><a href="#cb289-1"></a><span class="kw">select</span> <span class="dt">month</span>(dateField), <span class="dt">year</span>(dateField)</span></code></pre></div>
</section>
<section id="answer-3-score-32" class="level4">
<h4>Answer 3 (score 32)</h4>
<div class="sourceCode" id="cb290"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb290-1"><a href="#cb290-1"></a><span class="kw">SELECT</span> DATEPART(yy, DateVal)</span>
<span id="cb290-2"><a href="#cb290-2"></a><span class="kw">SELECT</span> DATEPART(MM, DateVal)</span>
<span id="cb290-3"><a href="#cb290-3"></a><span class="kw">SELECT</span> DATENAME(MM, DateVal)</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-to-query-mongodb-with-like-score-894279-in-2019" class="level3">
<h3>47: How to query MongoDB with “like”? (score <a href="https://stackoverflow.com/q/3305561.html">894279</a> in 2019)</h3>
<section id="question-46" class="level4">
<h4>Question</h4>
<p>I want to query something with SQL’s <code>like</code> query:</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb291-1"><a href="#cb291-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> users  <span class="kw">WHERE</span> name <span class="kw">LIKE</span> <span class="st">&#39;%m%&#39;</span></span></code></pre></div>
<p>How to do I achieve the same in MongoDB? I can’t find an operator for <code>like</code> in the <a href="http://www.mongodb.org/display/DOCS/Advanced+Queries" rel="noreferrer">documentation</a>.</p>
</section>
<section id="answer-accepted-score-1780" class="level4">
<h4>Answer accepted (score 1780)</h4>
<p>That would have to be:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb292-1"><a href="#cb292-1"></a>db.users.find({<span class="ot">&quot;name&quot;</span>: <span class="op">/</span>.<span class="op">*</span>m.<span class="op">*/</span>})</span></code></pre></div>
<p>or, similar:</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb293-1"><a href="#cb293-1"></a>db.users.find({<span class="ot">&quot;name&quot;</span>: <span class="op">/</span>m<span class="op">/</span>})</span></code></pre></div>
<p>You’re looking for something that contains “m” somewhere (SQL’s ‘<code>%</code>’ operator is equivalent to Regexp’s ‘<code>.*</code>’), not something that has “m” anchored to the beginning of the string.</p>
</section>
<section id="answer-2-score-330" class="level4">
<h4>Answer 2 (score 330)</h4>
<div class="sourceCode" id="cb294"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb294-1"><a href="#cb294-1"></a>db.users.<span class="kw">insert</span>({name: <span class="st">&#39;paulo&#39;</span>})</span>
<span id="cb294-2"><a href="#cb294-2"></a>db.users.<span class="kw">insert</span>({name: <span class="st">&#39;patric&#39;</span>})</span>
<span id="cb294-3"><a href="#cb294-3"></a>db.users.<span class="kw">insert</span>({name: <span class="st">&#39;pedro&#39;</span>})</span>
<span id="cb294-4"><a href="#cb294-4"></a></span>
<span id="cb294-5"><a href="#cb294-5"></a>db.users.find({name: <span class="op">/</span>a<span class="op">/</span>})  <span class="op">//</span><span class="kw">like</span> <span class="st">&#39;%a%&#39;</span></span></code></pre></div>
<p>out: paulo, patric</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb295-1"><a href="#cb295-1"></a>db.users.find({name: <span class="op">/</span>^pa<span class="op">/</span>}) <span class="op">//</span><span class="kw">like</span> <span class="st">&#39;pa%&#39;</span> </span></code></pre></div>
<p>out: paulo, patric</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb296-1"><a href="#cb296-1"></a>db.users.find({name: <span class="op">/</span>ro$<span class="op">/</span>}) <span class="op">//</span><span class="kw">like</span> <span class="st">&#39;%ro&#39;</span></span></code></pre></div>
<p>out: pedro</p>
</section>
<section id="answer-3-score-250" class="level4">
<h4>Answer 3 (score 250)</h4>
<p>In</p>
<ul>
<li>
<strong>PyMongo</strong> using <strong>Python</strong>
</li>
<li>
<strong>Mongoose</strong> using <strong>Node.js</strong>
</li>
<li>
<strong>Jongo</strong>, using <strong>Java</strong>
</li>
<li>
<strong>mgo</strong>, using <strong>Go</strong>
</li>
</ul>
<p>you can do:</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb297-1"><a href="#cb297-1"></a>db.users.find({<span class="st">&#39;name&#39;</span>: {<span class="st">&#39;$regex&#39;</span>: <span class="st">&#39;sometext&#39;</span>}})</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="convert-date-format-into-ddmmmyyyy-format-in-sql-server-score-891524-in-2016" class="level3">
<h3>48: Convert Date format into DD/MMM/YYYY format in SQL Server (score <a href="https://stackoverflow.com/q/17205441.html">891524</a> in 2016)</h3>
<section id="question-47" class="level4">
<h4>Question</h4>
<p>I have a query in sql, I have to get date in a format of <code>dd/mmm/yy</code></p>
<p>Example: <code>25/jun/2013</code>.</p>
<p>How can I convert it for SQL server?</p>
</section>
<section id="answer-accepted-score-63" class="level4">
<h4>Answer accepted (score 63)</h4>
<p>I’m not sure there is an exact match for the format you want. But you can get close with <a href="http://msdn.microsoft.com/en-us/library/ms187928.aspx" rel="noreferrer"><code>convert()</code></a> and style <code>106</code>. Then, replace the spaces:</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb298-1"><a href="#cb298-1"></a><span class="kw">SELECT</span> <span class="kw">replace</span>(<span class="fu">convert</span>(<span class="dt">NVARCHAR</span>, getdate(), <span class="dv">106</span>), <span class="st">&#39; &#39;</span>, <span class="st">&#39;/&#39;</span>)</span></code></pre></div>
</section>
<section id="answer-2-score-44-1" class="level4">
<h4>Answer 2 (score 44)</h4>
<p>There are already <a href="https://msdn.microsoft.com/en-us/library/ms187928.aspx">multiple answers and formatting types</a> for SQL server 2008. But this method somewhat ambiguous and it would be difficult for you to remember the number with respect to Specific Date Format. That’s why in next versions of SQL server there is better option.</p>
<h5>
If you are using SQL Server 2012 or above versions, you should use <a href="https://msdn.microsoft.com/en-us/library/hh213505.aspx">Format() function</a>
</h2>
<div class="sourceCode" id="cb299"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb299-1"><a href="#cb299-1"></a>FORMAT ( <span class="fu">value</span>, format [, culture ] )</span></code></pre></div>
<p>With culture option, you can specify date as per your viewers.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb300-1"><a href="#cb300-1"></a><span class="kw">DECLARE</span> @d DATETIME <span class="op">=</span> <span class="st">&#39;10/01/2011&#39;</span>;</span>
<span id="cb300-2"><a href="#cb300-2"></a><span class="kw">SELECT</span> FORMAT ( @d, <span class="st">&#39;d&#39;</span>, <span class="st">&#39;en-US&#39;</span> ) <span class="kw">AS</span> <span class="st">&#39;US English Result&#39;</span></span>
<span id="cb300-3"><a href="#cb300-3"></a>      ,FORMAT ( @d, <span class="st">&#39;d&#39;</span>, <span class="st">&#39;en-gb&#39;</span> ) <span class="kw">AS</span> <span class="st">&#39;Great Britain English Result&#39;</span></span>
<span id="cb300-4"><a href="#cb300-4"></a>      ,FORMAT ( @d, <span class="st">&#39;d&#39;</span>, <span class="st">&#39;de-de&#39;</span> ) <span class="kw">AS</span> <span class="st">&#39;German Result&#39;</span></span>
<span id="cb300-5"><a href="#cb300-5"></a>      ,FORMAT ( @d, <span class="st">&#39;d&#39;</span>, <span class="st">&#39;zh-cn&#39;</span> ) <span class="kw">AS</span> <span class="st">&#39;Simplified Chinese (PRC) Result&#39;</span>; </span>
<span id="cb300-6"><a href="#cb300-6"></a></span>
<span id="cb300-7"><a href="#cb300-7"></a><span class="kw">SELECT</span> FORMAT ( @d, <span class="st">&#39;D&#39;</span>, <span class="st">&#39;en-US&#39;</span> ) <span class="kw">AS</span> <span class="st">&#39;US English Result&#39;</span></span>
<span id="cb300-8"><a href="#cb300-8"></a>      ,FORMAT ( @d, <span class="st">&#39;D&#39;</span>, <span class="st">&#39;en-gb&#39;</span> ) <span class="kw">AS</span> <span class="st">&#39;Great Britain English Result&#39;</span></span>
<span id="cb300-9"><a href="#cb300-9"></a>      ,FORMAT ( @d, <span class="st">&#39;D&#39;</span>, <span class="st">&#39;de-de&#39;</span> ) <span class="kw">AS</span> <span class="st">&#39;German Result&#39;</span></span>
<span id="cb300-10"><a href="#cb300-10"></a>      ,FORMAT ( @d, <span class="st">&#39;D&#39;</span>, <span class="st">&#39;zh-cn&#39;</span> ) <span class="kw">AS</span> <span class="st">&#39;Chinese (Simplified PRC) Result&#39;</span>;</span>
<span id="cb300-11"><a href="#cb300-11"></a></span>
<span id="cb300-12"><a href="#cb300-12"></a>US English Result Great Britain English Result  German Result Simplified Chinese (PRC) Result</span>
<span id="cb300-13"><a href="#cb300-13"></a><span class="co">----------------  ----------------------------- ------------- -------------------------------------</span></span>
<span id="cb300-14"><a href="#cb300-14"></a><span class="dv">10</span><span class="op">/</span><span class="dv">1</span><span class="op">/</span><span class="dv">2011</span>         <span class="dv">01</span><span class="op">/</span><span class="dv">10</span><span class="op">/</span><span class="dv">2011</span>                    <span class="dv">01</span>.<span class="fl">10.2011</span>    <span class="dv">2011</span><span class="op">/</span><span class="dv">10</span><span class="op">/</span><span class="dv">1</span></span>
<span id="cb300-15"><a href="#cb300-15"></a></span>
<span id="cb300-16"><a href="#cb300-16"></a>US English Result            Great Britain English Result  German Result                    Chinese (Simplified PRC) Result</span>
<span id="cb300-17"><a href="#cb300-17"></a><span class="co">---------------------------- ----------------------------- -----------------------------  ---------------------------------------</span></span>
<span id="cb300-18"><a href="#cb300-18"></a>Saturday, October <span class="dv">01</span>, <span class="dv">2011</span>   <span class="dv">01</span> October <span class="dv">2011</span>               Samstag, <span class="fl">1.</span> Oktober <span class="dv">2011</span>        2011年10月1日</span></code></pre></div>
<p>For OP’s solution, we can use following format, which is already mentioned by <span class="citation" data-cites="Martin">@Martin</span> Smith:</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb301-1"><a href="#cb301-1"></a>FORMAT(GETDATE(), <span class="st">&#39;dd/MMM/yyyy&#39;</span>, <span class="st">&#39;en-us&#39;</span>)</span></code></pre></div>
<p>Some sample date formats:</p>
<p><a href="https://i.stack.imgur.com/07jfP.png"><img src="https://i.stack.imgur.com/07jfP.png" alt="enter image description here"></a></p>
<p>If you want more date formats of SQL server, you should visit:</p>
<ol>
<li>
<a href="https://msdn.microsoft.com/en-us/library/8kb3ddd4(v=vs.110).aspx">Custom Date and Time Format</a>
</li>
<li>
<a href="https://msdn.microsoft.com/en-us/library/az4se3k1(v=vs.110).aspx">Standard Date and Time Format</a>
</li>
</ol>
</section>
<section id="answer-3-score-30" class="level4">
<h4>Answer 3 (score 30)</h4>
<p>we can convert date into many formats like</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb302-1"><a href="#cb302-1"></a><span class="kw">SELECT</span> <span class="fu">convert</span>(<span class="dt">varchar</span>, getdate(), <span class="dv">106</span>)</span></code></pre></div>
<p>This returns <code>dd mon yyyy</code></p>
<p><a href="http://anubhavg.wordpress.com/2009/06/11/how-to-format-datetime-date-in-sql-server-2005/" rel="noreferrer">More Here</a> This may help you</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="oracle-sql-update-a-table-with-data-from-another-table-score-884573-in-2017" class="level3">
<h3>49: Oracle SQL: Update a table with data from another table (score <a href="https://stackoverflow.com/q/7030699.html">884573</a> in 2017)</h3>
<section id="question-48" class="level4">
<h4>Question</h4>
<p>Table 1:</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb303-1"><a href="#cb303-1"></a><span class="kw">id</span>    name    <span class="kw">desc</span></span>
<span id="cb303-2"><a href="#cb303-2"></a><span class="co">-----------------------</span></span>
<span id="cb303-3"><a href="#cb303-3"></a><span class="dv">1</span>     a       abc</span>
<span id="cb303-4"><a href="#cb303-4"></a><span class="dv">2</span>     b       def</span>
<span id="cb303-5"><a href="#cb303-5"></a><span class="dv">3</span>     c       adf</span></code></pre></div>
<p>Table 2:</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb304-1"><a href="#cb304-1"></a><span class="kw">id</span>    name    <span class="kw">desc</span></span>
<span id="cb304-2"><a href="#cb304-2"></a><span class="co">-----------------------</span></span>
<span id="cb304-3"><a href="#cb304-3"></a><span class="dv">1</span>     x       <span class="dv">123</span></span>
<span id="cb304-4"><a href="#cb304-4"></a><span class="dv">2</span>     y       <span class="dv">345</span></span></code></pre></div>
<p>In oracle SQL, how do I run an <strong>sql update</strong> query that can update Table 1 with Table 2’s <code>name</code> and <code>desc</code> using the same <code>id</code>? So the end result I would get is</p>
<p>Table 1:</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb305-1"><a href="#cb305-1"></a><span class="kw">id</span>    name    <span class="kw">desc</span></span>
<span id="cb305-2"><a href="#cb305-2"></a><span class="co">-----------------------</span></span>
<span id="cb305-3"><a href="#cb305-3"></a><span class="dv">1</span>     x       <span class="dv">123</span></span>
<span id="cb305-4"><a href="#cb305-4"></a><span class="dv">2</span>     y       <span class="dv">345</span></span>
<span id="cb305-5"><a href="#cb305-5"></a><span class="dv">3</span>     c       adf</span></code></pre></div>
<p>Question is taken from <a href="https://stackoverflow.com/questions/5036918/sql-update-query-with-data-from-another-table">update one table with data from another</a>, but specifically for oracle SQL.</p>
</section>
<section id="answer-accepted-score-473" class="level4">
<h4>Answer accepted (score 473)</h4>
<p>This is called a correlated update</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb306-1"><a href="#cb306-1"></a><span class="kw">UPDATE</span> table1 t1</span>
<span id="cb306-2"><a href="#cb306-2"></a>   <span class="kw">SET</span> (name, <span class="kw">desc</span>) <span class="op">=</span> (<span class="kw">SELECT</span> t2.name, t2.<span class="kw">desc</span></span>
<span id="cb306-3"><a href="#cb306-3"></a>                         <span class="kw">FROM</span> table2 t2</span>
<span id="cb306-4"><a href="#cb306-4"></a>                        <span class="kw">WHERE</span> t1.<span class="kw">id</span> <span class="op">=</span> t2.<span class="kw">id</span>)</span>
<span id="cb306-5"><a href="#cb306-5"></a> <span class="kw">WHERE</span> <span class="kw">EXISTS</span> (</span>
<span id="cb306-6"><a href="#cb306-6"></a>    <span class="kw">SELECT</span> <span class="dv">1</span></span>
<span id="cb306-7"><a href="#cb306-7"></a>      <span class="kw">FROM</span> table2 t2</span>
<span id="cb306-8"><a href="#cb306-8"></a>     <span class="kw">WHERE</span> t1.<span class="kw">id</span> <span class="op">=</span> t2.<span class="kw">id</span> )</span></code></pre></div>
<p>Assuming the join results in a key-preserved view, you could also</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb307-1"><a href="#cb307-1"></a><span class="kw">UPDATE</span> (<span class="kw">SELECT</span> t1.<span class="kw">id</span>, </span>
<span id="cb307-2"><a href="#cb307-2"></a>               t1.name name1,</span>
<span id="cb307-3"><a href="#cb307-3"></a>               t1.<span class="kw">desc</span> desc1,</span>
<span id="cb307-4"><a href="#cb307-4"></a>               t2.name name2,</span>
<span id="cb307-5"><a href="#cb307-5"></a>               t2.<span class="kw">desc</span> desc2</span>
<span id="cb307-6"><a href="#cb307-6"></a>          <span class="kw">FROM</span> table1 t1,</span>
<span id="cb307-7"><a href="#cb307-7"></a>               table2 t2</span>
<span id="cb307-8"><a href="#cb307-8"></a>         <span class="kw">WHERE</span> t1.<span class="kw">id</span> <span class="op">=</span> t2.<span class="kw">id</span>)</span>
<span id="cb307-9"><a href="#cb307-9"></a>   <span class="kw">SET</span> name1 <span class="op">=</span> name2,</span>
<span id="cb307-10"><a href="#cb307-10"></a>       desc1 <span class="op">=</span> desc2</span></code></pre></div>
</section>
<section id="answer-2-score-103" class="level4">
<h4>Answer 2 (score 103)</h4>
<p>Try this:</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb308-1"><a href="#cb308-1"></a><span class="kw">MERGE</span> <span class="kw">INTO</span> table1 t1</span>
<span id="cb308-2"><a href="#cb308-2"></a><span class="kw">USING</span></span>
<span id="cb308-3"><a href="#cb308-3"></a>(</span>
<span id="cb308-4"><a href="#cb308-4"></a><span class="co">-- For more complicated queries you can use WITH clause here</span></span>
<span id="cb308-5"><a href="#cb308-5"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> table2</span>
<span id="cb308-6"><a href="#cb308-6"></a>)t2</span>
<span id="cb308-7"><a href="#cb308-7"></a><span class="kw">ON</span>(t1.<span class="kw">id</span> <span class="op">=</span> t2.<span class="kw">id</span>)</span>
<span id="cb308-8"><a href="#cb308-8"></a><span class="cf">WHEN</span> MATCHED <span class="cf">THEN</span> <span class="kw">UPDATE</span> <span class="kw">SET</span></span>
<span id="cb308-9"><a href="#cb308-9"></a>t1.name <span class="op">=</span> t2.name,</span>
<span id="cb308-10"><a href="#cb308-10"></a>t1.<span class="kw">desc</span> <span class="op">=</span> t2.<span class="kw">desc</span>;</span></code></pre></div>
</section>
<section id="answer-3-score-17-1" class="level4">
<h4>Answer 3 (score 17)</h4>
<p>try</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb309-1"><a href="#cb309-1"></a><span class="kw">UPDATE</span> Table1 T1 <span class="kw">SET</span></span>
<span id="cb309-2"><a href="#cb309-2"></a>T1.name <span class="op">=</span> (<span class="kw">SELECT</span> T2.name <span class="kw">FROM</span> Table2 T2 <span class="kw">WHERE</span> T2.<span class="kw">id</span> <span class="op">=</span> T1.<span class="kw">id</span>),</span>
<span id="cb309-3"><a href="#cb309-3"></a>T1.<span class="kw">desc</span> <span class="op">=</span> (<span class="kw">SELECT</span> T2.<span class="kw">desc</span> <span class="kw">FROM</span> Table2 T2 <span class="kw">WHERE</span> T2.<span class="kw">id</span> <span class="op">=</span> T1.<span class="kw">id</span>)</span>
<span id="cb309-4"><a href="#cb309-4"></a><span class="kw">WHERE</span> T1.<span class="kw">id</span> <span class="kw">IN</span> (<span class="kw">SELECT</span> T2.<span class="kw">id</span> <span class="kw">FROM</span> Table2 T2 <span class="kw">WHERE</span> T2.<span class="kw">id</span> <span class="op">=</span> T1.<span class="kw">id</span>);</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="reset-identity-seed-after-deleting-records-in-sql-server-score-884214-in-2016" class="level3">
<h3>50: Reset identity seed after deleting records in SQL Server (score <a href="https://stackoverflow.com/q/21824478.html">884214</a> in 2016)</h3>
<section id="question-49" class="level4">
<h4>Question</h4>
<p>I have inserted records into a SQL Server database table. The table had a primary key defined and the auto increment identity seed is set to “Yes”. This is done primarily because in SQL Azure, each table has to have a primary key and identity defined.</p>
<p>But since I have to delete some records from the table, the identity seed for those tables will be disturbed and the index column (which is auto-generated with an increment of 1) will get disturbed.</p>
<p><strong>How can I reset the identity column after I deleted the records so that the column has sequence in ascending numerical order?</strong></p>
<p>The identity column is not used as a foreign key anywhere in database.</p>
</section>
<section id="answer-accepted-score-1001" class="level4">
<h4>Answer accepted (score 1001)</h4>
<p>The <a href="http://technet.microsoft.com/en-us/library/ms176057.aspx" rel="noreferrer"><code>DBCC CHECKIDENT</code></a> management command is used to reset identity counter. The command syntax is:</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb310-1"><a href="#cb310-1"></a>DBCC CHECKIDENT (table_name [, { NORESEED | { RESEED [, new_reseed_value ]}}])</span>
<span id="cb310-2"><a href="#cb310-2"></a>[ <span class="kw">WITH</span> NO_INFOMSGS ]</span></code></pre></div>
<p>Example:</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb311-1"><a href="#cb311-1"></a>DBCC CHECKIDENT (<span class="st">&#39;[TestTable]&#39;</span>, RESEED, <span class="dv">0</span>);</span>
<span id="cb311-2"><a href="#cb311-2"></a>GO</span></code></pre></div>
<p>It was not supported in a previous versions of Azure SQL Database, but is supported now.</p>
<hr>
<p>Please note that <code>new_reseed_value</code> argument is varied across SQL Server versions <a href="https://docs.microsoft.com/en-us/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql" rel="noreferrer">according to documentation</a>:</p>
<blockquote>
If rows are present in the table, the next row is inserted with the <em>new_reseed_value</em> value. In version SQL Server 2008 R2 and earlier, the next row inserted uses <em>new_reseed_value</em> + the current increment value.
</blockquote>
<p>However, <strong>I find this information misleading</strong> (just plain wrong actually) because observed behaviour indicates that at least SQL Server 2012 is still uses <em>new_reseed_value</em> + the current increment value logic. Microsoft even contradicts with its own <code>Example C</code> found on same page:</p>
<blockquote>
<p>C. Forcing the current identity value to a new value</p>
<p>
The following example forces the current identity value in the AddressTypeID column in the AddressType table to a value of 10. Because the table has existing rows, the next row inserted will use 11 as the value, that is, the new current increment value defined for the column value plus 1.
</p>
</blockquote>
<div class="sourceCode" id="cb312"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb312-1"><a href="#cb312-1"></a><span class="kw">USE</span> AdventureWorks2012;  </span>
<span id="cb312-2"><a href="#cb312-2"></a>GO  </span>
<span id="cb312-3"><a href="#cb312-3"></a>DBCC CHECKIDENT (<span class="st">&#39;Person.AddressType&#39;</span>, RESEED, <span class="dv">10</span>);  </span>
<span id="cb312-4"><a href="#cb312-4"></a>GO</span></code></pre></div>
<p>Still, this all leaves an option for different behaviour on newer SQL Server versions. I guess the only way to be sure, until Microsoft clear up things in its own documentation, is to do actual tests before usage.</p>
</section>
<section id="answer-2-score-200" class="level4">
<h4>Answer 2 (score 200)</h4>
<div class="sourceCode" id="cb313"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb313-1"><a href="#cb313-1"></a>DBCC CHECKIDENT (<span class="st">&#39;TestTable&#39;</span>, RESEED, <span class="dv">0</span>)</span>
<span id="cb313-2"><a href="#cb313-2"></a>GO</span></code></pre></div>
<p>Where 0 is <code>identity</code> Start value</p>
</section>
<section id="answer-3-score-80-1" class="level4">
<h4>Answer 3 (score 80)</h4>
<p>It should be noted that IF <em>all</em> of the data is being removed from the table via the <code>DELETE</code> (i.e. no <code>WHERE</code> clause), then as long as a) permissions allow for it, and b) there are no FKs referencing the table (which appears to be the case here), using <code>TRUNCATE TABLE</code> would be preferred as it does a more efficient <code>DELETE</code> <em>and</em> resets the <code>IDENTITY</code> seed at the same time. The following details are taken from the MSDN page for <a href="http://msdn.microsoft.com/en-us/library/ms177570.aspx" rel="noreferrer">TRUNCATE TABLE</a>:</p>
<blockquote>
<p>Compared to the DELETE statement, TRUNCATE TABLE has the following advantages:</p>
<ul>
<li>
<p>
Less transaction log space is used.
</p>
The DELETE statement removes rows one at a time and records an entry in the transaction log for each deleted row. TRUNCATE TABLE removes the data by deallocating the data pages used to store the table data and records only the page deallocations in the transaction log.
</li>
<li>
<p>
Fewer locks are typically used.
</p>
When the DELETE statement is executed using a row lock, each row in the table is locked for deletion. TRUNCATE TABLE always locks the table (including a schema (SCH-M) lock) and page but not each row.
</li>
<li>
<p>
Without exception, zero pages are left in the table.
</p>
After a DELETE statement is executed, the table can still contain empty pages. For example, empty pages in a heap cannot be deallocated without at least an exclusive (LCK_M_X) table lock. If the delete operation does not use a table lock, the table (heap) will contain many empty pages. For indexes, the delete operation can leave empty pages behind, although these pages will be deallocated quickly by a background cleanup process.
</li>
</ul>
If the table contains an identity column, the counter for that column is reset to the seed value defined for the column. If no seed was defined, the default value 1 is used. To retain the identity counter, use DELETE instead.<br />

</blockquote>
<p>So the following:</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb314-1"><a href="#cb314-1"></a><span class="kw">DELETE</span> <span class="kw">FROM</span> [MyTable];</span>
<span id="cb314-2"><a href="#cb314-2"></a>DBCC CHECKIDENT (<span class="st">&#39;[MyTable]&#39;</span>, RESEED, <span class="dv">0</span>);</span></code></pre></div>
<p>Becomes just:</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb315-1"><a href="#cb315-1"></a><span class="kw">TRUNCATE</span> <span class="kw">TABLE</span> [MyTable];</span></code></pre></div>
<p>Please see the <code>TRUNCATE TABLE</code> documentation (linked above) for additional information on restrictions, etc.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-to-create-id-with-auto_increment-on-oracle-score-874399-in-2017" class="level3">
<h3>51: How to create id with AUTO_INCREMENT on Oracle? (score <a href="https://stackoverflow.com/q/11296361.html">874399</a> in 2017)</h3>
<section id="question-50" class="level4">
<h4>Question</h4>
<p>It appears that there is no concept of AUTO_INCREMENT in Oracle, up until and including version 11g.</p>
<p>How can I create a column that behaves like auto increment in Oracle 11g?</p>
</section>
<section id="answer-accepted-score-546" class="level4">
<h4>Answer accepted (score 546)</h4>
<p>There is no such thing as “auto_increment” or “identity” columns in Oracle <em>as of Oracle 11g</em>. However, you can model it easily with a sequence and a trigger:</p>
<p>Table definition:</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb316-1"><a href="#cb316-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> departments (</span>
<span id="cb316-2"><a href="#cb316-2"></a>  <span class="kw">ID</span>           <span class="dt">NUMBER</span>(<span class="dv">10</span>)    <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb316-3"><a href="#cb316-3"></a>  DESCRIPTION  <span class="dt">VARCHAR2</span>(<span class="dv">50</span>)  <span class="kw">NOT</span> <span class="kw">NULL</span>);</span>
<span id="cb316-4"><a href="#cb316-4"></a></span>
<span id="cb316-5"><a href="#cb316-5"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> departments <span class="kw">ADD</span> (</span>
<span id="cb316-6"><a href="#cb316-6"></a>  <span class="kw">CONSTRAINT</span> dept_pk <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (<span class="kw">ID</span>));</span>
<span id="cb316-7"><a href="#cb316-7"></a></span>
<span id="cb316-8"><a href="#cb316-8"></a><span class="kw">CREATE</span> <span class="kw">SEQUENCE</span> dept_seq <span class="kw">START</span> <span class="kw">WITH</span> <span class="dv">1</span>;</span></code></pre></div>
<p>Trigger definition:</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb317-1"><a href="#cb317-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="kw">TRIGGER</span> dept_bir </span>
<span id="cb317-2"><a href="#cb317-2"></a><span class="kw">BEFORE</span> <span class="kw">INSERT</span> <span class="kw">ON</span> departments </span>
<span id="cb317-3"><a href="#cb317-3"></a><span class="cf">FOR</span> <span class="kw">EACH</span> <span class="kw">ROW</span></span>
<span id="cb317-4"><a href="#cb317-4"></a></span>
<span id="cb317-5"><a href="#cb317-5"></a><span class="cf">BEGIN</span></span>
<span id="cb317-6"><a href="#cb317-6"></a>  <span class="kw">SELECT</span> dept_seq.NEXTVAL</span>
<span id="cb317-7"><a href="#cb317-7"></a>  <span class="kw">INTO</span>   <span class="ch">:new</span>.<span class="kw">id</span></span>
<span id="cb317-8"><a href="#cb317-8"></a>  <span class="kw">FROM</span>   dual;</span>
<span id="cb317-9"><a href="#cb317-9"></a><span class="cf">END</span>;</span>
<span id="cb317-10"><a href="#cb317-10"></a><span class="op">/</span></span></code></pre></div>
<h5>
UPDATE:
</h3>
<p><a href="http://docs.oracle.com/database/121/DRDAA/migr_tools_feat.htm#DRDAA109" rel="noreferrer"><code>IDENTITY</code></a> column is now available on Oracle 12c:</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb318-1"><a href="#cb318-1"></a><span class="kw">create</span> <span class="kw">table</span> t1 (</span>
<span id="cb318-2"><a href="#cb318-2"></a>    c1 <span class="dt">NUMBER</span> <span class="kw">GENERATED</span> <span class="kw">by</span> <span class="kw">default</span> <span class="kw">on</span> <span class="kw">null</span> <span class="kw">as</span> IDENTITY,</span>
<span id="cb318-3"><a href="#cb318-3"></a>    c2 <span class="dt">VARCHAR2</span>(<span class="dv">10</span>)</span>
<span id="cb318-4"><a href="#cb318-4"></a>    );</span></code></pre></div>
<p>or specify starting and increment values, also preventing any insert into the identity column (<code>GENERATED ALWAYS</code>) (again, Oracle 12c+ only)</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb319-1"><a href="#cb319-1"></a><span class="kw">create</span> <span class="kw">table</span> t1 (</span>
<span id="cb319-2"><a href="#cb319-2"></a>    c1 <span class="dt">NUMBER</span> <span class="kw">GENERATED</span> ALWAYS <span class="kw">as</span> IDENTITY(<span class="kw">START</span> <span class="kw">with</span> <span class="dv">1</span> <span class="kw">INCREMENT</span> <span class="kw">by</span> <span class="dv">1</span>),</span>
<span id="cb319-3"><a href="#cb319-3"></a>    c2 <span class="dt">VARCHAR2</span>(<span class="dv">10</span>)</span>
<span id="cb319-4"><a href="#cb319-4"></a>    );</span></code></pre></div>
<p>Alternatively, Oracle 12 also allows to use a sequence as a default value:</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb320-1"><a href="#cb320-1"></a><span class="kw">CREATE</span> <span class="kw">SEQUENCE</span> dept_seq <span class="kw">START</span> <span class="kw">WITH</span> <span class="dv">1</span>;</span>
<span id="cb320-2"><a href="#cb320-2"></a></span>
<span id="cb320-3"><a href="#cb320-3"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> departments (</span>
<span id="cb320-4"><a href="#cb320-4"></a>  <span class="kw">ID</span>           <span class="dt">NUMBER</span>(<span class="dv">10</span>)    <span class="kw">DEFAULT</span> dept_seq.nextval <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb320-5"><a href="#cb320-5"></a>  DESCRIPTION  <span class="dt">VARCHAR2</span>(<span class="dv">50</span>)  <span class="kw">NOT</span> <span class="kw">NULL</span>);</span>
<span id="cb320-6"><a href="#cb320-6"></a></span>
<span id="cb320-7"><a href="#cb320-7"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> departments <span class="kw">ADD</span> (</span>
<span id="cb320-8"><a href="#cb320-8"></a>  <span class="kw">CONSTRAINT</span> dept_pk <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (<span class="kw">ID</span>));</span></code></pre></div>
</section>
<section id="answer-2-score-85" class="level4">
<h4>Answer 2 (score 85)</h4>
<p><code>SYS_GUID</code> returns a GUID– a globally unique ID. A <a href="http://docs.oracle.com/cd/B12037_01/server.101/b10759/functions153.htm"><code>SYS_GUID</code></a> is a <code>RAW(16)</code>. It does not generate an incrementing numeric value.</p>
<p>If you want to create an incrementing numeric key, you’ll want to create a sequence.</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb321-1"><a href="#cb321-1"></a><span class="kw">CREATE</span> <span class="kw">SEQUENCE</span> name_of_sequence</span>
<span id="cb321-2"><a href="#cb321-2"></a>  <span class="kw">START</span> <span class="kw">WITH</span> <span class="dv">1</span></span>
<span id="cb321-3"><a href="#cb321-3"></a>  <span class="kw">INCREMENT</span> <span class="kw">BY</span> <span class="dv">1</span></span>
<span id="cb321-4"><a href="#cb321-4"></a>  <span class="kw">CACHE</span> <span class="dv">100</span>;</span></code></pre></div>
<p>You would then either use that sequence in your <code>INSERT</code> statement</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb322-1"><a href="#cb322-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> name_of_table( primary_key_column, <span class="op">&lt;&lt;</span>other <span class="kw">columns</span><span class="op">&gt;&gt;</span> )</span>
<span id="cb322-2"><a href="#cb322-2"></a>  <span class="kw">VALUES</span>( name_of_sequence.nextval, <span class="op">&lt;&lt;</span>other <span class="kw">values</span><span class="op">&gt;&gt;</span> );</span></code></pre></div>
<p>Or you can define a trigger that automatically populates the primary key value using the sequence</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb323-1"><a href="#cb323-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="kw">TRIGGER</span> trigger_name</span>
<span id="cb323-2"><a href="#cb323-2"></a>  <span class="kw">BEFORE</span> <span class="kw">INSERT</span> <span class="kw">ON</span> table_name</span>
<span id="cb323-3"><a href="#cb323-3"></a>  <span class="cf">FOR</span> <span class="kw">EACH</span> <span class="kw">ROW</span></span>
<span id="cb323-4"><a href="#cb323-4"></a><span class="cf">BEGIN</span></span>
<span id="cb323-5"><a href="#cb323-5"></a>  <span class="kw">SELECT</span> name_of_sequence.nextval</span>
<span id="cb323-6"><a href="#cb323-6"></a>    <span class="kw">INTO</span> <span class="ch">:new</span>.primary_key_column</span>
<span id="cb323-7"><a href="#cb323-7"></a>    <span class="kw">FROM</span> dual;</span>
<span id="cb323-8"><a href="#cb323-8"></a><span class="cf">END</span>;</span></code></pre></div>
<p>If you are using Oracle 11.1 or later, you can simplify the trigger a bit</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb324-1"><a href="#cb324-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="kw">TRIGGER</span> trigger_name</span>
<span id="cb324-2"><a href="#cb324-2"></a>  <span class="kw">BEFORE</span> <span class="kw">INSERT</span> <span class="kw">ON</span> table_name</span>
<span id="cb324-3"><a href="#cb324-3"></a>  <span class="cf">FOR</span> <span class="kw">EACH</span> <span class="kw">ROW</span></span>
<span id="cb324-4"><a href="#cb324-4"></a><span class="cf">BEGIN</span></span>
<span id="cb324-5"><a href="#cb324-5"></a>  <span class="ch">:new</span>.primary_key_column <span class="op">:=</span> name_of_sequence.nextval;</span>
<span id="cb324-6"><a href="#cb324-6"></a><span class="cf">END</span>;</span></code></pre></div>
<p>If you really want to use <code>SYS_GUID</code></p>
<div class="sourceCode" id="cb325"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb325-1"><a href="#cb325-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> table_name (</span>
<span id="cb325-2"><a href="#cb325-2"></a>  primary_key_column <span class="dt">raw</span>(<span class="dv">16</span>) <span class="kw">default</span> <span class="fu">sys_guid</span>() <span class="kw">primary</span> <span class="kw">key</span>,</span>
<span id="cb325-3"><a href="#cb325-3"></a>  <span class="op">&lt;&lt;</span>other <span class="kw">columns</span><span class="op">&gt;&gt;</span></span>
<span id="cb325-4"><a href="#cb325-4"></a>)</span></code></pre></div>
</section>
<section id="answer-3-score-47" class="level4">
<h4>Answer 3 (score 47)</h4>
<p>In Oracle 12c onward you could do something like,</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb326-1"><a href="#cb326-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> MAPS</span>
<span id="cb326-2"><a href="#cb326-2"></a>(</span>
<span id="cb326-3"><a href="#cb326-3"></a>  MAP_ID <span class="dt">INTEGER</span> <span class="kw">GENERATED</span> ALWAYS <span class="kw">AS</span> IDENTITY (<span class="kw">START</span> <span class="kw">WITH</span> <span class="dv">1</span> <span class="kw">INCREMENT</span> <span class="kw">BY</span> <span class="dv">1</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb326-4"><a href="#cb326-4"></a>  MAP_NAME <span class="dt">VARCHAR</span>(<span class="dv">24</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb326-5"><a href="#cb326-5"></a>  <span class="kw">UNIQUE</span> (MAP_ID, MAP_NAME)</span>
<span id="cb326-6"><a href="#cb326-6"></a>);</span></code></pre></div>
<hr>
<p>And in Oracle (Pre 12c).</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb327-1"><a href="#cb327-1"></a><span class="co">-- create table</span></span>
<span id="cb327-2"><a href="#cb327-2"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> MAPS</span>
<span id="cb327-3"><a href="#cb327-3"></a>(</span>
<span id="cb327-4"><a href="#cb327-4"></a>  MAP_ID <span class="dt">INTEGER</span> <span class="kw">NOT</span> <span class="kw">NULL</span> ,</span>
<span id="cb327-5"><a href="#cb327-5"></a>  MAP_NAME <span class="dt">VARCHAR</span>(<span class="dv">24</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb327-6"><a href="#cb327-6"></a>  <span class="kw">UNIQUE</span> (MAP_ID, MAP_NAME)</span>
<span id="cb327-7"><a href="#cb327-7"></a>);</span>
<span id="cb327-8"><a href="#cb327-8"></a></span>
<span id="cb327-9"><a href="#cb327-9"></a><span class="co">-- create sequence</span></span>
<span id="cb327-10"><a href="#cb327-10"></a><span class="kw">CREATE</span> <span class="kw">SEQUENCE</span> MAPS_SEQ;</span>
<span id="cb327-11"><a href="#cb327-11"></a></span>
<span id="cb327-12"><a href="#cb327-12"></a><span class="co">-- create tigger using the sequence</span></span>
<span id="cb327-13"><a href="#cb327-13"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="kw">TRIGGER</span> MAPS_TRG </span>
<span id="cb327-14"><a href="#cb327-14"></a><span class="kw">BEFORE</span> <span class="kw">INSERT</span> <span class="kw">ON</span> MAPS </span>
<span id="cb327-15"><a href="#cb327-15"></a><span class="cf">FOR</span> <span class="kw">EACH</span> <span class="kw">ROW</span></span>
<span id="cb327-16"><a href="#cb327-16"></a><span class="cf">WHEN</span> (<span class="kw">new</span>.MAP_ID <span class="kw">IS</span> <span class="kw">NULL</span>)</span>
<span id="cb327-17"><a href="#cb327-17"></a><span class="cf">BEGIN</span></span>
<span id="cb327-18"><a href="#cb327-18"></a>  <span class="kw">SELECT</span> MAPS_SEQ.NEXTVAL</span>
<span id="cb327-19"><a href="#cb327-19"></a>  <span class="kw">INTO</span>   <span class="ch">:new</span>.MAP_ID</span>
<span id="cb327-20"><a href="#cb327-20"></a>  <span class="kw">FROM</span>   dual;</span>
<span id="cb327-21"><a href="#cb327-21"></a><span class="cf">END</span>;</span>
<span id="cb327-22"><a href="#cb327-22"></a><span class="op">/</span></span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-to-turn-identity_insert-on-and-off-using-sql-server-2008-score-872201-in-2013" class="level3">
<h3>52: How to turn IDENTITY_INSERT on and off using SQL Server 2008? (score <a href="https://stackoverflow.com/q/7063501.html">872201</a> in 2013)</h3>
<section id="question-51" class="level4">
<h4>Question</h4>
<p>Why am I getting an error doing an insert when <code>IDENTITY_INSERT</code> is set to OFF?</p>
<p>How do I turn it on properly in SQL Server 2008? Is it by using SQL Server Management Studio?</p>
<p>I have run this query:</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb328-1"><a href="#cb328-1"></a><span class="kw">SET</span> IDENTITY_INSERT <span class="kw">Database</span>. dbo. Baskets <span class="kw">ON</span></span></code></pre></div>
<p>
Then I got the message back in the console that the Command(s) completed successfully. However when I run the application, it still gives me the error shown below:
</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb329-1"><a href="#cb329-1"></a>Cannot <span class="kw">insert</span> explicit <span class="fu">value</span> <span class="cf">for</span> identity <span class="kw">column</span> <span class="kw">in</span> <span class="kw">table</span> <span class="st">&#39;Baskets&#39;</span> <span class="cf">when</span> </span>
<span id="cb329-2"><a href="#cb329-2"></a>IDENTITY_INSERT <span class="kw">is</span> <span class="kw">set</span> <span class="kw">to</span> <span class="kw">OFF</span>.</span></code></pre></div>
</section>
<section id="answer-accepted-score-703" class="level4">
<h4>Answer accepted (score 703)</h4>
<p>Via SQL as per <a href="https://docs.microsoft.com/en-us/sql/t-sql/statements/set-identity-insert-transact-sql" rel="noreferrer">MSDN</a></p>
<div class="sourceCode" id="cb330"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb330-1"><a href="#cb330-1"></a><span class="kw">SET</span> IDENTITY_INSERT sometableWithIdentity <span class="kw">ON</span></span>
<span id="cb330-2"><a href="#cb330-2"></a></span>
<span id="cb330-3"><a href="#cb330-3"></a><span class="kw">INSERT</span> sometableWithIdentity (IdentityColumn, col2, col3, <span class="op">..</span>.)</span>
<span id="cb330-4"><a href="#cb330-4"></a><span class="kw">VALUES</span> (AnIdentityValue, col2value, col3value, <span class="op">..</span>.)</span>
<span id="cb330-5"><a href="#cb330-5"></a></span>
<span id="cb330-6"><a href="#cb330-6"></a><span class="kw">SET</span> IDENTITY_INSERT sometableWithIdentity <span class="kw">OFF</span></span></code></pre></div>
<p>The complete error message tells you <em>exactly</em> what is wrong…</p>
<blockquote>
Cannot insert explicit value for identity column in table ‘sometableWithIdentity’ when IDENTITY_INSERT is set to OFF.
</blockquote>
</section>
<section id="answer-2-score-53" class="level4">
<h4>Answer 2 (score 53)</h4>
<p>I had a problem where it did not allow me to insert it even after setting the IDENTITY_INSERT ON.</p>
<p>The problem was that i did not specify the column names and for some reason it did not like it.</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb331-1"><a href="#cb331-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> tbl <span class="kw">Values</span>(vals)</span></code></pre></div>
<p><strong>So basically do the full INSERT INTO tbl(cols) Values(vals)</strong></p>
</section>
<section id="answer-3-score-34" class="level4">
<h4>Answer 3 (score 34)</h4>
<p>
<strong>Import:</strong> You must write columns in <code>INSERT</code> statement
</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb332-1"><a href="#cb332-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> <span class="kw">TABLE</span></span>
<span id="cb332-2"><a href="#cb332-2"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span>    </span></code></pre></div>
<p>Is not correct.</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb333-1"><a href="#cb333-1"></a><span class="kw">Insert</span> <span class="kw">into</span> <span class="kw">Table</span>(Field1,<span class="op">..</span>.)</span>
<span id="cb333-2"><a href="#cb333-2"></a><span class="kw">Select</span> (Field1,<span class="op">..</span>.) <span class="kw">from</span> <span class="kw">TABLE</span></span></code></pre></div>
<p>Is correct</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="sql-server-query---selecting-count-with-distinct-score-856305-in-2019" class="level3">
<h3>53: SQL Server query - Selecting COUNT(*) with DISTINCT (score <a href="https://stackoverflow.com/q/1521605.html">856305</a> in 2019)</h3>
<section id="question-52" class="level4">
<h4>Question</h4>
<p>In SQL Server 2005 I have a table cm_production that lists all the code that’s been put into production. The table has a ticket_number, program_type, and program_name and push_number along with some other columns.</p>
<p>GOAL: Count all the DISTINCT program names by program type and push number</p>
<p>What I have so far is:</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb334-1"><a href="#cb334-1"></a><span class="kw">DECLARE</span> @push_number <span class="dt">INT</span>;</span>
<span id="cb334-2"><a href="#cb334-2"></a><span class="kw">SET</span> @push_number <span class="op">=</span> [HERE_ADD_NUMBER];</span>
<span id="cb334-3"><a href="#cb334-3"></a></span>
<span id="cb334-4"><a href="#cb334-4"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> <span class="fu">Count</span>, program_type <span class="kw">AS</span> [<span class="kw">Type</span>] </span>
<span id="cb334-5"><a href="#cb334-5"></a><span class="kw">FROM</span> cm_production </span>
<span id="cb334-6"><a href="#cb334-6"></a><span class="kw">WHERE</span> push_number<span class="op">=</span>@push_number </span>
<span id="cb334-7"><a href="#cb334-7"></a><span class="kw">GROUP</span> <span class="kw">BY</span> program_type</span></code></pre></div>
<p>This gets me partway there, but it’s counting all the program names, not the distinct ones (which I don’t expect it to do in that query). I guess I just can’t wrap my head around how to tell it to count only the distinct program names without selecting them. Or something.</p>
</section>
<section id="answer-accepted-score-677" class="level4">
<h4>Answer accepted (score 677)</h4>
<blockquote>
Count all the DISTINCT program names by program type and push number
</blockquote>
<div class="sourceCode" id="cb335"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb335-1"><a href="#cb335-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> program_name) <span class="kw">AS</span> <span class="fu">Count</span>,</span>
<span id="cb335-2"><a href="#cb335-2"></a>  program_type <span class="kw">AS</span> [<span class="kw">Type</span>] </span>
<span id="cb335-3"><a href="#cb335-3"></a><span class="kw">FROM</span> cm_production </span>
<span id="cb335-4"><a href="#cb335-4"></a><span class="kw">WHERE</span> push_number<span class="op">=</span>@push_number </span>
<span id="cb335-5"><a href="#cb335-5"></a><span class="kw">GROUP</span> <span class="kw">BY</span> program_type</span></code></pre></div>
<p><code>DISTINCT COUNT(*)</code> will return a row for each unique count. What you want is <a href="http://msdn.microsoft.com/en-us/library/ms175997.aspx" rel="noreferrer"><code>COUNT(DISTINCT &amp;lt;expression&amp;gt;)</code></a>: evaluates expression for each row in a group and returns the number of unique, non-null values.</p>
</section>
<section id="answer-2-score-99" class="level4">
<h4>Answer 2 (score 99)</h4>
<p>
I needed to get the number of occurrences of each distinct value. The column contained Region info. The simple SQL query I ended up with was:
</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb336-1"><a href="#cb336-1"></a><span class="kw">SELECT</span> Region, <span class="fu">count</span>(<span class="op">*</span>)</span>
<span id="cb336-2"><a href="#cb336-2"></a><span class="kw">FROM</span> item</span>
<span id="cb336-3"><a href="#cb336-3"></a><span class="kw">WHERE</span> Region <span class="kw">is</span> <span class="kw">not</span> <span class="kw">null</span></span>
<span id="cb336-4"><a href="#cb336-4"></a><span class="kw">GROUP</span> <span class="kw">BY</span> Region</span></code></pre></div>
<p>Which would give me a list like, say:</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb337-1"><a href="#cb337-1"></a>Region, <span class="fu">count</span></span>
<span id="cb337-2"><a href="#cb337-2"></a>Denmark, <span class="dv">4</span></span>
<span id="cb337-3"><a href="#cb337-3"></a>Sweden, <span class="dv">1</span></span>
<span id="cb337-4"><a href="#cb337-4"></a>USA, <span class="dv">10</span></span></code></pre></div>
</section>
<section id="answer-3-score-35" class="level4">
<h4>Answer 3 (score 35)</h4>
<p>You have to create a derived table for the distinct columns and then query the count from that table:</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb338-1"><a href="#cb338-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) </span>
<span id="cb338-2"><a href="#cb338-2"></a><span class="kw">FROM</span> (<span class="kw">SELECT</span> <span class="kw">DISTINCT</span> column1,column2</span>
<span id="cb338-3"><a href="#cb338-3"></a>      <span class="kw">FROM</span>  tablename  </span>
<span id="cb338-4"><a href="#cb338-4"></a>      <span class="kw">WHERE</span> condition ) <span class="kw">as</span> dt</span></code></pre></div>
<p>Here <code>dt</code> is a derived table.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-do-i-or-can-i-select-distinct-on-multiple-columns-score-850430-in-2014" class="level3">
<h3>54: How do I (or can I) SELECT DISTINCT on multiple columns? (score <a href="https://stackoverflow.com/q/54418.html">850430</a> in 2014)</h3>
<section id="question-53" class="level4">
<h4>Question</h4>
<p>I need to retrieve all rows from a table where 2 columns combined are all different. So I want all the sales that do not have any other sales that happened on the same day for the same price. The sales that are unique based on day and price will get updated to an active status.</p>
<p>So I’m thinking:</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb339-1"><a href="#cb339-1"></a><span class="kw">UPDATE</span> sales</span>
<span id="cb339-2"><a href="#cb339-2"></a><span class="kw">SET</span> status <span class="op">=</span> <span class="st">&#39;ACTIVE&#39;</span></span>
<span id="cb339-3"><a href="#cb339-3"></a><span class="kw">WHERE</span> <span class="kw">id</span> <span class="kw">IN</span> (<span class="kw">SELECT</span> <span class="kw">DISTINCT</span> (saleprice, saledate), <span class="kw">id</span>, <span class="fu">count</span>(<span class="kw">id</span>)</span>
<span id="cb339-4"><a href="#cb339-4"></a>             <span class="kw">FROM</span> sales</span>
<span id="cb339-5"><a href="#cb339-5"></a>             <span class="kw">HAVING</span> <span class="fu">count</span> <span class="op">=</span> <span class="dv">1</span>)</span></code></pre></div>
<p>But my brain hurts going any farther than that.</p>
</section>
<section id="answer-accepted-score-413" class="level4">
<h4>Answer accepted (score 413)</h4>
<div class="sourceCode" id="cb340"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb340-1"><a href="#cb340-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> a,b,c <span class="kw">FROM</span> t</span></code></pre></div>
<p>is <em>roughly</em> equivalent to:</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb341-1"><a href="#cb341-1"></a><span class="kw">SELECT</span> a,b,c <span class="kw">FROM</span> t <span class="kw">GROUP</span> <span class="kw">BY</span> a,b,c</span></code></pre></div>
<p>It’s a good idea to get used to the GROUP BY syntax, as it’s more powerful.</p>
<p>For your query, I’d do it like this:</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb342-1"><a href="#cb342-1"></a><span class="kw">UPDATE</span> sales</span>
<span id="cb342-2"><a href="#cb342-2"></a><span class="kw">SET</span> status<span class="op">=</span><span class="st">&#39;ACTIVE&#39;</span></span>
<span id="cb342-3"><a href="#cb342-3"></a><span class="kw">WHERE</span> <span class="kw">id</span> <span class="kw">IN</span></span>
<span id="cb342-4"><a href="#cb342-4"></a>(</span>
<span id="cb342-5"><a href="#cb342-5"></a>    <span class="kw">SELECT</span> <span class="kw">id</span></span>
<span id="cb342-6"><a href="#cb342-6"></a>    <span class="kw">FROM</span> sales S</span>
<span id="cb342-7"><a href="#cb342-7"></a>    <span class="kw">INNER</span> <span class="kw">JOIN</span></span>
<span id="cb342-8"><a href="#cb342-8"></a>    (</span>
<span id="cb342-9"><a href="#cb342-9"></a>        <span class="kw">SELECT</span> saleprice, saledate</span>
<span id="cb342-10"><a href="#cb342-10"></a>        <span class="kw">FROM</span> sales</span>
<span id="cb342-11"><a href="#cb342-11"></a>        <span class="kw">GROUP</span> <span class="kw">BY</span> saleprice, saledate</span>
<span id="cb342-12"><a href="#cb342-12"></a>        <span class="kw">HAVING</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="op">=</span> <span class="dv">1</span> </span>
<span id="cb342-13"><a href="#cb342-13"></a>    ) T</span>
<span id="cb342-14"><a href="#cb342-14"></a>    <span class="kw">ON</span> S.saleprice<span class="op">=</span>T.saleprice <span class="kw">AND</span> s.saledate<span class="op">=</span>T.saledate</span>
<span id="cb342-15"><a href="#cb342-15"></a> )</span></code></pre></div>
</section>
<section id="answer-2-score-328" class="level4">
<h4>Answer 2 (score 328)</h4>
<p>If you put together the answers so far, clean up and improve, you would arrive at this superior query:</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb343-1"><a href="#cb343-1"></a><span class="kw">UPDATE</span> sales</span>
<span id="cb343-2"><a href="#cb343-2"></a><span class="kw">SET</span>    status <span class="op">=</span> <span class="st">&#39;ACTIVE&#39;</span></span>
<span id="cb343-3"><a href="#cb343-3"></a><span class="kw">WHERE</span>  (saleprice, saledate) <span class="kw">IN</span> (</span>
<span id="cb343-4"><a href="#cb343-4"></a>    <span class="kw">SELECT</span> saleprice, saledate</span>
<span id="cb343-5"><a href="#cb343-5"></a>    <span class="kw">FROM</span>   sales</span>
<span id="cb343-6"><a href="#cb343-6"></a>    <span class="kw">GROUP</span>  <span class="kw">BY</span> saleprice, saledate</span>
<span id="cb343-7"><a href="#cb343-7"></a>    <span class="kw">HAVING</span> <span class="fu">count</span>(<span class="op">*</span>) <span class="op">=</span> <span class="dv">1</span> </span>
<span id="cb343-8"><a href="#cb343-8"></a>    );</span></code></pre></div>
<p>Which is <em>much</em> faster than either of them. Nukes the performance of the currently accepted answer by factor 10 - 15 (in my tests on PostgreSQL 8.4 and 9.1).</p>
<p>But this is still far from optimal. Use a <a href="https://www.postgresql.org/docs/current/functions-subquery.html#FUNCTIONS-SUBQUERY-EXISTS" rel="noreferrer"><strong><code>NOT EXISTS</code></strong></a> (anti-)semi-join for even better performance. <code>EXISTS</code> is standard SQL, has been around forever (at least since PostgreSQL 7.2, long before this question was asked) and fits the presented requirements perfectly:</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb344-1"><a href="#cb344-1"></a><span class="kw">UPDATE</span> sales s</span>
<span id="cb344-2"><a href="#cb344-2"></a><span class="kw">SET</span>    status <span class="op">=</span> <span class="st">&#39;ACTIVE&#39;</span></span>
<span id="cb344-3"><a href="#cb344-3"></a><span class="kw">WHERE</span>  <span class="kw">NOT</span> <span class="kw">EXISTS</span> (</span>
<span id="cb344-4"><a href="#cb344-4"></a>   <span class="kw">SELECT</span> <span class="kw">FROM</span> sales s1                     <span class="co">-- SELECT list can be empty for EXISTS</span></span>
<span id="cb344-5"><a href="#cb344-5"></a>   <span class="kw">WHERE</span>  s.saleprice <span class="op">=</span> s1.saleprice</span>
<span id="cb344-6"><a href="#cb344-6"></a>   <span class="kw">AND</span>    s.saledate  <span class="op">=</span> s1.saledate</span>
<span id="cb344-7"><a href="#cb344-7"></a>   <span class="kw">AND</span>    s.<span class="kw">id</span> <span class="op">&lt;&gt;</span> s1.<span class="kw">id</span>                     <span class="co">-- except for row itself</span></span>
<span id="cb344-8"><a href="#cb344-8"></a>   )</span>
<span id="cb344-9"><a href="#cb344-9"></a><span class="kw">AND</span>    s.status <span class="kw">IS</span> <span class="kw">DISTINCT</span> <span class="kw">FROM</span> <span class="st">&#39;ACTIVE&#39;</span>;  <span class="co">-- avoid empty updates. see below</span></span></code></pre></div>
<p>
<em>db&lt;&gt;fiddle <a href="https://dbfiddle.uk/?rdbms=postgres_11&amp;fiddle=26c7eb96c3a22330a9c271d554c869fe" rel="noreferrer">here</a></em><br> <a href="http://sqlfiddle.com/#!17/6b5ef/1" rel="noreferrer">Old SQL Fiddle</a>
</p>
<h5>
Unique key to identify row
</h3>
<p>If you don’t have a primary or unique key for the table (<code>id</code> in the example), you can substitute with the system column <code>ctid</code> for the purpose of this query (but not for some other purposes):</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb345-1"><a href="#cb345-1"></a>   <span class="kw">AND</span>    s1.ctid <span class="op">&lt;&gt;</span> s.ctid</span></code></pre></div>
<p><sub>Every table should have a primary key. Add one if you didn’t have one, yet. I suggest a <code>serial</code> or an <code>IDENTITY</code> column in Postgres 10+.</sub></p>
<p>Related:</p>
<ul>
<li>
<a href="https://stackoverflow.com/questions/17500013/in-order-sequence-generation/17503095#17503095">In-order sequence generation</a>
</li>
<li>
<a href="https://stackoverflow.com/questions/9875223/auto-increment-table-column/9875517#9875517">Auto increment table column</a>
</li>
</ul>
<h5>
How is this faster?
</h3>
<p>The subquery in the <code>EXISTS</code> anti-semi-join can stop evaluating as soon as the first dupe is found (no point in looking further). For a base table with few duplicates this is only mildly more efficient. With lots of duplicates this becomes <em>way</em> more efficient.</p>
<h5>
Exclude empty updates
</h3>
<p>For rows that already have <code>status = 'ACTIVE'</code> this update would not change anything, but still insert a new row version at full cost (minor exceptions apply). Normally, you do not want this. Add another <code>WHERE</code> condition like demonstrated above to avoid this and make it even faster:</p>
<p>If <code>status</code> is defined <code>NOT NULL</code>, you can simplify to:</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb346-1"><a href="#cb346-1"></a><span class="kw">AND</span> status <span class="op">&lt;&gt;</span> <span class="st">&#39;ACTIVE&#39;</span>;</span></code></pre></div>
<h5>
Subtle difference in NULL handling
</h3>
<p>This query (unlike the <a href="https://stackoverflow.com/a/54430/939860">currently accepted answer by Joel</a>) does not treat NULL values as equal. The following two rows for <code>(saleprice, saledate)</code> would qualify as “distinct” (though looking identical to the human eye):</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb347-1"><a href="#cb347-1"></a>(<span class="dv">123</span>, <span class="kw">NULL</span>)</span>
<span id="cb347-2"><a href="#cb347-2"></a>(<span class="dv">123</span>, <span class="kw">NULL</span>)</span></code></pre></div>
<p>Also passes in a unique index and almost anywhere else, since NULL values do not compare equal according to the SQL standard. See:</p>
<ul>
<li>
<a href="https://stackoverflow.com/questions/8289100/create-unique-constraint-with-null-columns/8289253#8289253">Create unique constraint with null columns</a>
</li>
</ul>
<p>OTOH, <code>GROUP BY</code>, <code>DISTINCT</code> or <code>DISTINCT ON ()</code> treat NULL values as equal. Use an appropriate query style depending on what you want to achieve. You can still use this faster query with <a href="https://www.postgresql.org/docs/current/functions-comparison.html#FUNCTIONS-COMPARISON-PRED-TABLE" rel="noreferrer"><code>IS NOT DISTINCT FROM</code></a> instead of <code>=</code> for any or all comparisons to make NULL compare equal. More:</p>
<ul>
<li>
<a href="https://stackoverflow.com/questions/26769454/how-to-delete-duplicate-rows-without-unique-identifier/26773018#26773018">How to delete duplicate rows without unique identifier</a>
</li>
</ul>
<p>If all columns being compared are defined <code>NOT NULL</code>, there is no room for disagreement.</p>
</section>
<section id="answer-3-score-23-2" class="level4">
<h4>Answer 3 (score 23)</h4>
<p>The problem with your query is that when using a GROUP BY clause (which you essentially do by using distinct) you can only use columns that you group by or aggregate functions. You cannot use the column id because there are potentially different values. In your case there is always only one value because of the HAVING clause, but most RDBMS are not smart enough to recognize that.</p>
<p>This should work however (and doesn’t need a join):</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb348-1"><a href="#cb348-1"></a><span class="kw">UPDATE</span> sales</span>
<span id="cb348-2"><a href="#cb348-2"></a><span class="kw">SET</span> status<span class="op">=</span><span class="st">&#39;ACTIVE&#39;</span></span>
<span id="cb348-3"><a href="#cb348-3"></a><span class="kw">WHERE</span> <span class="kw">id</span> <span class="kw">IN</span> (</span>
<span id="cb348-4"><a href="#cb348-4"></a>  <span class="kw">SELECT</span> <span class="fu">MIN</span>(<span class="kw">id</span>) <span class="kw">FROM</span> sales</span>
<span id="cb348-5"><a href="#cb348-5"></a>  <span class="kw">GROUP</span> <span class="kw">BY</span> saleprice, saledate</span>
<span id="cb348-6"><a href="#cb348-6"></a>  <span class="kw">HAVING</span> <span class="fu">COUNT</span>(<span class="kw">id</span>) <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb348-7"><a href="#cb348-7"></a>)</span></code></pre></div>
<p>You could also use MAX or AVG instead of MIN, it is only important to use a function that returns the value of the column if there is only one matching row.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="sql-update-query-using-joins-score-847493-in-2014" class="level3">
<h3>55: SQL update query using joins (score <a href="https://stackoverflow.com/q/982919.html">847493</a> in 2014)</h3>
<section id="question-54" class="level4">
<h4>Question</h4>
<p>I have to update a field with a value which is returned by a join of 3 tables.</p>
<p>Example:</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb349-1"><a href="#cb349-1"></a><span class="kw">select</span></span>
<span id="cb349-2"><a href="#cb349-2"></a>    im.itemid</span>
<span id="cb349-3"><a href="#cb349-3"></a>    ,im.sku <span class="kw">as</span> iSku</span>
<span id="cb349-4"><a href="#cb349-4"></a>    ,gm.SKU <span class="kw">as</span> GSKU</span>
<span id="cb349-5"><a href="#cb349-5"></a>    ,mm.ManufacturerId <span class="kw">as</span> ManuId</span>
<span id="cb349-6"><a href="#cb349-6"></a>    ,mm.ManufacturerName</span>
<span id="cb349-7"><a href="#cb349-7"></a>    ,im.mf_item_number</span>
<span id="cb349-8"><a href="#cb349-8"></a>    ,mm.ManufacturerID</span>
<span id="cb349-9"><a href="#cb349-9"></a><span class="kw">from</span> </span>
<span id="cb349-10"><a href="#cb349-10"></a>    item_master im, group_master gm, Manufacturer_Master mm </span>
<span id="cb349-11"><a href="#cb349-11"></a><span class="kw">where</span></span>
<span id="cb349-12"><a href="#cb349-12"></a>    im.mf_item_number <span class="kw">like</span> <span class="st">&#39;STA%&#39;</span></span>
<span id="cb349-13"><a href="#cb349-13"></a>    <span class="kw">and</span> im.sku<span class="op">=</span>gm.sku</span>
<span id="cb349-14"><a href="#cb349-14"></a>    <span class="kw">and</span> gm.ManufacturerID <span class="op">=</span> mm.ManufacturerID</span>
<span id="cb349-15"><a href="#cb349-15"></a>    <span class="kw">and</span> gm.manufacturerID<span class="op">=</span><span class="dv">34</span></span></code></pre></div>
<p>I want to update the <code>mf_item_number</code> field values of table <code>item_master</code> with some other value which is joined in the above condition.</p>
<p>How can I do this in MS SQL Server?</p>
</section>
<section id="answer-accepted-score-1203" class="level4">
<h4>Answer accepted (score 1203)</h4>
<div class="sourceCode" id="cb350"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb350-1"><a href="#cb350-1"></a><span class="kw">UPDATE</span> im</span>
<span id="cb350-2"><a href="#cb350-2"></a><span class="kw">SET</span> mf_item_number <span class="op">=</span> gm.SKU <span class="co">--etc</span></span>
<span id="cb350-3"><a href="#cb350-3"></a><span class="kw">FROM</span> item_master im</span>
<span id="cb350-4"><a href="#cb350-4"></a><span class="kw">JOIN</span> group_master gm</span>
<span id="cb350-5"><a href="#cb350-5"></a>    <span class="kw">ON</span> im.sku <span class="op">=</span> gm.sku </span>
<span id="cb350-6"><a href="#cb350-6"></a><span class="kw">JOIN</span> Manufacturer_Master mm</span>
<span id="cb350-7"><a href="#cb350-7"></a>    <span class="kw">ON</span> gm.ManufacturerID <span class="op">=</span> mm.ManufacturerID</span>
<span id="cb350-8"><a href="#cb350-8"></a><span class="kw">WHERE</span> im.mf_item_number <span class="kw">like</span> <span class="st">&#39;STA%&#39;</span> <span class="kw">AND</span></span>
<span id="cb350-9"><a href="#cb350-9"></a>      gm.manufacturerID <span class="op">=</span> <span class="dv">34</span></span></code></pre></div>
<p>To make it clear… The <code>UPDATE</code> clause can refer to an table alias specified in the <code>FROM</code> clause. So <code>im</code> in this case is valid</p>
<h5>
Generic example
</h3>
<div class="sourceCode" id="cb351"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb351-1"><a href="#cb351-1"></a><span class="kw">UPDATE</span> A</span>
<span id="cb351-2"><a href="#cb351-2"></a><span class="kw">SET</span> foo <span class="op">=</span> B.bar</span>
<span id="cb351-3"><a href="#cb351-3"></a><span class="kw">FROM</span> TableA A</span>
<span id="cb351-4"><a href="#cb351-4"></a><span class="kw">JOIN</span> TableB B</span>
<span id="cb351-5"><a href="#cb351-5"></a>    <span class="kw">ON</span> A.col1 <span class="op">=</span> B.colx</span>
<span id="cb351-6"><a href="#cb351-6"></a><span class="kw">WHERE</span> <span class="op">..</span>.</span></code></pre></div>
</section>
<section id="answer-2-score-66" class="level4">
<h4>Answer 2 (score 66)</h4>
<p>One of the easiest way is to use a common table expression (since you’re already on SQL 2005):</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb352-1"><a href="#cb352-1"></a><span class="kw">with</span> cte <span class="kw">as</span> (</span>
<span id="cb352-2"><a href="#cb352-2"></a><span class="kw">select</span></span>
<span id="cb352-3"><a href="#cb352-3"></a>    im.itemid</span>
<span id="cb352-4"><a href="#cb352-4"></a>    ,im.sku <span class="kw">as</span> iSku</span>
<span id="cb352-5"><a href="#cb352-5"></a>    ,gm.SKU <span class="kw">as</span> GSKU</span>
<span id="cb352-6"><a href="#cb352-6"></a>    ,mm.ManufacturerId <span class="kw">as</span> ManuId</span>
<span id="cb352-7"><a href="#cb352-7"></a>    ,mm.ManufacturerName</span>
<span id="cb352-8"><a href="#cb352-8"></a>    ,im.mf_item_number</span>
<span id="cb352-9"><a href="#cb352-9"></a>    ,mm.ManufacturerID</span>
<span id="cb352-10"><a href="#cb352-10"></a>    , <span class="op">&lt;</span>your other field<span class="op">&gt;</span></span>
<span id="cb352-11"><a href="#cb352-11"></a><span class="kw">from</span> </span>
<span id="cb352-12"><a href="#cb352-12"></a>    item_master im, group_master gm, Manufacturer_Master mm </span>
<span id="cb352-13"><a href="#cb352-13"></a><span class="kw">where</span></span>
<span id="cb352-14"><a href="#cb352-14"></a>    im.mf_item_number <span class="kw">like</span> <span class="st">&#39;STA%&#39;</span></span>
<span id="cb352-15"><a href="#cb352-15"></a>    <span class="kw">and</span> im.sku<span class="op">=</span>gm.sku</span>
<span id="cb352-16"><a href="#cb352-16"></a>    <span class="kw">and</span> gm.ManufacturerID <span class="op">=</span> mm.ManufacturerID</span>
<span id="cb352-17"><a href="#cb352-17"></a>    <span class="kw">and</span> gm.manufacturerID<span class="op">=</span><span class="dv">34</span>)</span>
<span id="cb352-18"><a href="#cb352-18"></a><span class="kw">update</span> cte <span class="kw">set</span> mf_item_number <span class="op">=</span> <span class="op">&lt;</span>your other field<span class="op">&gt;</span></span></code></pre></div>
<p>The query execution engine will figure out on its own how to update the record.</p>
</section>
<section id="answer-3-score-61" class="level4">
<h4>Answer 3 (score 61)</h4>
<p>Adapting this to MySQL – there is no <code>FROM</code> clause in <code>UPDATE</code>, but this works:</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb353-1"><a href="#cb353-1"></a><span class="kw">UPDATE</span></span>
<span id="cb353-2"><a href="#cb353-2"></a>    item_master im</span>
<span id="cb353-3"><a href="#cb353-3"></a>    <span class="kw">JOIN</span></span>
<span id="cb353-4"><a href="#cb353-4"></a>    group_master gm <span class="kw">ON</span> im.sku<span class="op">=</span>gm.sku </span>
<span id="cb353-5"><a href="#cb353-5"></a>    <span class="kw">JOIN</span></span>
<span id="cb353-6"><a href="#cb353-6"></a>    Manufacturer_Master mm <span class="kw">ON</span> gm.ManufacturerID<span class="op">=</span>mm.ManufacturerID</span>
<span id="cb353-7"><a href="#cb353-7"></a><span class="kw">SET</span></span>
<span id="cb353-8"><a href="#cb353-8"></a>    im.mf_item_number <span class="op">=</span> gm.SKU <span class="co">--etc</span></span>
<span id="cb353-9"><a href="#cb353-9"></a><span class="kw">WHERE</span></span>
<span id="cb353-10"><a href="#cb353-10"></a>    im.mf_item_number <span class="kw">like</span> <span class="st">&#39;STA%&#39;</span></span>
<span id="cb353-11"><a href="#cb353-11"></a>    <span class="kw">AND</span></span>
<span id="cb353-12"><a href="#cb353-12"></a>    gm.manufacturerID<span class="op">=</span><span class="dv">34</span></span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-to-find-third-or-nth-maximum-salary-from-salary-table-score-839668-in-2015" class="level3">
<h3>56: How to find third or nth maximum salary from salary table? (score <a href="https://stackoverflow.com/q/16234983.html">839668</a> in 2015)</h3>
<section id="question-55" class="level4">
<h4>Question</h4>
<p>How to find <code>third or nth</code> maximum salary from salary <code>table(EmpID,EmpName,EmpSalary)</code> in Optimized way?</p>
</section>
<section id="answer-accepted-score-75" class="level4">
<h4>Answer accepted (score 75)</h4>
<p>Use <code>ROW_NUMBER</code>(if you want a single) or <code>DENSE_RANK</code>(for all related rows):</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb354-1"><a href="#cb354-1"></a><span class="kw">WITH</span> CTE <span class="kw">AS</span></span>
<span id="cb354-2"><a href="#cb354-2"></a>(</span>
<span id="cb354-3"><a href="#cb354-3"></a>    <span class="kw">SELECT</span> EmpID, EmpName, EmpSalary,</span>
<span id="cb354-4"><a href="#cb354-4"></a>           RN <span class="op">=</span> <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> EmpSalary <span class="kw">DESC</span>)</span>
<span id="cb354-5"><a href="#cb354-5"></a>    <span class="kw">FROM</span> dbo.Salary</span>
<span id="cb354-6"><a href="#cb354-6"></a>)</span>
<span id="cb354-7"><a href="#cb354-7"></a><span class="kw">SELECT</span> EmpID, EmpName, EmpSalary</span>
<span id="cb354-8"><a href="#cb354-8"></a><span class="kw">FROM</span> CTE</span>
<span id="cb354-9"><a href="#cb354-9"></a><span class="kw">WHERE</span> RN <span class="op">=</span> @NthRow</span></code></pre></div>
</section>
<section id="answer-2-score-85-1" class="level4">
<h4>Answer 2 (score 85)</h4>
<p>Row Number :</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb355-1"><a href="#cb355-1"></a><span class="kw">SELECT</span> Salary,EmpName</span>
<span id="cb355-2"><a href="#cb355-2"></a><span class="kw">FROM</span></span>
<span id="cb355-3"><a href="#cb355-3"></a>  (</span>
<span id="cb355-4"><a href="#cb355-4"></a>   <span class="kw">SELECT</span> Salary,EmpName,<span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span>(<span class="kw">ORDER</span> <span class="kw">BY</span> Salary) <span class="kw">As</span> <span class="kw">RowNum</span></span>
<span id="cb355-5"><a href="#cb355-5"></a>   <span class="kw">FROM</span> EMPLOYEE</span>
<span id="cb355-6"><a href="#cb355-6"></a>   ) <span class="kw">As</span> A</span>
<span id="cb355-7"><a href="#cb355-7"></a><span class="kw">WHERE</span> A.<span class="kw">RowNum</span> <span class="kw">IN</span> (<span class="dv">2</span>,<span class="dv">3</span>)</span></code></pre></div>
<p>Sub Query :</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb356-1"><a href="#cb356-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb356-2"><a href="#cb356-2"></a><span class="kw">FROM</span> Employee Emp1</span>
<span id="cb356-3"><a href="#cb356-3"></a><span class="kw">WHERE</span> (N<span class="op">-</span><span class="dv">1</span>) <span class="op">=</span> (</span>
<span id="cb356-4"><a href="#cb356-4"></a>               <span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span>(Emp2.Salary))</span>
<span id="cb356-5"><a href="#cb356-5"></a>               <span class="kw">FROM</span> Employee Emp2</span>
<span id="cb356-6"><a href="#cb356-6"></a>               <span class="kw">WHERE</span> Emp2.Salary <span class="op">&gt;</span> Emp1.Salary</span>
<span id="cb356-7"><a href="#cb356-7"></a>               )</span></code></pre></div>
<p>Top Keyword :</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb357-1"><a href="#cb357-1"></a><span class="kw">SELECT</span> TOP <span class="dv">1</span> salary</span>
<span id="cb357-2"><a href="#cb357-2"></a><span class="kw">FROM</span> (</span>
<span id="cb357-3"><a href="#cb357-3"></a>      <span class="kw">SELECT</span> <span class="kw">DISTINCT</span> TOP n salary</span>
<span id="cb357-4"><a href="#cb357-4"></a>      <span class="kw">FROM</span> employee</span>
<span id="cb357-5"><a href="#cb357-5"></a>      <span class="kw">ORDER</span> <span class="kw">BY</span> salary <span class="kw">DESC</span></span>
<span id="cb357-6"><a href="#cb357-6"></a>      ) a</span>
<span id="cb357-7"><a href="#cb357-7"></a><span class="kw">ORDER</span> <span class="kw">BY</span> salary</span></code></pre></div>
</section>
<section id="answer-3-score-58" class="level4">
<h4>Answer 3 (score 58)</h4>
<p>Try this</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb358-1"><a href="#cb358-1"></a><span class="kw">SELECT</span> TOP <span class="dv">1</span> salary <span class="kw">FROM</span> (</span>
<span id="cb358-2"><a href="#cb358-2"></a>   <span class="kw">SELECT</span> TOP <span class="dv">3</span> salary </span>
<span id="cb358-3"><a href="#cb358-3"></a>   <span class="kw">FROM</span> employees </span>
<span id="cb358-4"><a href="#cb358-4"></a>   <span class="kw">ORDER</span> <span class="kw">BY</span> salary <span class="kw">DESC</span>) <span class="kw">AS</span> emp </span>
<span id="cb358-5"><a href="#cb358-5"></a><span class="kw">ORDER</span> <span class="kw">BY</span> salary <span class="kw">ASC</span></span></code></pre></div>
<p>For 3 you can replace any value…</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="sql-query-to-insert-datetime-in-sql-server-score-835603-in-2018" class="level3">
<h3>57: Sql query to insert datetime in SQL Server (score <a href="https://stackoverflow.com/q/12957635.html">835603</a> in 2018)</h3>
<section id="question-56" class="level4">
<h4>Question</h4>
<p>I want to insert a <code>datetime</code> value into a table(SQL Server) using the sql query below</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb359-1"><a href="#cb359-1"></a><span class="kw">insert</span> <span class="kw">into</span> table1(approvaldate)<span class="kw">values</span>(<span class="dv">18</span><span class="op">-</span><span class="dv">06</span><span class="op">-</span><span class="dv">12</span> <span class="dv">10</span><span class="ch">:34:09</span> AM);</span></code></pre></div>
<p>But I get this Error msg. <code>Incorrect syntax near '10'.</code></p>
<p>I tried it with the quotes</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb360-1"><a href="#cb360-1"></a><span class="kw">insert</span> <span class="kw">into</span> table1(approvaldate)<span class="kw">values</span>(<span class="st">&#39;18-06-12 10:34:09 AM&#39;</span>);</span></code></pre></div>
<p>I get this error message <code>Cannot convert varchar to datetime</code></p>
<p>
Kindly help! Thanks.
</p>
</section>
<section id="answer-accepted-score-203" class="level4">
<h4>Answer accepted (score 203)</h4>
<p>You will want to use the YYYYMMDD for unambiguous date determination in SQL Server.</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb361-1"><a href="#cb361-1"></a><span class="kw">insert</span> <span class="kw">into</span> table1(approvaldate)<span class="kw">values</span>(<span class="st">&#39;20120618 10:34:09 AM&#39;</span>);</span></code></pre></div>
<p>If you are married to the <code>dd-mm-yy hh:mm:ss xm</code> format, you will need to use CONVERT with the specific style.</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb362-1"><a href="#cb362-1"></a><span class="kw">insert</span> table1 (approvaldate)</span>
<span id="cb362-2"><a href="#cb362-2"></a>       <span class="kw">values</span> (<span class="fu">convert</span>(datetime,<span class="st">&#39;18-06-12 10:34:09 PM&#39;</span>,<span class="dv">5</span>));</span></code></pre></div>
<p><strong><code>5</code></strong> here is the style for Italian dates. Well, not just Italians, but that’s the culture it’s attributed to in <a href="http://msdn.microsoft.com/en-us/library/ms187928.aspx">Books Online</a>.</p>
</section>
<section id="answer-2-score-26-1" class="level4">
<h4>Answer 2 (score 26)</h4>
<p>A more language-independent choice for string literals is the international standard <a href="http://en.wikipedia.org/wiki/ISO_8601" rel="nofollow noreferrer">ISO 8601</a> format “YYYY-MM-DDThh:mm:ss”. I used the SQL query below to test the format, and it does indeed work in all SQL languages in <a href="http://technet.microsoft.com/en-us/library/ms190303.aspx" rel="nofollow noreferrer">sys.syslanguages</a>:</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb363-1"><a href="#cb363-1"></a><span class="kw">declare</span> @sql <span class="dt">nvarchar</span>(<span class="dv">4000</span>)</span>
<span id="cb363-2"><a href="#cb363-2"></a></span>
<span id="cb363-3"><a href="#cb363-3"></a><span class="kw">declare</span> @LangID <span class="dt">smallint</span></span>
<span id="cb363-4"><a href="#cb363-4"></a><span class="kw">declare</span> @Alias sysname</span>
<span id="cb363-5"><a href="#cb363-5"></a></span>
<span id="cb363-6"><a href="#cb363-6"></a><span class="kw">declare</span> @MaxLangID <span class="dt">smallint</span></span>
<span id="cb363-7"><a href="#cb363-7"></a><span class="kw">select</span> @MaxLangID <span class="op">=</span> <span class="fu">max</span>(langid) <span class="kw">from</span> sys.syslanguages</span>
<span id="cb363-8"><a href="#cb363-8"></a></span>
<span id="cb363-9"><a href="#cb363-9"></a><span class="kw">set</span> @LangID <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb363-10"><a href="#cb363-10"></a></span>
<span id="cb363-11"><a href="#cb363-11"></a><span class="cf">while</span> @LangID <span class="op">&lt;=</span> @MaxLangID</span>
<span id="cb363-12"><a href="#cb363-12"></a><span class="cf">begin</span></span>
<span id="cb363-13"><a href="#cb363-13"></a></span>
<span id="cb363-14"><a href="#cb363-14"></a>    <span class="kw">select</span> @Alias <span class="op">=</span> alias</span>
<span id="cb363-15"><a href="#cb363-15"></a>    <span class="kw">from</span> sys.syslanguages</span>
<span id="cb363-16"><a href="#cb363-16"></a>    <span class="kw">where</span> langid <span class="op">=</span> @LangID</span>
<span id="cb363-17"><a href="#cb363-17"></a></span>
<span id="cb363-18"><a href="#cb363-18"></a>    <span class="cf">if</span> @Alias <span class="kw">is</span> <span class="kw">not</span> <span class="kw">null</span></span>
<span id="cb363-19"><a href="#cb363-19"></a>    <span class="cf">begin</span></span>
<span id="cb363-20"><a href="#cb363-20"></a></span>
<span id="cb363-21"><a href="#cb363-21"></a>        <span class="cf">begin</span> try</span>
<span id="cb363-22"><a href="#cb363-22"></a>            <span class="kw">set</span> @sql <span class="op">=</span> N<span class="st">&#39;declare @TestLang table (langdate datetime)</span></span>
<span id="cb363-23"><a href="#cb363-23"></a><span class="st">    set language </span><span class="ch">&#39;&#39;</span><span class="st">&#39;</span> <span class="op">+</span> @alias <span class="op">+</span> N<span class="st">&#39;</span><span class="ch">&#39;&#39;</span><span class="st">;</span></span>
<span id="cb363-24"><a href="#cb363-24"></a><span class="st">    insert into @TestLang (langdate)</span></span>
<span id="cb363-25"><a href="#cb363-25"></a><span class="st">    values (</span><span class="ch">&#39;&#39;</span><span class="st">2012-06-18T10:34:09</span><span class="ch">&#39;&#39;</span><span class="st">)&#39;</span></span>
<span id="cb363-26"><a href="#cb363-26"></a>            print <span class="st">&#39;Testing &#39;</span> <span class="op">+</span> @Alias</span>
<span id="cb363-27"><a href="#cb363-27"></a></span>
<span id="cb363-28"><a href="#cb363-28"></a>            <span class="kw">exec</span> sp_executesql @sql</span>
<span id="cb363-29"><a href="#cb363-29"></a>        <span class="cf">end</span> try</span>
<span id="cb363-30"><a href="#cb363-30"></a>        <span class="cf">begin</span> catch</span>
<span id="cb363-31"><a href="#cb363-31"></a>            print <span class="st">&#39;Error in language &#39;</span> <span class="op">+</span> @Alias</span>
<span id="cb363-32"><a href="#cb363-32"></a>            print ERROR_MESSAGE()</span>
<span id="cb363-33"><a href="#cb363-33"></a>        <span class="cf">end</span> catch</span>
<span id="cb363-34"><a href="#cb363-34"></a>    <span class="cf">end</span></span>
<span id="cb363-35"><a href="#cb363-35"></a></span>
<span id="cb363-36"><a href="#cb363-36"></a>    <span class="kw">select</span> @LangID <span class="op">=</span> <span class="fu">min</span>(langid)</span>
<span id="cb363-37"><a href="#cb363-37"></a>    <span class="kw">from</span> sys.syslanguages</span>
<span id="cb363-38"><a href="#cb363-38"></a>    <span class="kw">where</span> langid <span class="op">&gt;</span> @LangID</span>
<span id="cb363-39"><a href="#cb363-39"></a><span class="cf">end</span></span></code></pre></div>
<p>According to the <a href="http://technet.microsoft.com/en-us/library/ms180878%28v=sql.105%29.aspx#StringLiteralDateandTimeFormats" rel="nofollow noreferrer">String Literal Date and Time Formats</a> section in Microsoft TechNet, the standard ANSI Standard SQL date format “YYYY-MM-DD hh:mm:ss” is supposed to be “multi-language”. However, using the same query, the ANSI format does not work in all SQL languages.</p>
<p>For example, in Danish, you will many errors like the following:</p>
<blockquote>
<p>
Error in language Danish The conversion of a varchar data type to a datetime data type resulted in an out-of-range value.
</p>
</blockquote>
<p>If you want to build a query in C# to run on SQL Server, and you need to pass a date in the ISO 8601 format, use the <a href="https://docs.microsoft.com/en-us/dotnet/standard/base-types/standard-date-and-time-format-strings" rel="nofollow noreferrer">Sortable “s” format specifier</a>:</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb364-1"><a href="#cb364-1"></a>string.Format(<span class="ot">&quot;select convert(datetime2, &#39;{0:s}&#39;&quot;</span>, DateTime.Now);</span></code></pre></div>
</section>
<section id="answer-3-score-16" class="level4">
<h4>Answer 3 (score 16)</h4>
<p>Management studio creates scripts like:</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb365-1"><a href="#cb365-1"></a><span class="kw">insert</span> table1 (foodate) <span class="kw">values</span>(<span class="fu">CAST</span>(N<span class="st">&#39;2012-06-18 10:34:09.000&#39;</span> <span class="kw">AS</span> DateTime))</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-to-create-a-table-from-select-query-result-in-sql-server-2008-score-827650-in-2013" class="level3">
<h3>58: How to create a table from select query result in SQL Server 2008 (score <a href="https://stackoverflow.com/q/16683758.html">827650</a> in 2013)</h3>
<section id="question-57" class="level4">
<h4>Question</h4>
<p>I want to create a table from select query result in SQL Server, I tried</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb366-1"><a href="#cb366-1"></a><span class="kw">create</span> <span class="kw">table</span> temp <span class="kw">AS</span> <span class="kw">select</span><span class="op">....</span>.</span></code></pre></div>
<p>but I got an error</p>
<blockquote>
Incorrect syntax near the keyword ‘AS’
</blockquote>
</section>
<section id="answer-accepted-score-313" class="level4">
<h4>Answer accepted (score 313)</h4>
<p>Use following syntax to create new table from old table in SQL server 2008</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb367-1"><a href="#cb367-1"></a><span class="kw">Select</span> <span class="op">*</span> <span class="kw">into</span> new_table  <span class="kw">from</span>  old_table </span></code></pre></div>
</section>
<section id="answer-2-score-69" class="level4">
<h4>Answer 2 (score 69)</h4>
<p>use <code>SELECT...INTO</code></p>
<blockquote>
<p>
<strong>The SELECT INTO statement creates a new table and populates it with the result set of the SELECT statement.</strong> SELECT INTO can be used to combine data from several tables or views into one table. It can also be used to create a new table that contains data selected from a linked server.
</p>
</blockquote>
<p>Example,</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb368-1"><a href="#cb368-1"></a><span class="kw">SELECT</span> col1, col2 <span class="kw">INTO</span> #a <span class="co">-- &lt;&lt;== creates temporary table</span></span>
<span id="cb368-2"><a href="#cb368-2"></a><span class="kw">FROM</span>   tablename</span></code></pre></div>
<ul>
<li>
<a href="http://msdn.microsoft.com/en-us/library/ms190750.aspx">Inserting Rows by Using SELECT INTO</a>
</li>
</ul>
<p>Standard Syntax,</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb369-1"><a href="#cb369-1"></a><span class="kw">SELECT</span>  col1, <span class="op">....</span>., col@      <span class="co">-- &lt;&lt;== select as many columns as you want</span></span>
<span id="cb369-2"><a href="#cb369-2"></a>        <span class="kw">INTO</span> [<span class="kw">New</span> tableName]</span>
<span id="cb369-3"><a href="#cb369-3"></a><span class="kw">FROM</span>    [<span class="kw">Source</span> <span class="kw">Table</span> Name]</span></code></pre></div>
</section>
<section id="answer-3-score-25" class="level4">
<h4>Answer 3 (score 25)</h4>
<p>
Please be careful, MSSQL: <code>"SELECT * INTO NewTable FROM OldTable"</code>
</p>
<p>
is not always the same as MYSQL: <code>"create table temp AS select.."</code>
</p>
<p>
I think that there are occasions when this (in MSSQL) does not guarantee that all the fields in the new table are of the same type as the old.
</p>
<p>For example :</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb370-1"><a href="#cb370-1"></a><span class="kw">create</span> <span class="kw">table</span> oldTable (field1 <span class="dt">varchar</span>(<span class="dv">10</span>), field2 <span class="dt">integer</span>, field3 <span class="dt">float</span>)</span>
<span id="cb370-2"><a href="#cb370-2"></a><span class="kw">insert</span> <span class="kw">into</span> oldTable (field1,field2,field3) <span class="kw">values</span> (<span class="st">&#39;1&#39;</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb370-3"><a href="#cb370-3"></a><span class="kw">select</span> top <span class="dv">1</span> <span class="op">*</span> <span class="kw">into</span> newTable <span class="kw">from</span> oldTable</span></code></pre></div>
<p>does not always yield:</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb371-1"><a href="#cb371-1"></a><span class="kw">create</span> <span class="kw">table</span> newTable (field1 <span class="dt">varchar</span>(<span class="dv">10</span>), field2 <span class="dt">integer</span>, field3 <span class="dt">float</span>)</span></code></pre></div>
<p>but may be:</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb372-1"><a href="#cb372-1"></a><span class="kw">create</span> <span class="kw">table</span> newTable (field1 <span class="dt">varchar</span>(<span class="dv">10</span>), field2 <span class="dt">integer</span>, field3 <span class="dt">integer</span>)</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-do-i-split-a-string-so-i-can-access-item-x-score-817330-in-2018" class="level3">
<h3>59: How do I split a string so I can access item x? (score <a href="https://stackoverflow.com/q/2647.html">817330</a> in 2018)</h3>
<section id="question-58" class="level4">
<h4>Question</h4>
<p>Using SQL Server, how do I split a string so I can access item x?</p>
<p>Take a string “Hello John Smith”. How can I split the string by space and access the item at index 1 which should return “John”?</p>
</section>
<section id="answer-accepted-score-185" class="level4">
<h4>Answer accepted (score 185)</h4>
<p>You may find the solution in <em><a href="http://www.codeproject.com/KB/database/SQL_UDF_to_Parse_a_String.aspx" rel="noreferrer">SQL User Defined Function to Parse a Delimited String</a></em> helpful (from <a href="http://en.wikipedia.org/wiki/The_Code_Project" rel="noreferrer">The Code Project</a>).</p>
<p>You can use this simple logic:</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb373-1"><a href="#cb373-1"></a><span class="kw">Declare</span> @products <span class="dt">varchar</span>(<span class="dv">200</span>) <span class="op">=</span> <span class="st">&#39;1|20|3|343|44|6|8765&#39;</span></span>
<span id="cb373-2"><a href="#cb373-2"></a><span class="kw">Declare</span> @individual <span class="dt">varchar</span>(<span class="dv">20</span>) <span class="op">=</span> <span class="kw">null</span></span>
<span id="cb373-3"><a href="#cb373-3"></a></span>
<span id="cb373-4"><a href="#cb373-4"></a><span class="cf">WHILE</span> LEN(@products) <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb373-5"><a href="#cb373-5"></a><span class="cf">BEGIN</span></span>
<span id="cb373-6"><a href="#cb373-6"></a>    <span class="cf">IF</span> PATINDEX(<span class="st">&#39;%|%&#39;</span>, @products) <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb373-7"><a href="#cb373-7"></a>    <span class="cf">BEGIN</span></span>
<span id="cb373-8"><a href="#cb373-8"></a>        <span class="kw">SET</span> @individual <span class="op">=</span> SUBSTRING(@products,</span>
<span id="cb373-9"><a href="#cb373-9"></a>                                    <span class="dv">0</span>,</span>
<span id="cb373-10"><a href="#cb373-10"></a>                                    PATINDEX(<span class="st">&#39;%|%&#39;</span>, @products))</span>
<span id="cb373-11"><a href="#cb373-11"></a>        <span class="kw">SELECT</span> @individual</span>
<span id="cb373-12"><a href="#cb373-12"></a></span>
<span id="cb373-13"><a href="#cb373-13"></a>        <span class="kw">SET</span> @products <span class="op">=</span> SUBSTRING(@products,</span>
<span id="cb373-14"><a href="#cb373-14"></a>                                  LEN(@individual <span class="op">+</span> <span class="st">&#39;|&#39;</span>) <span class="op">+</span> <span class="dv">1</span>,</span>
<span id="cb373-15"><a href="#cb373-15"></a>                                  LEN(@products))</span>
<span id="cb373-16"><a href="#cb373-16"></a>    <span class="cf">END</span></span>
<span id="cb373-17"><a href="#cb373-17"></a>    <span class="cf">ELSE</span></span>
<span id="cb373-18"><a href="#cb373-18"></a>    <span class="cf">BEGIN</span></span>
<span id="cb373-19"><a href="#cb373-19"></a>        <span class="kw">SET</span> @individual <span class="op">=</span> @products</span>
<span id="cb373-20"><a href="#cb373-20"></a>        <span class="kw">SET</span> @products <span class="op">=</span> <span class="kw">NULL</span></span>
<span id="cb373-21"><a href="#cb373-21"></a>        <span class="kw">SELECT</span> @individual</span>
<span id="cb373-22"><a href="#cb373-22"></a>    <span class="cf">END</span></span>
<span id="cb373-23"><a href="#cb373-23"></a><span class="cf">END</span></span></code></pre></div>
</section>
<section id="answer-2-score-352" class="level4">
<h4>Answer 2 (score 352)</h4>
<p>I don’t believe SQL Server has a built-in split function, so other than a UDF, the only other answer I know is to hijack the PARSENAME function:</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb374-1"><a href="#cb374-1"></a><span class="kw">SELECT</span> PARSENAME(<span class="kw">REPLACE</span>(<span class="st">&#39;Hello John Smith&#39;</span>, <span class="st">&#39; &#39;</span>, <span class="st">&#39;.&#39;</span>), <span class="dv">2</span>) </span></code></pre></div>
<p>PARSENAME takes a string and splits it on the period character. It takes a number as its second argument, and that number specifies which segment of the string to return (working from back to front).</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb375-1"><a href="#cb375-1"></a><span class="kw">SELECT</span> PARSENAME(<span class="kw">REPLACE</span>(<span class="st">&#39;Hello John Smith&#39;</span>, <span class="st">&#39; &#39;</span>, <span class="st">&#39;.&#39;</span>), <span class="dv">3</span>)  <span class="co">--return Hello</span></span></code></pre></div>
<p>Obvious problem is when the string already contains a period. I still think using a UDF is the best way…any other suggestions?</p>
</section>
<section id="answer-3-score-108" class="level4">
<h4>Answer 3 (score 108)</h4>
<p>First, create a function (using CTE, common table expression does away with the need for a temp table)</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb376-1"><a href="#cb376-1"></a> <span class="kw">create</span> <span class="kw">function</span> dbo.SplitString </span>
<span id="cb376-2"><a href="#cb376-2"></a>    (</span>
<span id="cb376-3"><a href="#cb376-3"></a>        @str <span class="dt">nvarchar</span>(<span class="dv">4000</span>), </span>
<span id="cb376-4"><a href="#cb376-4"></a>        @separator <span class="dt">char</span>(<span class="dv">1</span>)</span>
<span id="cb376-5"><a href="#cb376-5"></a>    )</span>
<span id="cb376-6"><a href="#cb376-6"></a>    returns <span class="kw">table</span></span>
<span id="cb376-7"><a href="#cb376-7"></a>    <span class="kw">AS</span></span>
<span id="cb376-8"><a href="#cb376-8"></a>    <span class="kw">return</span> (</span>
<span id="cb376-9"><a href="#cb376-9"></a>        <span class="kw">with</span> tokens(p, a, b) <span class="kw">AS</span> (</span>
<span id="cb376-10"><a href="#cb376-10"></a>            <span class="kw">select</span> </span>
<span id="cb376-11"><a href="#cb376-11"></a>                <span class="dv">1</span>, </span>
<span id="cb376-12"><a href="#cb376-12"></a>                <span class="dv">1</span>, </span>
<span id="cb376-13"><a href="#cb376-13"></a>                charindex(@separator, @str)</span>
<span id="cb376-14"><a href="#cb376-14"></a>            <span class="kw">union</span> <span class="kw">all</span></span>
<span id="cb376-15"><a href="#cb376-15"></a>            <span class="kw">select</span></span>
<span id="cb376-16"><a href="#cb376-16"></a>                p <span class="op">+</span> <span class="dv">1</span>, </span>
<span id="cb376-17"><a href="#cb376-17"></a>                b <span class="op">+</span> <span class="dv">1</span>, </span>
<span id="cb376-18"><a href="#cb376-18"></a>                charindex(@separator, @str, b <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb376-19"><a href="#cb376-19"></a>            <span class="kw">from</span> tokens</span>
<span id="cb376-20"><a href="#cb376-20"></a>            <span class="kw">where</span> b <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb376-21"><a href="#cb376-21"></a>        )</span>
<span id="cb376-22"><a href="#cb376-22"></a>        <span class="kw">select</span></span>
<span id="cb376-23"><a href="#cb376-23"></a>            p<span class="op">-</span><span class="dv">1</span> zeroBasedOccurance,</span>
<span id="cb376-24"><a href="#cb376-24"></a>            substring(</span>
<span id="cb376-25"><a href="#cb376-25"></a>                @str, </span>
<span id="cb376-26"><a href="#cb376-26"></a>                a, </span>
<span id="cb376-27"><a href="#cb376-27"></a>                <span class="cf">case</span> <span class="cf">when</span> b <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">then</span> b<span class="op">-</span>a <span class="cf">ELSE</span> <span class="dv">4000</span> <span class="cf">end</span>) </span>
<span id="cb376-28"><a href="#cb376-28"></a>            <span class="kw">AS</span> s</span>
<span id="cb376-29"><a href="#cb376-29"></a>        <span class="kw">from</span> tokens</span>
<span id="cb376-30"><a href="#cb376-30"></a>      )</span>
<span id="cb376-31"><a href="#cb376-31"></a>    GO</span></code></pre></div>
<p>Then, use it as any table (or modify it to fit within your existing stored proc) like this.</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb377-1"><a href="#cb377-1"></a><span class="kw">select</span> s </span>
<span id="cb377-2"><a href="#cb377-2"></a><span class="kw">from</span> dbo.SplitString(<span class="st">&#39;Hello John Smith&#39;</span>, <span class="st">&#39; &#39;</span>)</span>
<span id="cb377-3"><a href="#cb377-3"></a><span class="kw">where</span> zeroBasedOccurance<span class="op">=</span><span class="dv">1</span></span></code></pre></div>
<p><strong>Update</strong></p>
<p>Previous version would fail for input string longer than 4000 chars. This version takes care of the limitation:</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb378-1"><a href="#cb378-1"></a><span class="kw">create</span> <span class="kw">function</span> dbo.SplitString </span>
<span id="cb378-2"><a href="#cb378-2"></a>(</span>
<span id="cb378-3"><a href="#cb378-3"></a>    @str <span class="dt">nvarchar</span>(<span class="fu">max</span>), </span>
<span id="cb378-4"><a href="#cb378-4"></a>    @separator <span class="dt">char</span>(<span class="dv">1</span>)</span>
<span id="cb378-5"><a href="#cb378-5"></a>)</span>
<span id="cb378-6"><a href="#cb378-6"></a>returns <span class="kw">table</span></span>
<span id="cb378-7"><a href="#cb378-7"></a><span class="kw">AS</span></span>
<span id="cb378-8"><a href="#cb378-8"></a><span class="kw">return</span> (</span>
<span id="cb378-9"><a href="#cb378-9"></a><span class="kw">with</span> tokens(p, a, b) <span class="kw">AS</span> (</span>
<span id="cb378-10"><a href="#cb378-10"></a>    <span class="kw">select</span> </span>
<span id="cb378-11"><a href="#cb378-11"></a>        <span class="fu">cast</span>(<span class="dv">1</span> <span class="kw">as</span> bigint), </span>
<span id="cb378-12"><a href="#cb378-12"></a>        <span class="fu">cast</span>(<span class="dv">1</span> <span class="kw">as</span> bigint), </span>
<span id="cb378-13"><a href="#cb378-13"></a>        charindex(@separator, @str)</span>
<span id="cb378-14"><a href="#cb378-14"></a>    <span class="kw">union</span> <span class="kw">all</span></span>
<span id="cb378-15"><a href="#cb378-15"></a>    <span class="kw">select</span></span>
<span id="cb378-16"><a href="#cb378-16"></a>        p <span class="op">+</span> <span class="dv">1</span>, </span>
<span id="cb378-17"><a href="#cb378-17"></a>        b <span class="op">+</span> <span class="dv">1</span>, </span>
<span id="cb378-18"><a href="#cb378-18"></a>        charindex(@separator, @str, b <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb378-19"><a href="#cb378-19"></a>    <span class="kw">from</span> tokens</span>
<span id="cb378-20"><a href="#cb378-20"></a>    <span class="kw">where</span> b <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb378-21"><a href="#cb378-21"></a>)</span>
<span id="cb378-22"><a href="#cb378-22"></a><span class="kw">select</span></span>
<span id="cb378-23"><a href="#cb378-23"></a>    p<span class="op">-</span><span class="dv">1</span> ItemIndex,</span>
<span id="cb378-24"><a href="#cb378-24"></a>    substring(</span>
<span id="cb378-25"><a href="#cb378-25"></a>        @str, </span>
<span id="cb378-26"><a href="#cb378-26"></a>        a, </span>
<span id="cb378-27"><a href="#cb378-27"></a>        <span class="cf">case</span> <span class="cf">when</span> b <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">then</span> b<span class="op">-</span>a <span class="cf">ELSE</span> LEN(@str) <span class="cf">end</span>) </span>
<span id="cb378-28"><a href="#cb378-28"></a>    <span class="kw">AS</span> s</span>
<span id="cb378-29"><a href="#cb378-29"></a><span class="kw">from</span> tokens</span>
<span id="cb378-30"><a href="#cb378-30"></a>);</span>
<span id="cb378-31"><a href="#cb378-31"></a></span>
<span id="cb378-32"><a href="#cb378-32"></a>GO</span></code></pre></div>
<p>Usage remains the same.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="copy-tables-from-one-database-to-another-in-sql-server-score-814936-in-2013" class="level3">
<h3>60: Copy tables from one database to another in SQL Server (score <a href="https://stackoverflow.com/q/187770.html">814936</a> in 2013)</h3>
<section id="question-59" class="level4">
<h4>Question</h4>
<p>I have a database called foo and a database called bar. I have a table in foo called tblFoobar that I want to move (data and all) to database bar from database foo. What is the SQL statement to do this?</p>
</section>
<section id="answer-accepted-score-204" class="level4">
<h4>Answer accepted (score 204)</h4>
<p>On SQL Server? and on the same database server? Use three part naming.</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb379-1"><a href="#cb379-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> bar<span class="op">..</span>tblFoobar( <span class="op">*</span>fieldlist<span class="op">*</span> )</span>
<span id="cb379-2"><a href="#cb379-2"></a><span class="kw">SELECT</span> <span class="op">*</span>fieldlist<span class="op">*</span> <span class="kw">FROM</span> foo<span class="op">..</span>tblFoobar</span></code></pre></div>
<p>This just moves the data. If you want to move the table definition (and other attributes such as permissions and indexes), you’ll have to do something else.</p>
</section>
<section id="answer-2-score-531" class="level4">
<h4>Answer 2 (score 531)</h4>
<p>SQL Server Management Studio’s “Import Data” task (right-click on the DB name, then tasks) will do most of this for you. Run it from the database you want to copy the data into.</p>
<p>If the tables don’t exist it will create them for you, but you’ll probably have to recreate any indexes and such. If the tables do exist, it will append the new data by default but you can adjust that (edit mappings) so it will delete all existing data.</p>
<p>I use this all the time and it works fairly well.</p>
</section>
<section id="answer-3-score-102" class="level4">
<h4>Answer 3 (score 102)</h4>
<p>This should work:</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb380-1"><a href="#cb380-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb380-2"><a href="#cb380-2"></a><span class="kw">INTO</span> DestinationDB<span class="op">..</span>MyDestinationTable </span>
<span id="cb380-3"><a href="#cb380-3"></a><span class="kw">FROM</span> SourceDB<span class="op">..</span>MySourceTable </span></code></pre></div>
<p>It will <strong>not</strong> copy constaints, defaults or indexes. The table created will <strong>not</strong> have a clustered index.</p>
<p>Alternatively you could:</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb381-1"><a href="#cb381-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> DestinationDB<span class="op">..</span>MyDestinationTable </span>
<span id="cb381-2"><a href="#cb381-2"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> SourceDB<span class="op">..</span>MySourceTable</span></code></pre></div>
<p>If your destination table exists and is empty.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="sql-server---select-from-stored-procedure-score-813645-in-2012" class="level3">
<h3>61: SQL Server - SELECT FROM stored procedure (score <a href="https://stackoverflow.com/q/1492411.html">813645</a> in 2012)</h3>
<section id="question-60" class="level4">
<h4>Question</h4>
<p>I have a stored procedure that returns rows:</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb382-1"><a href="#cb382-1"></a><span class="kw">CREATE</span> <span class="kw">PROCEDURE</span> MyProc</span>
<span id="cb382-2"><a href="#cb382-2"></a><span class="kw">AS</span></span>
<span id="cb382-3"><a href="#cb382-3"></a><span class="cf">BEGIN</span></span>
<span id="cb382-4"><a href="#cb382-4"></a>    <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> MyTable</span>
<span id="cb382-5"><a href="#cb382-5"></a><span class="cf">END</span></span></code></pre></div>
<p>My actual procedure is a little more complicated, which is why a sproc is necessary.</p>
<p>Is it possible to select the output by calling this procedure?</p>
<p>Something like:</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb383-1"><a href="#cb383-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> (<span class="kw">EXEC</span> MyProc) <span class="kw">AS</span> TEMP</span></code></pre></div>
<p>I need to use <code>SELECT TOP X</code>, <code>ROW_NUMBER</code>, and an additional <code>WHERE</code> clause to page my data, and I don’t really want to pass these values as parameters.</p>
</section>
<section id="answer-accepted-score-143" class="level4">
<h4>Answer accepted (score 143)</h4>
<p>You can use a <a href="https://docs.microsoft.com/en-us/sql/relational-databases/user-defined-functions/user-defined-functions" rel="noreferrer">User-defined function</a> or a <a href="https://docs.microsoft.com/en-us/sql/relational-databases/views/views" rel="noreferrer">view</a> instead of a procedure.</p>
<p>A procedure can return multiple result sets, each with its own schema. It’s not suitable for using in a <code>SELECT</code> statement.</p>
</section>
<section id="answer-2-score-171" class="level4">
<h4>Answer 2 (score 171)</h4>
<p>You can</p>
<ol>
<li>
create a table variable to hold the result set from the stored proc and then
</li>
<li>
insert the output of the stored proc into the table variable, and then
</li>
<li>
use the table variable exactly as you would any other table…
</li>
</ol>
<p>… sql ….</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb384-1"><a href="#cb384-1"></a><span class="kw">Declare</span> @T <span class="kw">Table</span> ([<span class="kw">column</span> definitions here])</span>
<span id="cb384-2"><a href="#cb384-2"></a><span class="kw">Insert</span> @T <span class="kw">Exec</span> storedProcname params </span>
<span id="cb384-3"><a href="#cb384-3"></a><span class="kw">Select</span> <span class="op">*</span> <span class="kw">from</span> @T <span class="kw">Where</span> <span class="op">..</span>.</span></code></pre></div>
</section>
<section id="answer-3-score-156" class="level4">
<h4>Answer 3 (score 156)</h4>
<p>You should look at this excellent article by Erland Sommarskog:</p>
<ul>
<li>
<a href="http://www.sommarskog.se/share_data.html" rel="noreferrer">How to Share Data Between Stored Procedure</a>
</li>
</ul>
<p>It basically lists all available options for your scenario.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="adding-an-identity-to-an-existing-column-score-807332-in-2011" class="level3">
<h3>62: Adding an identity to an existing column (score <a href="https://stackoverflow.com/q/1049210.html">807332</a> in 2011)</h3>
<section id="question-61" class="level4">
<h4>Question</h4>
<p>I need to change the primary key of a table to an identity column, and there’s already a number of rows in table.</p>
<p>I’ve got a script to clean up the IDs to ensure they’re sequential starting at 1, works fine on my test database.</p>
<p>What’s the SQL command to alter the column to have an identity property?</p>
</section>
<section id="answer-accepted-score-450" class="level4">
<h4>Answer accepted (score 450)</h4>
<p>You can’t alter the existing columns for identity.</p>
<p>You have 2 options,</p>
<ol>
<li>
<p>
Create a new table with identity &amp; drop the existing table
</p>
</li>
<li>
<p>
Create a new column with identity &amp; drop the existing column
</p>
</li>
</ol>
<p>Approach 1. (<em>New table</em>) Here you can retain the existing data values on the newly created identity column.</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb385-1"><a href="#cb385-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> dbo.Tmp_Names</span>
<span id="cb385-2"><a href="#cb385-2"></a>    (</span>
<span id="cb385-3"><a href="#cb385-3"></a>      <span class="kw">Id</span> <span class="dt">int</span> <span class="kw">NOT</span> <span class="kw">NULL</span></span>
<span id="cb385-4"><a href="#cb385-4"></a>             IDENTITY(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb385-5"><a href="#cb385-5"></a>      Name <span class="dt">varchar</span>(<span class="dv">50</span>) <span class="kw">NULL</span></span>
<span id="cb385-6"><a href="#cb385-6"></a>    )</span>
<span id="cb385-7"><a href="#cb385-7"></a><span class="kw">ON</span>  [<span class="kw">PRIMARY</span>]</span>
<span id="cb385-8"><a href="#cb385-8"></a>go</span>
<span id="cb385-9"><a href="#cb385-9"></a></span>
<span id="cb385-10"><a href="#cb385-10"></a><span class="kw">SET</span> IDENTITY_INSERT dbo.Tmp_Names <span class="kw">ON</span></span>
<span id="cb385-11"><a href="#cb385-11"></a>go</span>
<span id="cb385-12"><a href="#cb385-12"></a></span>
<span id="cb385-13"><a href="#cb385-13"></a><span class="cf">IF</span> <span class="kw">EXISTS</span> ( <span class="kw">SELECT</span>  <span class="op">*</span></span>
<span id="cb385-14"><a href="#cb385-14"></a>            <span class="kw">FROM</span>    dbo.Names ) </span>
<span id="cb385-15"><a href="#cb385-15"></a>    <span class="kw">INSERT</span>  <span class="kw">INTO</span> dbo.Tmp_Names ( <span class="kw">Id</span>, Name )</span>
<span id="cb385-16"><a href="#cb385-16"></a>            <span class="kw">SELECT</span>  <span class="kw">Id</span>,</span>
<span id="cb385-17"><a href="#cb385-17"></a>                    Name</span>
<span id="cb385-18"><a href="#cb385-18"></a>            <span class="kw">FROM</span>    dbo.Names TABLOCKX</span>
<span id="cb385-19"><a href="#cb385-19"></a>go</span>
<span id="cb385-20"><a href="#cb385-20"></a></span>
<span id="cb385-21"><a href="#cb385-21"></a><span class="kw">SET</span> IDENTITY_INSERT dbo.Tmp_Names <span class="kw">OFF</span></span>
<span id="cb385-22"><a href="#cb385-22"></a>go</span>
<span id="cb385-23"><a href="#cb385-23"></a></span>
<span id="cb385-24"><a href="#cb385-24"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> dbo.Names</span>
<span id="cb385-25"><a href="#cb385-25"></a>go</span>
<span id="cb385-26"><a href="#cb385-26"></a></span>
<span id="cb385-27"><a href="#cb385-27"></a><span class="kw">Exec</span> sp_rename <span class="st">&#39;Tmp_Names&#39;</span>, <span class="st">&#39;Names&#39;</span></span></code></pre></div>
<p>Approach 2 (<em>New column</em>) You can’t retain the existing data values on the newly created identity column, The identity column will hold the sequence of number.</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb386-1"><a href="#cb386-1"></a><span class="kw">Alter</span> <span class="kw">Table</span> Names</span>
<span id="cb386-2"><a href="#cb386-2"></a><span class="kw">Add</span> Id_new <span class="dt">Int</span> Identity(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb386-3"><a href="#cb386-3"></a>Go</span>
<span id="cb386-4"><a href="#cb386-4"></a></span>
<span id="cb386-5"><a href="#cb386-5"></a><span class="kw">Alter</span> <span class="kw">Table</span> Names <span class="kw">Drop</span> <span class="kw">Column</span> <span class="kw">ID</span></span>
<span id="cb386-6"><a href="#cb386-6"></a>Go</span>
<span id="cb386-7"><a href="#cb386-7"></a></span>
<span id="cb386-8"><a href="#cb386-8"></a><span class="kw">Exec</span> sp_rename <span class="st">&#39;Names.Id_new&#39;</span>, <span class="st">&#39;ID&#39;</span>, <span class="st">&#39;Column&#39;</span></span></code></pre></div>
<p>See the following Microsoft SQL Server Forum post for more details:</p>
<p><a href="http://social.msdn.microsoft.com/forums/en-US/transactsql/thread/04d69ee6-d4f5-4f8f-a115-d89f7bcbc032" rel="noreferrer">How to alter column to identity(1,1)</a></p>
</section>
<section id="answer-2-score-197" class="level4">
<h4>Answer 2 (score 197)</h4>
<p>In SQL 2005 and above, there’s a trick to solve this problem without changing the table’s data pages. This is important for large tables where touching every data page can take minutes or hours. The trick also works even if the identity column is a primary key, is part of a clustered or non-clustered index, or other gotchas which can trip up the the simpler “add/remove/rename column” solution.</p>
<p>Here’s the trick: you can use SQL Server’s <a href="https://docs.microsoft.com/en-us/sql/t-sql/statements/alter-table-transact-sql" rel="noreferrer">ALTER TABLE…SWITCH</a> statement to change the schema of a table without changing the data, meaning you can replace a table with an IDENTITY with an identical table schema, but without an IDENTITY column. The same trick works to add IDENTITY to an existing column.</p>
<p>Normally, <a href="https://docs.microsoft.com/en-us/sql/t-sql/statements/alter-table-transact-sql" rel="noreferrer">ALTER TABLE…SWITCH</a> is used to efficiently replace a full partition in a partitioned table with a new, empty partition. But it can also be used in non-partitioned tables too.</p>
<p>I’ve used this trick to convert, in under 5 seconds, a column of a of a 2.5 billion row table from IDENTITY to a non-IDENTITY (in order to run a multi-hour query whose query plan worked better for non-IDENTITY columns), and then restored the IDENTITY setting, again in less than 5 seconds.</p>
<p>Here’s a code sample of how it works.</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb387-1"><a href="#cb387-1"></a> <span class="kw">CREATE</span> <span class="kw">TABLE</span> Test</span>
<span id="cb387-2"><a href="#cb387-2"></a> (</span>
<span id="cb387-3"><a href="#cb387-3"></a>   <span class="kw">id</span> <span class="dt">int</span> identity(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb387-4"><a href="#cb387-4"></a>   somecolumn <span class="dt">varchar</span>(<span class="dv">10</span>)</span>
<span id="cb387-5"><a href="#cb387-5"></a> );</span>
<span id="cb387-6"><a href="#cb387-6"></a></span>
<span id="cb387-7"><a href="#cb387-7"></a> <span class="kw">INSERT</span> <span class="kw">INTO</span> Test <span class="kw">VALUES</span> (<span class="st">&#39;Hello&#39;</span>);</span>
<span id="cb387-8"><a href="#cb387-8"></a> <span class="kw">INSERT</span> <span class="kw">INTO</span> Test <span class="kw">VALUES</span> (<span class="st">&#39;World&#39;</span>);</span>
<span id="cb387-9"><a href="#cb387-9"></a></span>
<span id="cb387-10"><a href="#cb387-10"></a> <span class="co">-- copy the table. use same schema, but no identity</span></span>
<span id="cb387-11"><a href="#cb387-11"></a> <span class="kw">CREATE</span> <span class="kw">TABLE</span> Test2</span>
<span id="cb387-12"><a href="#cb387-12"></a> (</span>
<span id="cb387-13"><a href="#cb387-13"></a>   <span class="kw">id</span> <span class="dt">int</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb387-14"><a href="#cb387-14"></a>   somecolumn <span class="dt">varchar</span>(<span class="dv">10</span>)</span>
<span id="cb387-15"><a href="#cb387-15"></a> );</span>
<span id="cb387-16"><a href="#cb387-16"></a></span>
<span id="cb387-17"><a href="#cb387-17"></a> <span class="kw">ALTER</span> <span class="kw">TABLE</span> Test <span class="kw">SWITCH</span> <span class="kw">TO</span> Test2;</span>
<span id="cb387-18"><a href="#cb387-18"></a></span>
<span id="cb387-19"><a href="#cb387-19"></a> <span class="co">-- drop the original (now empty) table</span></span>
<span id="cb387-20"><a href="#cb387-20"></a> <span class="kw">DROP</span> <span class="kw">TABLE</span> Test;</span>
<span id="cb387-21"><a href="#cb387-21"></a></span>
<span id="cb387-22"><a href="#cb387-22"></a> <span class="co">-- rename new table to old table&#39;s name</span></span>
<span id="cb387-23"><a href="#cb387-23"></a> <span class="kw">EXEC</span> sp_rename <span class="st">&#39;Test2&#39;</span>,<span class="st">&#39;Test&#39;</span>;</span>
<span id="cb387-24"><a href="#cb387-24"></a></span>
<span id="cb387-25"><a href="#cb387-25"></a> <span class="co">-- update the identity seed</span></span>
<span id="cb387-26"><a href="#cb387-26"></a> DBCC CHECKIDENT(<span class="st">&#39;Test&#39;</span>);</span>
<span id="cb387-27"><a href="#cb387-27"></a></span>
<span id="cb387-28"><a href="#cb387-28"></a> <span class="co">-- see same records</span></span>
<span id="cb387-29"><a href="#cb387-29"></a> <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> Test; </span></code></pre></div>
<p>This is obviously more involved than the solutions in other answers, but if your table is large this can be a real life-saver. There are some caveats:</p>
<ul>
<li>
As far as I know, identity is the only thing you can change about your table’s columns with this method. Adding/removing columns, changing nullability, etc. isn’t allowed.
</li>
<li>
You’ll need to drop foriegn keys before you do the switch and restore them after.
</li>
<li>
Same for WITH SCHEMABINDING functions, views, etc.
</li>
<li>
new table’s indexes need to match exactly (same columns, same order, etc.)
</li>
<li>
Old and new tables need to be on the same filegroup.
</li>
<li>
Only works on SQL Server 2005 or later
</li>
<li>
I previously believed that this trick only works on the Enterprise or Developer editions of SQL Server (because partitions are only supported in Enterprise and Developer versions), but Mason G. Zhwiti in his comment below says that it also works in SQL Standard Edition too. I assume this means that the restriction to Enterprise or Developer doesn’t apply to ALTER TABLE…SWITCH.
</li>
</ul>
<p>There’s a good <a href="https://technet.microsoft.com/en-us/library/ms191160.aspx" rel="noreferrer">article on TechNet</a> detailing the requirements above.</p>
<p>UPDATE - <a href="https://stackoverflow.com/users/2713582/eric-wu">Eric Wu</a> had a comment below that adds important info about this solution. Copying it here to make sure it gets more attention:</p>
<blockquote>
<p>
There’s another caveat here that is worth mentioning. Although the new table will happily receive data from the old table, and all the new rows will be inserted following a identity pattern, they will start at 1 and potentially break if the said column is a primary key. Consider running <code>DBCC CHECKIDENT('&amp;lt;newTableName&amp;gt;')</code> immediately after switching. See <a href="http://msdn.microsoft.com/en-us/library/ms176057.aspx" rel="noreferrer">msdn.microsoft.com/en-us/library/ms176057.aspx</a> for more info.
</p>
</blockquote>
<p>If the table is actively being extended with new rows (meaning you don’t have much if any downtime between adding IDENTITY and adding new rows, then instead of <code>DBCC CHECKIDENT</code> you’ll want to manually set the identity seed value in the new table schema to be larger than the largest existing ID in the table, e.g. <code>IDENTITY (2435457, 1)</code>. You might be able to include both the <code>ALTER TABLE...SWITCH</code> and the <code>DBCC CHECKIDENT</code> in a transaction (or not– haven’t tested this) but seems like setting the seed value manually will be easier and safer.</p>
<p>Obviously, if no new rows are being added to the table (or they’re only added occasionally, like a daily ETL process) then this race condition won’t happen so <code>DBCC CHECKIDENT</code> is fine.</p>
</section>
<section id="answer-3-score-66" class="level4">
<h4>Answer 3 (score 66)</h4>
<p>You cannot alter a column to be an IDENTITY column. What you’ll need to do is create a new column which is defined as an IDENTITY from the get-go, then drop the old column, and rename the new one to the old name.</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb388-1"><a href="#cb388-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> (yourTable) <span class="kw">ADD</span> NewColumn <span class="dt">INT</span> IDENTITY(<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb388-2"><a href="#cb388-2"></a></span>
<span id="cb388-3"><a href="#cb388-3"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> (yourTable) <span class="kw">DROP</span> <span class="kw">COLUMN</span> OldColumnName</span>
<span id="cb388-4"><a href="#cb388-4"></a></span>
<span id="cb388-5"><a href="#cb388-5"></a><span class="kw">EXEC</span> sp_rename <span class="st">&#39;yourTable.NewColumn&#39;</span>, <span class="st">&#39;OldColumnName&#39;</span>, <span class="st">&#39;COLUMN&#39;</span></span></code></pre></div>
<p>Marc</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-does-database-indexing-work-score-804940-in-2018" class="level3">
<h3>63: How does database indexing work? (score <a href="https://stackoverflow.com/q/1108.html">804940</a> in 2018)</h3>
<section id="question-62" class="level4">
<h4>Question</h4>
<p>Given that indexing is so important as your data set increases in size, can someone explain how indexing works at a database-agnostic level?</p>
<p>For information on queries to index a field, check out <a href="https://stackoverflow.com/questions/1156/">How do I index a database column</a>.</p>
</section>
<section id="answer-accepted-score-3385" class="level4">
<h4>Answer accepted (score 3385)</h4>
<p><strong>Why is it needed?</strong></p>
<p>When data is stored on disk-based storage devices, it is stored as blocks of data. These blocks are accessed in their entirety, making them the atomic disk access operation. Disk blocks are structured in much the same way as linked lists; both contain a section for data, a pointer to the location of the next node (or block), and both need not be stored contiguously.</p>
<p>Due to the fact that a number of records can only be sorted on one field, we can state that searching on a field that isn’t sorted requires a Linear Search which requires <code>N/2</code> block accesses (on average), where <code>N</code> is the number of blocks that the table spans. If that field is a non-key field (i.e. doesn’t contain unique entries) then the entire tablespace must be searched at <code>N</code> block accesses.</p>
<p>Whereas with a sorted field, a Binary Search may be used, which has <code>log2 N</code> block accesses. Also since the data is sorted given a non-key field, the rest of the table doesn’t need to be searched for duplicate values, once a higher value is found. Thus the performance increase is substantial.</p>
<p><strong>What is indexing?</strong></p>
<p>Indexing is a way of sorting a number of records on multiple fields. Creating an index on a field in a table creates another data structure which holds the field value, and a pointer to the record it relates to. This index structure is then sorted, allowing Binary Searches to be performed on it.</p>
<p>The downside to indexing is that these indices require additional space on the disk since the indices are stored together in a table using the MyISAM engine, this file can quickly reach the size limits of the underlying file system if many fields within the same table are indexed.</p>
<p><strong>How does it work?</strong></p>
<p>Firstly, let’s outline a sample database table schema;</p>
<pre>
Field name       Data type      Size on disk
id (Primary key) Unsigned INT   4 bytes
firstName        Char(50)       50 bytes
lastName         Char(50)       50 bytes
emailAddress     Char(100)      100 bytes
</pre>
<p>
<strong>Note</strong>: char was used in place of varchar to allow for an accurate size on disk value. This sample database contains five million rows and is unindexed. The performance of several queries will now be analyzed. These are a query using the <em>id</em> (a sorted key field) and one using the <em>firstName</em> (a non-key unsorted field).
</p>
<p><strong><em>Example 1</em></strong> - <em>sorted vs unsorted fields</em></p>
<p>Given our sample database of <code>r = 5,000,000</code> records of a fixed size giving a record length of <code>R = 204</code> bytes and they are stored in a table using the MyISAM engine which is using the default block size <code>B = 1,024</code> bytes. The blocking factor of the table would be <code>bfr = (B/R) = 1024/204 = 5</code> records per disk block. The total number of blocks required to hold the table is <code>N = (r/bfr) = 5000000/5 = 1,000,000</code> blocks.</p>
<p>A linear search on the id field would require an average of <code>N/2 = 500,000</code> block accesses to find a value, given that the id field is a key field. But since the id field is also sorted, a binary search can be conducted requiring an average of <code>log2 1000000 = 19.93 = 20</code> block accesses. Instantly we can see this is a drastic improvement.</p>
<p>Now the <em>firstName</em> field is neither sorted nor a key field, so a binary search is impossible, nor are the values unique, and thus the table will require searching to the end for an exact <code>N = 1,000,000</code> block accesses. It is this situation that indexing aims to correct.</p>
<p>Given that an index record contains only the indexed field and a pointer to the original record, it stands to reason that it will be smaller than the multi-field record that it points to. So the index itself requires fewer disk blocks than the original table, which therefore requires fewer block accesses to iterate through. The schema for an index on the <em>firstName</em> field is outlined below;</p>
<pre>
Field name       Data type      Size on disk
firstName        Char(50)       50 bytes
(record pointer) Special        4 bytes
</pre>
<p><strong>Note</strong>: Pointers in MySQL are 2, 3, 4 or 5 bytes in length depending on the size of the table.</p>
<p><strong><em>Example 2</em></strong> - <em>indexing</em></p>
<p>Given our sample database of <code>r = 5,000,000</code> records with an index record length of <code>R = 54</code> bytes and using the default block size <code>B = 1,024</code> bytes. The blocking factor of the index would be <code>bfr = (B/R) = 1024/54 = 18</code> records per disk block. The total number of blocks required to hold the index is <code>N = (r/bfr) = 5000000/18 = 277,778</code> blocks.</p>
<p>Now a search using the <em>firstName</em> field can utilize the index to increase performance. This allows for a binary search of the index with an average of <code>log2 277778 = 18.08 = 19</code> block accesses. To find the address of the actual record, which requires a further block access to read, bringing the total to <code>19 + 1 = 20</code> block accesses, a far cry from the 1,000,000 block accesses required to find a <em>firstName</em> match in the non-indexed table.</p>
<p><strong>When should it be used?</strong></p>
<p>Given that creating an index requires additional disk space (277,778 blocks extra from the above example, a ~28% increase), and that too many indices can cause issues arising from the file systems size limits, careful thought must be used to select the correct fields to index.</p>
<p>Since indices are only used to speed up the searching for a matching field within the records, it stands to reason that indexing fields used only for output would be simply a waste of disk space and processing time when doing an insert or delete operation, and thus should be avoided. Also given the nature of a binary search, the cardinality or uniqueness of the data is important. Indexing on a field with a cardinality of 2 would split the data in half, whereas a cardinality of 1,000 would return approximately 1,000 records. With such a low cardinality the effectiveness is reduced to a linear sort, and the query optimizer will avoid using the index if the cardinality is less than 30% of the record number, effectively making the index a waste of space.</p>
</section>
<section id="answer-2-score-232" class="level4">
<h4>Answer 2 (score 232)</h4>
<p>The first time I read this it was very helpful to me. Thank you.</p>
<p>
Since then I gained some insight about the downside of creating indexes: if you write into a table (<code>UPDATE</code> or <code>INSERT</code>) with one index, you have actually two writing operations in the file system. One for the table data and another one for the index data (and the resorting of it (and - if clustered - the resorting of the table data)). If table and index are located on the same hard disk this costs more time. Thus a table without an index (a heap) , would allow for quicker write operations. (if you had two indexes you would end up with three write operations, and so on)
</p>
<p>However, defining two different locations on two different hard disks for index data and table data can decrease/eliminate the problem of increased cost of time. This requires definition of additional file groups with according files on the desired hard disks and definition of table/index location as desired.</p>
<p>Another problem with indexes is their fragmentation over time as data is inserted. <code>REORGANIZE</code> helps, you must write routines to have it done.</p>
<p>In certain scenarios a heap is more helpful than a table with indexes,</p>
<p>e.g:- If you have lots of rivalling writes but only one nightly read outside business hours for reporting.</p>
<p>Also, a differentiation between clustered and non-clustered indexes is rather important.</p>
<p>Helped me:- <a href="https://stackoverflow.com/questions/1251636/what-do-clustered-and-non-clustered-index-actually-mean">What do Clustered and Non clustered index actually mean?</a></p>
</section>
<section id="answer-3-score-221" class="level4">
<h4>Answer 3 (score 221)</h4>
<p>Classic example <strong>“Index in Books”</strong></p>
<p>Consider a “Book” of 1000 pages, divided by 100 sections, each section with X pages.</p>
<p>Simple, huh?</p>
<p>Now, without an index page, to find a particular section that starts with letter “S”, you have no other option than scanning through the entire book. i.e: 1000 pages</p>
<p>But with an index page at the beginning, you are there. And more, to read any particular section that matters, you just need to look over the index page, again and again, every time. After finding the matching index you can efficiently jump to the section by skipping other sections.</p>
<p>But then, in addition to 1000 pages, you will need another ~10 pages to display the index page, so totally 1010 pages.</p>
<p>Thus, the index is a separate section that stores values of indexed column + pointer to the indexed row in a sorted order for efficient look-ups.</p>
<p>Things are simple in schools, isn’t it? :P</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="sqlmysql---select-distinctunique-but-return-all-columns-score-797787-in-2015" class="level3">
<h3>64: SQL/mysql - Select distinct/UNIQUE but return all columns? (score <a href="https://stackoverflow.com/q/6127338.html">797787</a> in 2015)</h3>
<section id="question-63" class="level4">
<h4>Question</h4>
<div class="sourceCode" id="cb389"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb389-1"><a href="#cb389-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> field1, field2, field3, <span class="op">......</span>   <span class="kw">FROM</span> <span class="kw">table</span></span></code></pre></div>
<p>I am trying to accomplish the following sql statement but I want it to return all columns is this possible? Something like:</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb390-1"><a href="#cb390-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> field1, <span class="op">*</span> <span class="kw">from</span> <span class="kw">table</span></span></code></pre></div>
</section>
<section id="answer-accepted-score-375" class="level4">
<h4>Answer accepted (score 375)</h4>
<p>You’re looking for a group by:</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb391-1"><a href="#cb391-1"></a><span class="kw">select</span> <span class="op">*</span></span>
<span id="cb391-2"><a href="#cb391-2"></a><span class="kw">from</span> <span class="kw">table</span></span>
<span id="cb391-3"><a href="#cb391-3"></a><span class="kw">group</span> <span class="kw">by</span> field1</span></code></pre></div>
<p>Which can occasionally be written with a distinct on statement:</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb392-1"><a href="#cb392-1"></a><span class="kw">select</span> <span class="kw">distinct</span> <span class="kw">on</span> field1 <span class="op">*</span></span>
<span id="cb392-2"><a href="#cb392-2"></a><span class="kw">from</span> <span class="kw">table</span></span></code></pre></div>
<p>On most platforms, however, neither of the above will work because the behavior on the other columns is unspecified. (The first works in MySQL, if that’s what you’re using.)</p>
<p>You could fetch the distinct fields and stick to picking a single arbitrary row each time.</p>
<p>On some platforms (e.g. PostgreSQL, Oracle, T-SQL) this can be done directly using window functions:</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb393-1"><a href="#cb393-1"></a><span class="kw">select</span> <span class="op">*</span></span>
<span id="cb393-2"><a href="#cb393-2"></a><span class="kw">from</span> (</span>
<span id="cb393-3"><a href="#cb393-3"></a>   <span class="kw">select</span> <span class="op">*</span>,</span>
<span id="cb393-4"><a href="#cb393-4"></a>          <span class="fu">row_number</span>() <span class="kw">over</span> (<span class="kw">partition</span> <span class="kw">by</span> field1 <span class="kw">order</span> <span class="kw">by</span> field2) <span class="kw">as</span> <span class="fu">row_number</span></span>
<span id="cb393-5"><a href="#cb393-5"></a>   <span class="kw">from</span> <span class="kw">table</span></span>
<span id="cb393-6"><a href="#cb393-6"></a>   ) <span class="kw">as</span> <span class="kw">rows</span></span>
<span id="cb393-7"><a href="#cb393-7"></a><span class="kw">where</span> <span class="fu">row_number</span> <span class="op">=</span> <span class="dv">1</span></span></code></pre></div>
<p>On others (MySQL, SQLite), you’ll need to write subqueries that will make you join the entire table with itself (<a href="https://stackoverflow.com/questions/6109894/how-to-efficiently-determine-changes-between-rows-using-sql/6110200#6110200">example</a>), so not recommended.</p>
</section>
<section id="answer-2-score-56" class="level4">
<h4>Answer 2 (score 56)</h4>
<p>From the phrasing of your question, I understand that you want to select the distinct values for a given field and for each such value to have all the other column values in the same row listed. Most DBMSs will not allow this with neither <code>DISTINCT</code> nor <code>GROUP BY</code>, because the result is not determined.</p>
<p>Think of it like this: if your <code>field1</code> occurs more than once, what value of <code>field2</code> will be listed (given that you have the same value for <code>field1</code> in two rows but two distinct values of <code>field2</code> in those two rows).</p>
<p>You can however use aggregate functions (explicitely for every field that you want to be shown) and using a <code>GROUP BY</code> instead of <code>DISTINCT</code>:</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb394-1"><a href="#cb394-1"></a><span class="kw">SELECT</span> field1, <span class="fu">MAX</span>(field2), <span class="fu">COUNT</span>(field3), <span class="fu">SUM</span>(field4), <span class="op">....</span> <span class="kw">FROM</span> <span class="kw">table</span> <span class="kw">GROUP</span> <span class="kw">BY</span> field1</span></code></pre></div>
</section>
<section id="answer-3-score-21" class="level4">
<h4>Answer 3 (score 21)</h4>
<p>If I understood your problem correctly, it’s similar to one I just had. You want to be able limit the usability of DISTINCT to a specified field, rather than applying it to all the data.</p>
<p>If you use GROUP BY without an aggregate function, which ever field you GROUP BY will be your DISTINCT filed.</p>
<p>If you make your query:</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb395-1"><a href="#cb395-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">from</span> <span class="kw">table</span> <span class="kw">GROUP</span> <span class="kw">BY</span> field1;</span></code></pre></div>
<p>It will show all your results based on a single instance of field1.</p>
<p>For example, if you have a table with name, address and city. A single person has multiple addresses recorded, but you just want a single address for the person, you can query as follows:</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb396-1"><a href="#cb396-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> persons <span class="kw">GROUP</span> <span class="kw">BY</span> name;</span></code></pre></div>
<p>The result will be that only one instance of that name will appear with its address, and the other one will be omitted from the resulting table. Caution: if your fileds have atomic values such as firstName, lastName you want to group by both.</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb397-1"><a href="#cb397-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> persons <span class="kw">GROUP</span> <span class="kw">BY</span> lastName, firstName;</span></code></pre></div>
<p>because if two people have the same last name and you only group by lastName, one of those persons will be omitted from the results. You need to keep those things into consideration. Hope this helps.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="sql-with-clause-example-score-797102-in-2017" class="level3">
<h3>65: SQL WITH clause example (score <a href="https://stackoverflow.com/q/12552288.html">797102</a> in 2017)</h3>
<section id="question-64" class="level4">
<h4>Question</h4>
<blockquote>
<p>
<strong>Possible Duplicate:</strong><br> <a href="https://stackoverflow.com/questions/706972/difference-between-cte-and-subquery">Difference between CTE and SubQuery?</a>
</p>
</blockquote>
<p>I was trying to understand how to use the <code>WITH</code> clause and the purpose of the <code>WITH</code> clause.</p>
<p>All I understood was, the <code>WITH</code> clause was a replacement for normal sub-queries.</p>
<p>Can anyone explain this to me with a small example in detail ?</p>
</section>
<section id="answer-2-score-235" class="level4">
<h4>Answer 2 (score 235)</h4>
<p>The SQL WITH clause was introduced by Oracle in the Oracle 9i release 2 database. The SQL WITH clause allows you to give a sub-query block a name (a process also called sub-query refactoring), which can be referenced in several places within the main SQL query. The name assigned to the sub-query is treated as though it was an inline view or table. The SQL WITH clause is basically a drop-in replacement to the normal sub-query.</p>
<p>Syntax For The SQL WITH Clause</p>
<p>The following is the syntax of the SQL WITH clause when using a single sub-query alias.</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb398-1"><a href="#cb398-1"></a><span class="kw">WITH</span> <span class="op">&lt;</span>alias_name<span class="op">&gt;</span> <span class="kw">AS</span> (sql_subquery_statement)</span>
<span id="cb398-2"><a href="#cb398-2"></a><span class="kw">SELECT</span> column_list <span class="kw">FROM</span> <span class="op">&lt;</span>alias_name<span class="op">&gt;</span>[,table_name]</span>
<span id="cb398-3"><a href="#cb398-3"></a>[<span class="kw">WHERE</span> <span class="op">&lt;</span>join_condition<span class="op">&gt;</span>]</span></code></pre></div>
<p>When using multiple sub-query aliases, the syntax is as follows.</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb399-1"><a href="#cb399-1"></a><span class="kw">WITH</span> <span class="op">&lt;</span>alias_name_A<span class="op">&gt;</span> <span class="kw">AS</span> (sql_subquery_statement),</span>
<span id="cb399-2"><a href="#cb399-2"></a><span class="op">&lt;</span>alias_name_B<span class="op">&gt;</span> <span class="kw">AS</span>(sql_subquery_statement_from_alias_name_A</span>
<span id="cb399-3"><a href="#cb399-3"></a><span class="kw">or</span> sql_subquery_statement )</span>
<span id="cb399-4"><a href="#cb399-4"></a><span class="kw">SELECT</span> <span class="op">&lt;</span>column_list<span class="op">&gt;</span></span>
<span id="cb399-5"><a href="#cb399-5"></a><span class="kw">FROM</span> <span class="op">&lt;</span>alias_name_A<span class="op">&gt;</span>, <span class="op">&lt;</span>alias_name_B<span class="op">&gt;</span> [,table_names]</span>
<span id="cb399-6"><a href="#cb399-6"></a>[<span class="kw">WHERE</span> <span class="op">&lt;</span>join_condition<span class="op">&gt;</span>]</span></code></pre></div>
<p>In the syntax documentation above, the occurrences of <code>alias_name</code> is a meaningful name you would give to the sub-query after the AS clause. Each sub-query should be separated with a comma <a href="http://docs.oracle.com/cd/B19306_01/server.102/b14200/img_text/subquery_factoring_clause.htm" rel="noreferrer">Example for WITH statement</a>. The rest of the queries follow the standard formats for simple and complex SQL SELECT queries.</p>
<p>For more information: <a href="http://www.brighthub.com/internet/web-development/articles/91893.aspx" rel="noreferrer">http://www.brighthub.com/internet/web-development/articles/91893.aspx</a></p>
</section>
<section id="answer-3-score-84" class="level4">
<h4>Answer 3 (score 84)</h4>
<p>This has been fully answered <a href="https://stackoverflow.com/questions/324935/mysql-with-clause">here</a>.</p>
<p>See <a href="http://docs.oracle.com/cd/B19306_01/server.102/b14200/statements_10002.htm#i2161315" rel="noreferrer">Oracle’s docs on SELECT</a> to see how subquery factoring works, and Mark’s example:</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb400-1"><a href="#cb400-1"></a><span class="kw">WITH</span> employee <span class="kw">AS</span> (<span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> Employees)</span>
<span id="cb400-2"><a href="#cb400-2"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> employee <span class="kw">WHERE</span> <span class="kw">ID</span> <span class="op">&lt;</span> <span class="dv">20</span></span>
<span id="cb400-3"><a href="#cb400-3"></a><span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb400-4"><a href="#cb400-4"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> employee <span class="kw">WHERE</span> Sex <span class="op">=</span> <span class="st">&#39;M&#39;</span></span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-do-i-restore-a-dump-file-from-mysqldump-score-793050-in-2018" class="level3">
<h3>66: How do I restore a dump file from mysqldump? (score <a href="https://stackoverflow.com/q/105776.html">793050</a> in 2018)</h3>
<section id="question-65" class="level4">
<h4>Question</h4>
<p>I was given a MySQL database file that I need to restore as a database on my Windows Server 2008 machine.</p>
<p>I tried using MySQL Administrator, but I got the following error:</p>
<blockquote>
<p>
The selected file was generated by mysqldump and cannot be restored by this application.
</p>
</blockquote>
<p>How do I get this working?</p>
</section>
<section id="answer-accepted-score-561" class="level4">
<h4>Answer accepted (score 561)</h4>
<p>It should be as simple as running this:</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb401-1"><a href="#cb401-1"></a>mysql <span class="op">-</span>u <span class="op">&lt;</span><span class="fu">user</span><span class="op">&gt;</span> <span class="op">-</span>p <span class="op">&lt;</span> db_backup.<span class="fu">dump</span></span></code></pre></div>
<p>If the dump is of a single database you may have to add a line at the top of the file:</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb402-1"><a href="#cb402-1"></a><span class="kw">USE</span> <span class="op">&lt;</span><span class="kw">database</span><span class="op">-</span>name<span class="op">-</span>here<span class="op">&gt;</span>;</span></code></pre></div>
<p>If it was a dump of many databases, the use statements are already in there.</p>
<p>To run these commands, open up a command prompt (in Windows) and <code>cd</code> to the directory where the <code>mysql.exe</code> executable is (you may have to look around a bit for it, it’ll depend on how you installed mysql, i.e. standalone or as part of a package like WAMP). Once you’re in that directory, you should be able to just type the command as I have it above.</p>
</section>
<section id="answer-2-score-697" class="level4">
<h4>Answer 2 (score 697)</h4>
<p>If the database you want to restore doesn’t already exist, you need to create it first.</p>
<p>On the command-line, if you’re in the same directory that contains the dumped file, use these commands (with appropriate substitutions):</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb403-1"><a href="#cb403-1"></a>C:\<span class="op">&gt;</span> mysql <span class="op">-</span>u root <span class="op">-</span>p</span>
<span id="cb403-2"><a href="#cb403-2"></a></span>
<span id="cb403-3"><a href="#cb403-3"></a>mysql<span class="op">&gt;</span> <span class="kw">create</span> <span class="kw">database</span> mydb;</span>
<span id="cb403-4"><a href="#cb403-4"></a>mysql<span class="op">&gt;</span> <span class="kw">use</span> mydb;</span>
<span id="cb403-5"><a href="#cb403-5"></a>mysql<span class="op">&gt;</span> <span class="kw">source</span> db_backup.<span class="fu">dump</span>;</span></code></pre></div>
</section>
<section id="answer-3-score-232" class="level4">
<h4>Answer 3 (score 232)</h4>
<p>You simply need to run this:</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb404-1"><a href="#cb404-1"></a>mysql <span class="op">-</span>p <span class="op">-</span>u[<span class="fu">user</span>] [<span class="kw">database</span>] <span class="op">&lt;</span> db_backup.<span class="fu">dump</span></span></code></pre></div>
<p>If the dump contains multiple databases you should omit the database name:</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb405-1"><a href="#cb405-1"></a>mysql <span class="op">-</span>p <span class="op">-</span>u[<span class="fu">user</span>] <span class="op">&lt;</span> db_backup.<span class="fu">dump</span></span></code></pre></div>
<p>To run these commands, open up a command prompt (in Windows) and <code>cd</code> to the directory where the <code>mysql.exe</code> executable is (you may have to look around a bit for it, it’ll depend on how you installed mysql, i.e. standalone or as part of a package like WAMP). Once you’re in that directory, you should be able to just type the command.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-do-i-use-row_number-score-792545-in-2013" class="level3">
<h3>67: How do I use ROW_NUMBER()? (score <a href="https://stackoverflow.com/q/961007.html">792545</a> in 2013)</h3>
<section id="question-66" class="level4">
<h4>Question</h4>
<p>I want to use the <code>ROW_NUMBER()</code> to get…</p>
<ol>
<li>
To get the <code>max(ROW_NUMBER())</code> –&gt; Or i guess this would also be the count of all rows
</li>
</ol>
<p>I tried doing:</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb406-1"><a href="#cb406-1"></a><span class="kw">SELECT</span> <span class="fu">max</span>(<span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span>(<span class="kw">ORDER</span> <span class="kw">BY</span> UserId)) <span class="kw">FROM</span> Users</span></code></pre></div>
<p>but it didn’t seem to work…</p>
<ol start="2">
<li>
To get <code>ROW_NUMBER()</code> using a given piece of information, ie. if I have a name and I want to know what row the name came from.
</li>
</ol>
<p>I assume it would be something similar to what I tried for #1</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb407-1"><a href="#cb407-1"></a><span class="kw">SELECT</span> <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span>(<span class="kw">ORDER</span> <span class="kw">BY</span> UserId) <span class="kw">From</span> Users <span class="kw">WHERE</span> UserName<span class="op">=</span><span class="st">&#39;Joe&#39;</span></span></code></pre></div>
<p>but this didn’t work either…</p>
<p>Any Ideas?</p>
</section>
<section id="answer-2-score-138" class="level4">
<h4>Answer 2 (score 138)</h4>
<p>For the first question, why not just use?</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb408-1"><a href="#cb408-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">FROM</span> myTable </span></code></pre></div>
<p>to get the count.</p>
<p>And for the second question, the primary key of the row is what should be used to identify a particular row. Don’t try and use the row number for that.</p>
<hr>
<p>If you returned Row_Number() in your main query,</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb409-1"><a href="#cb409-1"></a><span class="kw">SELECT</span> <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> (<span class="kw">Order</span> <span class="kw">by</span> <span class="kw">Id</span>) <span class="kw">AS</span> RowNumber, Field1, Field2, Field3</span>
<span id="cb409-2"><a href="#cb409-2"></a><span class="kw">FROM</span> <span class="fu">User</span></span></code></pre></div>
<p>Then when you want to go 5 rows back then you can take the current row number and use the following query to determine the row with currentrow -5</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb410-1"><a href="#cb410-1"></a><span class="kw">SELECT</span> us.<span class="kw">Id</span></span>
<span id="cb410-2"><a href="#cb410-2"></a><span class="kw">FROM</span> (<span class="kw">SELECT</span> <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> <span class="kw">id</span>) <span class="kw">AS</span> <span class="kw">Row</span>, <span class="kw">Id</span></span>
<span id="cb410-3"><a href="#cb410-3"></a>     <span class="kw">FROM</span> <span class="fu">User</span> ) us </span>
<span id="cb410-4"><a href="#cb410-4"></a><span class="kw">WHERE</span> <span class="kw">Row</span> <span class="op">=</span> CurrentRow <span class="op">-</span> <span class="dv">5</span>   </span></code></pre></div>
</section>
<section id="answer-3-score-41-1" class="level4">
<h4>Answer 3 (score 41)</h4>
<p>Though I agree with others that you could use <code>count()</code> to get the total number of rows, here is how you can use the <code>row_count()</code>:</p>
<ol>
<li>
<p>
To get the total no of rows:
</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb411-1"><a href="#cb411-1"></a><span class="kw">with</span> temp <span class="kw">as</span> (</span>
<span id="cb411-2"><a href="#cb411-2"></a>    <span class="kw">select</span> <span class="fu">row_number</span>() <span class="kw">over</span> (<span class="kw">order</span> <span class="kw">by</span> <span class="kw">id</span>) <span class="kw">as</span> <span class="kw">rownum</span></span>
<span id="cb411-3"><a href="#cb411-3"></a>    <span class="kw">from</span> table_name </span>
<span id="cb411-4"><a href="#cb411-4"></a>)</span>
<span id="cb411-5"><a href="#cb411-5"></a><span class="kw">select</span> <span class="fu">max</span>(<span class="kw">rownum</span>) <span class="kw">from</span> temp```<span class="op">&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb411-6"><a href="#cb411-6"></a><span class="op">&lt;</span>li<span class="op">&gt;&lt;</span>p<span class="op">&gt;</span><span class="kw">To</span> get <span class="kw">the</span> <span class="kw">row</span> numbers <span class="kw">where</span> name <span class="kw">is</span> Matt:<span class="op">&lt;/</span>p<span class="op">&gt;</span></span>
<span id="cb411-7"><a href="#cb411-7"></a></span>
<span id="cb411-8"><a href="#cb411-8"></a>```sql</span>
<span id="cb411-9"><a href="#cb411-9"></a><span class="kw">with</span> temp <span class="kw">as</span> (</span>
<span id="cb411-10"><a href="#cb411-10"></a>    <span class="kw">select</span> name, <span class="fu">row_number</span>() <span class="kw">over</span> (<span class="kw">order</span> <span class="kw">by</span> <span class="kw">id</span>) <span class="kw">as</span> <span class="kw">rownum</span></span>
<span id="cb411-11"><a href="#cb411-11"></a>    <span class="kw">from</span> table_name</span>
<span id="cb411-12"><a href="#cb411-12"></a>)</span>
<span id="cb411-13"><a href="#cb411-13"></a><span class="kw">select</span> <span class="kw">rownum</span> <span class="kw">from</span> temp <span class="kw">where</span> name <span class="kw">like</span> <span class="st">&#39;Matt&#39;</span>```<span class="op">&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb411-14"><a href="#cb411-14"></a><span class="op">&lt;/</span>ol<span class="op">&gt;</span></span>
<span id="cb411-15"><a href="#cb411-15"></a></span>
<span id="cb411-16"><a href="#cb411-16"></a>You can further <span class="kw">use</span> `min(<span class="kw">rownum</span>)` <span class="kw">or</span> `max(<span class="kw">rownum</span>)` <span class="kw">to</span> get <span class="kw">the</span> <span class="fu">first</span> <span class="kw">or</span> <span class="fu">last</span> <span class="kw">row</span> <span class="cf">for</span> Matt respectively.  </span>
<span id="cb411-17"><a href="#cb411-17"></a></span>
<span id="cb411-18"><a href="#cb411-18"></a>These were very simple implementations <span class="kw">of</span> `row_number()`. You can <span class="kw">use</span> it <span class="cf">for</span> more complex <span class="fu">grouping</span>. <span class="kw">Check</span> <span class="kw">out</span> my response <span class="kw">on</span> <span class="op">&lt;</span>a href<span class="op">=</span><span class="ot">&quot;https://stackoverflow.com/questions/968305/advanced-grouping-without-using-a-sub-query/968983#968983&quot;</span><span class="op">&gt;</span>Advanced <span class="fu">grouping</span> <span class="kw">without</span> <span class="kw">using</span> a sub <span class="kw">query</span><span class="op">&lt;/</span>a<span class="op">&gt;</span>  </span>
<span id="cb411-19"><a href="#cb411-19"></a></span>
<span id="cb411-20"><a href="#cb411-20"></a><span class="op">&lt;/</span>b<span class="op">&gt;</span> <span class="op">&lt;/</span>em<span class="op">&gt;</span> <span class="op">&lt;/</span>i<span class="op">&gt;</span> <span class="op">&lt;/</span>small<span class="op">&gt;</span> <span class="op">&lt;/</span>strong<span class="op">&gt;</span> <span class="op">&lt;/</span>sub<span class="op">&gt;</span> <span class="op">&lt;/</span>sup<span class="op">&gt;</span></span>
<span id="cb411-21"><a href="#cb411-21"></a></span>
<span id="cb411-22"><a href="#cb411-22"></a>### <span class="dv">68</span>: SQL <span class="op">-</span> Rounding <span class="kw">off</span> <span class="kw">to</span> <span class="dv">2</span> <span class="dt">decimal</span> places (score [<span class="dv">791521</span>](https:<span class="op">//</span>stackoverflow.com<span class="op">/</span>q<span class="op">/</span><span class="fl">10380197.</span>html) <span class="kw">in</span> <span class="dv">2012</span>)</span>
<span id="cb411-23"><a href="#cb411-23"></a></span>
<span id="cb411-24"><a href="#cb411-24"></a>#### Question</span>
<span id="cb411-25"><a href="#cb411-25"></a>I need <span class="kw">to</span> <span class="fu">convert</span> minutes <span class="kw">to</span> hours, rounded <span class="kw">off</span> <span class="kw">to</span> <span class="dv">2</span> <span class="dt">decimal</span> places.I also need <span class="kw">to</span> display <span class="kw">only</span> up <span class="kw">to</span> <span class="dv">2</span> numbers <span class="kw">after</span> <span class="kw">the</span> <span class="dt">decimal</span> point. So <span class="cf">if</span> I have minutes <span class="kw">as</span> <span class="fl">650.</span><span class="cf">Then</span> hours should be <span class="fl">10.83</span>  </span>
<span id="cb411-26"><a href="#cb411-26"></a></span>
<span id="cb411-27"><a href="#cb411-27"></a>Here<span class="st">&#39;s what I have so far:  </span></span>
<span id="cb411-28"><a href="#cb411-28"></a></span>
<span id="cb411-29"><a href="#cb411-29"></a><span class="st">```sql</span></span>
<span id="cb411-30"><a href="#cb411-30"></a><span class="st">Select round(Minutes/60.0,2) from ....</span></span></code></pre></div>
<p>But in this case, if my minutes is, say,630 - hours is 10.5000000. But I want it as 10.50 only(after rounding). How do I achieve this?</p>
</section>
<section id="answer-accepted-score-363" class="level4">
<h4>Answer accepted (score 363)</h4>
<p>Could you not cast your result as <code>numeric(x,2)</code>? Where <code>x &amp;lt;= 38</code></p>
<div class="sourceCode" id="cb412"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb412-1"><a href="#cb412-1"></a><span class="kw">select</span> </span>
<span id="cb412-2"><a href="#cb412-2"></a>    <span class="fu">round</span>(<span class="dv">630</span><span class="op">/</span><span class="fl">60.0</span>,<span class="dv">2</span>), </span>
<span id="cb412-3"><a href="#cb412-3"></a>    <span class="fu">cast</span>(<span class="fu">round</span>(<span class="dv">630</span><span class="op">/</span><span class="fl">60.0</span>,<span class="dv">2</span>) <span class="kw">as</span> <span class="dt">numeric</span>(<span class="dv">36</span>,<span class="dv">2</span>))</span></code></pre></div>
<p>Returns</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb413-1"><a href="#cb413-1"></a><span class="fl">10.500000</span>   <span class="fl">10.50</span></span></code></pre></div>
</section>
<section id="answer-2-score-73" class="level4">
<h4>Answer 2 (score 73)</h4>
<p>As with SQL Server 2012, you can use the built-in <a href="http://msdn.microsoft.com/en-us/library/hh213505.aspx" rel="noreferrer">format function</a>:</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb414-1"><a href="#cb414-1"></a><span class="kw">SELECT</span> FORMAT(Minutes<span class="op">/</span><span class="fl">60.0</span>, <span class="st">&#39;N2&#39;</span>)</span></code></pre></div>
<p>(just for further readings…)</p>
</section>
<section id="answer-3-score-23-3" class="level4">
<h4>Answer 3 (score 23)</h4>
<p>you can use</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb415-1"><a href="#cb415-1"></a><span class="kw">select</span> <span class="fu">cast</span>((<span class="dv">630</span><span class="op">/</span><span class="fl">60.0</span>) <span class="kw">as</span>  <span class="dt">decimal</span>(<span class="dv">16</span>,<span class="dv">2</span>))</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="sql-multiple-column-ordering-score-790109-in-2015" class="level3">
<h3>69: SQL multiple column ordering (score <a href="https://stackoverflow.com/q/2051162.html">790109</a> in 2015)</h3>
<section id="question-67" class="level4">
<h4>Question</h4>
<p>I am trying to sort by multiple columns in SQL, and in different directions. <code>column1</code> would be sorted descending, and <code>column2</code> ascending.</p>
<p>How can I do this?</p>
</section>
<section id="answer-accepted-score-948" class="level4">
<h4>Answer accepted (score 948)</h4>
<div class="sourceCode" id="cb416"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb416-1"><a href="#cb416-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> column1 <span class="kw">DESC</span>, column2</span></code></pre></div>
<p>This sorts everything by <code>column1</code> (descending) first, and then by <code>column2</code> (ascending, which is the default) whenever the <code>column1</code> fields for two or more rows are equal.</p>
</section>
<section id="answer-2-score-328-1" class="level4">
<h4>Answer 2 (score 328)</h4>
<p>The other answers lack a concrete example, so here it goes:</p>
<p>Given the following <strong>People</strong> table:</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb417-1"><a href="#cb417-1"></a> FirstName |  LastName   |  YearOfBirth</span>
<span id="cb417-2"><a href="#cb417-2"></a><span class="co">----------------------------------------</span></span>
<span id="cb417-3"><a href="#cb417-3"></a>  Thomas   | Alva Edison |   <span class="dv">1847</span></span>
<span id="cb417-4"><a href="#cb417-4"></a>  Benjamin | Franklin    |   <span class="dv">1706</span></span>
<span id="cb417-5"><a href="#cb417-5"></a>  Thomas   | More        |   <span class="dv">1478</span></span>
<span id="cb417-6"><a href="#cb417-6"></a>  Thomas   | Jefferson   |   <span class="dv">1826</span></span></code></pre></div>
<p>If you execute the query below:</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb418-1"><a href="#cb418-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> People <span class="kw">ORDER</span> <span class="kw">BY</span> FirstName <span class="kw">DESC</span>, YearOfBirth <span class="kw">ASC</span></span></code></pre></div>
<p>The result set will look like this:</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb419-1"><a href="#cb419-1"></a> FirstName |  LastName   |  YearOfBirth</span>
<span id="cb419-2"><a href="#cb419-2"></a><span class="co">----------------------------------------</span></span>
<span id="cb419-3"><a href="#cb419-3"></a>  Thomas   | More        |   <span class="dv">1478</span></span>
<span id="cb419-4"><a href="#cb419-4"></a>  Thomas   | Jefferson   |   <span class="dv">1826</span></span>
<span id="cb419-5"><a href="#cb419-5"></a>  Thomas   | Alva Edison |   <span class="dv">1847</span></span>
<span id="cb419-6"><a href="#cb419-6"></a>  Benjamin | Franklin    |   <span class="dv">1706</span></span></code></pre></div>
</section>
<section id="answer-3-score-132" class="level4">
<h4>Answer 3 (score 132)</h4>
<div class="sourceCode" id="cb420"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb420-1"><a href="#cb420-1"></a><span class="kw">SELECT</span>  <span class="op">*</span></span>
<span id="cb420-2"><a href="#cb420-2"></a><span class="kw">FROM</span>    mytable</span>
<span id="cb420-3"><a href="#cb420-3"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb420-4"><a href="#cb420-4"></a>        column1 <span class="kw">DESC</span>, column2 <span class="kw">ASC</span></span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="efficiently-convert-rows-to-columns-in-sql-server-score-785265-in-2018" class="level3">
<h3>70: Efficiently convert rows to columns in sql server (score <a href="https://stackoverflow.com/q/15745042.html">785265</a> in 2018)</h3>
<section id="question-68" class="level4">
<h4>Question</h4>
<p>I’m looking for an efficient way to convert rows to columns in SQL server, I heard that PIVOT is not very fast, and I need to deal with lot of records.</p>
<p>This is my example:</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb421-1"><a href="#cb421-1"></a>   <span class="co">-------------------------------</span></span>
<span id="cb421-2"><a href="#cb421-2"></a>   | <span class="kw">Id</span> | <span class="fu">Value</span>  | ColumnName    |</span>
<span id="cb421-3"><a href="#cb421-3"></a>   <span class="co">-------------------------------</span></span>
<span id="cb421-4"><a href="#cb421-4"></a>   | <span class="dv">1</span>  | John   | FirstName     |</span>
<span id="cb421-5"><a href="#cb421-5"></a>   | <span class="dv">2</span>  | <span class="fl">2.4</span>    | Amount        |</span>
<span id="cb421-6"><a href="#cb421-6"></a>   | <span class="dv">3</span>  | ZH1E4A | PostalCode    |</span>
<span id="cb421-7"><a href="#cb421-7"></a>   | <span class="dv">4</span>  | Fork   | LastName      |</span>
<span id="cb421-8"><a href="#cb421-8"></a>   | <span class="dv">5</span>  | <span class="dv">857685</span> | AccountNumber |</span>
<span id="cb421-9"><a href="#cb421-9"></a>   <span class="co">-------------------------------</span></span></code></pre></div>
<p>This is my result:</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb422-1"><a href="#cb422-1"></a><span class="co">---------------------------------------------------------------------</span></span>
<span id="cb422-2"><a href="#cb422-2"></a>| FirstName  |Amount|   PostalCode   |   LastName  |  AccountNumber |</span>
<span id="cb422-3"><a href="#cb422-3"></a><span class="co">---------------------------------------------------------------------</span></span>
<span id="cb422-4"><a href="#cb422-4"></a>| John       | <span class="fl">2.4</span>  |   ZH1E4A       |   Fork      |  <span class="dv">857685</span>        |</span>
<span id="cb422-5"><a href="#cb422-5"></a><span class="co">---------------------------------------------------------------------</span></span></code></pre></div>
<p>How can I build the result?</p>
</section>
<section id="answer-accepted-score-495" class="level4">
<h4>Answer accepted (score 495)</h4>
<p>There are several ways that you can transform data from multiple rows into columns.</p>
<h5>
Using <code>PIVOT</code>
</h2>
<p>In SQL Server you can use the <code>PIVOT</code> function to transform the data from rows to columns:</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb423-1"><a href="#cb423-1"></a><span class="kw">select</span> Firstname, Amount, PostalCode, LastName, AccountNumber</span>
<span id="cb423-2"><a href="#cb423-2"></a><span class="kw">from</span></span>
<span id="cb423-3"><a href="#cb423-3"></a>(</span>
<span id="cb423-4"><a href="#cb423-4"></a>  <span class="kw">select</span> <span class="fu">value</span>, columnname</span>
<span id="cb423-5"><a href="#cb423-5"></a>  <span class="kw">from</span> yourtable</span>
<span id="cb423-6"><a href="#cb423-6"></a>) d</span>
<span id="cb423-7"><a href="#cb423-7"></a>pivot</span>
<span id="cb423-8"><a href="#cb423-8"></a>(</span>
<span id="cb423-9"><a href="#cb423-9"></a>  <span class="fu">max</span>(<span class="fu">value</span>)</span>
<span id="cb423-10"><a href="#cb423-10"></a>  <span class="cf">for</span> columnname <span class="kw">in</span> (Firstname, Amount, PostalCode, LastName, AccountNumber)</span>
<span id="cb423-11"><a href="#cb423-11"></a>) piv;</span></code></pre></div>
<p>See <a href="https://data.stackexchange.com/stackoverflow/query/497432" rel="noreferrer">Demo</a>.</p>
<h5>
Pivot with unknown number of <code>columnnames</code>
</h3>
<p>If you have an unknown number of <code>columnnames</code> that you want to transpose, then you can use dynamic SQL:</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb424-1"><a href="#cb424-1"></a><span class="kw">DECLARE</span> @cols <span class="kw">AS</span> <span class="dt">NVARCHAR</span>(<span class="fu">MAX</span>),</span>
<span id="cb424-2"><a href="#cb424-2"></a>    @query  <span class="kw">AS</span> <span class="dt">NVARCHAR</span>(<span class="fu">MAX</span>)</span>
<span id="cb424-3"><a href="#cb424-3"></a></span>
<span id="cb424-4"><a href="#cb424-4"></a><span class="kw">select</span> @cols <span class="op">=</span> STUFF((<span class="kw">SELECT</span> <span class="st">&#39;,&#39;</span> <span class="op">+</span> QUOTENAME(ColumnName) </span>
<span id="cb424-5"><a href="#cb424-5"></a>                    <span class="kw">from</span> yourtable</span>
<span id="cb424-6"><a href="#cb424-6"></a>                    <span class="kw">group</span> <span class="kw">by</span> ColumnName, <span class="kw">id</span></span>
<span id="cb424-7"><a href="#cb424-7"></a>                    <span class="kw">order</span> <span class="kw">by</span> <span class="kw">id</span></span>
<span id="cb424-8"><a href="#cb424-8"></a>            <span class="cf">FOR</span> XML PATH(<span class="st">&#39;&#39;</span>), <span class="kw">TYPE</span></span>
<span id="cb424-9"><a href="#cb424-9"></a>            ).<span class="fu">value</span>(<span class="st">&#39;.&#39;</span>, <span class="st">&#39;NVARCHAR(MAX)&#39;</span>) </span>
<span id="cb424-10"><a href="#cb424-10"></a>        ,<span class="dv">1</span>,<span class="dv">1</span>,<span class="st">&#39;&#39;</span>)</span>
<span id="cb424-11"><a href="#cb424-11"></a></span>
<span id="cb424-12"><a href="#cb424-12"></a><span class="kw">set</span> @query <span class="op">=</span> N<span class="st">&#39;SELECT &#39;</span> <span class="op">+</span> @cols <span class="op">+</span> N<span class="st">&#39; from </span></span>
<span id="cb424-13"><a href="#cb424-13"></a><span class="st">             (</span></span>
<span id="cb424-14"><a href="#cb424-14"></a><span class="st">                select value, ColumnName</span></span>
<span id="cb424-15"><a href="#cb424-15"></a><span class="st">                from yourtable</span></span>
<span id="cb424-16"><a href="#cb424-16"></a><span class="st">            ) x</span></span>
<span id="cb424-17"><a href="#cb424-17"></a><span class="st">            pivot </span></span>
<span id="cb424-18"><a href="#cb424-18"></a><span class="st">            (</span></span>
<span id="cb424-19"><a href="#cb424-19"></a><span class="st">                max(value)</span></span>
<span id="cb424-20"><a href="#cb424-20"></a><span class="st">                for ColumnName in (&#39;</span> <span class="op">+</span> @cols <span class="op">+</span> N<span class="st">&#39;)</span></span>
<span id="cb424-21"><a href="#cb424-21"></a><span class="st">            ) p &#39;</span></span>
<span id="cb424-22"><a href="#cb424-22"></a></span>
<span id="cb424-23"><a href="#cb424-23"></a><span class="kw">exec</span> sp_executesql @query;</span></code></pre></div>
<p>See <a href="https://data.stackexchange.com/stackoverflow/query/497433" rel="noreferrer">Demo</a>.</p>
<h5>
Using an aggregate function
</h2>
<p>If you do not want to use the <code>PIVOT</code> function, then you can use an aggregate function with a <code>CASE</code> expression:</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb425-1"><a href="#cb425-1"></a><span class="kw">select</span></span>
<span id="cb425-2"><a href="#cb425-2"></a>  <span class="fu">max</span>(<span class="cf">case</span> <span class="cf">when</span> columnname <span class="op">=</span> <span class="st">&#39;FirstName&#39;</span> <span class="cf">then</span> <span class="fu">value</span> <span class="cf">end</span>) Firstname,</span>
<span id="cb425-3"><a href="#cb425-3"></a>  <span class="fu">max</span>(<span class="cf">case</span> <span class="cf">when</span> columnname <span class="op">=</span> <span class="st">&#39;Amount&#39;</span> <span class="cf">then</span> <span class="fu">value</span> <span class="cf">end</span>) Amount,</span>
<span id="cb425-4"><a href="#cb425-4"></a>  <span class="fu">max</span>(<span class="cf">case</span> <span class="cf">when</span> columnname <span class="op">=</span> <span class="st">&#39;PostalCode&#39;</span> <span class="cf">then</span> <span class="fu">value</span> <span class="cf">end</span>) PostalCode,</span>
<span id="cb425-5"><a href="#cb425-5"></a>  <span class="fu">max</span>(<span class="cf">case</span> <span class="cf">when</span> columnname <span class="op">=</span> <span class="st">&#39;LastName&#39;</span> <span class="cf">then</span> <span class="fu">value</span> <span class="cf">end</span>) LastName,</span>
<span id="cb425-6"><a href="#cb425-6"></a>  <span class="fu">max</span>(<span class="cf">case</span> <span class="cf">when</span> columnname <span class="op">=</span> <span class="st">&#39;AccountNumber&#39;</span> <span class="cf">then</span> <span class="fu">value</span> <span class="cf">end</span>) AccountNumber</span>
<span id="cb425-7"><a href="#cb425-7"></a><span class="kw">from</span> yourtable</span></code></pre></div>
<p>See <a href="https://data.stackexchange.com/stackoverflow/query/497434" rel="noreferrer">Demo</a>.</p>
<h5>
Using multiple joins
</h2>
<p>This could also be completed using multiple joins, but you will need some column to associate each of the rows which you do not have in your sample data. But the basic syntax would be:</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb426-1"><a href="#cb426-1"></a><span class="kw">select</span> fn.<span class="fu">value</span> <span class="kw">as</span> FirstName,</span>
<span id="cb426-2"><a href="#cb426-2"></a>  a.<span class="fu">value</span> <span class="kw">as</span> Amount,</span>
<span id="cb426-3"><a href="#cb426-3"></a>  pc.<span class="fu">value</span> <span class="kw">as</span> PostalCode,</span>
<span id="cb426-4"><a href="#cb426-4"></a>  <span class="fu">ln</span>.<span class="fu">value</span> <span class="kw">as</span> LastName,</span>
<span id="cb426-5"><a href="#cb426-5"></a>  an.<span class="fu">value</span> <span class="kw">as</span> AccountNumber</span>
<span id="cb426-6"><a href="#cb426-6"></a><span class="kw">from</span> yourtable fn</span>
<span id="cb426-7"><a href="#cb426-7"></a><span class="kw">left</span> <span class="kw">join</span> yourtable a</span>
<span id="cb426-8"><a href="#cb426-8"></a>  <span class="kw">on</span> fn.somecol <span class="op">=</span> a.somecol</span>
<span id="cb426-9"><a href="#cb426-9"></a>  <span class="kw">and</span> a.columnname <span class="op">=</span> <span class="st">&#39;Amount&#39;</span></span>
<span id="cb426-10"><a href="#cb426-10"></a><span class="kw">left</span> <span class="kw">join</span> yourtable pc</span>
<span id="cb426-11"><a href="#cb426-11"></a>  <span class="kw">on</span> fn.somecol <span class="op">=</span> pc.somecol</span>
<span id="cb426-12"><a href="#cb426-12"></a>  <span class="kw">and</span> pc.columnname <span class="op">=</span> <span class="st">&#39;PostalCode&#39;</span></span>
<span id="cb426-13"><a href="#cb426-13"></a><span class="kw">left</span> <span class="kw">join</span> yourtable <span class="fu">ln</span></span>
<span id="cb426-14"><a href="#cb426-14"></a>  <span class="kw">on</span> fn.somecol <span class="op">=</span> <span class="fu">ln</span>.somecol</span>
<span id="cb426-15"><a href="#cb426-15"></a>  <span class="kw">and</span> <span class="fu">ln</span>.columnname <span class="op">=</span> <span class="st">&#39;LastName&#39;</span></span>
<span id="cb426-16"><a href="#cb426-16"></a><span class="kw">left</span> <span class="kw">join</span> yourtable an</span>
<span id="cb426-17"><a href="#cb426-17"></a>  <span class="kw">on</span> fn.somecol <span class="op">=</span> an.somecol</span>
<span id="cb426-18"><a href="#cb426-18"></a>  <span class="kw">and</span> an.columnname <span class="op">=</span> <span class="st">&#39;AccountNumber&#39;</span></span>
<span id="cb426-19"><a href="#cb426-19"></a><span class="kw">where</span> fn.columnname <span class="op">=</span> <span class="st">&#39;Firstname&#39;</span></span></code></pre></div>
</section>
<section id="answer-2-score-9" class="level4">
<h4>Answer 2 (score 9)</h4>
<p>
as pivoting data is still a hot one I decided to add something form me. This is rather a method than just a single script but gives you much more possibilities. First of all There are 3 scripts you need to deploy: 1) User defined TABLE type [<code>ColumnActionList</code>] -&gt; holds data as parameter 2) SP [<code>proc_PivotPrepare</code>] -&gt; prepares our data 3) SP [<code>proc_PivotExecute</code>] -&gt; execute the script
</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb427-1"><a href="#cb427-1"></a>    <span class="kw">CREATE</span> <span class="kw">TYPE</span> [dbo].[ColumnActionList] <span class="kw">AS</span> <span class="kw">TABLE</span>(</span>
<span id="cb427-2"><a href="#cb427-2"></a>        [<span class="kw">ID</span>] [<span class="dt">smallint</span>] <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb427-3"><a href="#cb427-3"></a>        [ColumnName] [<span class="dt">nvarchar</span>](<span class="fl">128.</span>html) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb427-4"><a href="#cb427-4"></a>        [Action] [<span class="dt">nchar</span>](<span class="fl">1.</span>html) <span class="kw">NOT</span> <span class="kw">NULL</span></span>
<span id="cb427-5"><a href="#cb427-5"></a>    );</span>
<span id="cb427-6"><a href="#cb427-6"></a>GO</span>
<span id="cb427-7"><a href="#cb427-7"></a></span>
<span id="cb427-8"><a href="#cb427-8"></a>    <span class="kw">CREATE</span> <span class="kw">PROCEDURE</span> [dbo].[proc_PivotPrepare] </span>
<span id="cb427-9"><a href="#cb427-9"></a>    (</span>
<span id="cb427-10"><a href="#cb427-10"></a>    @DB_Name        <span class="dt">nvarchar</span>(<span class="dv">128</span>),</span>
<span id="cb427-11"><a href="#cb427-11"></a>    @TableName      <span class="dt">nvarchar</span>(<span class="dv">128</span>)</span>
<span id="cb427-12"><a href="#cb427-12"></a>    )</span>
<span id="cb427-13"><a href="#cb427-13"></a>    <span class="kw">AS</span></span>
<span id="cb427-14"><a href="#cb427-14"></a>    <span class="co">----------------------------------------------------------------------------------------------------</span></span>
<span id="cb427-15"><a href="#cb427-15"></a>    <span class="co">-----| Author: Bartosz</span></span>
<span id="cb427-16"><a href="#cb427-16"></a>    <span class="co">----------------------------------------------------------------------------------------------------</span></span>
<span id="cb427-17"><a href="#cb427-17"></a>    <span class="kw">SELECT</span> @DB_Name <span class="op">=</span> ISNULL(@DB_Name,db_name())</span>
<span id="cb427-18"><a href="#cb427-18"></a>    <span class="kw">DECLARE</span> @SQL_Code <span class="dt">nvarchar</span>(<span class="fu">max</span>)</span>
<span id="cb427-19"><a href="#cb427-19"></a></span>
<span id="cb427-20"><a href="#cb427-20"></a>    <span class="kw">DECLARE</span> @MyTab <span class="kw">TABLE</span> (<span class="kw">ID</span> <span class="dt">smallint</span> identity(<span class="dv">1</span>,<span class="dv">1</span>), [Column_Name] <span class="dt">nvarchar</span>(<span class="dv">128</span>), [<span class="kw">Type</span>] <span class="dt">nchar</span>(<span class="dv">1</span>), [<span class="kw">Set</span> Action SQL] <span class="dt">nvarchar</span>(<span class="fu">max</span>));</span>
<span id="cb427-21"><a href="#cb427-21"></a></span>
<span id="cb427-22"><a href="#cb427-22"></a>    <span class="kw">SELECT</span> @SQL_Code        <span class="op">=</span>   <span class="st">&#39;SELECT [&lt;| SQL_Code |&gt;] = </span><span class="ch">&#39;&#39;</span><span class="st"> </span><span class="ch">&#39;&#39;</span><span class="st"> &#39;</span></span>
<span id="cb427-23"><a href="#cb427-23"></a>                                        <span class="op">+</span> <span class="st">&#39;UNION ALL &#39;</span></span>
<span id="cb427-24"><a href="#cb427-24"></a>                                        <span class="op">+</span> <span class="st">&#39;SELECT </span><span class="ch">&#39;&#39;</span><span class="st">----------------------------------------------------------------------------------------------------</span><span class="ch">&#39;&#39;</span><span class="st"> &#39;</span></span>
<span id="cb427-25"><a href="#cb427-25"></a>                                        <span class="op">+</span> <span class="st">&#39;UNION ALL &#39;</span></span>
<span id="cb427-26"><a href="#cb427-26"></a>                                        <span class="op">+</span> <span class="st">&#39;SELECT </span><span class="ch">&#39;&#39;</span><span class="st">-----| Declare user defined type [ID] / [ColumnName] / [PivotAction] </span><span class="ch">&#39;&#39;</span><span class="st"> &#39;</span></span>
<span id="cb427-27"><a href="#cb427-27"></a>                                        <span class="op">+</span> <span class="st">&#39;UNION ALL &#39;</span></span>
<span id="cb427-28"><a href="#cb427-28"></a>                                        <span class="op">+</span> <span class="st">&#39;SELECT </span><span class="ch">&#39;&#39;</span><span class="st">----------------------------------------------------------------------------------------------------</span><span class="ch">&#39;&#39;</span><span class="st"> &#39;</span></span>
<span id="cb427-29"><a href="#cb427-29"></a>                                        <span class="op">+</span> <span class="st">&#39;UNION ALL &#39;</span></span>
<span id="cb427-30"><a href="#cb427-30"></a>                                        <span class="op">+</span> <span class="st">&#39;SELECT </span><span class="ch">&#39;&#39;</span><span class="st">DECLARE @ColumnListWithActions ColumnActionList;</span><span class="ch">&#39;&#39;</span><span class="st">&#39;</span></span>
<span id="cb427-31"><a href="#cb427-31"></a>                                        <span class="op">+</span> <span class="st">&#39;UNION ALL &#39;</span></span>
<span id="cb427-32"><a href="#cb427-32"></a>                                        <span class="op">+</span> <span class="st">&#39;SELECT </span><span class="ch">&#39;&#39;</span><span class="st">----------------------------------------------------------------------------------------------------</span><span class="ch">&#39;&#39;</span><span class="st"> &#39;</span></span>
<span id="cb427-33"><a href="#cb427-33"></a>                                        <span class="op">+</span> <span class="st">&#39;UNION ALL &#39;</span></span>
<span id="cb427-34"><a href="#cb427-34"></a>                                        <span class="op">+</span> <span class="st">&#39;SELECT </span><span class="ch">&#39;&#39;</span><span class="st">-----| Set [PivotAction] (</span><span class="ch">&#39;&#39;&#39;&#39;</span><span class="st">S</span><span class="ch">&#39;&#39;&#39;&#39;</span><span class="st"> as default) to select dimentions and values </span><span class="ch">&#39;&#39;</span><span class="st"> &#39;</span></span>
<span id="cb427-35"><a href="#cb427-35"></a>                                        <span class="op">+</span> <span class="st">&#39;UNION ALL &#39;</span></span>
<span id="cb427-36"><a href="#cb427-36"></a>                                        <span class="op">+</span> <span class="st">&#39;SELECT </span><span class="ch">&#39;&#39;</span><span class="st">-----|</span><span class="ch">&#39;&#39;</span><span class="st">&#39;</span></span>
<span id="cb427-37"><a href="#cb427-37"></a>                                        <span class="op">+</span> <span class="st">&#39;UNION ALL &#39;</span></span>
<span id="cb427-38"><a href="#cb427-38"></a>                                        <span class="op">+</span> <span class="st">&#39;SELECT </span><span class="ch">&#39;&#39;</span><span class="st">-----| </span><span class="ch">&#39;&#39;&#39;&#39;</span><span class="st">S</span><span class="ch">&#39;&#39;&#39;&#39;</span><span class="st"> = Stable column || </span><span class="ch">&#39;&#39;&#39;&#39;</span><span class="st">D</span><span class="ch">&#39;&#39;&#39;&#39;</span><span class="st"> = Dimention column || </span><span class="ch">&#39;&#39;&#39;&#39;</span><span class="st">V</span><span class="ch">&#39;&#39;&#39;&#39;</span><span class="st"> = Value column </span><span class="ch">&#39;&#39;</span><span class="st"> &#39;</span></span>
<span id="cb427-39"><a href="#cb427-39"></a>                                        <span class="op">+</span> <span class="st">&#39;UNION ALL &#39;</span></span>
<span id="cb427-40"><a href="#cb427-40"></a>                                        <span class="op">+</span> <span class="st">&#39;SELECT </span><span class="ch">&#39;&#39;</span><span class="st">----------------------------------------------------------------------------------------------------</span><span class="ch">&#39;&#39;</span><span class="st"> &#39;</span></span>
<span id="cb427-41"><a href="#cb427-41"></a>                                        <span class="op">+</span> <span class="st">&#39;UNION ALL &#39;</span></span>
<span id="cb427-42"><a href="#cb427-42"></a>                                        <span class="op">+</span> <span class="st">&#39;SELECT </span><span class="ch">&#39;&#39;</span><span class="st">INSERT INTO  @ColumnListWithActions VALUES (</span><span class="ch">&#39;&#39;</span><span class="st"> + CAST( ROW_NUMBER() OVER (ORDER BY [NAME]) as nvarchar(10)) + </span><span class="ch">&#39;&#39;</span><span class="st">, </span><span class="ch">&#39;&#39;</span><span class="st"> + </span><span class="ch">&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;</span><span class="st"> + [NAME] + </span><span class="ch">&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;</span><span class="st">+ </span><span class="ch">&#39;&#39;</span><span class="st">, </span><span class="ch">&#39;&#39;&#39;&#39;</span><span class="st">S</span><span class="ch">&#39;&#39;&#39;&#39;</span><span class="st">);</span><span class="ch">&#39;&#39;</span><span class="st">&#39;</span></span>
<span id="cb427-43"><a href="#cb427-43"></a>                                        <span class="op">+</span> <span class="st">&#39;FROM [&#39;</span> <span class="op">+</span> @DB_Name <span class="op">+</span> <span class="st">&#39;].sys.columns  &#39;</span></span>
<span id="cb427-44"><a href="#cb427-44"></a>                                        <span class="op">+</span> <span class="st">&#39;WHERE object_id = object_id(</span><span class="ch">&#39;&#39;</span><span class="st">[&#39;</span> <span class="op">+</span> @DB_Name <span class="op">+</span> <span class="st">&#39;]..[&#39;</span> <span class="op">+</span> @TableName <span class="op">+</span> <span class="st">&#39;]</span><span class="ch">&#39;&#39;</span><span class="st">) &#39;</span></span>
<span id="cb427-45"><a href="#cb427-45"></a>                                        <span class="op">+</span> <span class="st">&#39;UNION ALL &#39;</span></span>
<span id="cb427-46"><a href="#cb427-46"></a>                                        <span class="op">+</span> <span class="st">&#39;SELECT </span><span class="ch">&#39;&#39;</span><span class="st">----------------------------------------------------------------------------------------------------</span><span class="ch">&#39;&#39;</span><span class="st"> &#39;</span></span>
<span id="cb427-47"><a href="#cb427-47"></a>                                        <span class="op">+</span> <span class="st">&#39;UNION ALL &#39;</span></span>
<span id="cb427-48"><a href="#cb427-48"></a>                                        <span class="op">+</span> <span class="st">&#39;SELECT </span><span class="ch">&#39;&#39;</span><span class="st">-----| Execute sp_PivotExecute with parameters: columns and dimentions and main table name</span><span class="ch">&#39;&#39;</span><span class="st"> &#39;</span></span>
<span id="cb427-49"><a href="#cb427-49"></a>                                        <span class="op">+</span> <span class="st">&#39;UNION ALL &#39;</span></span>
<span id="cb427-50"><a href="#cb427-50"></a>                                        <span class="op">+</span> <span class="st">&#39;SELECT </span><span class="ch">&#39;&#39;</span><span class="st">----------------------------------------------------------------------------------------------------</span><span class="ch">&#39;&#39;</span><span class="st"> &#39;</span></span>
<span id="cb427-51"><a href="#cb427-51"></a>                                        <span class="op">+</span> <span class="st">&#39;UNION ALL &#39;</span></span>
<span id="cb427-52"><a href="#cb427-52"></a>                                        <span class="op">+</span> <span class="st">&#39;SELECT </span><span class="ch">&#39;&#39;</span><span class="st">EXEC [dbo].[sp_PivotExecute] @ColumnListWithActions, &#39;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">&#39;&#39;&#39;&#39;</span><span class="st">&#39;</span> <span class="op">+</span> @TableName <span class="op">+</span> <span class="st">&#39;</span><span class="ch">&#39;&#39;&#39;&#39;</span><span class="st">&#39;</span> <span class="op">+</span> <span class="st">&#39;;</span><span class="ch">&#39;&#39;</span><span class="st">&#39;</span></span>
<span id="cb427-53"><a href="#cb427-53"></a>                                        <span class="op">+</span> <span class="st">&#39;UNION ALL &#39;</span></span>
<span id="cb427-54"><a href="#cb427-54"></a>                                        <span class="op">+</span> <span class="st">&#39;SELECT </span><span class="ch">&#39;&#39;</span><span class="st">----------------------------------------------------------------------------------------------------</span><span class="ch">&#39;&#39;</span><span class="st"> &#39;</span>                            </span>
<span id="cb427-55"><a href="#cb427-55"></a>     <span class="kw">EXECUTE</span> SP_EXECUTESQL @SQL_Code;</span>
<span id="cb427-56"><a href="#cb427-56"></a></span>
<span id="cb427-57"><a href="#cb427-57"></a>GO</span>
<span id="cb427-58"><a href="#cb427-58"></a><span class="kw">CREATE</span> <span class="kw">PROCEDURE</span> [dbo].[proc_PivotExecute]</span>
<span id="cb427-59"><a href="#cb427-59"></a>(</span>
<span id="cb427-60"><a href="#cb427-60"></a><span class="ot">@ColumnListWithActions  ColumnActionList ReadOnly</span></span>
<span id="cb427-61"><a href="#cb427-61"></a>,@TableName                     <span class="dt">nvarchar</span>(<span class="dv">128</span>)</span>
<span id="cb427-62"><a href="#cb427-62"></a>)</span>
<span id="cb427-63"><a href="#cb427-63"></a><span class="kw">AS</span></span>
<span id="cb427-64"><a href="#cb427-64"></a><span class="co">--#######################################################################################################################</span></span>
<span id="cb427-65"><a href="#cb427-65"></a><span class="co">--###| Author: Bartosz</span></span>
<span id="cb427-66"><a href="#cb427-66"></a><span class="co">--#######################################################################################################################</span></span>
<span id="cb427-67"><a href="#cb427-67"></a></span>
<span id="cb427-68"><a href="#cb427-68"></a></span>
<span id="cb427-69"><a href="#cb427-69"></a><span class="co">--#######################################################################################################################</span></span>
<span id="cb427-70"><a href="#cb427-70"></a><span class="co">--###| Step 1 - Select our user-defined-table-variable into temp table</span></span>
<span id="cb427-71"><a href="#cb427-71"></a><span class="co">--#######################################################################################################################</span></span>
<span id="cb427-72"><a href="#cb427-72"></a></span>
<span id="cb427-73"><a href="#cb427-73"></a><span class="cf">IF</span> OBJECT_ID(<span class="st">&#39;tempdb.dbo.#ColumnListWithActions&#39;</span>, <span class="st">&#39;U&#39;</span>) <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DROP</span> <span class="kw">TABLE</span> #ColumnListWithActions; </span>
<span id="cb427-74"><a href="#cb427-74"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">INTO</span> #ColumnListWithActions <span class="kw">FROM</span> @ColumnListWithActions;</span>
<span id="cb427-75"><a href="#cb427-75"></a></span>
<span id="cb427-76"><a href="#cb427-76"></a><span class="co">--#######################################################################################################################</span></span>
<span id="cb427-77"><a href="#cb427-77"></a><span class="co">--###| Step 2 - Preparing lists of column groups as strings:</span></span>
<span id="cb427-78"><a href="#cb427-78"></a><span class="co">--#######################################################################################################################</span></span>
<span id="cb427-79"><a href="#cb427-79"></a></span>
<span id="cb427-80"><a href="#cb427-80"></a><span class="kw">DECLARE</span> @ColumnName                     <span class="dt">nvarchar</span>(<span class="dv">128</span>)</span>
<span id="cb427-81"><a href="#cb427-81"></a><span class="kw">DECLARE</span> @Destiny                        <span class="dt">nchar</span>(<span class="dv">1</span>)</span>
<span id="cb427-82"><a href="#cb427-82"></a></span>
<span id="cb427-83"><a href="#cb427-83"></a><span class="kw">DECLARE</span> @ListOfColumns_Stable           <span class="dt">nvarchar</span>(<span class="fu">max</span>)</span>
<span id="cb427-84"><a href="#cb427-84"></a><span class="kw">DECLARE</span> @ListOfColumns_Dimension    <span class="dt">nvarchar</span>(<span class="fu">max</span>)</span>
<span id="cb427-85"><a href="#cb427-85"></a><span class="kw">DECLARE</span> @ListOfColumns_Variable     <span class="dt">nvarchar</span>(<span class="fu">max</span>)</span>
<span id="cb427-86"><a href="#cb427-86"></a><span class="co">--############################</span></span>
<span id="cb427-87"><a href="#cb427-87"></a><span class="co">--###| Cursor for List of Stable Columns</span></span>
<span id="cb427-88"><a href="#cb427-88"></a><span class="co">--############################</span></span>
<span id="cb427-89"><a href="#cb427-89"></a></span>
<span id="cb427-90"><a href="#cb427-90"></a><span class="kw">DECLARE</span> ColumnListStringCreator_S <span class="kw">CURSOR</span> <span class="cf">FOR</span></span>
<span id="cb427-91"><a href="#cb427-91"></a><span class="kw">SELECT</span>      [ColumnName]</span>
<span id="cb427-92"><a href="#cb427-92"></a><span class="kw">FROM</span>        #ColumnListWithActions</span>
<span id="cb427-93"><a href="#cb427-93"></a><span class="kw">WHERE</span>       [Action] <span class="op">=</span> <span class="st">&#39;S&#39;</span></span>
<span id="cb427-94"><a href="#cb427-94"></a><span class="kw">OPEN</span> ColumnListStringCreator_S;</span>
<span id="cb427-95"><a href="#cb427-95"></a>FETCH <span class="kw">NEXT</span> <span class="kw">FROM</span> ColumnListStringCreator_S</span>
<span id="cb427-96"><a href="#cb427-96"></a><span class="kw">INTO</span> @ColumnName</span>
<span id="cb427-97"><a href="#cb427-97"></a>  <span class="cf">WHILE</span> @@FETCH_STATUS <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb427-98"><a href="#cb427-98"></a></span>
<span id="cb427-99"><a href="#cb427-99"></a>   <span class="cf">BEGIN</span></span>
<span id="cb427-100"><a href="#cb427-100"></a>        <span class="kw">SELECT</span> @ListOfColumns_Stable <span class="op">=</span> ISNULL(@ListOfColumns_Stable, <span class="st">&#39;&#39;</span>) <span class="op">+</span> <span class="st">&#39; [&#39;</span> <span class="op">+</span> @ColumnName <span class="op">+</span> <span class="st">&#39;] ,&#39;</span>;</span>
<span id="cb427-101"><a href="#cb427-101"></a>        FETCH <span class="kw">NEXT</span> <span class="kw">FROM</span> ColumnListStringCreator_S <span class="kw">INTO</span> @ColumnName</span>
<span id="cb427-102"><a href="#cb427-102"></a>   <span class="cf">END</span></span>
<span id="cb427-103"><a href="#cb427-103"></a></span>
<span id="cb427-104"><a href="#cb427-104"></a><span class="kw">CLOSE</span> ColumnListStringCreator_S;</span>
<span id="cb427-105"><a href="#cb427-105"></a><span class="kw">DEALLOCATE</span> ColumnListStringCreator_S;</span>
<span id="cb427-106"><a href="#cb427-106"></a></span>
<span id="cb427-107"><a href="#cb427-107"></a><span class="co">--############################</span></span>
<span id="cb427-108"><a href="#cb427-108"></a><span class="co">--###| Cursor for List of Dimension Columns</span></span>
<span id="cb427-109"><a href="#cb427-109"></a><span class="co">--############################</span></span>
<span id="cb427-110"><a href="#cb427-110"></a></span>
<span id="cb427-111"><a href="#cb427-111"></a><span class="kw">DECLARE</span> ColumnListStringCreator_D <span class="kw">CURSOR</span> <span class="cf">FOR</span></span>
<span id="cb427-112"><a href="#cb427-112"></a><span class="kw">SELECT</span>      [ColumnName]</span>
<span id="cb427-113"><a href="#cb427-113"></a><span class="kw">FROM</span>        #ColumnListWithActions</span>
<span id="cb427-114"><a href="#cb427-114"></a><span class="kw">WHERE</span>       [Action] <span class="op">=</span> <span class="st">&#39;D&#39;</span></span>
<span id="cb427-115"><a href="#cb427-115"></a><span class="kw">OPEN</span> ColumnListStringCreator_D;</span>
<span id="cb427-116"><a href="#cb427-116"></a>FETCH <span class="kw">NEXT</span> <span class="kw">FROM</span> ColumnListStringCreator_D</span>
<span id="cb427-117"><a href="#cb427-117"></a><span class="kw">INTO</span> @ColumnName</span>
<span id="cb427-118"><a href="#cb427-118"></a>  <span class="cf">WHILE</span> @@FETCH_STATUS <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb427-119"><a href="#cb427-119"></a></span>
<span id="cb427-120"><a href="#cb427-120"></a>   <span class="cf">BEGIN</span></span>
<span id="cb427-121"><a href="#cb427-121"></a>        <span class="kw">SELECT</span> @ListOfColumns_Dimension <span class="op">=</span> ISNULL(@ListOfColumns_Dimension, <span class="st">&#39;&#39;</span>) <span class="op">+</span> <span class="st">&#39; [&#39;</span> <span class="op">+</span> @ColumnName <span class="op">+</span> <span class="st">&#39;] ,&#39;</span>;</span>
<span id="cb427-122"><a href="#cb427-122"></a>        FETCH <span class="kw">NEXT</span> <span class="kw">FROM</span> ColumnListStringCreator_D <span class="kw">INTO</span> @ColumnName</span>
<span id="cb427-123"><a href="#cb427-123"></a>   <span class="cf">END</span></span>
<span id="cb427-124"><a href="#cb427-124"></a></span>
<span id="cb427-125"><a href="#cb427-125"></a><span class="kw">CLOSE</span> ColumnListStringCreator_D;</span>
<span id="cb427-126"><a href="#cb427-126"></a><span class="kw">DEALLOCATE</span> ColumnListStringCreator_D;</span>
<span id="cb427-127"><a href="#cb427-127"></a></span>
<span id="cb427-128"><a href="#cb427-128"></a><span class="co">--############################</span></span>
<span id="cb427-129"><a href="#cb427-129"></a><span class="co">--###| Cursor for List of Variable Columns</span></span>
<span id="cb427-130"><a href="#cb427-130"></a><span class="co">--############################</span></span>
<span id="cb427-131"><a href="#cb427-131"></a></span>
<span id="cb427-132"><a href="#cb427-132"></a><span class="kw">DECLARE</span> ColumnListStringCreator_V <span class="kw">CURSOR</span> <span class="cf">FOR</span></span>
<span id="cb427-133"><a href="#cb427-133"></a><span class="kw">SELECT</span>      [ColumnName]</span>
<span id="cb427-134"><a href="#cb427-134"></a><span class="kw">FROM</span>        #ColumnListWithActions</span>
<span id="cb427-135"><a href="#cb427-135"></a><span class="kw">WHERE</span>       [Action] <span class="op">=</span> <span class="st">&#39;V&#39;</span></span>
<span id="cb427-136"><a href="#cb427-136"></a><span class="kw">OPEN</span> ColumnListStringCreator_V;</span>
<span id="cb427-137"><a href="#cb427-137"></a>FETCH <span class="kw">NEXT</span> <span class="kw">FROM</span> ColumnListStringCreator_V</span>
<span id="cb427-138"><a href="#cb427-138"></a><span class="kw">INTO</span> @ColumnName</span>
<span id="cb427-139"><a href="#cb427-139"></a>  <span class="cf">WHILE</span> @@FETCH_STATUS <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb427-140"><a href="#cb427-140"></a></span>
<span id="cb427-141"><a href="#cb427-141"></a>   <span class="cf">BEGIN</span></span>
<span id="cb427-142"><a href="#cb427-142"></a>        <span class="kw">SELECT</span> @ListOfColumns_Variable <span class="op">=</span> ISNULL(@ListOfColumns_Variable, <span class="st">&#39;&#39;</span>) <span class="op">+</span> <span class="st">&#39; [&#39;</span> <span class="op">+</span> @ColumnName <span class="op">+</span> <span class="st">&#39;] ,&#39;</span>;</span>
<span id="cb427-143"><a href="#cb427-143"></a>        FETCH <span class="kw">NEXT</span> <span class="kw">FROM</span> ColumnListStringCreator_V <span class="kw">INTO</span> @ColumnName</span>
<span id="cb427-144"><a href="#cb427-144"></a>   <span class="cf">END</span></span>
<span id="cb427-145"><a href="#cb427-145"></a></span>
<span id="cb427-146"><a href="#cb427-146"></a><span class="kw">CLOSE</span> ColumnListStringCreator_V;</span>
<span id="cb427-147"><a href="#cb427-147"></a><span class="kw">DEALLOCATE</span> ColumnListStringCreator_V;</span>
<span id="cb427-148"><a href="#cb427-148"></a></span>
<span id="cb427-149"><a href="#cb427-149"></a><span class="kw">SELECT</span> @ListOfColumns_Variable      <span class="op">=</span> <span class="kw">LEFT</span>(@ListOfColumns_Variable, LEN(@ListOfColumns_Variable) <span class="op">-</span> <span class="dv">1</span>);</span>
<span id="cb427-150"><a href="#cb427-150"></a><span class="kw">SELECT</span> @ListOfColumns_Dimension <span class="op">=</span> <span class="kw">LEFT</span>(@ListOfColumns_Dimension, LEN(@ListOfColumns_Dimension) <span class="op">-</span> <span class="dv">1</span>);</span>
<span id="cb427-151"><a href="#cb427-151"></a><span class="kw">SELECT</span> @ListOfColumns_Stable            <span class="op">=</span> <span class="kw">LEFT</span>(@ListOfColumns_Stable, LEN(@ListOfColumns_Stable) <span class="op">-</span> <span class="dv">1</span>);</span>
<span id="cb427-152"><a href="#cb427-152"></a></span>
<span id="cb427-153"><a href="#cb427-153"></a><span class="co">--#######################################################################################################################</span></span>
<span id="cb427-154"><a href="#cb427-154"></a><span class="co">--###| Step 3 - Preparing table with all possible connections between Dimension columns excluding NULLs</span></span>
<span id="cb427-155"><a href="#cb427-155"></a><span class="co">--#######################################################################################################################</span></span>
<span id="cb427-156"><a href="#cb427-156"></a><span class="kw">DECLARE</span> @DIM_TAB <span class="kw">TABLE</span> ([DIM_ID] <span class="dt">smallint</span>, [ColumnName] <span class="dt">nvarchar</span>(<span class="dv">128</span>))</span>
<span id="cb427-157"><a href="#cb427-157"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> @DIM_TAB </span>
<span id="cb427-158"><a href="#cb427-158"></a><span class="kw">SELECT</span> [DIM_ID] <span class="op">=</span> <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span>(<span class="kw">ORDER</span> <span class="kw">BY</span> [ColumnName]), [ColumnName] <span class="kw">FROM</span> #ColumnListWithActions <span class="kw">WHERE</span> [Action] <span class="op">=</span> <span class="st">&#39;D&#39;</span>;</span>
<span id="cb427-159"><a href="#cb427-159"></a></span>
<span id="cb427-160"><a href="#cb427-160"></a><span class="kw">DECLARE</span> @DIM_ID <span class="dt">smallint</span>;</span>
<span id="cb427-161"><a href="#cb427-161"></a><span class="kw">SELECT</span>      @DIM_ID <span class="op">=</span> <span class="dv">1</span>;</span>
<span id="cb427-162"><a href="#cb427-162"></a></span>
<span id="cb427-163"><a href="#cb427-163"></a></span>
<span id="cb427-164"><a href="#cb427-164"></a><span class="kw">DECLARE</span> @SQL_Dimentions <span class="dt">nvarchar</span>(<span class="fu">max</span>);</span>
<span id="cb427-165"><a href="#cb427-165"></a></span>
<span id="cb427-166"><a href="#cb427-166"></a><span class="cf">IF</span> OBJECT_ID(<span class="st">&#39;tempdb.dbo.##ALL_Dimentions&#39;</span>, <span class="st">&#39;U&#39;</span>) <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DROP</span> <span class="kw">TABLE</span> ##ALL_Dimentions; </span>
<span id="cb427-167"><a href="#cb427-167"></a></span>
<span id="cb427-168"><a href="#cb427-168"></a><span class="kw">SELECT</span> @SQL_Dimentions      <span class="op">=</span> <span class="st">&#39;SELECT ID = ROW_NUMBER() OVER (ORDER BY &#39;</span> <span class="op">+</span> @ListOfColumns_Dimension <span class="op">+</span> <span class="st">&#39;), &#39;</span> <span class="op">+</span> @ListOfColumns_Dimension</span>
<span id="cb427-169"><a href="#cb427-169"></a>                                            <span class="op">+</span> <span class="st">&#39; INTO ##ALL_Dimentions &#39;</span></span>
<span id="cb427-170"><a href="#cb427-170"></a>                                            <span class="op">+</span> <span class="st">&#39; FROM (SELECT DISTINCT&#39;</span> <span class="op">+</span> @ListOfColumns_Dimension <span class="op">+</span> <span class="st">&#39; FROM  &#39;</span> <span class="op">+</span> @TableName</span>
<span id="cb427-171"><a href="#cb427-171"></a>                                            <span class="op">+</span> <span class="st">&#39; WHERE &#39;</span> <span class="op">+</span> (<span class="kw">SELECT</span> [ColumnName] <span class="kw">FROM</span> @DIM_TAB <span class="kw">WHERE</span> [DIM_ID] <span class="op">=</span> @DIM_ID) <span class="op">+</span> <span class="st">&#39; IS NOT NULL &#39;</span>;</span>
<span id="cb427-172"><a href="#cb427-172"></a>                                            <span class="kw">SELECT</span> @DIM_ID <span class="op">=</span> @DIM_ID <span class="op">+</span> <span class="dv">1</span>;</span>
<span id="cb427-173"><a href="#cb427-173"></a>            <span class="cf">WHILE</span> @DIM_ID <span class="op">&lt;=</span> (<span class="kw">SELECT</span> <span class="fu">MAX</span>([DIM_ID]) <span class="kw">FROM</span> @DIM_TAB)</span>
<span id="cb427-174"><a href="#cb427-174"></a>            <span class="cf">BEGIN</span></span>
<span id="cb427-175"><a href="#cb427-175"></a>            <span class="kw">SELECT</span> @SQL_Dimentions <span class="op">=</span> @SQL_Dimentions <span class="op">+</span> <span class="st">&#39;AND &#39;</span> <span class="op">+</span> (<span class="kw">SELECT</span> [ColumnName] <span class="kw">FROM</span> @DIM_TAB <span class="kw">WHERE</span> [DIM_ID] <span class="op">=</span> @DIM_ID) <span class="op">+</span>  <span class="st">&#39; IS NOT NULL &#39;</span>;</span>
<span id="cb427-176"><a href="#cb427-176"></a>            <span class="kw">SELECT</span> @DIM_ID <span class="op">=</span> @DIM_ID <span class="op">+</span> <span class="dv">1</span>;</span>
<span id="cb427-177"><a href="#cb427-177"></a>            <span class="cf">END</span></span>
<span id="cb427-178"><a href="#cb427-178"></a></span>
<span id="cb427-179"><a href="#cb427-179"></a><span class="kw">SELECT</span> @SQL_Dimentions   <span class="op">=</span> @SQL_Dimentions <span class="op">+</span> <span class="st">&#39; )x&#39;</span>;</span>
<span id="cb427-180"><a href="#cb427-180"></a></span>
<span id="cb427-181"><a href="#cb427-181"></a><span class="kw">EXECUTE</span> SP_EXECUTESQL  @SQL_Dimentions;</span>
<span id="cb427-182"><a href="#cb427-182"></a></span>
<span id="cb427-183"><a href="#cb427-183"></a><span class="co">--#######################################################################################################################</span></span>
<span id="cb427-184"><a href="#cb427-184"></a><span class="co">--###| Step 4 - Preparing table with all possible connections between Stable columns excluding NULLs</span></span>
<span id="cb427-185"><a href="#cb427-185"></a><span class="co">--#######################################################################################################################</span></span>
<span id="cb427-186"><a href="#cb427-186"></a><span class="kw">DECLARE</span> @StabPos_TAB <span class="kw">TABLE</span> ([StabPos_ID] <span class="dt">smallint</span>, [ColumnName] <span class="dt">nvarchar</span>(<span class="dv">128</span>))</span>
<span id="cb427-187"><a href="#cb427-187"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> @StabPos_TAB </span>
<span id="cb427-188"><a href="#cb427-188"></a><span class="kw">SELECT</span> [StabPos_ID] <span class="op">=</span> <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span>(<span class="kw">ORDER</span> <span class="kw">BY</span> [ColumnName]), [ColumnName] <span class="kw">FROM</span> #ColumnListWithActions <span class="kw">WHERE</span> [Action] <span class="op">=</span> <span class="st">&#39;S&#39;</span>;</span>
<span id="cb427-189"><a href="#cb427-189"></a></span>
<span id="cb427-190"><a href="#cb427-190"></a><span class="kw">DECLARE</span> @StabPos_ID <span class="dt">smallint</span>;</span>
<span id="cb427-191"><a href="#cb427-191"></a><span class="kw">SELECT</span>      @StabPos_ID <span class="op">=</span> <span class="dv">1</span>;</span>
<span id="cb427-192"><a href="#cb427-192"></a></span>
<span id="cb427-193"><a href="#cb427-193"></a></span>
<span id="cb427-194"><a href="#cb427-194"></a><span class="kw">DECLARE</span> @SQL_MainStableColumnTable <span class="dt">nvarchar</span>(<span class="fu">max</span>);</span>
<span id="cb427-195"><a href="#cb427-195"></a></span>
<span id="cb427-196"><a href="#cb427-196"></a><span class="cf">IF</span> OBJECT_ID(<span class="st">&#39;tempdb.dbo.##ALL_StableColumns&#39;</span>, <span class="st">&#39;U&#39;</span>) <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DROP</span> <span class="kw">TABLE</span> ##ALL_StableColumns; </span>
<span id="cb427-197"><a href="#cb427-197"></a></span>
<span id="cb427-198"><a href="#cb427-198"></a><span class="kw">SELECT</span> @SQL_MainStableColumnTable       <span class="op">=</span> <span class="st">&#39;SELECT ID = ROW_NUMBER() OVER (ORDER BY &#39;</span> <span class="op">+</span> @ListOfColumns_Stable <span class="op">+</span> <span class="st">&#39;), &#39;</span> <span class="op">+</span> @ListOfColumns_Stable</span>
<span id="cb427-199"><a href="#cb427-199"></a>                                            <span class="op">+</span> <span class="st">&#39; INTO ##ALL_StableColumns &#39;</span></span>
<span id="cb427-200"><a href="#cb427-200"></a>                                            <span class="op">+</span> <span class="st">&#39; FROM (SELECT DISTINCT&#39;</span> <span class="op">+</span> @ListOfColumns_Stable <span class="op">+</span> <span class="st">&#39; FROM  &#39;</span> <span class="op">+</span> @TableName</span>
<span id="cb427-201"><a href="#cb427-201"></a>                                            <span class="op">+</span> <span class="st">&#39; WHERE &#39;</span> <span class="op">+</span> (<span class="kw">SELECT</span> [ColumnName] <span class="kw">FROM</span> @StabPos_TAB <span class="kw">WHERE</span> [StabPos_ID] <span class="op">=</span> @StabPos_ID) <span class="op">+</span> <span class="st">&#39; IS NOT NULL &#39;</span>;</span>
<span id="cb427-202"><a href="#cb427-202"></a>                                            <span class="kw">SELECT</span> @StabPos_ID <span class="op">=</span> @StabPos_ID <span class="op">+</span> <span class="dv">1</span>;</span>
<span id="cb427-203"><a href="#cb427-203"></a>            <span class="cf">WHILE</span> @StabPos_ID <span class="op">&lt;=</span> (<span class="kw">SELECT</span> <span class="fu">MAX</span>([StabPos_ID]) <span class="kw">FROM</span> @StabPos_TAB)</span>
<span id="cb427-204"><a href="#cb427-204"></a>            <span class="cf">BEGIN</span></span>
<span id="cb427-205"><a href="#cb427-205"></a>            <span class="kw">SELECT</span> @SQL_MainStableColumnTable <span class="op">=</span> @SQL_MainStableColumnTable <span class="op">+</span> <span class="st">&#39;AND &#39;</span> <span class="op">+</span> (<span class="kw">SELECT</span> [ColumnName] <span class="kw">FROM</span> @StabPos_TAB <span class="kw">WHERE</span> [StabPos_ID] <span class="op">=</span> @StabPos_ID) <span class="op">+</span>  <span class="st">&#39; IS NOT NULL &#39;</span>;</span>
<span id="cb427-206"><a href="#cb427-206"></a>            <span class="kw">SELECT</span> @StabPos_ID <span class="op">=</span> @StabPos_ID <span class="op">+</span> <span class="dv">1</span>;</span>
<span id="cb427-207"><a href="#cb427-207"></a>            <span class="cf">END</span></span>
<span id="cb427-208"><a href="#cb427-208"></a></span>
<span id="cb427-209"><a href="#cb427-209"></a><span class="kw">SELECT</span> @SQL_MainStableColumnTable    <span class="op">=</span> @SQL_MainStableColumnTable <span class="op">+</span> <span class="st">&#39; )x&#39;</span>;</span>
<span id="cb427-210"><a href="#cb427-210"></a></span>
<span id="cb427-211"><a href="#cb427-211"></a><span class="kw">EXECUTE</span> SP_EXECUTESQL  @SQL_MainStableColumnTable;</span>
<span id="cb427-212"><a href="#cb427-212"></a></span>
<span id="cb427-213"><a href="#cb427-213"></a><span class="co">--#######################################################################################################################</span></span>
<span id="cb427-214"><a href="#cb427-214"></a><span class="co">--###| Step 5 - Preparing table with all options ID</span></span>
<span id="cb427-215"><a href="#cb427-215"></a><span class="co">--#######################################################################################################################</span></span>
<span id="cb427-216"><a href="#cb427-216"></a></span>
<span id="cb427-217"><a href="#cb427-217"></a><span class="kw">DECLARE</span> @FULL_SQL_1 <span class="dt">NVARCHAR</span>(<span class="fu">MAX</span>)</span>
<span id="cb427-218"><a href="#cb427-218"></a><span class="kw">SELECT</span> @FULL_SQL_1 <span class="op">=</span> <span class="st">&#39;&#39;</span></span>
<span id="cb427-219"><a href="#cb427-219"></a></span>
<span id="cb427-220"><a href="#cb427-220"></a><span class="kw">DECLARE</span> @i <span class="dt">smallint</span></span>
<span id="cb427-221"><a href="#cb427-221"></a></span>
<span id="cb427-222"><a href="#cb427-222"></a><span class="cf">IF</span> OBJECT_ID(<span class="st">&#39;tempdb.dbo.##FinalTab&#39;</span>, <span class="st">&#39;U&#39;</span>) <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DROP</span> <span class="kw">TABLE</span> ##FinalTab; </span>
<span id="cb427-223"><a href="#cb427-223"></a></span>
<span id="cb427-224"><a href="#cb427-224"></a><span class="kw">SELECT</span> @FULL_SQL_1 <span class="op">=</span> <span class="st">&#39;SELECT t.*, dim.[ID] &#39;</span></span>
<span id="cb427-225"><a href="#cb427-225"></a>                                    <span class="op">+</span> <span class="st">&#39; INTO ##FinalTab &#39;</span></span>
<span id="cb427-226"><a href="#cb427-226"></a>                                    <span class="op">+</span>   <span class="st">&#39;FROM &#39;</span> <span class="op">+</span> @TableName <span class="op">+</span> <span class="st">&#39; t &#39;</span></span>
<span id="cb427-227"><a href="#cb427-227"></a>                                    <span class="op">+</span>   <span class="st">&#39;JOIN ##ALL_Dimentions dim &#39;</span></span>
<span id="cb427-228"><a href="#cb427-228"></a>                                    <span class="op">+</span>   <span class="st">&#39;ON t.&#39;</span> <span class="op">+</span> (<span class="kw">SELECT</span> [ColumnName] <span class="kw">FROM</span> @DIM_TAB <span class="kw">WHERE</span> [DIM_ID] <span class="op">=</span> <span class="dv">1</span>) <span class="op">+</span> <span class="st">&#39; = dim.&#39;</span> <span class="op">+</span> (<span class="kw">SELECT</span> [ColumnName] <span class="kw">FROM</span> @DIM_TAB <span class="kw">WHERE</span> [DIM_ID] <span class="op">=</span> <span class="dv">1</span>);</span>
<span id="cb427-229"><a href="#cb427-229"></a>                                <span class="kw">SELECT</span> @i <span class="op">=</span> <span class="dv">2</span>                               </span>
<span id="cb427-230"><a href="#cb427-230"></a>                                <span class="cf">WHILE</span> @i <span class="op">&lt;=</span> (<span class="kw">SELECT</span> <span class="fu">MAX</span>([DIM_ID]) <span class="kw">FROM</span> @DIM_TAB)</span>
<span id="cb427-231"><a href="#cb427-231"></a>                                    <span class="cf">BEGIN</span></span>
<span id="cb427-232"><a href="#cb427-232"></a>                                    <span class="kw">SELECT</span> @FULL_SQL_1 <span class="op">=</span> @FULL_SQL_1 <span class="op">+</span> <span class="st">&#39; AND t.&#39;</span> <span class="op">+</span> (<span class="kw">SELECT</span> [ColumnName] <span class="kw">FROM</span> @DIM_TAB <span class="kw">WHERE</span> [DIM_ID] <span class="op">=</span> @i) <span class="op">+</span> <span class="st">&#39; = dim.&#39;</span> <span class="op">+</span> (<span class="kw">SELECT</span> [ColumnName] <span class="kw">FROM</span> @DIM_TAB <span class="kw">WHERE</span> [DIM_ID] <span class="op">=</span> @i)</span>
<span id="cb427-233"><a href="#cb427-233"></a>                                    <span class="kw">SELECT</span> @i <span class="op">=</span> @i <span class="op">+</span><span class="dv">1</span></span>
<span id="cb427-234"><a href="#cb427-234"></a>                                <span class="cf">END</span></span>
<span id="cb427-235"><a href="#cb427-235"></a><span class="kw">EXECUTE</span> SP_EXECUTESQL @FULL_SQL_1</span>
<span id="cb427-236"><a href="#cb427-236"></a></span>
<span id="cb427-237"><a href="#cb427-237"></a><span class="co">--#######################################################################################################################</span></span>
<span id="cb427-238"><a href="#cb427-238"></a><span class="co">--###| Step 6 - Selecting final data</span></span>
<span id="cb427-239"><a href="#cb427-239"></a><span class="co">--#######################################################################################################################</span></span>
<span id="cb427-240"><a href="#cb427-240"></a><span class="kw">DECLARE</span> @STAB_TAB <span class="kw">TABLE</span> ([STAB_ID] <span class="dt">smallint</span>, [ColumnName] <span class="dt">nvarchar</span>(<span class="dv">128</span>))</span>
<span id="cb427-241"><a href="#cb427-241"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> @STAB_TAB </span>
<span id="cb427-242"><a href="#cb427-242"></a><span class="kw">SELECT</span> [STAB_ID] <span class="op">=</span> <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span>(<span class="kw">ORDER</span> <span class="kw">BY</span> [ColumnName]), [ColumnName]</span>
<span id="cb427-243"><a href="#cb427-243"></a><span class="kw">FROM</span> #ColumnListWithActions <span class="kw">WHERE</span> [Action] <span class="op">=</span> <span class="st">&#39;S&#39;</span>;</span>
<span id="cb427-244"><a href="#cb427-244"></a></span>
<span id="cb427-245"><a href="#cb427-245"></a><span class="kw">DECLARE</span> @VAR_TAB <span class="kw">TABLE</span> ([VAR_ID] <span class="dt">smallint</span>, [ColumnName] <span class="dt">nvarchar</span>(<span class="dv">128</span>))</span>
<span id="cb427-246"><a href="#cb427-246"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> @VAR_TAB </span>
<span id="cb427-247"><a href="#cb427-247"></a><span class="kw">SELECT</span> [VAR_ID] <span class="op">=</span> <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span>(<span class="kw">ORDER</span> <span class="kw">BY</span> [ColumnName]), [ColumnName]</span>
<span id="cb427-248"><a href="#cb427-248"></a><span class="kw">FROM</span> #ColumnListWithActions <span class="kw">WHERE</span> [Action] <span class="op">=</span> <span class="st">&#39;V&#39;</span>;</span>
<span id="cb427-249"><a href="#cb427-249"></a></span>
<span id="cb427-250"><a href="#cb427-250"></a><span class="kw">DECLARE</span> @y <span class="dt">smallint</span>;</span>
<span id="cb427-251"><a href="#cb427-251"></a><span class="kw">DECLARE</span> @x <span class="dt">smallint</span>;</span>
<span id="cb427-252"><a href="#cb427-252"></a><span class="kw">DECLARE</span> @z <span class="dt">smallint</span>;</span>
<span id="cb427-253"><a href="#cb427-253"></a></span>
<span id="cb427-254"><a href="#cb427-254"></a></span>
<span id="cb427-255"><a href="#cb427-255"></a><span class="kw">DECLARE</span> @FinalCode <span class="dt">nvarchar</span>(<span class="fu">max</span>)</span>
<span id="cb427-256"><a href="#cb427-256"></a></span>
<span id="cb427-257"><a href="#cb427-257"></a><span class="kw">SELECT</span> @FinalCode <span class="op">=</span> <span class="st">&#39; SELECT ID1.*&#39;</span></span>
<span id="cb427-258"><a href="#cb427-258"></a>                                        <span class="kw">SELECT</span> @y <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb427-259"><a href="#cb427-259"></a>                                        <span class="cf">WHILE</span> @y <span class="op">&lt;=</span> (<span class="kw">SELECT</span> <span class="fu">MAX</span>([<span class="kw">ID</span>]) <span class="kw">FROM</span> ##FinalTab)</span>
<span id="cb427-260"><a href="#cb427-260"></a>                                            <span class="cf">BEGIN</span></span>
<span id="cb427-261"><a href="#cb427-261"></a>                                                <span class="kw">SELECT</span> @z <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb427-262"><a href="#cb427-262"></a>                                                <span class="cf">WHILE</span> @z <span class="op">&lt;=</span> (<span class="kw">SELECT</span> <span class="fu">MAX</span>([VAR_ID]) <span class="kw">FROM</span> @VAR_TAB)</span>
<span id="cb427-263"><a href="#cb427-263"></a>                                                    <span class="cf">BEGIN</span></span>
<span id="cb427-264"><a href="#cb427-264"></a>                                                        <span class="kw">SELECT</span> @FinalCode <span class="op">=</span> @FinalCode <span class="op">+</span>    <span class="st">&#39;, [ID&#39;</span> <span class="op">+</span> <span class="fu">CAST</span>((@y) <span class="kw">as</span> <span class="dt">varchar</span>(<span class="dv">10</span>)) <span class="op">+</span> <span class="st">&#39;.&#39;</span> <span class="op">+</span> (<span class="kw">SELECT</span> [ColumnName] <span class="kw">FROM</span> @VAR_TAB <span class="kw">WHERE</span> [VAR_ID] <span class="op">=</span> @z) <span class="op">+</span> <span class="st">&#39;] =  ID&#39;</span> <span class="op">+</span> <span class="fu">CAST</span>((@y <span class="op">+</span> <span class="dv">1</span>) <span class="kw">as</span> <span class="dt">varchar</span>(<span class="dv">10</span>)) <span class="op">+</span> <span class="st">&#39;.&#39;</span> <span class="op">+</span> (<span class="kw">SELECT</span> [ColumnName] <span class="kw">FROM</span> @VAR_TAB <span class="kw">WHERE</span> [VAR_ID] <span class="op">=</span> @z)</span>
<span id="cb427-265"><a href="#cb427-265"></a>                                                        <span class="kw">SELECT</span> @z <span class="op">=</span> @z <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb427-266"><a href="#cb427-266"></a>                                                    <span class="cf">END</span></span>
<span id="cb427-267"><a href="#cb427-267"></a>                                                    <span class="kw">SELECT</span> @y <span class="op">=</span> @y <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb427-268"><a href="#cb427-268"></a>                                                <span class="cf">END</span></span>
<span id="cb427-269"><a href="#cb427-269"></a>        <span class="kw">SELECT</span> @FinalCode <span class="op">=</span> @FinalCode <span class="op">+</span> </span>
<span id="cb427-270"><a href="#cb427-270"></a>                                        <span class="st">&#39; FROM ( SELECT * FROM ##ALL_StableColumns)ID1&#39;</span>;</span>
<span id="cb427-271"><a href="#cb427-271"></a>                                        <span class="kw">SELECT</span> @y <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb427-272"><a href="#cb427-272"></a>                                        <span class="cf">WHILE</span> @y <span class="op">&lt;=</span> (<span class="kw">SELECT</span> <span class="fu">MAX</span>([<span class="kw">ID</span>]) <span class="kw">FROM</span> ##FinalTab)</span>
<span id="cb427-273"><a href="#cb427-273"></a>                                        <span class="cf">BEGIN</span></span>
<span id="cb427-274"><a href="#cb427-274"></a>                                            <span class="kw">SELECT</span> @x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb427-275"><a href="#cb427-275"></a>                                            <span class="kw">SELECT</span> @FinalCode <span class="op">=</span> @FinalCode </span>
<span id="cb427-276"><a href="#cb427-276"></a>                                                                                <span class="op">+</span> <span class="st">&#39; LEFT JOIN (SELECT &#39;</span> <span class="op">+</span>  @ListOfColumns_Stable <span class="op">+</span> <span class="st">&#39; , &#39;</span> <span class="op">+</span> @ListOfColumns_Variable </span>
<span id="cb427-277"><a href="#cb427-277"></a>                                                                                <span class="op">+</span> <span class="st">&#39; FROM ##FinalTab WHERE [ID] = &#39;</span> </span>
<span id="cb427-278"><a href="#cb427-278"></a>                                                                                <span class="op">+</span> <span class="fu">CAST</span>(@y <span class="kw">as</span> <span class="dt">varchar</span>(<span class="dv">10</span>)) <span class="op">+</span> <span class="st">&#39; )ID&#39;</span> <span class="op">+</span> <span class="fu">CAST</span>((@y <span class="op">+</span> <span class="dv">1</span>) <span class="kw">as</span> <span class="dt">varchar</span>(<span class="dv">10</span>))  </span>
<span id="cb427-279"><a href="#cb427-279"></a>                                                                                <span class="op">+</span> <span class="st">&#39; ON 1 = 1&#39;</span> </span>
<span id="cb427-280"><a href="#cb427-280"></a>                                                                                <span class="cf">WHILE</span> @x <span class="op">&lt;=</span> (<span class="kw">SELECT</span> <span class="fu">MAX</span>([STAB_ID]) <span class="kw">FROM</span> @STAB_TAB)</span>
<span id="cb427-281"><a href="#cb427-281"></a>                                                                                <span class="cf">BEGIN</span></span>
<span id="cb427-282"><a href="#cb427-282"></a>                                                                                    <span class="kw">SELECT</span> @FinalCode <span class="op">=</span> @FinalCode <span class="op">+</span> <span class="st">&#39; AND ID1.&#39;</span> <span class="op">+</span> (<span class="kw">SELECT</span> [ColumnName] <span class="kw">FROM</span> @STAB_TAB <span class="kw">WHERE</span> [STAB_ID] <span class="op">=</span> @x) <span class="op">+</span> <span class="st">&#39; = ID&#39;</span> <span class="op">+</span> <span class="fu">CAST</span>((@y<span class="op">+</span><span class="dv">1</span>) <span class="kw">as</span> <span class="dt">varchar</span>(<span class="dv">10</span>)) <span class="op">+</span> <span class="st">&#39;.&#39;</span> <span class="op">+</span> (<span class="kw">SELECT</span> [ColumnName] <span class="kw">FROM</span> @STAB_TAB <span class="kw">WHERE</span> [STAB_ID] <span class="op">=</span> @x)</span>
<span id="cb427-283"><a href="#cb427-283"></a>                                                                                    <span class="kw">SELECT</span> @x <span class="op">=</span> @x <span class="op">+</span><span class="dv">1</span></span>
<span id="cb427-284"><a href="#cb427-284"></a>                                                                                <span class="cf">END</span></span>
<span id="cb427-285"><a href="#cb427-285"></a>                                            <span class="kw">SELECT</span> @y <span class="op">=</span> @y <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb427-286"><a href="#cb427-286"></a>                                        <span class="cf">END</span></span>
<span id="cb427-287"><a href="#cb427-287"></a></span>
<span id="cb427-288"><a href="#cb427-288"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> ##ALL_Dimentions;</span>
<span id="cb427-289"><a href="#cb427-289"></a><span class="kw">EXECUTE</span> SP_EXECUTESQL @FinalCode;</span>
<span id="cb427-290"><a href="#cb427-290"></a><span class="co">--#######################################################################################################################</span></span></code></pre></div>
<p>
From executing the first query (by passing source DB and table name) you will get a pre-created execution query for the second SP, all you have to do is define is the column from your source: + Stable + Value (will be used to concentrate values based on that) + Dim (column you want to use to pivot by)
</p>
<p>Names and datatypes will be defined automatically!</p>
<p>I cant recommend it for any production environments but does the job for adhoc BI requests.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="best-way-to-get-identity-of-inserted-row-score-784594-in-2018" class="level3">
<h3>71: Best way to get identity of inserted row? (score <a href="https://stackoverflow.com/q/42648.html">784594</a> in 2018)</h3>
<section id="question-69" class="level4">
<h4>Question</h4>
<p>What is the best way to get <code>IDENTITY</code> of inserted row?</p>
<p>I know about <code>@@IDENTITY</code> and <code>IDENT_CURRENT</code> and <code>SCOPE_IDENTITY</code> but don’t understand the pros and cons attached to each.</p>
<p>Can someone please explain the differences and when I should be using each?</p>
</section>
<section id="answer-accepted-score-1341" class="level4">
<h4>Answer accepted (score 1341)</h4>
<ul>
<li>
<p>
<a href="http://msdn.microsoft.com/en-us/library/ms187342.aspx" rel="noreferrer"><code>@@IDENTITY</code></a> returns the last identity value generated for any table in the current session, across all scopes. <strong>You need to be careful here</strong>, since it’s across scopes. You could get a value from a trigger, instead of your current statement.
</p>
</li>
<li>
<p>
<a href="http://msdn.microsoft.com/en-us/library/ms190315.aspx" rel="noreferrer"><code>SCOPE_IDENTITY()</code></a> returns the last identity value generated for any table in the current session and the current scope. <strong>Generally what you want to use</strong>.
</p>
</li>
<li>
<p>
<a href="http://msdn.microsoft.com/en-us/library/ms175098.aspx" rel="noreferrer"><code>IDENT_CURRENT('tableName')</code></a> returns the last identity value generated for a specific table in any session and any scope. This lets you specify which table you want the value from, in case the two above aren’t quite what you need (<strong>very rare</strong>). Also, as @<a href="https://stackoverflow.com/questions/42648/best-way-to-get-identity-of-inserted-row#42665">Guy Starbuck</a> mentioned, “You could use this if you want to get the current IDENTITY value for a table that you have not inserted a record into.”
</p>
</li>
<li>
<p>
The <a href="http://msdn.microsoft.com/en-us/library/ms177564.aspx" rel="noreferrer"><code>OUTPUT</code> clause</a> of the <code>INSERT</code> statement will let you access every row that was inserted via that statement. Since it’s scoped to the specific statement, it’s <strong>more straightforward</strong> than the other functions above. However, it’s a little <strong>more verbose</strong> (you’ll need to insert into a table variable/temp table and then query that) and it gives results even in an error scenario where the statement is rolled back. That said, if your query uses a parallel execution plan, this is the <strong>only guaranteed method</strong> for getting the identity (short of turning off parallelism). However, it is executed <em>before</em> triggers and cannot be used to return trigger-generated values.
</p>
</li>
</ul>
</section>
<section id="answer-2-score-169" class="level4">
<h4>Answer 2 (score 169)</h4>
<p>I believe the safest and most accurate method of retrieving the inserted id would be using the output clause.</p>
<p>for example (taken from the following <a href="http://msdn.microsoft.com/en-us/library/ms177564.aspx" rel="noreferrer">MSDN</a> article)</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb428-1"><a href="#cb428-1"></a><span class="kw">USE</span> AdventureWorks2008R2;</span>
<span id="cb428-2"><a href="#cb428-2"></a>GO</span>
<span id="cb428-3"><a href="#cb428-3"></a><span class="kw">DECLARE</span> @MyTableVar <span class="kw">table</span>( NewScrapReasonID <span class="dt">smallint</span>,</span>
<span id="cb428-4"><a href="#cb428-4"></a>                           Name <span class="dt">varchar</span>(<span class="dv">50</span>),</span>
<span id="cb428-5"><a href="#cb428-5"></a>                           ModifiedDate datetime);</span>
<span id="cb428-6"><a href="#cb428-6"></a><span class="kw">INSERT</span> Production.ScrapReason</span>
<span id="cb428-7"><a href="#cb428-7"></a>    OUTPUT INSERTED.ScrapReasonID, INSERTED.Name, INSERTED.ModifiedDate</span>
<span id="cb428-8"><a href="#cb428-8"></a>        <span class="kw">INTO</span> @MyTableVar</span>
<span id="cb428-9"><a href="#cb428-9"></a><span class="kw">VALUES</span> (N<span class="st">&#39;Operator error&#39;</span>, GETDATE());</span>
<span id="cb428-10"><a href="#cb428-10"></a></span>
<span id="cb428-11"><a href="#cb428-11"></a><span class="co">--Display the result set of the table variable.</span></span>
<span id="cb428-12"><a href="#cb428-12"></a><span class="kw">SELECT</span> NewScrapReasonID, Name, ModifiedDate <span class="kw">FROM</span> @MyTableVar;</span>
<span id="cb428-13"><a href="#cb428-13"></a><span class="co">--Display the result set of the table.</span></span>
<span id="cb428-14"><a href="#cb428-14"></a><span class="kw">SELECT</span> ScrapReasonID, Name, ModifiedDate </span>
<span id="cb428-15"><a href="#cb428-15"></a><span class="kw">FROM</span> Production.ScrapReason;</span>
<span id="cb428-16"><a href="#cb428-16"></a>GO</span></code></pre></div>
</section>
<section id="answer-3-score-103" class="level4">
<h4>Answer 3 (score 103)</h4>
<p>I’m saying the same thing as the other guys, so everyone’s correct, I’m just trying to make it more clear.</p>
<p>
<code>@@IDENTITY</code> returns the id of the last thing that was inserted by your client’s connection to the database.<br> Most of the time this works fine, but sometimes a trigger will go and insert a new row that you don’t know about, and you’ll get the ID from this new row, instead of the one you want
</p>
<p><code>SCOPE_IDENTITY()</code> solves this problem. It returns the id of the last thing that <em>you inserted</em> in the SQL code <em>you sent</em> to the database. If triggers go and create extra rows, they won’t cause the wrong value to get returned. Hooray</p>
<p><code>IDENT_CURRENT</code> returns the last ID that was inserted by anyone. If some other app happens to insert another row at an unforunate time, you’ll get the ID of that row instead of your one.</p>
<p>If you want to play it safe, always use <code>SCOPE_IDENTITY()</code>. If you stick with <code>@@IDENTITY</code> and someone decides to add a trigger later on, all your code will break.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="case-statement-within-where-clause-in-sql-server-2008-score-782209-in-2012" class="level3">
<h3>72: “CASE” statement within “WHERE” clause in SQL Server 2008 (score <a href="https://stackoverflow.com/q/8785209.html">782209</a> in 2012)</h3>
<section id="question-70" class="level4">
<h4>Question</h4>
<p>I am working with a query which contains “CASE” statement within “WHERE” clause. But SQL Server 2008 is giving some errors while executing it. Can anyone please help me with the correct query? Here is the query:</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb429-1"><a href="#cb429-1"></a><span class="kw">SELECT</span></span>
<span id="cb429-2"><a href="#cb429-2"></a>    tl.storenum <span class="st">&#39;Store #&#39;</span>, </span>
<span id="cb429-3"><a href="#cb429-3"></a>    co.ccnum <span class="st">&#39;FuelFirst Card #&#39;</span>, </span>
<span id="cb429-4"><a href="#cb429-4"></a>    co.dtentered <span class="st">&#39;Date Entered&#39;</span>,</span>
<span id="cb429-5"><a href="#cb429-5"></a>    <span class="cf">CASE</span> st.reasonid </span>
<span id="cb429-6"><a href="#cb429-6"></a>        <span class="cf">WHEN</span> <span class="dv">1</span> <span class="cf">THEN</span> <span class="st">&#39;Active&#39;</span> </span>
<span id="cb429-7"><a href="#cb429-7"></a>   <span class="cf">WHEN</span> <span class="dv">2</span> <span class="cf">THEN</span> <span class="st">&#39;Not Active&#39;</span> </span>
<span id="cb429-8"><a href="#cb429-8"></a>   <span class="cf">WHEN</span> <span class="dv">0</span> <span class="cf">THEN</span> st.ccstatustypename </span>
<span id="cb429-9"><a href="#cb429-9"></a>   <span class="cf">ELSE</span> <span class="st">&#39;Unknown&#39;</span> </span>
<span id="cb429-10"><a href="#cb429-10"></a>    <span class="cf">END</span> <span class="st">&#39;Status&#39;</span>,</span>
<span id="cb429-11"><a href="#cb429-11"></a>    <span class="cf">CASE</span> st.ccstatustypename </span>
<span id="cb429-12"><a href="#cb429-12"></a>        <span class="cf">WHEN</span> <span class="st">&#39;Active&#39;</span> <span class="cf">THEN</span> <span class="st">&#39; &#39;</span> </span>
<span id="cb429-13"><a href="#cb429-13"></a>   <span class="cf">WHEN</span> <span class="st">&#39;Not Active&#39;</span> <span class="cf">THEN</span> <span class="st">&#39; &#39;</span> </span>
<span id="cb429-14"><a href="#cb429-14"></a>   <span class="cf">ELSE</span> st.ccstatustypename </span>
<span id="cb429-15"><a href="#cb429-15"></a>    <span class="cf">END</span> <span class="st">&#39;Reason&#39;</span>,</span>
<span id="cb429-16"><a href="#cb429-16"></a>    <span class="fu">UPPER</span>(<span class="kw">REPLACE</span>(<span class="kw">REPLACE</span>(co.personentered,<span class="st">&#39;RT</span><span class="ch">\\\\</span><span class="st">&#39;</span>,<span class="st">&#39;&#39;</span>),<span class="st">&#39;RACETRAC</span><span class="ch">\\\\</span><span class="st">&#39;</span>,<span class="st">&#39;&#39;</span>)) <span class="st">&#39;Person Entered&#39;</span>,</span>
<span id="cb429-17"><a href="#cb429-17"></a>    co.comments <span class="st">&#39;Comments or Notes&#39;</span></span>
<span id="cb429-18"><a href="#cb429-18"></a><span class="kw">FROM</span> </span>
<span id="cb429-19"><a href="#cb429-19"></a>    comments co</span>
<span id="cb429-20"><a href="#cb429-20"></a>    <span class="kw">INNER</span> <span class="kw">JOIN</span> cards cc <span class="kw">ON</span> co.ccnum<span class="op">=</span>cc.ccnum</span>
<span id="cb429-21"><a href="#cb429-21"></a>    <span class="kw">INNER</span> <span class="kw">JOIN</span> customerinfo ci <span class="kw">ON</span> cc.customerinfoid<span class="op">=</span>ci.customerinfoid</span>
<span id="cb429-22"><a href="#cb429-22"></a>    <span class="kw">INNER</span> <span class="kw">JOIN</span> ccstatustype st <span class="kw">ON</span> st.ccstatustypeid<span class="op">=</span>cc.ccstatustypeid</span>
<span id="cb429-23"><a href="#cb429-23"></a>    <span class="kw">INNER</span> <span class="kw">JOIN</span> customerstatus cs <span class="kw">ON</span> cs.customerstatuscd<span class="op">=</span>ci.customerstatuscd</span>
<span id="cb429-24"><a href="#cb429-24"></a>    <span class="kw">INNER</span> <span class="kw">JOIN</span> transactionlog tl <span class="kw">ON</span> tl.transactionlogid<span class="op">=</span>co.transactionlogid</span>
<span id="cb429-25"><a href="#cb429-25"></a>    <span class="kw">LEFT</span> <span class="kw">JOIN</span> stores s <span class="kw">ON</span> s.StoreNum <span class="op">=</span> tl.StoreNum</span>
<span id="cb429-26"><a href="#cb429-26"></a><span class="kw">WHERE</span> </span>
<span id="cb429-27"><a href="#cb429-27"></a>    <span class="cf">CASE</span> LEN(<span class="st">&#39;TestPerson&#39;</span>)</span>
<span id="cb429-28"><a href="#cb429-28"></a>        <span class="cf">WHEN</span> <span class="dv">0</span> <span class="cf">THEN</span> co.personentered  <span class="op">=</span> co.personentered</span>
<span id="cb429-29"><a href="#cb429-29"></a>   <span class="cf">ELSE</span> co.personentered <span class="kw">LIKE</span> <span class="st">&#39;%TestPerson&#39;</span></span>
<span id="cb429-30"><a href="#cb429-30"></a>    <span class="cf">END</span> </span>
<span id="cb429-31"><a href="#cb429-31"></a>    <span class="kw">AND</span> cc.ccnum <span class="op">=</span> <span class="cf">CASE</span> LEN(<span class="st">&#39;TestFFNum&#39;</span>)</span>
<span id="cb429-32"><a href="#cb429-32"></a>        <span class="cf">WHEN</span> <span class="dv">0</span> <span class="cf">THEN</span> cc.ccnum </span>
<span id="cb429-33"><a href="#cb429-33"></a>   <span class="cf">ELSE</span> <span class="st">&#39;TestFFNum&#39;</span> </span>
<span id="cb429-34"><a href="#cb429-34"></a>    <span class="cf">END</span> </span>
<span id="cb429-35"><a href="#cb429-35"></a>    <span class="kw">AND</span> <span class="cf">CASE</span> LEN(<span class="st">&#39;2011-01-09 11:56:29.327&#39;</span>) </span>
<span id="cb429-36"><a href="#cb429-36"></a>        <span class="cf">WHEN</span> <span class="dv">0</span> <span class="cf">THEN</span> co.DTEntered <span class="op">=</span> co.DTEntered </span>
<span id="cb429-37"><a href="#cb429-37"></a>   <span class="cf">ELSE</span> </span>
<span id="cb429-38"><a href="#cb429-38"></a>       <span class="cf">CASE</span> LEN(<span class="st">&#39;2012-01-09 11:56:29.327&#39;</span>) </span>
<span id="cb429-39"><a href="#cb429-39"></a>           <span class="cf">WHEN</span> <span class="dv">0</span> <span class="cf">THEN</span> co.DTEntered <span class="op">&gt;=</span> <span class="st">&#39;2011-01-09 11:56:29.327&#39;</span> </span>
<span id="cb429-40"><a href="#cb429-40"></a>      <span class="cf">ELSE</span> co.DTEntered <span class="kw">BETWEEN</span> <span class="st">&#39;2011-01-09 11:56:29.327&#39;</span> <span class="kw">AND</span> <span class="st">&#39;2012-01-09 11:56:29.327&#39;</span> </span>
<span id="cb429-41"><a href="#cb429-41"></a>       <span class="cf">END</span> </span>
<span id="cb429-42"><a href="#cb429-42"></a>    <span class="cf">END</span></span>
<span id="cb429-43"><a href="#cb429-43"></a>    <span class="kw">AND</span> tl.storenum <span class="op">&lt;</span> <span class="dv">699</span> </span>
<span id="cb429-44"><a href="#cb429-44"></a><span class="kw">ORDER</span> <span class="kw">BY</span> tl.StoreNum</span></code></pre></div>
</section>
<section id="answer-2-score-186" class="level4">
<h4>Answer 2 (score 186)</h4>
<p>First off, the <code>CASE</code> statement must be <em>part</em> of the expression, not the expression itself.</p>
<p>In other words, you can have:</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb430-1"><a href="#cb430-1"></a><span class="kw">WHERE</span> co.DTEntered <span class="op">=</span> <span class="cf">CASE</span> </span>
<span id="cb430-2"><a href="#cb430-2"></a>                          <span class="cf">WHEN</span> LEN(<span class="st">&#39;blah&#39;</span>) <span class="op">=</span> <span class="dv">0</span> </span>
<span id="cb430-3"><a href="#cb430-3"></a>                               <span class="cf">THEN</span> co.DTEntered </span>
<span id="cb430-4"><a href="#cb430-4"></a>                          <span class="cf">ELSE</span> <span class="st">&#39;2011-01-01&#39;</span> </span>
<span id="cb430-5"><a href="#cb430-5"></a>                     <span class="cf">END</span> </span></code></pre></div>
<p>But it won’t work the way you have written them eg:</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb431-1"><a href="#cb431-1"></a><span class="kw">WHERE</span> </span>
<span id="cb431-2"><a href="#cb431-2"></a>    <span class="cf">CASE</span> LEN(<span class="st">&#39;TestPerson&#39;</span>)</span>
<span id="cb431-3"><a href="#cb431-3"></a>        <span class="cf">WHEN</span> <span class="dv">0</span> <span class="cf">THEN</span> co.personentered  <span class="op">=</span> co.personentered</span>
<span id="cb431-4"><a href="#cb431-4"></a>   <span class="cf">ELSE</span> co.personentered <span class="kw">LIKE</span> <span class="st">&#39;%TestPerson&#39;</span></span>
<span id="cb431-5"><a href="#cb431-5"></a>    <span class="cf">END</span> </span></code></pre></div>
<p>You may have better luck using combined OR statements like this:</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb432-1"><a href="#cb432-1"></a><span class="kw">WHERE</span> (</span>
<span id="cb432-2"><a href="#cb432-2"></a>        (LEN(<span class="st">&#39;TestPerson&#39;</span>) <span class="op">=</span> <span class="dv">0</span> </span>
<span id="cb432-3"><a href="#cb432-3"></a>             <span class="kw">AND</span> co.personentered <span class="op">=</span> co.personentered</span>
<span id="cb432-4"><a href="#cb432-4"></a>        ) </span>
<span id="cb432-5"><a href="#cb432-5"></a>        <span class="kw">OR</span> </span>
<span id="cb432-6"><a href="#cb432-6"></a>        (LEN(<span class="st">&#39;TestPerson&#39;</span>) <span class="op">&lt;&gt;</span> <span class="dv">0</span> </span>
<span id="cb432-7"><a href="#cb432-7"></a>             <span class="kw">AND</span> co.personentered <span class="kw">LIKE</span> <span class="st">&#39;%TestPerson&#39;</span>)</span>
<span id="cb432-8"><a href="#cb432-8"></a>      )</span></code></pre></div>
<p>Although, either way I’m not sure how great of a query plan you’ll get. These types of shenanigans in a <code>WHERE</code> clause will often prevent the query optimizer from utilizing indexes.</p>
</section>
<section id="answer-3-score-14" class="level4">
<h4>Answer 3 (score 14)</h4>
<p>This should solve your problem for the time being but I must remind you it isn’t a good approach :</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb433-1"><a href="#cb433-1"></a><span class="kw">WHERE</span> </span>
<span id="cb433-2"><a href="#cb433-2"></a>            <span class="cf">CASE</span> LEN(<span class="st">&#39;TestPerson&#39;</span>)</span>
<span id="cb433-3"><a href="#cb433-3"></a>                <span class="cf">WHEN</span> <span class="dv">0</span> <span class="cf">THEN</span> </span>
<span id="cb433-4"><a href="#cb433-4"></a>                        <span class="cf">CASE</span> <span class="cf">WHEN</span> co.personentered  <span class="op">=</span> co.personentered <span class="cf">THEN</span> <span class="dv">1</span> <span class="cf">ELSE</span> <span class="dv">0</span> <span class="cf">END</span></span>
<span id="cb433-5"><a href="#cb433-5"></a>                <span class="cf">ELSE</span> </span>
<span id="cb433-6"><a href="#cb433-6"></a>                        <span class="cf">CASE</span> <span class="cf">WHEN</span> co.personentered <span class="kw">LIKE</span> <span class="st">&#39;%TestPerson&#39;</span> <span class="cf">THEN</span> <span class="dv">1</span> <span class="cf">ELSE</span> <span class="dv">0</span> <span class="cf">END</span></span>
<span id="cb433-7"><a href="#cb433-7"></a>            <span class="cf">END</span> <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb433-8"><a href="#cb433-8"></a>        <span class="kw">AND</span> cc.ccnum <span class="op">=</span> <span class="cf">CASE</span> LEN(<span class="st">&#39;TestFFNum&#39;</span>)</span>
<span id="cb433-9"><a href="#cb433-9"></a>                            <span class="cf">WHEN</span> <span class="dv">0</span> <span class="cf">THEN</span> cc.ccnum </span>
<span id="cb433-10"><a href="#cb433-10"></a>                            <span class="cf">ELSE</span> <span class="st">&#39;TestFFNum&#39;</span> </span>
<span id="cb433-11"><a href="#cb433-11"></a>                       <span class="cf">END</span> </span>
<span id="cb433-12"><a href="#cb433-12"></a>        <span class="kw">AND</span> <span class="cf">CASE</span> LEN(<span class="st">&#39;2011-01-09 11:56:29.327&#39;</span>) </span>
<span id="cb433-13"><a href="#cb433-13"></a>                <span class="cf">WHEN</span> <span class="dv">0</span> <span class="cf">THEN</span> <span class="cf">CASE</span> <span class="cf">WHEN</span> co.DTEntered <span class="op">=</span> co.DTEntered <span class="cf">THEN</span> <span class="dv">1</span> <span class="cf">ELSE</span> <span class="dv">0</span> <span class="cf">END</span> </span>
<span id="cb433-14"><a href="#cb433-14"></a>                <span class="cf">ELSE</span> </span>
<span id="cb433-15"><a href="#cb433-15"></a>                    <span class="cf">CASE</span> LEN(<span class="st">&#39;2012-01-09 11:56:29.327&#39;</span>) </span>
<span id="cb433-16"><a href="#cb433-16"></a>                        <span class="cf">WHEN</span> <span class="dv">0</span> <span class="cf">THEN</span> </span>
<span id="cb433-17"><a href="#cb433-17"></a>                            <span class="cf">CASE</span> <span class="cf">WHEN</span> co.DTEntered <span class="op">&gt;=</span> <span class="st">&#39;2011-01-09 11:56:29.327&#39;</span> <span class="cf">THEN</span> <span class="dv">1</span> <span class="cf">ELSE</span> <span class="dv">0</span> <span class="cf">END</span> </span>
<span id="cb433-18"><a href="#cb433-18"></a>                        <span class="cf">ELSE</span> </span>
<span id="cb433-19"><a href="#cb433-19"></a>                            <span class="cf">CASE</span> <span class="cf">WHEN</span> co.DTEntered <span class="kw">BETWEEN</span> <span class="st">&#39;2011-01-09 11:56:29.327&#39;</span> </span>
<span id="cb433-20"><a href="#cb433-20"></a>                                                        <span class="kw">AND</span> <span class="st">&#39;2012-01-09 11:56:29.327&#39;</span> </span>
<span id="cb433-21"><a href="#cb433-21"></a>                                                     <span class="cf">THEN</span> <span class="dv">1</span> <span class="cf">ELSE</span> <span class="dv">0</span> <span class="cf">END</span></span>
<span id="cb433-22"><a href="#cb433-22"></a>                    <span class="cf">END</span></span>
<span id="cb433-23"><a href="#cb433-23"></a>            <span class="cf">END</span> <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb433-24"><a href="#cb433-24"></a>        <span class="kw">AND</span> tl.storenum <span class="op">&lt;</span> <span class="dv">699</span> </span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-to-delete-duplicate-rows-in-sql-server-score-779227-in-2019" class="level3">
<h3>73: How to delete duplicate rows in SQL Server? (score <a href="https://stackoverflow.com/q/18390574.html">779227</a> in 2019)</h3>
<section id="question-71" class="level4">
<h4>Question</h4>
<p>How can I <strong>delete duplicate rows</strong> where no <code>unique row id</code> exists?</p>
<p>My table is</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb434-1"><a href="#cb434-1"></a>col1  col2 col3 col4 col5 col6 col7</span>
<span id="cb434-2"><a href="#cb434-2"></a>john  <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span> </span>
<span id="cb434-3"><a href="#cb434-3"></a>john  <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb434-4"><a href="#cb434-4"></a>sally <span class="dv">2</span>    <span class="dv">2</span>    <span class="dv">2</span>    <span class="dv">2</span>    <span class="dv">2</span>    <span class="dv">2</span></span>
<span id="cb434-5"><a href="#cb434-5"></a>sally <span class="dv">2</span>    <span class="dv">2</span>    <span class="dv">2</span>    <span class="dv">2</span>    <span class="dv">2</span>    <span class="dv">2</span></span></code></pre></div>
<p>I want to be left with the following after the duplicate removal:</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb435-1"><a href="#cb435-1"></a>john  <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb435-2"><a href="#cb435-2"></a>sally <span class="dv">2</span>    <span class="dv">2</span>    <span class="dv">2</span>    <span class="dv">2</span>    <span class="dv">2</span>    <span class="dv">2</span></span></code></pre></div>
<p>I’ve tried a few queries but I think they depend on having a row id as I don’t get the desired result. For example:</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb436-1"><a href="#cb436-1"></a><span class="kw">DELETE</span></span>
<span id="cb436-2"><a href="#cb436-2"></a><span class="kw">FROM</span> <span class="kw">table</span></span>
<span id="cb436-3"><a href="#cb436-3"></a><span class="kw">WHERE</span> col1 <span class="kw">IN</span> (</span>
<span id="cb436-4"><a href="#cb436-4"></a>    <span class="kw">SELECT</span> <span class="kw">id</span></span>
<span id="cb436-5"><a href="#cb436-5"></a>    <span class="kw">FROM</span> <span class="kw">table</span></span>
<span id="cb436-6"><a href="#cb436-6"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span> <span class="kw">id</span></span>
<span id="cb436-7"><a href="#cb436-7"></a>    <span class="kw">HAVING</span> (<span class="fu">COUNT</span>(col1) <span class="op">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb436-8"><a href="#cb436-8"></a>)</span></code></pre></div>
</section>
<section id="answer-2-score-735" class="level4">
<h4>Answer 2 (score 735)</h4>
<p>I like CTEs and <code>ROW_NUMBER</code> as the two combined allow us to see which rows are deleted (or updated), therefore just change the <code>DELETE FROM CTE...</code> to <code>SELECT * FROM CTE</code>:</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb437-1"><a href="#cb437-1"></a><span class="kw">WITH</span> CTE <span class="kw">AS</span>(</span>
<span id="cb437-2"><a href="#cb437-2"></a>   <span class="kw">SELECT</span> [col1], [col2], [col3], [col4], [col5], [col6], [col7],</span>
<span id="cb437-3"><a href="#cb437-3"></a>       RN <span class="op">=</span> <span class="fu">ROW_NUMBER</span>()<span class="kw">OVER</span>(<span class="kw">PARTITION</span> <span class="kw">BY</span> col1 <span class="kw">ORDER</span> <span class="kw">BY</span> col1)</span>
<span id="cb437-4"><a href="#cb437-4"></a>   <span class="kw">FROM</span> dbo.Table1</span>
<span id="cb437-5"><a href="#cb437-5"></a>)</span>
<span id="cb437-6"><a href="#cb437-6"></a><span class="kw">DELETE</span> <span class="kw">FROM</span> CTE <span class="kw">WHERE</span> RN <span class="op">&gt;</span> <span class="dv">1</span></span></code></pre></div>
<p><kbd><a href="http://rextester.com/ZHFH51082" rel="noreferrer"><strong>DEMO</strong></a></kbd> (result is different; I assume that it’s due to a typo on your part)</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb438-1"><a href="#cb438-1"></a>COL1    COL2    COL3    COL4    COL5    COL6    COL7</span>
<span id="cb438-2"><a href="#cb438-2"></a>john    <span class="dv">1</span>        <span class="dv">1</span>       <span class="dv">1</span>       <span class="dv">1</span>       <span class="dv">1</span>       <span class="dv">1</span></span>
<span id="cb438-3"><a href="#cb438-3"></a>sally   <span class="dv">2</span>        <span class="dv">2</span>       <span class="dv">2</span>       <span class="dv">2</span>       <span class="dv">2</span>       <span class="dv">2</span></span></code></pre></div>
<p>This example determines duplicates by a single column <code>col1</code> because of the <code>PARTITION BY col1</code>. If you want to include multiple columns simply add them to the <code>PARTITION BY</code>:</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb439-1"><a href="#cb439-1"></a><span class="fu">ROW_NUMBER</span>()<span class="kw">OVER</span>(<span class="kw">PARTITION</span> <span class="kw">BY</span> Col1, Col2, <span class="op">..</span>. <span class="kw">ORDER</span> <span class="kw">BY</span> OrderColumn)</span></code></pre></div>
</section>
<section id="answer-3-score-149" class="level4">
<h4>Answer 3 (score 149)</h4>
<p>I would prefer CTE for deleting duplicate rows from sql server table</p>
<p>strongly recommend to follow this article ::<a href="http://codaffection.com/sql-server-article/delete-duplicate-rows-in-sql-server/" rel="noreferrer">http://codaffection.com/sql-server-article/delete-duplicate-rows-in-sql-server/</a></p>
<blockquote>
by keeping original
</blockquote>
<div class="sourceCode" id="cb440"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb440-1"><a href="#cb440-1"></a><span class="kw">WITH</span> CTE <span class="kw">AS</span></span>
<span id="cb440-2"><a href="#cb440-2"></a>(</span>
<span id="cb440-3"><a href="#cb440-3"></a><span class="kw">SELECT</span> <span class="op">*</span>,<span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> col1,col2,col3 <span class="kw">ORDER</span> <span class="kw">BY</span> col1,col2,col3) <span class="kw">AS</span> RN</span>
<span id="cb440-4"><a href="#cb440-4"></a><span class="kw">FROM</span> MyTable</span>
<span id="cb440-5"><a href="#cb440-5"></a>)</span>
<span id="cb440-6"><a href="#cb440-6"></a></span>
<span id="cb440-7"><a href="#cb440-7"></a><span class="kw">DELETE</span> <span class="kw">FROM</span> CTE <span class="kw">WHERE</span> RN<span class="op">&lt;&gt;</span><span class="dv">1</span></span></code></pre></div>
<blockquote>
without keeping original
</blockquote>
<div class="sourceCode" id="cb441"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb441-1"><a href="#cb441-1"></a><span class="kw">WITH</span> CTE <span class="kw">AS</span></span>
<span id="cb441-2"><a href="#cb441-2"></a>(<span class="kw">SELECT</span> <span class="op">*</span>,R<span class="op">=</span><span class="fu">RANK</span>() <span class="kw">OVER</span> (<span class="kw">ORDER</span> <span class="kw">BY</span> col1,col2,col3)</span>
<span id="cb441-3"><a href="#cb441-3"></a><span class="kw">FROM</span> MyTable)</span>
<span id="cb441-4"><a href="#cb441-4"></a> </span>
<span id="cb441-5"><a href="#cb441-5"></a><span class="kw">DELETE</span> CTE</span>
<span id="cb441-6"><a href="#cb441-6"></a><span class="kw">WHERE</span> R <span class="kw">IN</span> (<span class="kw">SELECT</span> R <span class="kw">FROM</span> CTE <span class="kw">GROUP</span> <span class="kw">BY</span> R <span class="kw">HAVING</span> <span class="fu">COUNT</span>(<span class="op">*</span>)<span class="op">&gt;</span><span class="dv">1</span>)</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="update-and-replace-part-of-a-string-score-777842-in-2015" class="level3">
<h3>74: UPDATE and REPLACE part of a string (score <a href="https://stackoverflow.com/q/17365222.html">777842</a> in 2015)</h3>
<section id="question-72" class="level4">
<h4>Question</h4>
<p>I’ve got a table with two columns, <code>ID</code> and <code>Value</code>. I want to change a part of some strings in the second column.</p>
<p>Example of Table:</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb442-1"><a href="#cb442-1"></a><span class="kw">ID</span>            <span class="fu">Value</span></span>
<span id="cb442-2"><a href="#cb442-2"></a><span class="co">---------------------------------</span></span>
<span id="cb442-3"><a href="#cb442-3"></a><span class="dv">1</span>             c:\temp\<span class="dv">123</span>\abc\<span class="dv">111</span></span>
<span id="cb442-4"><a href="#cb442-4"></a><span class="dv">2</span>             c:\temp\<span class="dv">123</span>\abc\<span class="dv">222</span></span>
<span id="cb442-5"><a href="#cb442-5"></a><span class="dv">3</span>             c:\temp\<span class="dv">123</span>\abc\<span class="dv">333</span></span>
<span id="cb442-6"><a href="#cb442-6"></a><span class="dv">4</span>             c:\temp\<span class="dv">123</span>\abc\<span class="dv">444</span></span></code></pre></div>
<p>Now the <code>123\</code> in the <code>Value</code> string is not needed. I tried <code>UPDATE</code> and <code>REPLACE</code>:</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb443-1"><a href="#cb443-1"></a><span class="kw">UPDATE</span> dbo.xxx</span>
<span id="cb443-2"><a href="#cb443-2"></a><span class="kw">SET</span> <span class="fu">Value</span> <span class="op">=</span> <span class="kw">REPLACE</span>(<span class="fu">Value</span>, <span class="st">&#39;%123%&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb443-3"><a href="#cb443-3"></a><span class="kw">WHERE</span> <span class="kw">ID</span> <span class="op">&lt;=</span> <span class="dv">4</span></span></code></pre></div>
<p>When I execute the script SQL Server does not report an error, but it does not update anything either. Why is that?</p>
</section>
<section id="answer-accepted-score-639" class="level4">
<h4>Answer accepted (score 639)</h4>
<p>You don’t need wildcards in the <code>REPLACE</code> - it just finds the string you enter for the second argument, so the following should work:</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb444-1"><a href="#cb444-1"></a><span class="kw">UPDATE</span> dbo.xxx</span>
<span id="cb444-2"><a href="#cb444-2"></a><span class="kw">SET</span> <span class="fu">Value</span> <span class="op">=</span> <span class="kw">REPLACE</span>(<span class="fu">Value</span>, <span class="st">&#39;123\&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb444-3"><a href="#cb444-3"></a><span class="kw">WHERE</span> <span class="kw">ID</span> <span class="op">&lt;=</span><span class="dv">4</span></span></code></pre></div>
<p>(I also added the <code>\</code> in the replace as I assume you don’t need that either)</p>
</section>
<section id="answer-2-score-50" class="level4">
<h4>Answer 2 (score 50)</h4>
<p>Try to remove <code>%</code> chars as below</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb445-1"><a href="#cb445-1"></a><span class="kw">UPDATE</span> dbo.xxx</span>
<span id="cb445-2"><a href="#cb445-2"></a><span class="kw">SET</span> <span class="fu">Value</span> <span class="op">=</span> <span class="kw">REPLACE</span>(<span class="fu">Value</span>, <span class="st">&#39;123&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb445-3"><a href="#cb445-3"></a><span class="kw">WHERE</span> <span class="kw">ID</span> <span class="op">&lt;=</span><span class="dv">4</span></span></code></pre></div>
</section>
<section id="answer-3-score-35-1" class="level4">
<h4>Answer 3 (score 35)</h4>
<p>To make the query run <strong>faster</strong> in big tables where not every line needs to be updated, you can also choose to only update rows that will be modified:</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb446-1"><a href="#cb446-1"></a><span class="kw">UPDATE</span> dbo.xxx</span>
<span id="cb446-2"><a href="#cb446-2"></a><span class="kw">SET</span> <span class="fu">Value</span> <span class="op">=</span> <span class="kw">REPLACE</span>(<span class="fu">Value</span>, <span class="st">&#39;123&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb446-3"><a href="#cb446-3"></a><span class="kw">WHERE</span> <span class="kw">ID</span> <span class="op">&lt;=</span> <span class="dv">4</span></span>
<span id="cb446-4"><a href="#cb446-4"></a><span class="kw">AND</span> <span class="fu">Value</span> <span class="kw">LIKE</span> <span class="st">&#39;%123%&#39;</span></span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="convert-rows-to-columns-using-pivot-in-sql-server-score-777059-in-2019" class="level3">
<h3>75: Convert Rows to columns using ‘Pivot’ in SQL Server (score <a href="https://stackoverflow.com/q/15931607.html">777059</a> in 2019)</h3>
<section id="question-73" class="level4">
<h4>Question</h4>
<p>I have read the stuff on MS pivot tables and I am still having problems getting this correct.</p>
<p>I have a temp table that is being created, we will say that column 1 is a Store number, and column 2 is a week number and lastly column 3 is a total of some type. Also the Week numbers are dynamic, the store numbers are static.</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb447-1"><a href="#cb447-1"></a><span class="kw">Store</span>      Week     xCount</span>
<span id="cb447-2"><a href="#cb447-2"></a><span class="co">-------    ----     ------</span></span>
<span id="cb447-3"><a href="#cb447-3"></a><span class="dv">102</span>        <span class="dv">1</span>        <span class="dv">96</span></span>
<span id="cb447-4"><a href="#cb447-4"></a><span class="dv">101</span>        <span class="dv">1</span>        <span class="dv">138</span></span>
<span id="cb447-5"><a href="#cb447-5"></a><span class="dv">105</span>        <span class="dv">1</span>        <span class="dv">37</span></span>
<span id="cb447-6"><a href="#cb447-6"></a><span class="dv">109</span>        <span class="dv">1</span>        <span class="dv">59</span></span>
<span id="cb447-7"><a href="#cb447-7"></a><span class="dv">101</span>        <span class="dv">2</span>        <span class="dv">282</span></span>
<span id="cb447-8"><a href="#cb447-8"></a><span class="dv">102</span>        <span class="dv">2</span>        <span class="dv">212</span></span>
<span id="cb447-9"><a href="#cb447-9"></a><span class="dv">105</span>        <span class="dv">2</span>        <span class="dv">78</span></span>
<span id="cb447-10"><a href="#cb447-10"></a><span class="dv">109</span>        <span class="dv">2</span>        <span class="dv">97</span></span>
<span id="cb447-11"><a href="#cb447-11"></a><span class="dv">105</span>        <span class="dv">3</span>        <span class="dv">60</span></span>
<span id="cb447-12"><a href="#cb447-12"></a><span class="dv">102</span>        <span class="dv">3</span>        <span class="dv">123</span></span>
<span id="cb447-13"><a href="#cb447-13"></a><span class="dv">101</span>        <span class="dv">3</span>        <span class="dv">220</span></span>
<span id="cb447-14"><a href="#cb447-14"></a><span class="dv">109</span>        <span class="dv">3</span>        <span class="dv">87</span></span></code></pre></div>
<p>I would like it to come out as a pivot table, like this:</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb448-1"><a href="#cb448-1"></a><span class="kw">Store</span>        <span class="dv">1</span>          <span class="dv">2</span>          <span class="dv">3</span>        <span class="dv">4</span>        <span class="dv">5</span>        <span class="dv">6</span><span class="op">....</span></span>
<span id="cb448-2"><a href="#cb448-2"></a><span class="co">----- </span></span>
<span id="cb448-3"><a href="#cb448-3"></a><span class="dv">101</span>        <span class="dv">138</span>        <span class="dv">282</span>        <span class="dv">220</span></span>
<span id="cb448-4"><a href="#cb448-4"></a><span class="dv">102</span>         <span class="dv">96</span>        <span class="dv">212</span>        <span class="dv">123</span></span>
<span id="cb448-5"><a href="#cb448-5"></a><span class="dv">105</span>         <span class="dv">37</span>        </span>
<span id="cb448-6"><a href="#cb448-6"></a><span class="dv">109</span></span></code></pre></div>
<p>Store numbers down the side and weeks across the top.</p>
</section>
<section id="answer-accepted-score-335" class="level4">
<h4>Answer accepted (score 335)</h4>
<p>If you are using SQL Server 2005+, then you can use the <code>PIVOT</code> function to transform the data from rows into columns.</p>
<p>It sounds like you will need to use dynamic sql if the weeks are unknown but it is easier to see the correct code using a hard-coded version initially.</p>
<p>First up, here are some quick table definitions and data for use:</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb449-1"><a href="#cb449-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> #yt </span>
<span id="cb449-2"><a href="#cb449-2"></a>(</span>
<span id="cb449-3"><a href="#cb449-3"></a>  [<span class="kw">Store</span>] <span class="dt">int</span>, </span>
<span id="cb449-4"><a href="#cb449-4"></a>  [Week] <span class="dt">int</span>, </span>
<span id="cb449-5"><a href="#cb449-5"></a>  [xCount] <span class="dt">int</span></span>
<span id="cb449-6"><a href="#cb449-6"></a>);</span>
<span id="cb449-7"><a href="#cb449-7"></a></span>
<span id="cb449-8"><a href="#cb449-8"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> #yt</span>
<span id="cb449-9"><a href="#cb449-9"></a>(</span>
<span id="cb449-10"><a href="#cb449-10"></a>  [<span class="kw">Store</span>], </span>
<span id="cb449-11"><a href="#cb449-11"></a>  [Week], [xCount]</span>
<span id="cb449-12"><a href="#cb449-12"></a>)</span>
<span id="cb449-13"><a href="#cb449-13"></a><span class="kw">VALUES</span></span>
<span id="cb449-14"><a href="#cb449-14"></a>    (<span class="dv">102</span>, <span class="dv">1</span>, <span class="dv">96</span>),</span>
<span id="cb449-15"><a href="#cb449-15"></a>    (<span class="dv">101</span>, <span class="dv">1</span>, <span class="dv">138</span>),</span>
<span id="cb449-16"><a href="#cb449-16"></a>    (<span class="dv">105</span>, <span class="dv">1</span>, <span class="dv">37</span>),</span>
<span id="cb449-17"><a href="#cb449-17"></a>    (<span class="dv">109</span>, <span class="dv">1</span>, <span class="dv">59</span>),</span>
<span id="cb449-18"><a href="#cb449-18"></a>    (<span class="dv">101</span>, <span class="dv">2</span>, <span class="dv">282</span>),</span>
<span id="cb449-19"><a href="#cb449-19"></a>    (<span class="dv">102</span>, <span class="dv">2</span>, <span class="dv">212</span>),</span>
<span id="cb449-20"><a href="#cb449-20"></a>    (<span class="dv">105</span>, <span class="dv">2</span>, <span class="dv">78</span>),</span>
<span id="cb449-21"><a href="#cb449-21"></a>    (<span class="dv">109</span>, <span class="dv">2</span>, <span class="dv">97</span>),</span>
<span id="cb449-22"><a href="#cb449-22"></a>    (<span class="dv">105</span>, <span class="dv">3</span>, <span class="dv">60</span>),</span>
<span id="cb449-23"><a href="#cb449-23"></a>    (<span class="dv">102</span>, <span class="dv">3</span>, <span class="dv">123</span>),</span>
<span id="cb449-24"><a href="#cb449-24"></a>    (<span class="dv">101</span>, <span class="dv">3</span>, <span class="dv">220</span>),</span>
<span id="cb449-25"><a href="#cb449-25"></a>    (<span class="dv">109</span>, <span class="dv">3</span>, <span class="dv">87</span>);</span></code></pre></div>
<p>If your values are known, then you will hard-code the query:</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb450-1"><a href="#cb450-1"></a><span class="kw">select</span> <span class="op">*</span></span>
<span id="cb450-2"><a href="#cb450-2"></a><span class="kw">from</span> </span>
<span id="cb450-3"><a href="#cb450-3"></a>(</span>
<span id="cb450-4"><a href="#cb450-4"></a>  <span class="kw">select</span> <span class="kw">store</span>, week, xCount</span>
<span id="cb450-5"><a href="#cb450-5"></a>  <span class="kw">from</span> yt</span>
<span id="cb450-6"><a href="#cb450-6"></a>) src</span>
<span id="cb450-7"><a href="#cb450-7"></a>pivot</span>
<span id="cb450-8"><a href="#cb450-8"></a>(</span>
<span id="cb450-9"><a href="#cb450-9"></a>  <span class="fu">sum</span>(xcount)</span>
<span id="cb450-10"><a href="#cb450-10"></a>  <span class="cf">for</span> week <span class="kw">in</span> ([<span class="dv">1</span>], [<span class="dv">2</span>], [<span class="dv">3</span>])</span>
<span id="cb450-11"><a href="#cb450-11"></a>) piv;</span></code></pre></div>
<p>See <a href="https://data.stackexchange.com/stackoverflow/query/580181" rel="noreferrer">SQL Demo</a></p>
<p>Then if you need to generate the week number dynamically, your code will be:</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb451-1"><a href="#cb451-1"></a><span class="kw">DECLARE</span> @cols <span class="kw">AS</span> <span class="dt">NVARCHAR</span>(<span class="fu">MAX</span>),</span>
<span id="cb451-2"><a href="#cb451-2"></a>    @query  <span class="kw">AS</span> <span class="dt">NVARCHAR</span>(<span class="fu">MAX</span>)</span>
<span id="cb451-3"><a href="#cb451-3"></a></span>
<span id="cb451-4"><a href="#cb451-4"></a><span class="kw">select</span> @cols <span class="op">=</span> STUFF((<span class="kw">SELECT</span> <span class="st">&#39;,&#39;</span> <span class="op">+</span> QUOTENAME(Week) </span>
<span id="cb451-5"><a href="#cb451-5"></a>                    <span class="kw">from</span> yt</span>
<span id="cb451-6"><a href="#cb451-6"></a>                    <span class="kw">group</span> <span class="kw">by</span> Week</span>
<span id="cb451-7"><a href="#cb451-7"></a>                    <span class="kw">order</span> <span class="kw">by</span> Week</span>
<span id="cb451-8"><a href="#cb451-8"></a>            <span class="cf">FOR</span> XML PATH(<span class="st">&#39;&#39;</span>), <span class="kw">TYPE</span></span>
<span id="cb451-9"><a href="#cb451-9"></a>            ).<span class="fu">value</span>(<span class="st">&#39;.&#39;</span>, <span class="st">&#39;NVARCHAR(MAX)&#39;</span>) </span>
<span id="cb451-10"><a href="#cb451-10"></a>        ,<span class="dv">1</span>,<span class="dv">1</span>,<span class="st">&#39;&#39;</span>)</span>
<span id="cb451-11"><a href="#cb451-11"></a></span>
<span id="cb451-12"><a href="#cb451-12"></a><span class="kw">set</span> @query <span class="op">=</span> <span class="st">&#39;SELECT store,&#39;</span> <span class="op">+</span> @cols <span class="op">+</span> <span class="st">&#39; from </span></span>
<span id="cb451-13"><a href="#cb451-13"></a><span class="st">             (</span></span>
<span id="cb451-14"><a href="#cb451-14"></a><span class="st">                select store, week, xCount</span></span>
<span id="cb451-15"><a href="#cb451-15"></a><span class="st">                from yt</span></span>
<span id="cb451-16"><a href="#cb451-16"></a><span class="st">            ) x</span></span>
<span id="cb451-17"><a href="#cb451-17"></a><span class="st">            pivot </span></span>
<span id="cb451-18"><a href="#cb451-18"></a><span class="st">            (</span></span>
<span id="cb451-19"><a href="#cb451-19"></a><span class="st">                sum(xCount)</span></span>
<span id="cb451-20"><a href="#cb451-20"></a><span class="st">                for week in (&#39;</span> <span class="op">+</span> @cols <span class="op">+</span> <span class="st">&#39;)</span></span>
<span id="cb451-21"><a href="#cb451-21"></a><span class="st">            ) p &#39;</span></span>
<span id="cb451-22"><a href="#cb451-22"></a></span>
<span id="cb451-23"><a href="#cb451-23"></a><span class="kw">execute</span>(@query);</span></code></pre></div>
<p>See <a href="https://data.stackexchange.com/stackoverflow/query/580183" rel="noreferrer">SQL Demo</a>.</p>
<p>The dynamic version, generates the list of <code>week</code> numbers that should be converted to columns. Both give the same result:</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb452-1"><a href="#cb452-1"></a>| <span class="kw">STORE</span> |   <span class="dv">1</span> |   <span class="dv">2</span> |   <span class="dv">3</span> |</span>
<span id="cb452-2"><a href="#cb452-2"></a><span class="co">---------------------------</span></span>
<span id="cb452-3"><a href="#cb452-3"></a>|   <span class="dv">101</span> | <span class="dv">138</span> | <span class="dv">282</span> | <span class="dv">220</span> |</span>
<span id="cb452-4"><a href="#cb452-4"></a>|   <span class="dv">102</span> |  <span class="dv">96</span> | <span class="dv">212</span> | <span class="dv">123</span> |</span>
<span id="cb452-5"><a href="#cb452-5"></a>|   <span class="dv">105</span> |  <span class="dv">37</span> |  <span class="dv">78</span> |  <span class="dv">60</span> |</span>
<span id="cb452-6"><a href="#cb452-6"></a>|   <span class="dv">109</span> |  <span class="dv">59</span> |  <span class="dv">97</span> |  <span class="dv">87</span> |</span></code></pre></div>
</section>
<section id="answer-2-score-25" class="level4">
<h4>Answer 2 (score 25)</h4>
<p>This is for dynamic # of weeks.</p>
<p>Full example here:<a href="http://sqlhints.com/2014/03/18/dynamic-pivot-in-sql-server/" rel="noreferrer">SQL Dynamic Pivot</a></p>
<div class="sourceCode" id="cb453"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb453-1"><a href="#cb453-1"></a><span class="kw">DECLARE</span> @DynamicPivotQuery <span class="kw">AS</span> <span class="dt">NVARCHAR</span>(<span class="fu">MAX</span>)</span>
<span id="cb453-2"><a href="#cb453-2"></a><span class="kw">DECLARE</span> @ColumnName <span class="kw">AS</span> <span class="dt">NVARCHAR</span>(<span class="fu">MAX</span>)</span>
<span id="cb453-3"><a href="#cb453-3"></a></span>
<span id="cb453-4"><a href="#cb453-4"></a><span class="co">--Get distinct values of the PIVOT Column </span></span>
<span id="cb453-5"><a href="#cb453-5"></a><span class="kw">SELECT</span> @ColumnName<span class="op">=</span> ISNULL(@ColumnName <span class="op">+</span> <span class="st">&#39;,&#39;</span>,<span class="st">&#39;&#39;</span>) <span class="op">+</span> QUOTENAME(Week)</span>
<span id="cb453-6"><a href="#cb453-6"></a><span class="kw">FROM</span> (<span class="kw">SELECT</span> <span class="kw">DISTINCT</span> Week <span class="kw">FROM</span> #StoreSales) <span class="kw">AS</span> Weeks</span>
<span id="cb453-7"><a href="#cb453-7"></a></span>
<span id="cb453-8"><a href="#cb453-8"></a><span class="co">--Prepare the PIVOT query using the dynamic </span></span>
<span id="cb453-9"><a href="#cb453-9"></a><span class="kw">SET</span> @DynamicPivotQuery <span class="op">=</span> </span>
<span id="cb453-10"><a href="#cb453-10"></a>  N<span class="st">&#39;SELECT Store, &#39;</span> <span class="op">+</span> @ColumnName <span class="op">+</span> <span class="st">&#39; </span></span>
<span id="cb453-11"><a href="#cb453-11"></a><span class="st">    FROM #StoreSales</span></span>
<span id="cb453-12"><a href="#cb453-12"></a><span class="st">    PIVOT(SUM(xCount) </span></span>
<span id="cb453-13"><a href="#cb453-13"></a><span class="st">          FOR Week IN (&#39;</span> <span class="op">+</span> @ColumnName <span class="op">+</span> <span class="st">&#39;)) AS PVTTable&#39;</span></span>
<span id="cb453-14"><a href="#cb453-14"></a><span class="co">--Execute the Dynamic Pivot Query</span></span>
<span id="cb453-15"><a href="#cb453-15"></a><span class="kw">EXEC</span> sp_executesql @DynamicPivotQuery</span></code></pre></div>
</section>
<section id="answer-3-score-16-1" class="level4">
<h4>Answer 3 (score 16)</h4>
<p>I’ve achieved the same thing before by using subqueries. So if your original table was called StoreCountsByWeek, and you had a separate table that listed the Store IDs, then it would look like this:</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb454-1"><a href="#cb454-1"></a><span class="kw">SELECT</span> StoreID, </span>
<span id="cb454-2"><a href="#cb454-2"></a>    Week1<span class="op">=</span>(<span class="kw">SELECT</span> ISNULL(<span class="fu">SUM</span>(xCount),<span class="dv">0</span>) <span class="kw">FROM</span> StoreCountsByWeek <span class="kw">WHERE</span> StoreCountsByWeek.StoreID<span class="op">=</span><span class="kw">Store</span>.StoreID <span class="kw">AND</span> Week<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb454-3"><a href="#cb454-3"></a>    Week2<span class="op">=</span>(<span class="kw">SELECT</span> ISNULL(<span class="fu">SUM</span>(xCount),<span class="dv">0</span>) <span class="kw">FROM</span> StoreCountsByWeek <span class="kw">WHERE</span> StoreCountsByWeek.StoreID<span class="op">=</span><span class="kw">Store</span>.StoreID <span class="kw">AND</span> Week<span class="op">=</span><span class="dv">2</span>),</span>
<span id="cb454-4"><a href="#cb454-4"></a>    Week3<span class="op">=</span>(<span class="kw">SELECT</span> ISNULL(<span class="fu">SUM</span>(xCount),<span class="dv">0</span>) <span class="kw">FROM</span> StoreCountsByWeek <span class="kw">WHERE</span> StoreCountsByWeek.StoreID<span class="op">=</span><span class="kw">Store</span>.StoreID <span class="kw">AND</span> Week<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb454-5"><a href="#cb454-5"></a><span class="kw">FROM</span> <span class="kw">Store</span></span>
<span id="cb454-6"><a href="#cb454-6"></a><span class="kw">ORDER</span> <span class="kw">BY</span> StoreID</span></code></pre></div>
<p>One advantage to this method is that the syntax is more clear and it makes it easier to join to other tables to pull other fields into the results too.</p>
<p>My anecdotal results are that running this query over a couple of thousand rows completed in less than one second, and I actually had 7 subqueries. But as noted in the comments, it is more computationally expensive to do it this way, so be careful about using this method if you expect it to run on large amounts of data .</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="sql-query-return-data-from-multiple-tables-score-775509-in-2018" class="level3">
<h3>76: SQL query return data from multiple tables (score <a href="https://stackoverflow.com/q/12475850.html">775509</a> in 2018)</h3>
<section id="question-74" class="level4">
<h4>Question</h4>
<p>I would like to know the following:</p>
<ul>
<li>
how to get data from multiple tables in my database?
</li>
<li>
what types of methods are there to do this?
</li>
<li>
what are joins and unions and how are they different from one another?
</li>
<li>
When should I use each one compared to the others?
</li>
</ul>
<p>I am planning to use this in my (for example - PHP) application, but don’t want to run multiple queries against the database, what options do I have to get data from multiple tables in a single query?</p>
<p>Note: I am writing this as I would like to be able to link to a well written guide on the numerous questions that I constantly come across in the PHP queue, so I can link to this for further detail when I post an answer.</p>
<p>The answers cover off the following:</p>
<ol>
<li>
<a href="https://stackoverflow.com/questions/12475850/how-can-an-sql-query-return-data-from-multiple-tables/12475851#12475851">Part 1 - Joins and Unions</a>
</li>
<li>
<a href="https://stackoverflow.com/questions/12475850/how-can-an-sql-query-return-data-from-multiple-tables/12492267#12492267">Part 2 - Subqueries</a>
</li>
<li>
<a href="https://stackoverflow.com/questions/12475850/how-can-an-sql-query-return-data-from-multiple-tables/12508381#12508381">Part 3 - Tricks and Efficient Code</a>
</li>
<li>
<a href="https://stackoverflow.com/a/12542115/1450077">Part 4 - Subqueries in the From Clause</a>
</li>
<li>
<a href="https://stackoverflow.com/a/12586263/1450077">Part 5 - Mixed Bag of John’s Tricks</a>
</li>
</ol>
</section>
<section id="answer-accepted-score-454-1" class="level4">
<h4>Answer accepted (score 454)</h4>
<h5>
Part 1 - Joins and Unions
</h1>
<p>This answer covers:</p>
<ol>
<li>
<p>Part 1</p>
<ul>
<li>
Joining two or more tables using an inner join (See the <a href="http://en.wikipedia.org/wiki/Join_%28SQL%29" rel="noreferrer">wikipedia entry</a> for additional info)
</li>
<li>
How to use a union query
</li>
<li>
Left and Right Outer Joins (this <a href="https://stackoverflow.com/a/4715847/1450077">stackOverflow answer</a> is excellent to describe types of joins)
</li>
<li>
Intersect queries (and how to reproduce them if your database doesn’t support them) - this is a function of SQL-Server (<a href="https://stackoverflow.com/questions/148795/what-is-the-standard-sql-query-to-retrieve-the-intersection-of-tables">see info</a>) and part of the <a href="https://stackoverflow.com/questions/12443904/creating-query-that-returns-id-if-condition-is-matched-in-rows-from-two-tables/12455505#12455505">reason I wrote this whole thing</a> in the first place.
</li>
</ul>
</li>
<li>
<p>Part 2</p>
<ul>
<li>
Subqueries - what they are, where they can be used and what to watch out for
</li>
<li>
Cartesian joins AKA - Oh, the misery!
</li>
</ul>
</li>
</ol>
<p>There are a number of ways to retrieve data from multiple tables in a database. In this answer, I will be using ANSI-92 join syntax. This may be different to a number of other tutorials out there which use the older ANSI-89 syntax (and if you are used to 89, may seem much less intuitive - but all I can say is to try it) as it is <em>much</em> easier to understand when the queries start getting more complex. Why use it? Is there a performance gain? The <a href="https://stackoverflow.com/questions/334201/why-isnt-sql-ansi-92-standard-better-adopted-over-ansi-89">short answer</a> is no, but it <em>is</em> easier to read once you get used to it. It is easier to read queries written by other folks using this syntax.</p>
<p>I am also going to use the concept of a small caryard which has a database to keep track of what cars it has available. The owner has hired you as his IT Computer guy and expects you to be able to drop him the data that he asks for at the drop of a hat.</p>
<p>I have made a number of lookup tables that will be used by the final table. This will give us a reasonable model to work from. To start off, I will be running my queries against an example database that has the following structure. I will try to think of common mistakes that are made when starting out and explain what goes wrong with them - as well as of course showing how to correct them.</p>
<p>The first table is simply a color listing so that we know what colors we have in the car yard.</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb455-1"><a href="#cb455-1"></a>mysql<span class="op">&gt;</span> <span class="kw">create</span> <span class="kw">table</span> colors(<span class="kw">id</span> <span class="dt">int</span>(<span class="dv">3</span>) <span class="kw">not</span> <span class="kw">null</span> auto_increment <span class="kw">primary</span> <span class="kw">key</span>, </span>
<span id="cb455-2"><a href="#cb455-2"></a>    <span class="op">-&gt;</span> color <span class="dt">varchar</span>(<span class="dv">15</span>), paint <span class="dt">varchar</span>(<span class="dv">10</span>));</span>
<span id="cb455-3"><a href="#cb455-3"></a><span class="kw">Query</span> OK, <span class="dv">0</span> <span class="kw">rows</span> affected (<span class="fl">0.01</span> sec)</span>
<span id="cb455-4"><a href="#cb455-4"></a></span>
<span id="cb455-5"><a href="#cb455-5"></a>mysql<span class="op">&gt;</span> show <span class="kw">columns</span> <span class="kw">from</span> colors;</span>
<span id="cb455-6"><a href="#cb455-6"></a><span class="op">+</span><span class="co">-------+-------------+------+-----+---------+----------------+</span></span>
<span id="cb455-7"><a href="#cb455-7"></a>| Field | <span class="kw">Type</span>        | <span class="kw">Null</span> | <span class="kw">Key</span> | <span class="kw">Default</span> | Extra          |</span>
<span id="cb455-8"><a href="#cb455-8"></a><span class="op">+</span><span class="co">-------+-------------+------+-----+---------+----------------+</span></span>
<span id="cb455-9"><a href="#cb455-9"></a>| <span class="kw">id</span>    | <span class="dt">int</span>(<span class="dv">3</span>)      | <span class="kw">NO</span>   | PRI | <span class="kw">NULL</span>    | auto_increment |</span>
<span id="cb455-10"><a href="#cb455-10"></a>| color | <span class="dt">varchar</span>(<span class="dv">15</span>) | YES  |     | <span class="kw">NULL</span>    |                |</span>
<span id="cb455-11"><a href="#cb455-11"></a>| paint | <span class="dt">varchar</span>(<span class="dv">10</span>) | YES  |     | <span class="kw">NULL</span>    |                |</span>
<span id="cb455-12"><a href="#cb455-12"></a><span class="op">+</span><span class="co">-------+-------------+------+-----+---------+----------------+</span></span>
<span id="cb455-13"><a href="#cb455-13"></a><span class="dv">3</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.01</span> sec)</span>
<span id="cb455-14"><a href="#cb455-14"></a></span>
<span id="cb455-15"><a href="#cb455-15"></a>mysql<span class="op">&gt;</span> <span class="kw">insert</span> <span class="kw">into</span> colors (color, paint) <span class="kw">values</span> (<span class="st">&#39;Red&#39;</span>, <span class="st">&#39;Metallic&#39;</span>), </span>
<span id="cb455-16"><a href="#cb455-16"></a>    <span class="op">-&gt;</span> (<span class="st">&#39;Green&#39;</span>, <span class="st">&#39;Gloss&#39;</span>), (<span class="st">&#39;Blue&#39;</span>, <span class="st">&#39;Metallic&#39;</span>), </span>
<span id="cb455-17"><a href="#cb455-17"></a>    <span class="op">-&gt;</span> (<span class="st">&#39;White&#39;</span> <span class="st">&#39;Gloss&#39;</span>), (<span class="st">&#39;Black&#39;</span> <span class="st">&#39;Gloss&#39;</span>);</span>
<span id="cb455-18"><a href="#cb455-18"></a><span class="kw">Query</span> OK, <span class="dv">5</span> <span class="kw">rows</span> affected (<span class="fl">0.00</span> sec)</span>
<span id="cb455-19"><a href="#cb455-19"></a>Records: <span class="dv">5</span>  Duplicates: <span class="dv">0</span>  Warnings: <span class="dv">0</span></span>
<span id="cb455-20"><a href="#cb455-20"></a></span>
<span id="cb455-21"><a href="#cb455-21"></a>mysql<span class="op">&gt;</span> <span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> colors;</span>
<span id="cb455-22"><a href="#cb455-22"></a><span class="op">+</span><span class="co">----+-------+----------+</span></span>
<span id="cb455-23"><a href="#cb455-23"></a>| <span class="kw">id</span> | color | paint    |</span>
<span id="cb455-24"><a href="#cb455-24"></a><span class="op">+</span><span class="co">----+-------+----------+</span></span>
<span id="cb455-25"><a href="#cb455-25"></a>|  <span class="dv">1</span> | Red   | Metallic |</span>
<span id="cb455-26"><a href="#cb455-26"></a>|  <span class="dv">2</span> | Green | Gloss    |</span>
<span id="cb455-27"><a href="#cb455-27"></a>|  <span class="dv">3</span> | Blue  | Metallic |</span>
<span id="cb455-28"><a href="#cb455-28"></a>|  <span class="dv">4</span> | White | Gloss    |</span>
<span id="cb455-29"><a href="#cb455-29"></a>|  <span class="dv">5</span> | Black | Gloss    |</span>
<span id="cb455-30"><a href="#cb455-30"></a><span class="op">+</span><span class="co">----+-------+----------+</span></span>
<span id="cb455-31"><a href="#cb455-31"></a><span class="dv">5</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>The brands table identifies the different brands of the cars out caryard could possibly sell.</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb456-1"><a href="#cb456-1"></a>mysql<span class="op">&gt;</span> <span class="kw">create</span> <span class="kw">table</span> brands (<span class="kw">id</span> <span class="dt">int</span>(<span class="dv">3</span>) <span class="kw">not</span> <span class="kw">null</span> auto_increment <span class="kw">primary</span> <span class="kw">key</span>, </span>
<span id="cb456-2"><a href="#cb456-2"></a>    <span class="op">-&gt;</span> brand <span class="dt">varchar</span>(<span class="dv">15</span>));</span>
<span id="cb456-3"><a href="#cb456-3"></a><span class="kw">Query</span> OK, <span class="dv">0</span> <span class="kw">rows</span> affected (<span class="fl">0.01</span> sec)</span>
<span id="cb456-4"><a href="#cb456-4"></a></span>
<span id="cb456-5"><a href="#cb456-5"></a>mysql<span class="op">&gt;</span> show <span class="kw">columns</span> <span class="kw">from</span> brands;</span>
<span id="cb456-6"><a href="#cb456-6"></a><span class="op">+</span><span class="co">-------+-------------+------+-----+---------+----------------+</span></span>
<span id="cb456-7"><a href="#cb456-7"></a>| Field | <span class="kw">Type</span>        | <span class="kw">Null</span> | <span class="kw">Key</span> | <span class="kw">Default</span> | Extra          |</span>
<span id="cb456-8"><a href="#cb456-8"></a><span class="op">+</span><span class="co">-------+-------------+------+-----+---------+----------------+</span></span>
<span id="cb456-9"><a href="#cb456-9"></a>| <span class="kw">id</span>    | <span class="dt">int</span>(<span class="dv">3</span>)      | <span class="kw">NO</span>   | PRI | <span class="kw">NULL</span>    | auto_increment |</span>
<span id="cb456-10"><a href="#cb456-10"></a>| brand | <span class="dt">varchar</span>(<span class="dv">15</span>) | YES  |     | <span class="kw">NULL</span>    |                |</span>
<span id="cb456-11"><a href="#cb456-11"></a><span class="op">+</span><span class="co">-------+-------------+------+-----+---------+----------------+</span></span>
<span id="cb456-12"><a href="#cb456-12"></a><span class="dv">2</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.01</span> sec)</span>
<span id="cb456-13"><a href="#cb456-13"></a></span>
<span id="cb456-14"><a href="#cb456-14"></a>mysql<span class="op">&gt;</span> <span class="kw">insert</span> <span class="kw">into</span> brands (brand) <span class="kw">values</span> (<span class="st">&#39;Ford&#39;</span>), (<span class="st">&#39;Toyota&#39;</span>), </span>
<span id="cb456-15"><a href="#cb456-15"></a>    <span class="op">-&gt;</span> (<span class="st">&#39;Nissan&#39;</span>), (<span class="st">&#39;Smart&#39;</span>), (<span class="st">&#39;BMW&#39;</span>);</span>
<span id="cb456-16"><a href="#cb456-16"></a><span class="kw">Query</span> OK, <span class="dv">5</span> <span class="kw">rows</span> affected (<span class="fl">0.00</span> sec)</span>
<span id="cb456-17"><a href="#cb456-17"></a>Records: <span class="dv">5</span>  Duplicates: <span class="dv">0</span>  Warnings: <span class="dv">0</span></span>
<span id="cb456-18"><a href="#cb456-18"></a></span>
<span id="cb456-19"><a href="#cb456-19"></a>mysql<span class="op">&gt;</span> <span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> brands;</span>
<span id="cb456-20"><a href="#cb456-20"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb456-21"><a href="#cb456-21"></a>| <span class="kw">id</span> | brand  |</span>
<span id="cb456-22"><a href="#cb456-22"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb456-23"><a href="#cb456-23"></a>|  <span class="dv">1</span> | Ford   |</span>
<span id="cb456-24"><a href="#cb456-24"></a>|  <span class="dv">2</span> | Toyota |</span>
<span id="cb456-25"><a href="#cb456-25"></a>|  <span class="dv">3</span> | Nissan |</span>
<span id="cb456-26"><a href="#cb456-26"></a>|  <span class="dv">4</span> | Smart  |</span>
<span id="cb456-27"><a href="#cb456-27"></a>|  <span class="dv">5</span> | BMW    |</span>
<span id="cb456-28"><a href="#cb456-28"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb456-29"><a href="#cb456-29"></a><span class="dv">5</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>The model table will cover off different types of cars, it is going to be simpler for this to use different car types rather than actual car models.</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb457-1"><a href="#cb457-1"></a>mysql<span class="op">&gt;</span> <span class="kw">create</span> <span class="kw">table</span> models (<span class="kw">id</span> <span class="dt">int</span>(<span class="dv">3</span>) <span class="kw">not</span> <span class="kw">null</span> auto_increment <span class="kw">primary</span> <span class="kw">key</span>, </span>
<span id="cb457-2"><a href="#cb457-2"></a>    <span class="op">-&gt;</span> model <span class="dt">varchar</span>(<span class="dv">15</span>));</span>
<span id="cb457-3"><a href="#cb457-3"></a><span class="kw">Query</span> OK, <span class="dv">0</span> <span class="kw">rows</span> affected (<span class="fl">0.01</span> sec)</span>
<span id="cb457-4"><a href="#cb457-4"></a></span>
<span id="cb457-5"><a href="#cb457-5"></a>mysql<span class="op">&gt;</span> show <span class="kw">columns</span> <span class="kw">from</span> models;</span>
<span id="cb457-6"><a href="#cb457-6"></a><span class="op">+</span><span class="co">-------+-------------+------+-----+---------+----------------+</span></span>
<span id="cb457-7"><a href="#cb457-7"></a>| Field | <span class="kw">Type</span>        | <span class="kw">Null</span> | <span class="kw">Key</span> | <span class="kw">Default</span> | Extra          |</span>
<span id="cb457-8"><a href="#cb457-8"></a><span class="op">+</span><span class="co">-------+-------------+------+-----+---------+----------------+</span></span>
<span id="cb457-9"><a href="#cb457-9"></a>| <span class="kw">id</span>    | <span class="dt">int</span>(<span class="dv">3</span>)      | <span class="kw">NO</span>   | PRI | <span class="kw">NULL</span>    | auto_increment |</span>
<span id="cb457-10"><a href="#cb457-10"></a>| model | <span class="dt">varchar</span>(<span class="dv">15</span>) | YES  |     | <span class="kw">NULL</span>    |                |</span>
<span id="cb457-11"><a href="#cb457-11"></a><span class="op">+</span><span class="co">-------+-------------+------+-----+---------+----------------+</span></span>
<span id="cb457-12"><a href="#cb457-12"></a><span class="dv">2</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span>
<span id="cb457-13"><a href="#cb457-13"></a></span>
<span id="cb457-14"><a href="#cb457-14"></a>mysql<span class="op">&gt;</span> <span class="kw">insert</span> <span class="kw">into</span> models (model) <span class="kw">values</span> (<span class="st">&#39;Sports&#39;</span>), (<span class="st">&#39;Sedan&#39;</span>), (<span class="st">&#39;4WD&#39;</span>), (<span class="st">&#39;Luxury&#39;</span>);</span>
<span id="cb457-15"><a href="#cb457-15"></a><span class="kw">Query</span> OK, <span class="dv">4</span> <span class="kw">rows</span> affected (<span class="fl">0.00</span> sec)</span>
<span id="cb457-16"><a href="#cb457-16"></a>Records: <span class="dv">4</span>  Duplicates: <span class="dv">0</span>  Warnings: <span class="dv">0</span></span>
<span id="cb457-17"><a href="#cb457-17"></a></span>
<span id="cb457-18"><a href="#cb457-18"></a>mysql<span class="op">&gt;</span> <span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> models;</span>
<span id="cb457-19"><a href="#cb457-19"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb457-20"><a href="#cb457-20"></a>| <span class="kw">id</span> | model  |</span>
<span id="cb457-21"><a href="#cb457-21"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb457-22"><a href="#cb457-22"></a>|  <span class="dv">1</span> | Sports |</span>
<span id="cb457-23"><a href="#cb457-23"></a>|  <span class="dv">2</span> | Sedan  |</span>
<span id="cb457-24"><a href="#cb457-24"></a>|  <span class="dv">3</span> | 4WD    |</span>
<span id="cb457-25"><a href="#cb457-25"></a>|  <span class="dv">4</span> | Luxury |</span>
<span id="cb457-26"><a href="#cb457-26"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb457-27"><a href="#cb457-27"></a><span class="dv">4</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>And finally, to tie up all these other tables, the table that ties everything together. The ID field is actually the unique lot number used to identify cars.</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb458-1"><a href="#cb458-1"></a>mysql<span class="op">&gt;</span> <span class="kw">create</span> <span class="kw">table</span> cars (<span class="kw">id</span> <span class="dt">int</span>(<span class="dv">3</span>) <span class="kw">not</span> <span class="kw">null</span> auto_increment <span class="kw">primary</span> <span class="kw">key</span>, </span>
<span id="cb458-2"><a href="#cb458-2"></a>    <span class="op">-&gt;</span> color <span class="dt">int</span>(<span class="dv">3</span>), brand <span class="dt">int</span>(<span class="dv">3</span>), model <span class="dt">int</span>(<span class="dv">3</span>));</span>
<span id="cb458-3"><a href="#cb458-3"></a><span class="kw">Query</span> OK, <span class="dv">0</span> <span class="kw">rows</span> affected (<span class="fl">0.01</span> sec)</span>
<span id="cb458-4"><a href="#cb458-4"></a></span>
<span id="cb458-5"><a href="#cb458-5"></a>mysql<span class="op">&gt;</span> show <span class="kw">columns</span> <span class="kw">from</span> cars;</span>
<span id="cb458-6"><a href="#cb458-6"></a><span class="op">+</span><span class="co">-------+--------+------+-----+---------+----------------+</span></span>
<span id="cb458-7"><a href="#cb458-7"></a>| Field | <span class="kw">Type</span>   | <span class="kw">Null</span> | <span class="kw">Key</span> | <span class="kw">Default</span> | Extra          |</span>
<span id="cb458-8"><a href="#cb458-8"></a><span class="op">+</span><span class="co">-------+--------+------+-----+---------+----------------+</span></span>
<span id="cb458-9"><a href="#cb458-9"></a>| <span class="kw">id</span>    | <span class="dt">int</span>(<span class="dv">3</span>) | <span class="kw">NO</span>   | PRI | <span class="kw">NULL</span>    | auto_increment |</span>
<span id="cb458-10"><a href="#cb458-10"></a>| color | <span class="dt">int</span>(<span class="dv">3</span>) | YES  |     | <span class="kw">NULL</span>    |                |</span>
<span id="cb458-11"><a href="#cb458-11"></a>| brand | <span class="dt">int</span>(<span class="dv">3</span>) | YES  |     | <span class="kw">NULL</span>    |                |</span>
<span id="cb458-12"><a href="#cb458-12"></a>| model | <span class="dt">int</span>(<span class="dv">3</span>) | YES  |     | <span class="kw">NULL</span>    |                |</span>
<span id="cb458-13"><a href="#cb458-13"></a><span class="op">+</span><span class="co">-------+--------+------+-----+---------+----------------+</span></span>
<span id="cb458-14"><a href="#cb458-14"></a><span class="dv">4</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span>
<span id="cb458-15"><a href="#cb458-15"></a></span>
<span id="cb458-16"><a href="#cb458-16"></a>mysql<span class="op">&gt;</span> <span class="kw">insert</span> <span class="kw">into</span> cars (color, brand, model) <span class="kw">values</span> (<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>), (<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">2</span>), (<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">1</span>), </span>
<span id="cb458-17"><a href="#cb458-17"></a>    <span class="op">-&gt;</span> (<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">2</span>), (<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>), (<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">4</span>), (<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">3</span>), (<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>), (<span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">3</span>), (<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">1</span>);</span>
<span id="cb458-18"><a href="#cb458-18"></a><span class="kw">Query</span> OK, <span class="dv">10</span> <span class="kw">rows</span> affected (<span class="fl">0.00</span> sec)</span>
<span id="cb458-19"><a href="#cb458-19"></a>Records: <span class="dv">10</span>  Duplicates: <span class="dv">0</span>  Warnings: <span class="dv">0</span></span>
<span id="cb458-20"><a href="#cb458-20"></a></span>
<span id="cb458-21"><a href="#cb458-21"></a>mysql<span class="op">&gt;</span> <span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> cars;</span>
<span id="cb458-22"><a href="#cb458-22"></a><span class="op">+</span><span class="co">----+-------+-------+-------+</span></span>
<span id="cb458-23"><a href="#cb458-23"></a>| <span class="kw">id</span> | color | brand | model |</span>
<span id="cb458-24"><a href="#cb458-24"></a><span class="op">+</span><span class="co">----+-------+-------+-------+</span></span>
<span id="cb458-25"><a href="#cb458-25"></a>|  <span class="dv">1</span> |     <span class="dv">1</span> |     <span class="dv">2</span> |     <span class="dv">1</span> |</span>
<span id="cb458-26"><a href="#cb458-26"></a>|  <span class="dv">2</span> |     <span class="dv">3</span> |     <span class="dv">1</span> |     <span class="dv">2</span> |</span>
<span id="cb458-27"><a href="#cb458-27"></a>|  <span class="dv">3</span> |     <span class="dv">5</span> |     <span class="dv">3</span> |     <span class="dv">1</span> |</span>
<span id="cb458-28"><a href="#cb458-28"></a>|  <span class="dv">4</span> |     <span class="dv">4</span> |     <span class="dv">4</span> |     <span class="dv">2</span> |</span>
<span id="cb458-29"><a href="#cb458-29"></a>|  <span class="dv">5</span> |     <span class="dv">2</span> |     <span class="dv">2</span> |     <span class="dv">3</span> |</span>
<span id="cb458-30"><a href="#cb458-30"></a>|  <span class="dv">6</span> |     <span class="dv">3</span> |     <span class="dv">5</span> |     <span class="dv">4</span> |</span>
<span id="cb458-31"><a href="#cb458-31"></a>|  <span class="dv">7</span> |     <span class="dv">4</span> |     <span class="dv">1</span> |     <span class="dv">3</span> |</span>
<span id="cb458-32"><a href="#cb458-32"></a>|  <span class="dv">8</span> |     <span class="dv">2</span> |     <span class="dv">2</span> |     <span class="dv">1</span> |</span>
<span id="cb458-33"><a href="#cb458-33"></a>|  <span class="dv">9</span> |     <span class="dv">5</span> |     <span class="dv">2</span> |     <span class="dv">3</span> |</span>
<span id="cb458-34"><a href="#cb458-34"></a>| <span class="dv">10</span> |     <span class="dv">4</span> |     <span class="dv">5</span> |     <span class="dv">1</span> |</span>
<span id="cb458-35"><a href="#cb458-35"></a><span class="op">+</span><span class="co">----+-------+-------+-------+</span></span>
<span id="cb458-36"><a href="#cb458-36"></a><span class="dv">10</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>This will give us enough data (I hope) to cover off the examples below of different types of joins and also give enough data to make them worthwhile.</p>
<p>So getting into the grit of it, the boss wants to know <em>The IDs of all the sports cars he has</em>.</p>
<p>This is a simple two table join. We have a table that identifies the model and the table with the available stock in it. As you can see, the data in the <code>model</code> column of the <code>cars</code> table relates to the <code>models</code> column of the <code>cars</code> table we have. Now, we know that the models table has an ID of <code>1</code> for <code>Sports</code> so lets write the join.</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb459-1"><a href="#cb459-1"></a><span class="kw">select</span></span>
<span id="cb459-2"><a href="#cb459-2"></a>    <span class="kw">ID</span>,</span>
<span id="cb459-3"><a href="#cb459-3"></a>    model</span>
<span id="cb459-4"><a href="#cb459-4"></a><span class="kw">from</span></span>
<span id="cb459-5"><a href="#cb459-5"></a>    cars</span>
<span id="cb459-6"><a href="#cb459-6"></a>        <span class="kw">join</span> models</span>
<span id="cb459-7"><a href="#cb459-7"></a>            <span class="kw">on</span> model<span class="op">=</span><span class="kw">ID</span></span></code></pre></div>
<p>So this query looks good right? We have identified the two tables and contain the information we need and use a join that correctly identifies what columns to join on.</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb460-1"><a href="#cb460-1"></a>ERROR <span class="dv">1052</span> (<span class="dv">23000</span>): <span class="kw">Column</span> <span class="st">&#39;ID&#39;</span> <span class="kw">in</span> field <span class="kw">list</span> <span class="kw">is</span> ambiguous</span></code></pre></div>
<p>Oh noes! An error in our first query! Yes, and it is a plum. You see, the query has indeed got the right columns, but some of them exist in both tables, so the database gets confused about what actual column we mean and where. There are two solutions to solve this. The first is nice and simple, we can use <code>tableName.columnName</code> to tell the database exactly what we mean, like this:</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb461-1"><a href="#cb461-1"></a><span class="kw">select</span></span>
<span id="cb461-2"><a href="#cb461-2"></a>    cars.<span class="kw">ID</span>,</span>
<span id="cb461-3"><a href="#cb461-3"></a>    models.model</span>
<span id="cb461-4"><a href="#cb461-4"></a><span class="kw">from</span></span>
<span id="cb461-5"><a href="#cb461-5"></a>    cars</span>
<span id="cb461-6"><a href="#cb461-6"></a>        <span class="kw">join</span> models</span>
<span id="cb461-7"><a href="#cb461-7"></a>            <span class="kw">on</span> cars.model<span class="op">=</span>models.<span class="kw">ID</span></span>
<span id="cb461-8"><a href="#cb461-8"></a></span>
<span id="cb461-9"><a href="#cb461-9"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb461-10"><a href="#cb461-10"></a>| <span class="kw">ID</span> | model  |</span>
<span id="cb461-11"><a href="#cb461-11"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb461-12"><a href="#cb461-12"></a>|  <span class="dv">1</span> | Sports |</span>
<span id="cb461-13"><a href="#cb461-13"></a>|  <span class="dv">3</span> | Sports |</span>
<span id="cb461-14"><a href="#cb461-14"></a>|  <span class="dv">8</span> | Sports |</span>
<span id="cb461-15"><a href="#cb461-15"></a>| <span class="dv">10</span> | Sports |</span>
<span id="cb461-16"><a href="#cb461-16"></a>|  <span class="dv">2</span> | Sedan  |</span>
<span id="cb461-17"><a href="#cb461-17"></a>|  <span class="dv">4</span> | Sedan  |</span>
<span id="cb461-18"><a href="#cb461-18"></a>|  <span class="dv">5</span> | 4WD    |</span>
<span id="cb461-19"><a href="#cb461-19"></a>|  <span class="dv">7</span> | 4WD    |</span>
<span id="cb461-20"><a href="#cb461-20"></a>|  <span class="dv">9</span> | 4WD    |</span>
<span id="cb461-21"><a href="#cb461-21"></a>|  <span class="dv">6</span> | Luxury |</span>
<span id="cb461-22"><a href="#cb461-22"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb461-23"><a href="#cb461-23"></a><span class="dv">10</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>The other is probably more often used and is called table aliasing. The tables in this example have nice and short simple names, but typing out something like <code>KPI_DAILY_SALES_BY_DEPARTMENT</code> would probably get old quickly, so a simple way is to nickname the table like this:</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb462-1"><a href="#cb462-1"></a><span class="kw">select</span></span>
<span id="cb462-2"><a href="#cb462-2"></a>    a.<span class="kw">ID</span>,</span>
<span id="cb462-3"><a href="#cb462-3"></a>    b.model</span>
<span id="cb462-4"><a href="#cb462-4"></a><span class="kw">from</span></span>
<span id="cb462-5"><a href="#cb462-5"></a>    cars a</span>
<span id="cb462-6"><a href="#cb462-6"></a>        <span class="kw">join</span> models b</span>
<span id="cb462-7"><a href="#cb462-7"></a>            <span class="kw">on</span> a.model<span class="op">=</span>b.<span class="kw">ID</span></span></code></pre></div>
<p>Now, back to the request. As you can see we have the information we need, but we also have information that wasn’t asked for, so we need to include a where clause in the statement to only get the Sports cars as was asked. As I prefer the table alias method rather than using the table names over and over, I will stick to it from this point onwards.</p>
<p>Clearly, we need to add a where clause to our query. We can identify Sports cars either by <code>ID=1</code> or <code>model='Sports'</code>. As the ID is indexed and the primary key (and it happens to be less typing), lets use that in our query.</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb463-1"><a href="#cb463-1"></a><span class="kw">select</span></span>
<span id="cb463-2"><a href="#cb463-2"></a>    a.<span class="kw">ID</span>,</span>
<span id="cb463-3"><a href="#cb463-3"></a>    b.model</span>
<span id="cb463-4"><a href="#cb463-4"></a><span class="kw">from</span></span>
<span id="cb463-5"><a href="#cb463-5"></a>    cars a</span>
<span id="cb463-6"><a href="#cb463-6"></a>        <span class="kw">join</span> models b</span>
<span id="cb463-7"><a href="#cb463-7"></a>            <span class="kw">on</span> a.model<span class="op">=</span>b.<span class="kw">ID</span></span>
<span id="cb463-8"><a href="#cb463-8"></a><span class="kw">where</span></span>
<span id="cb463-9"><a href="#cb463-9"></a>    b.<span class="kw">ID</span><span class="op">=</span><span class="dv">1</span></span>
<span id="cb463-10"><a href="#cb463-10"></a></span>
<span id="cb463-11"><a href="#cb463-11"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb463-12"><a href="#cb463-12"></a>| <span class="kw">ID</span> | model  |</span>
<span id="cb463-13"><a href="#cb463-13"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb463-14"><a href="#cb463-14"></a>|  <span class="dv">1</span> | Sports |</span>
<span id="cb463-15"><a href="#cb463-15"></a>|  <span class="dv">3</span> | Sports |</span>
<span id="cb463-16"><a href="#cb463-16"></a>|  <span class="dv">8</span> | Sports |</span>
<span id="cb463-17"><a href="#cb463-17"></a>| <span class="dv">10</span> | Sports |</span>
<span id="cb463-18"><a href="#cb463-18"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb463-19"><a href="#cb463-19"></a><span class="dv">4</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>Bingo! The boss is happy. Of course, being a boss and never being happy with what he asked for, he looks at the information, then says <em>I want the colors as well</em>.</p>
<p>Okay, so we have a good part of our query already written, but we need to use a third table which is colors. Now, our main information table <code>cars</code> stores the car color ID and this links back to the colors ID column. So, in a similar manner to the original, we can join a third table:</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb464-1"><a href="#cb464-1"></a><span class="kw">select</span></span>
<span id="cb464-2"><a href="#cb464-2"></a>    a.<span class="kw">ID</span>,</span>
<span id="cb464-3"><a href="#cb464-3"></a>    b.model</span>
<span id="cb464-4"><a href="#cb464-4"></a><span class="kw">from</span></span>
<span id="cb464-5"><a href="#cb464-5"></a>    cars a</span>
<span id="cb464-6"><a href="#cb464-6"></a>        <span class="kw">join</span> models b</span>
<span id="cb464-7"><a href="#cb464-7"></a>            <span class="kw">on</span> a.model<span class="op">=</span>b.<span class="kw">ID</span></span>
<span id="cb464-8"><a href="#cb464-8"></a>        <span class="kw">join</span> colors c</span>
<span id="cb464-9"><a href="#cb464-9"></a>            <span class="kw">on</span> a.color<span class="op">=</span>c.<span class="kw">ID</span></span>
<span id="cb464-10"><a href="#cb464-10"></a><span class="kw">where</span></span>
<span id="cb464-11"><a href="#cb464-11"></a>    b.<span class="kw">ID</span><span class="op">=</span><span class="dv">1</span></span>
<span id="cb464-12"><a href="#cb464-12"></a></span>
<span id="cb464-13"><a href="#cb464-13"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb464-14"><a href="#cb464-14"></a>| <span class="kw">ID</span> | model  |</span>
<span id="cb464-15"><a href="#cb464-15"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb464-16"><a href="#cb464-16"></a>|  <span class="dv">1</span> | Sports |</span>
<span id="cb464-17"><a href="#cb464-17"></a>|  <span class="dv">3</span> | Sports |</span>
<span id="cb464-18"><a href="#cb464-18"></a>|  <span class="dv">8</span> | Sports |</span>
<span id="cb464-19"><a href="#cb464-19"></a>| <span class="dv">10</span> | Sports |</span>
<span id="cb464-20"><a href="#cb464-20"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb464-21"><a href="#cb464-21"></a><span class="dv">4</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>Damn, although the table was correctly joined and the related columns were linked, we forgot to pull in the actual <em>information</em> from the new table that we just linked.</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb465-1"><a href="#cb465-1"></a><span class="kw">select</span></span>
<span id="cb465-2"><a href="#cb465-2"></a>    a.<span class="kw">ID</span>,</span>
<span id="cb465-3"><a href="#cb465-3"></a>    b.model,</span>
<span id="cb465-4"><a href="#cb465-4"></a>    c.color</span>
<span id="cb465-5"><a href="#cb465-5"></a><span class="kw">from</span></span>
<span id="cb465-6"><a href="#cb465-6"></a>    cars a</span>
<span id="cb465-7"><a href="#cb465-7"></a>        <span class="kw">join</span> models b</span>
<span id="cb465-8"><a href="#cb465-8"></a>            <span class="kw">on</span> a.model<span class="op">=</span>b.<span class="kw">ID</span></span>
<span id="cb465-9"><a href="#cb465-9"></a>        <span class="kw">join</span> colors c</span>
<span id="cb465-10"><a href="#cb465-10"></a>            <span class="kw">on</span> a.color<span class="op">=</span>c.<span class="kw">ID</span></span>
<span id="cb465-11"><a href="#cb465-11"></a><span class="kw">where</span></span>
<span id="cb465-12"><a href="#cb465-12"></a>    b.<span class="kw">ID</span><span class="op">=</span><span class="dv">1</span></span>
<span id="cb465-13"><a href="#cb465-13"></a></span>
<span id="cb465-14"><a href="#cb465-14"></a><span class="op">+</span><span class="co">----+--------+-------+</span></span>
<span id="cb465-15"><a href="#cb465-15"></a>| <span class="kw">ID</span> | model  | color |</span>
<span id="cb465-16"><a href="#cb465-16"></a><span class="op">+</span><span class="co">----+--------+-------+</span></span>
<span id="cb465-17"><a href="#cb465-17"></a>|  <span class="dv">1</span> | Sports | Red   |</span>
<span id="cb465-18"><a href="#cb465-18"></a>|  <span class="dv">8</span> | Sports | Green |</span>
<span id="cb465-19"><a href="#cb465-19"></a>| <span class="dv">10</span> | Sports | White |</span>
<span id="cb465-20"><a href="#cb465-20"></a>|  <span class="dv">3</span> | Sports | Black |</span>
<span id="cb465-21"><a href="#cb465-21"></a><span class="op">+</span><span class="co">----+--------+-------+</span></span>
<span id="cb465-22"><a href="#cb465-22"></a><span class="dv">4</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>Right, that’s the boss off our back for a moment. Now, to explain some of this in a little more detail. As you can see, the <code>from</code> clause in our statement links our main table (I often use a table that contains information rather than a lookup or dimension table. The query would work just as well with the tables all switched around, but make less sense when we come back to this query to read it in a few months time, so it is often best to try to write a query that will be nice and easy to understand - lay it out intuitively, use nice indenting so that everything is as clear as it can be. If you go on to teach others, try to instill these characteristics in their queries - especially if you will be troubleshooting them.</p>
<p>It is entirely possible to keep linking more and more tables in this manner.</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb466-1"><a href="#cb466-1"></a><span class="kw">select</span></span>
<span id="cb466-2"><a href="#cb466-2"></a>    a.<span class="kw">ID</span>,</span>
<span id="cb466-3"><a href="#cb466-3"></a>    b.model,</span>
<span id="cb466-4"><a href="#cb466-4"></a>    c.color</span>
<span id="cb466-5"><a href="#cb466-5"></a><span class="kw">from</span></span>
<span id="cb466-6"><a href="#cb466-6"></a>    cars a</span>
<span id="cb466-7"><a href="#cb466-7"></a>        <span class="kw">join</span> models b</span>
<span id="cb466-8"><a href="#cb466-8"></a>            <span class="kw">on</span> a.model<span class="op">=</span>b.<span class="kw">ID</span></span>
<span id="cb466-9"><a href="#cb466-9"></a>        <span class="kw">join</span> colors c</span>
<span id="cb466-10"><a href="#cb466-10"></a>            <span class="kw">on</span> a.color<span class="op">=</span>c.<span class="kw">ID</span></span>
<span id="cb466-11"><a href="#cb466-11"></a>        <span class="kw">join</span> brands d</span>
<span id="cb466-12"><a href="#cb466-12"></a>            <span class="kw">on</span> a.brand<span class="op">=</span>d.<span class="kw">ID</span></span>
<span id="cb466-13"><a href="#cb466-13"></a><span class="kw">where</span></span>
<span id="cb466-14"><a href="#cb466-14"></a>    b.<span class="kw">ID</span><span class="op">=</span><span class="dv">1</span></span></code></pre></div>
<p>While I forgot to include a table where we might want to join more than one column in the <code>join</code> statement, here is an example. If the <code>models</code> table had brand-specific models and therefore also had a column called <code>brand</code> which linked back to the <code>brands</code> table on the <code>ID</code> field, it could be done as this:</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb467-1"><a href="#cb467-1"></a><span class="kw">select</span></span>
<span id="cb467-2"><a href="#cb467-2"></a>    a.<span class="kw">ID</span>,</span>
<span id="cb467-3"><a href="#cb467-3"></a>    b.model,</span>
<span id="cb467-4"><a href="#cb467-4"></a>    c.color</span>
<span id="cb467-5"><a href="#cb467-5"></a><span class="kw">from</span></span>
<span id="cb467-6"><a href="#cb467-6"></a>    cars a</span>
<span id="cb467-7"><a href="#cb467-7"></a>        <span class="kw">join</span> models b</span>
<span id="cb467-8"><a href="#cb467-8"></a>            <span class="kw">on</span> a.model<span class="op">=</span>b.<span class="kw">ID</span></span>
<span id="cb467-9"><a href="#cb467-9"></a>        <span class="kw">join</span> colors c</span>
<span id="cb467-10"><a href="#cb467-10"></a>            <span class="kw">on</span> a.color<span class="op">=</span>c.<span class="kw">ID</span></span>
<span id="cb467-11"><a href="#cb467-11"></a>        <span class="kw">join</span> brands d</span>
<span id="cb467-12"><a href="#cb467-12"></a>            <span class="kw">on</span> a.brand<span class="op">=</span>d.<span class="kw">ID</span></span>
<span id="cb467-13"><a href="#cb467-13"></a>            <span class="kw">and</span> b.brand<span class="op">=</span>d.<span class="kw">ID</span></span>
<span id="cb467-14"><a href="#cb467-14"></a><span class="kw">where</span></span>
<span id="cb467-15"><a href="#cb467-15"></a>    b.<span class="kw">ID</span><span class="op">=</span><span class="dv">1</span></span></code></pre></div>
<p>You can see, the query above not only links the joined tables to the main <code>cars</code> table, but also specifies joins between the already joined tables. If this wasn’t done, the result is called a cartesian join - which is dba speak for bad. A cartesian join is one where rows are returned because the information doesn’t tell the database how to limit the results, so the query returns <em>all</em> the rows that fit the criteria.</p>
<p>So, to give an example of a cartesian join, lets run the following query:</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb468-1"><a href="#cb468-1"></a><span class="kw">select</span></span>
<span id="cb468-2"><a href="#cb468-2"></a>    a.<span class="kw">ID</span>,</span>
<span id="cb468-3"><a href="#cb468-3"></a>    b.model</span>
<span id="cb468-4"><a href="#cb468-4"></a><span class="kw">from</span></span>
<span id="cb468-5"><a href="#cb468-5"></a>    cars a</span>
<span id="cb468-6"><a href="#cb468-6"></a>        <span class="kw">join</span> models b</span>
<span id="cb468-7"><a href="#cb468-7"></a></span>
<span id="cb468-8"><a href="#cb468-8"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb468-9"><a href="#cb468-9"></a>| <span class="kw">ID</span> | model  |</span>
<span id="cb468-10"><a href="#cb468-10"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb468-11"><a href="#cb468-11"></a>|  <span class="dv">1</span> | Sports |</span>
<span id="cb468-12"><a href="#cb468-12"></a>|  <span class="dv">1</span> | Sedan  |</span>
<span id="cb468-13"><a href="#cb468-13"></a>|  <span class="dv">1</span> | 4WD    |</span>
<span id="cb468-14"><a href="#cb468-14"></a>|  <span class="dv">1</span> | Luxury |</span>
<span id="cb468-15"><a href="#cb468-15"></a>|  <span class="dv">2</span> | Sports |</span>
<span id="cb468-16"><a href="#cb468-16"></a>|  <span class="dv">2</span> | Sedan  |</span>
<span id="cb468-17"><a href="#cb468-17"></a>|  <span class="dv">2</span> | 4WD    |</span>
<span id="cb468-18"><a href="#cb468-18"></a>|  <span class="dv">2</span> | Luxury |</span>
<span id="cb468-19"><a href="#cb468-19"></a>|  <span class="dv">3</span> | Sports |</span>
<span id="cb468-20"><a href="#cb468-20"></a>|  <span class="dv">3</span> | Sedan  |</span>
<span id="cb468-21"><a href="#cb468-21"></a>|  <span class="dv">3</span> | 4WD    |</span>
<span id="cb468-22"><a href="#cb468-22"></a>|  <span class="dv">3</span> | Luxury |</span>
<span id="cb468-23"><a href="#cb468-23"></a>|  <span class="dv">4</span> | Sports |</span>
<span id="cb468-24"><a href="#cb468-24"></a>|  <span class="dv">4</span> | Sedan  |</span>
<span id="cb468-25"><a href="#cb468-25"></a>|  <span class="dv">4</span> | 4WD    |</span>
<span id="cb468-26"><a href="#cb468-26"></a>|  <span class="dv">4</span> | Luxury |</span>
<span id="cb468-27"><a href="#cb468-27"></a>|  <span class="dv">5</span> | Sports |</span>
<span id="cb468-28"><a href="#cb468-28"></a>|  <span class="dv">5</span> | Sedan  |</span>
<span id="cb468-29"><a href="#cb468-29"></a>|  <span class="dv">5</span> | 4WD    |</span>
<span id="cb468-30"><a href="#cb468-30"></a>|  <span class="dv">5</span> | Luxury |</span>
<span id="cb468-31"><a href="#cb468-31"></a>|  <span class="dv">6</span> | Sports |</span>
<span id="cb468-32"><a href="#cb468-32"></a>|  <span class="dv">6</span> | Sedan  |</span>
<span id="cb468-33"><a href="#cb468-33"></a>|  <span class="dv">6</span> | 4WD    |</span>
<span id="cb468-34"><a href="#cb468-34"></a>|  <span class="dv">6</span> | Luxury |</span>
<span id="cb468-35"><a href="#cb468-35"></a>|  <span class="dv">7</span> | Sports |</span>
<span id="cb468-36"><a href="#cb468-36"></a>|  <span class="dv">7</span> | Sedan  |</span>
<span id="cb468-37"><a href="#cb468-37"></a>|  <span class="dv">7</span> | 4WD    |</span>
<span id="cb468-38"><a href="#cb468-38"></a>|  <span class="dv">7</span> | Luxury |</span>
<span id="cb468-39"><a href="#cb468-39"></a>|  <span class="dv">8</span> | Sports |</span>
<span id="cb468-40"><a href="#cb468-40"></a>|  <span class="dv">8</span> | Sedan  |</span>
<span id="cb468-41"><a href="#cb468-41"></a>|  <span class="dv">8</span> | 4WD    |</span>
<span id="cb468-42"><a href="#cb468-42"></a>|  <span class="dv">8</span> | Luxury |</span>
<span id="cb468-43"><a href="#cb468-43"></a>|  <span class="dv">9</span> | Sports |</span>
<span id="cb468-44"><a href="#cb468-44"></a>|  <span class="dv">9</span> | Sedan  |</span>
<span id="cb468-45"><a href="#cb468-45"></a>|  <span class="dv">9</span> | 4WD    |</span>
<span id="cb468-46"><a href="#cb468-46"></a>|  <span class="dv">9</span> | Luxury |</span>
<span id="cb468-47"><a href="#cb468-47"></a>| <span class="dv">10</span> | Sports |</span>
<span id="cb468-48"><a href="#cb468-48"></a>| <span class="dv">10</span> | Sedan  |</span>
<span id="cb468-49"><a href="#cb468-49"></a>| <span class="dv">10</span> | 4WD    |</span>
<span id="cb468-50"><a href="#cb468-50"></a>| <span class="dv">10</span> | Luxury |</span>
<span id="cb468-51"><a href="#cb468-51"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb468-52"><a href="#cb468-52"></a><span class="dv">40</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>Good god, that’s ugly. However, as far as the database is concerned, it is <em>exactly</em> what was asked for. In the query, we asked for for the <code>ID</code> from <code>cars</code> and the <code>model</code> from <code>models</code>. However, because we didn’t specify <em>how</em> to join the tables, the database has matched <em>every</em> row from the first table with <em>every</em> row from the second table.</p>
<p>Okay, so the boss is back, and he wants more information again. <em>I want the same list, but also include 4WDs in it</em>.</p>
<p>This however, gives us a great excuse to look at two different ways to accomplish this. We could add another condition to the where clause like this:</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb469-1"><a href="#cb469-1"></a><span class="kw">select</span></span>
<span id="cb469-2"><a href="#cb469-2"></a>    a.<span class="kw">ID</span>,</span>
<span id="cb469-3"><a href="#cb469-3"></a>    b.model,</span>
<span id="cb469-4"><a href="#cb469-4"></a>    c.color</span>
<span id="cb469-5"><a href="#cb469-5"></a><span class="kw">from</span></span>
<span id="cb469-6"><a href="#cb469-6"></a>    cars a</span>
<span id="cb469-7"><a href="#cb469-7"></a>        <span class="kw">join</span> models b</span>
<span id="cb469-8"><a href="#cb469-8"></a>            <span class="kw">on</span> a.model<span class="op">=</span>b.<span class="kw">ID</span></span>
<span id="cb469-9"><a href="#cb469-9"></a>        <span class="kw">join</span> colors c</span>
<span id="cb469-10"><a href="#cb469-10"></a>            <span class="kw">on</span> a.color<span class="op">=</span>c.<span class="kw">ID</span></span>
<span id="cb469-11"><a href="#cb469-11"></a>        <span class="kw">join</span> brands d</span>
<span id="cb469-12"><a href="#cb469-12"></a>            <span class="kw">on</span> a.brand<span class="op">=</span>d.<span class="kw">ID</span></span>
<span id="cb469-13"><a href="#cb469-13"></a><span class="kw">where</span></span>
<span id="cb469-14"><a href="#cb469-14"></a>    b.<span class="kw">ID</span><span class="op">=</span><span class="dv">1</span></span>
<span id="cb469-15"><a href="#cb469-15"></a>    <span class="kw">or</span> b.<span class="kw">ID</span><span class="op">=</span><span class="dv">3</span></span></code></pre></div>
<p>While the above will work perfectly well, lets look at it differently, this is a great excuse to show how a <code>union</code> query will work.</p>
<p>We know that the following will return all the Sports cars:</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb470-1"><a href="#cb470-1"></a><span class="kw">select</span></span>
<span id="cb470-2"><a href="#cb470-2"></a>    a.<span class="kw">ID</span>,</span>
<span id="cb470-3"><a href="#cb470-3"></a>    b.model,</span>
<span id="cb470-4"><a href="#cb470-4"></a>    c.color</span>
<span id="cb470-5"><a href="#cb470-5"></a><span class="kw">from</span></span>
<span id="cb470-6"><a href="#cb470-6"></a>    cars a</span>
<span id="cb470-7"><a href="#cb470-7"></a>        <span class="kw">join</span> models b</span>
<span id="cb470-8"><a href="#cb470-8"></a>            <span class="kw">on</span> a.model<span class="op">=</span>b.<span class="kw">ID</span></span>
<span id="cb470-9"><a href="#cb470-9"></a>        <span class="kw">join</span> colors c</span>
<span id="cb470-10"><a href="#cb470-10"></a>            <span class="kw">on</span> a.color<span class="op">=</span>c.<span class="kw">ID</span></span>
<span id="cb470-11"><a href="#cb470-11"></a>        <span class="kw">join</span> brands d</span>
<span id="cb470-12"><a href="#cb470-12"></a>            <span class="kw">on</span> a.brand<span class="op">=</span>d.<span class="kw">ID</span></span>
<span id="cb470-13"><a href="#cb470-13"></a><span class="kw">where</span></span>
<span id="cb470-14"><a href="#cb470-14"></a>    b.<span class="kw">ID</span><span class="op">=</span><span class="dv">1</span></span></code></pre></div>
<p>And the following would return all the 4WDs:</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb471-1"><a href="#cb471-1"></a><span class="kw">select</span></span>
<span id="cb471-2"><a href="#cb471-2"></a>    a.<span class="kw">ID</span>,</span>
<span id="cb471-3"><a href="#cb471-3"></a>    b.model,</span>
<span id="cb471-4"><a href="#cb471-4"></a>    c.color</span>
<span id="cb471-5"><a href="#cb471-5"></a><span class="kw">from</span></span>
<span id="cb471-6"><a href="#cb471-6"></a>    cars a</span>
<span id="cb471-7"><a href="#cb471-7"></a>        <span class="kw">join</span> models b</span>
<span id="cb471-8"><a href="#cb471-8"></a>            <span class="kw">on</span> a.model<span class="op">=</span>b.<span class="kw">ID</span></span>
<span id="cb471-9"><a href="#cb471-9"></a>        <span class="kw">join</span> colors c</span>
<span id="cb471-10"><a href="#cb471-10"></a>            <span class="kw">on</span> a.color<span class="op">=</span>c.<span class="kw">ID</span></span>
<span id="cb471-11"><a href="#cb471-11"></a>        <span class="kw">join</span> brands d</span>
<span id="cb471-12"><a href="#cb471-12"></a>            <span class="kw">on</span> a.brand<span class="op">=</span>d.<span class="kw">ID</span></span>
<span id="cb471-13"><a href="#cb471-13"></a><span class="kw">where</span></span>
<span id="cb471-14"><a href="#cb471-14"></a>    b.<span class="kw">ID</span><span class="op">=</span><span class="dv">3</span></span></code></pre></div>
<p>So by adding a <code>union all</code> clause between them, the results of the second query will be appended to the results of the first query.</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb472-1"><a href="#cb472-1"></a><span class="kw">select</span></span>
<span id="cb472-2"><a href="#cb472-2"></a>    a.<span class="kw">ID</span>,</span>
<span id="cb472-3"><a href="#cb472-3"></a>    b.model,</span>
<span id="cb472-4"><a href="#cb472-4"></a>    c.color</span>
<span id="cb472-5"><a href="#cb472-5"></a><span class="kw">from</span></span>
<span id="cb472-6"><a href="#cb472-6"></a>    cars a</span>
<span id="cb472-7"><a href="#cb472-7"></a>        <span class="kw">join</span> models b</span>
<span id="cb472-8"><a href="#cb472-8"></a>            <span class="kw">on</span> a.model<span class="op">=</span>b.<span class="kw">ID</span></span>
<span id="cb472-9"><a href="#cb472-9"></a>        <span class="kw">join</span> colors c</span>
<span id="cb472-10"><a href="#cb472-10"></a>            <span class="kw">on</span> a.color<span class="op">=</span>c.<span class="kw">ID</span></span>
<span id="cb472-11"><a href="#cb472-11"></a>        <span class="kw">join</span> brands d</span>
<span id="cb472-12"><a href="#cb472-12"></a>            <span class="kw">on</span> a.brand<span class="op">=</span>d.<span class="kw">ID</span></span>
<span id="cb472-13"><a href="#cb472-13"></a><span class="kw">where</span></span>
<span id="cb472-14"><a href="#cb472-14"></a>    b.<span class="kw">ID</span><span class="op">=</span><span class="dv">1</span></span>
<span id="cb472-15"><a href="#cb472-15"></a><span class="kw">union</span> <span class="kw">all</span></span>
<span id="cb472-16"><a href="#cb472-16"></a><span class="kw">select</span></span>
<span id="cb472-17"><a href="#cb472-17"></a>    a.<span class="kw">ID</span>,</span>
<span id="cb472-18"><a href="#cb472-18"></a>    b.model,</span>
<span id="cb472-19"><a href="#cb472-19"></a>    c.color</span>
<span id="cb472-20"><a href="#cb472-20"></a><span class="kw">from</span></span>
<span id="cb472-21"><a href="#cb472-21"></a>    cars a</span>
<span id="cb472-22"><a href="#cb472-22"></a>        <span class="kw">join</span> models b</span>
<span id="cb472-23"><a href="#cb472-23"></a>            <span class="kw">on</span> a.model<span class="op">=</span>b.<span class="kw">ID</span></span>
<span id="cb472-24"><a href="#cb472-24"></a>        <span class="kw">join</span> colors c</span>
<span id="cb472-25"><a href="#cb472-25"></a>            <span class="kw">on</span> a.color<span class="op">=</span>c.<span class="kw">ID</span></span>
<span id="cb472-26"><a href="#cb472-26"></a>        <span class="kw">join</span> brands d</span>
<span id="cb472-27"><a href="#cb472-27"></a>            <span class="kw">on</span> a.brand<span class="op">=</span>d.<span class="kw">ID</span></span>
<span id="cb472-28"><a href="#cb472-28"></a><span class="kw">where</span></span>
<span id="cb472-29"><a href="#cb472-29"></a>    b.<span class="kw">ID</span><span class="op">=</span><span class="dv">3</span></span>
<span id="cb472-30"><a href="#cb472-30"></a></span>
<span id="cb472-31"><a href="#cb472-31"></a><span class="op">+</span><span class="co">----+--------+-------+</span></span>
<span id="cb472-32"><a href="#cb472-32"></a>| <span class="kw">ID</span> | model  | color |</span>
<span id="cb472-33"><a href="#cb472-33"></a><span class="op">+</span><span class="co">----+--------+-------+</span></span>
<span id="cb472-34"><a href="#cb472-34"></a>|  <span class="dv">1</span> | Sports | Red   |</span>
<span id="cb472-35"><a href="#cb472-35"></a>|  <span class="dv">8</span> | Sports | Green |</span>
<span id="cb472-36"><a href="#cb472-36"></a>| <span class="dv">10</span> | Sports | White |</span>
<span id="cb472-37"><a href="#cb472-37"></a>|  <span class="dv">3</span> | Sports | Black |</span>
<span id="cb472-38"><a href="#cb472-38"></a>|  <span class="dv">5</span> | 4WD    | Green |</span>
<span id="cb472-39"><a href="#cb472-39"></a>|  <span class="dv">7</span> | 4WD    | White |</span>
<span id="cb472-40"><a href="#cb472-40"></a>|  <span class="dv">9</span> | 4WD    | Black |</span>
<span id="cb472-41"><a href="#cb472-41"></a><span class="op">+</span><span class="co">----+--------+-------+</span></span>
<span id="cb472-42"><a href="#cb472-42"></a><span class="dv">7</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>As you can see, the results of the first query are returned first, followed by the results of the second query.</p>
<p>In this example, it would of course have been much easier to simply use the first query, but <code>union</code> queries can be great for specific cases. They are a great way to return specific results from tables from tables that aren’t easily joined together - or for that matter <em>completely</em> unrelated tables. There are a few rules to follow however.</p>
<ul>
<li>
The column types from the first query must match the column types from every other query below.
</li>
<li>
The names of the columns from the first query will be used to identify the entire set of results.
</li>
<li>
The number of columns in each query must be the same.
</li>
</ul>
<p>Now, you might <a href="https://stackoverflow.com/questions/49925/what-is-the-difference-between-union-and-union-all">be wondering what the</a> difference is between using <code>union</code> and <code>union all</code>. A <code>union</code> query will remove duplicates, while a <code>union all</code> will not. This does mean that there is a small performance hit when using <code>union</code> over <code>union all</code> but the results may be worth it - I won’t speculate on that sort of thing in this though.</p>
<p>On this note, it might be worth noting some additional notes here.</p>
<ul>
<li>
If we wanted to order the results, we can use an <code>order by</code> but you can’t use the alias anymore. In the query above, appending an <code>order by a.ID</code> would result in an error - as far as the results are concerned, the column is called <code>ID</code> rather than <code>a.ID</code> - even though the same alias has been used in both queries.
</li>
<li>
We can only have one <code>order by</code> statement, and it must be as the last statement.
</li>
</ul>
<p>For the next examples, I am adding a few extra rows to our tables.</p>
<p>
I have added <code>Holden</code> to the brands table. I have also added a row into <code>cars</code> that has the <code>color</code> value of <code>12</code> - which has no reference in the colors table.
</p>
<p>Okay, the boss is back again, barking requests out - *I want a count of each brand we carry and the number of cars in it!` - Typical, we just get to an interesting section of our discussion and the boss wants more work.</p>
<p>Rightyo, so the first thing we need to do is get a complete listing of possible brands.</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb473-1"><a href="#cb473-1"></a><span class="kw">select</span></span>
<span id="cb473-2"><a href="#cb473-2"></a>    a.brand</span>
<span id="cb473-3"><a href="#cb473-3"></a><span class="kw">from</span></span>
<span id="cb473-4"><a href="#cb473-4"></a>    brands a</span>
<span id="cb473-5"><a href="#cb473-5"></a></span>
<span id="cb473-6"><a href="#cb473-6"></a><span class="op">+</span><span class="co">--------+</span></span>
<span id="cb473-7"><a href="#cb473-7"></a>| brand  |</span>
<span id="cb473-8"><a href="#cb473-8"></a><span class="op">+</span><span class="co">--------+</span></span>
<span id="cb473-9"><a href="#cb473-9"></a>| Ford   |</span>
<span id="cb473-10"><a href="#cb473-10"></a>| Toyota |</span>
<span id="cb473-11"><a href="#cb473-11"></a>| Nissan |</span>
<span id="cb473-12"><a href="#cb473-12"></a>| Smart  |</span>
<span id="cb473-13"><a href="#cb473-13"></a>| BMW    |</span>
<span id="cb473-14"><a href="#cb473-14"></a>| Holden |</span>
<span id="cb473-15"><a href="#cb473-15"></a><span class="op">+</span><span class="co">--------+</span></span>
<span id="cb473-16"><a href="#cb473-16"></a><span class="dv">6</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>Now, when we join this to our cars table we get the following result:</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb474-1"><a href="#cb474-1"></a><span class="kw">select</span></span>
<span id="cb474-2"><a href="#cb474-2"></a>    a.brand</span>
<span id="cb474-3"><a href="#cb474-3"></a><span class="kw">from</span></span>
<span id="cb474-4"><a href="#cb474-4"></a>    brands a</span>
<span id="cb474-5"><a href="#cb474-5"></a>        <span class="kw">join</span> cars b</span>
<span id="cb474-6"><a href="#cb474-6"></a>            <span class="kw">on</span> a.<span class="kw">ID</span><span class="op">=</span>b.brand</span>
<span id="cb474-7"><a href="#cb474-7"></a><span class="kw">group</span> <span class="kw">by</span></span>
<span id="cb474-8"><a href="#cb474-8"></a>    a.brand</span>
<span id="cb474-9"><a href="#cb474-9"></a></span>
<span id="cb474-10"><a href="#cb474-10"></a><span class="op">+</span><span class="co">--------+</span></span>
<span id="cb474-11"><a href="#cb474-11"></a>| brand  |</span>
<span id="cb474-12"><a href="#cb474-12"></a><span class="op">+</span><span class="co">--------+</span></span>
<span id="cb474-13"><a href="#cb474-13"></a>| BMW    |</span>
<span id="cb474-14"><a href="#cb474-14"></a>| Ford   |</span>
<span id="cb474-15"><a href="#cb474-15"></a>| Nissan |</span>
<span id="cb474-16"><a href="#cb474-16"></a>| Smart  |</span>
<span id="cb474-17"><a href="#cb474-17"></a>| Toyota |</span>
<span id="cb474-18"><a href="#cb474-18"></a><span class="op">+</span><span class="co">--------+</span></span>
<span id="cb474-19"><a href="#cb474-19"></a><span class="dv">5</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>Which is of course a problem - we aren’t seeing any mention of the lovely <code>Holden</code> brand I added.</p>
<p>This is because a join looks for matching rows in <em>both</em> tables. As there is no data in cars that is of type <code>Holden</code> it isn’t returned. This is where we can use an <code>outer</code> join. This will return <em>all</em> the results from one table whether they are matched in the other table or not:</p>
<div class="sourceCode" id="cb475"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb475-1"><a href="#cb475-1"></a><span class="kw">select</span></span>
<span id="cb475-2"><a href="#cb475-2"></a>    a.brand</span>
<span id="cb475-3"><a href="#cb475-3"></a><span class="kw">from</span></span>
<span id="cb475-4"><a href="#cb475-4"></a>    brands a</span>
<span id="cb475-5"><a href="#cb475-5"></a>        <span class="kw">left</span> <span class="kw">outer</span> <span class="kw">join</span> cars b</span>
<span id="cb475-6"><a href="#cb475-6"></a>            <span class="kw">on</span> a.<span class="kw">ID</span><span class="op">=</span>b.brand</span>
<span id="cb475-7"><a href="#cb475-7"></a><span class="kw">group</span> <span class="kw">by</span></span>
<span id="cb475-8"><a href="#cb475-8"></a>    a.brand</span>
<span id="cb475-9"><a href="#cb475-9"></a></span>
<span id="cb475-10"><a href="#cb475-10"></a><span class="op">+</span><span class="co">--------+</span></span>
<span id="cb475-11"><a href="#cb475-11"></a>| brand  |</span>
<span id="cb475-12"><a href="#cb475-12"></a><span class="op">+</span><span class="co">--------+</span></span>
<span id="cb475-13"><a href="#cb475-13"></a>| BMW    |</span>
<span id="cb475-14"><a href="#cb475-14"></a>| Ford   |</span>
<span id="cb475-15"><a href="#cb475-15"></a>| Holden |</span>
<span id="cb475-16"><a href="#cb475-16"></a>| Nissan |</span>
<span id="cb475-17"><a href="#cb475-17"></a>| Smart  |</span>
<span id="cb475-18"><a href="#cb475-18"></a>| Toyota |</span>
<span id="cb475-19"><a href="#cb475-19"></a><span class="op">+</span><span class="co">--------+</span></span>
<span id="cb475-20"><a href="#cb475-20"></a><span class="dv">6</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>Now that we have that, we can add a lovely aggregate function to get a count and get the boss off our backs for a moment.</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb476-1"><a href="#cb476-1"></a><span class="kw">select</span></span>
<span id="cb476-2"><a href="#cb476-2"></a>    a.brand,</span>
<span id="cb476-3"><a href="#cb476-3"></a>    <span class="fu">count</span>(b.<span class="kw">id</span>) <span class="kw">as</span> countOfBrand</span>
<span id="cb476-4"><a href="#cb476-4"></a><span class="kw">from</span></span>
<span id="cb476-5"><a href="#cb476-5"></a>    brands a</span>
<span id="cb476-6"><a href="#cb476-6"></a>        <span class="kw">left</span> <span class="kw">outer</span> <span class="kw">join</span> cars b</span>
<span id="cb476-7"><a href="#cb476-7"></a>            <span class="kw">on</span> a.<span class="kw">ID</span><span class="op">=</span>b.brand</span>
<span id="cb476-8"><a href="#cb476-8"></a><span class="kw">group</span> <span class="kw">by</span></span>
<span id="cb476-9"><a href="#cb476-9"></a>    a.brand</span>
<span id="cb476-10"><a href="#cb476-10"></a></span>
<span id="cb476-11"><a href="#cb476-11"></a><span class="op">+</span><span class="co">--------+--------------+</span></span>
<span id="cb476-12"><a href="#cb476-12"></a>| brand  | countOfBrand |</span>
<span id="cb476-13"><a href="#cb476-13"></a><span class="op">+</span><span class="co">--------+--------------+</span></span>
<span id="cb476-14"><a href="#cb476-14"></a>| BMW    |            <span class="dv">2</span> |</span>
<span id="cb476-15"><a href="#cb476-15"></a>| Ford   |            <span class="dv">2</span> |</span>
<span id="cb476-16"><a href="#cb476-16"></a>| Holden |            <span class="dv">0</span> |</span>
<span id="cb476-17"><a href="#cb476-17"></a>| Nissan |            <span class="dv">1</span> |</span>
<span id="cb476-18"><a href="#cb476-18"></a>| Smart  |            <span class="dv">1</span> |</span>
<span id="cb476-19"><a href="#cb476-19"></a>| Toyota |            <span class="dv">5</span> |</span>
<span id="cb476-20"><a href="#cb476-20"></a><span class="op">+</span><span class="co">--------+--------------+</span></span>
<span id="cb476-21"><a href="#cb476-21"></a><span class="dv">6</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>And with that, away the boss skulks.</p>
<p>Now, to explain this in some more detail, outer joins can be of the <code>left</code> or <code>right</code> type. The Left or Right defines which table is <em>fully</em> included. A <code>left outer join</code> will include all the rows from the table on the left, while (you guessed it) a <code>right outer join</code> brings all the results from the table on the right into the results.</p>
<p>Some databases will allow a <code>full outer join</code> which will bring back results (whether matched or not) from <em>both</em> tables, but this isn’t supported in all databases.</p>
<p>Now, I probably figure at this point in time, you are wondering whether or not you can merge join types in a query - and the answer is yes, you absolutely can.</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb477-1"><a href="#cb477-1"></a><span class="kw">select</span></span>
<span id="cb477-2"><a href="#cb477-2"></a>    b.brand,</span>
<span id="cb477-3"><a href="#cb477-3"></a>    c.color,</span>
<span id="cb477-4"><a href="#cb477-4"></a>    <span class="fu">count</span>(a.<span class="kw">id</span>) <span class="kw">as</span> countOfBrand</span>
<span id="cb477-5"><a href="#cb477-5"></a><span class="kw">from</span></span>
<span id="cb477-6"><a href="#cb477-6"></a>    cars a</span>
<span id="cb477-7"><a href="#cb477-7"></a>        <span class="kw">right</span> <span class="kw">outer</span> <span class="kw">join</span> brands b</span>
<span id="cb477-8"><a href="#cb477-8"></a>            <span class="kw">on</span> b.<span class="kw">ID</span><span class="op">=</span>a.brand</span>
<span id="cb477-9"><a href="#cb477-9"></a>        <span class="kw">join</span> colors c</span>
<span id="cb477-10"><a href="#cb477-10"></a>            <span class="kw">on</span> a.color<span class="op">=</span>c.<span class="kw">ID</span></span>
<span id="cb477-11"><a href="#cb477-11"></a><span class="kw">group</span> <span class="kw">by</span></span>
<span id="cb477-12"><a href="#cb477-12"></a>    a.brand,</span>
<span id="cb477-13"><a href="#cb477-13"></a>    c.color</span>
<span id="cb477-14"><a href="#cb477-14"></a></span>
<span id="cb477-15"><a href="#cb477-15"></a><span class="op">+</span><span class="co">--------+-------+--------------+</span></span>
<span id="cb477-16"><a href="#cb477-16"></a>| brand  | color | countOfBrand |</span>
<span id="cb477-17"><a href="#cb477-17"></a><span class="op">+</span><span class="co">--------+-------+--------------+</span></span>
<span id="cb477-18"><a href="#cb477-18"></a>| Ford   | Blue  |            <span class="dv">1</span> |</span>
<span id="cb477-19"><a href="#cb477-19"></a>| Ford   | White |            <span class="dv">1</span> |</span>
<span id="cb477-20"><a href="#cb477-20"></a>| Toyota | Black |            <span class="dv">1</span> |</span>
<span id="cb477-21"><a href="#cb477-21"></a>| Toyota | Green |            <span class="dv">2</span> |</span>
<span id="cb477-22"><a href="#cb477-22"></a>| Toyota | Red   |            <span class="dv">1</span> |</span>
<span id="cb477-23"><a href="#cb477-23"></a>| Nissan | Black |            <span class="dv">1</span> |</span>
<span id="cb477-24"><a href="#cb477-24"></a>| Smart  | White |            <span class="dv">1</span> |</span>
<span id="cb477-25"><a href="#cb477-25"></a>| BMW    | Blue  |            <span class="dv">1</span> |</span>
<span id="cb477-26"><a href="#cb477-26"></a>| BMW    | White |            <span class="dv">1</span> |</span>
<span id="cb477-27"><a href="#cb477-27"></a><span class="op">+</span><span class="co">--------+-------+--------------+</span></span>
<span id="cb477-28"><a href="#cb477-28"></a><span class="dv">9</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>So, why is that not the results that were expected? It is because although we have selected the outer join from cars to brands, it wasn’t specified in the join to colors - so that particular join will only bring back results that match in both tables.</p>
<p>Here is the query that would work to get the results that we expected:</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb478-1"><a href="#cb478-1"></a><span class="kw">select</span></span>
<span id="cb478-2"><a href="#cb478-2"></a>    a.brand,</span>
<span id="cb478-3"><a href="#cb478-3"></a>    c.color,</span>
<span id="cb478-4"><a href="#cb478-4"></a>    <span class="fu">count</span>(b.<span class="kw">id</span>) <span class="kw">as</span> countOfBrand</span>
<span id="cb478-5"><a href="#cb478-5"></a><span class="kw">from</span></span>
<span id="cb478-6"><a href="#cb478-6"></a>    brands a</span>
<span id="cb478-7"><a href="#cb478-7"></a>        <span class="kw">left</span> <span class="kw">outer</span> <span class="kw">join</span> cars b</span>
<span id="cb478-8"><a href="#cb478-8"></a>            <span class="kw">on</span> a.<span class="kw">ID</span><span class="op">=</span>b.brand</span>
<span id="cb478-9"><a href="#cb478-9"></a>        <span class="kw">left</span> <span class="kw">outer</span> <span class="kw">join</span> colors c</span>
<span id="cb478-10"><a href="#cb478-10"></a>            <span class="kw">on</span> b.color<span class="op">=</span>c.<span class="kw">ID</span></span>
<span id="cb478-11"><a href="#cb478-11"></a><span class="kw">group</span> <span class="kw">by</span></span>
<span id="cb478-12"><a href="#cb478-12"></a>    a.brand,</span>
<span id="cb478-13"><a href="#cb478-13"></a>    c.color</span>
<span id="cb478-14"><a href="#cb478-14"></a></span>
<span id="cb478-15"><a href="#cb478-15"></a><span class="op">+</span><span class="co">--------+-------+--------------+</span></span>
<span id="cb478-16"><a href="#cb478-16"></a>| brand  | color | countOfBrand |</span>
<span id="cb478-17"><a href="#cb478-17"></a><span class="op">+</span><span class="co">--------+-------+--------------+</span></span>
<span id="cb478-18"><a href="#cb478-18"></a>| BMW    | Blue  |            <span class="dv">1</span> |</span>
<span id="cb478-19"><a href="#cb478-19"></a>| BMW    | White |            <span class="dv">1</span> |</span>
<span id="cb478-20"><a href="#cb478-20"></a>| Ford   | Blue  |            <span class="dv">1</span> |</span>
<span id="cb478-21"><a href="#cb478-21"></a>| Ford   | White |            <span class="dv">1</span> |</span>
<span id="cb478-22"><a href="#cb478-22"></a>| Holden | <span class="kw">NULL</span>  |            <span class="dv">0</span> |</span>
<span id="cb478-23"><a href="#cb478-23"></a>| Nissan | Black |            <span class="dv">1</span> |</span>
<span id="cb478-24"><a href="#cb478-24"></a>| Smart  | White |            <span class="dv">1</span> |</span>
<span id="cb478-25"><a href="#cb478-25"></a>| Toyota | <span class="kw">NULL</span>  |            <span class="dv">1</span> |</span>
<span id="cb478-26"><a href="#cb478-26"></a>| Toyota | Black |            <span class="dv">1</span> |</span>
<span id="cb478-27"><a href="#cb478-27"></a>| Toyota | Green |            <span class="dv">2</span> |</span>
<span id="cb478-28"><a href="#cb478-28"></a>| Toyota | Red   |            <span class="dv">1</span> |</span>
<span id="cb478-29"><a href="#cb478-29"></a><span class="op">+</span><span class="co">--------+-------+--------------+</span></span>
<span id="cb478-30"><a href="#cb478-30"></a><span class="dv">11</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>As we can see, we have two outer joins in the query and the results are coming through as expected.</p>
<p>Now, how about those other types of joins you ask? What about Intersections?</p>
<p>Well, not all databases support the <code>intersection</code> but pretty much all databases will allow you to create an intersection through a join (or a well structured where statement at the least).</p>
<p>An Intersection is a type of join somewhat similar to a <code>union</code> as described above - but the difference is that it <em>only</em> returns rows of data that are identical (and I do mean identical) between the various individual queries joined by the union. Only rows that are identical in every regard will be returned.</p>
<p>A simple example would be as such:</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb479-1"><a href="#cb479-1"></a><span class="kw">select</span></span>
<span id="cb479-2"><a href="#cb479-2"></a>    <span class="op">*</span></span>
<span id="cb479-3"><a href="#cb479-3"></a><span class="kw">from</span></span>
<span id="cb479-4"><a href="#cb479-4"></a>    colors</span>
<span id="cb479-5"><a href="#cb479-5"></a><span class="kw">where</span></span>
<span id="cb479-6"><a href="#cb479-6"></a>    <span class="kw">ID</span><span class="op">&gt;</span><span class="dv">2</span></span>
<span id="cb479-7"><a href="#cb479-7"></a><span class="kw">intersect</span></span>
<span id="cb479-8"><a href="#cb479-8"></a><span class="kw">select</span></span>
<span id="cb479-9"><a href="#cb479-9"></a>    <span class="op">*</span></span>
<span id="cb479-10"><a href="#cb479-10"></a><span class="kw">from</span></span>
<span id="cb479-11"><a href="#cb479-11"></a>    colors</span>
<span id="cb479-12"><a href="#cb479-12"></a><span class="kw">where</span></span>
<span id="cb479-13"><a href="#cb479-13"></a>    <span class="kw">id</span><span class="op">&lt;</span><span class="dv">4</span></span></code></pre></div>
<p>While a normal <code>union</code> query would return all the rows of the table (the first query returning anything over <code>ID&amp;gt;2</code> and the second anything having <code>ID&amp;lt;4</code>) which would result in a full set, an intersect query would only return the row matching <code>id=3</code> as it meets both criteria.</p>
<p>Now, if your database doesn’t support an <code>intersect</code> query, the above can be easily accomlished with the following query:</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb480-1"><a href="#cb480-1"></a><span class="kw">select</span></span>
<span id="cb480-2"><a href="#cb480-2"></a>    a.<span class="kw">ID</span>,</span>
<span id="cb480-3"><a href="#cb480-3"></a>    a.color,</span>
<span id="cb480-4"><a href="#cb480-4"></a>    a.paint</span>
<span id="cb480-5"><a href="#cb480-5"></a><span class="kw">from</span></span>
<span id="cb480-6"><a href="#cb480-6"></a>    colors a</span>
<span id="cb480-7"><a href="#cb480-7"></a>        <span class="kw">join</span> colors b</span>
<span id="cb480-8"><a href="#cb480-8"></a>            <span class="kw">on</span> a.<span class="kw">ID</span><span class="op">=</span>b.<span class="kw">ID</span></span>
<span id="cb480-9"><a href="#cb480-9"></a><span class="kw">where</span></span>
<span id="cb480-10"><a href="#cb480-10"></a>    a.<span class="kw">ID</span><span class="op">&gt;</span><span class="dv">2</span></span>
<span id="cb480-11"><a href="#cb480-11"></a>    <span class="kw">and</span> b.<span class="kw">ID</span><span class="op">&lt;</span><span class="dv">4</span></span>
<span id="cb480-12"><a href="#cb480-12"></a></span>
<span id="cb480-13"><a href="#cb480-13"></a><span class="op">+</span><span class="co">----+-------+----------+</span></span>
<span id="cb480-14"><a href="#cb480-14"></a>| <span class="kw">ID</span> | color | paint    |</span>
<span id="cb480-15"><a href="#cb480-15"></a><span class="op">+</span><span class="co">----+-------+----------+</span></span>
<span id="cb480-16"><a href="#cb480-16"></a>|  <span class="dv">3</span> | Blue  | Metallic |</span>
<span id="cb480-17"><a href="#cb480-17"></a><span class="op">+</span><span class="co">----+-------+----------+</span></span>
<span id="cb480-18"><a href="#cb480-18"></a><span class="dv">1</span> <span class="kw">row</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>If you wish to perform an intersection across two different tables using a database that doesn’t inherently support an intersection query, you will need to create a join on <em>every column</em> of the tables.</p>
</section>
<section id="answer-2-score-98" class="level4">
<h4>Answer 2 (score 98)</h4>
<p>Ok, I found this post very interesting and I would like to share some of my knowledge on creating a query. Thanks for this <strong><a href="https://stackoverflow.com/users/1450077/fluffeh">Fluffeh</a></strong>. Others who may read this and may feel that I’m wrong are 101% free to edit and criticise my answer. (<em>Honestly, I feel very thankful for correcting my mistake(s).</em>)</p>
<p>I’ll be posting some of the frequently asked questions in <code>MySQL</code> tag.</p>
<hr>
<h5>
<strong>Trick No. 1 (<em>rows that matches to multiple conditions</em>)</strong>
</h1>
<p>Given this schema</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb481-1"><a href="#cb481-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> MovieList</span>
<span id="cb481-2"><a href="#cb481-2"></a>(</span>
<span id="cb481-3"><a href="#cb481-3"></a>    <span class="kw">ID</span> <span class="dt">INT</span>,</span>
<span id="cb481-4"><a href="#cb481-4"></a>    MovieName <span class="dt">VARCHAR</span>(<span class="dv">25</span>),</span>
<span id="cb481-5"><a href="#cb481-5"></a>    <span class="kw">CONSTRAINT</span> ml_pk <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (<span class="kw">ID</span>),</span>
<span id="cb481-6"><a href="#cb481-6"></a>    <span class="kw">CONSTRAINT</span> ml_uq <span class="kw">UNIQUE</span> (MovieName)</span>
<span id="cb481-7"><a href="#cb481-7"></a>);</span>
<span id="cb481-8"><a href="#cb481-8"></a></span>
<span id="cb481-9"><a href="#cb481-9"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> MovieList <span class="kw">VALUES</span> (<span class="dv">1</span>, <span class="st">&#39;American Pie&#39;</span>);</span>
<span id="cb481-10"><a href="#cb481-10"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> MovieList <span class="kw">VALUES</span> (<span class="dv">2</span>, <span class="st">&#39;The Notebook&#39;</span>);</span>
<span id="cb481-11"><a href="#cb481-11"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> MovieList <span class="kw">VALUES</span> (<span class="dv">3</span>, <span class="st">&#39;Discovery Channel: Africa&#39;</span>);</span>
<span id="cb481-12"><a href="#cb481-12"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> MovieList <span class="kw">VALUES</span> (<span class="dv">4</span>, <span class="st">&#39;Mr. Bean&#39;</span>);</span>
<span id="cb481-13"><a href="#cb481-13"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> MovieList <span class="kw">VALUES</span> (<span class="dv">5</span>, <span class="st">&#39;Expendables 2&#39;</span>);</span>
<span id="cb481-14"><a href="#cb481-14"></a></span>
<span id="cb481-15"><a href="#cb481-15"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> CategoryList</span>
<span id="cb481-16"><a href="#cb481-16"></a>(</span>
<span id="cb481-17"><a href="#cb481-17"></a>    MovieID <span class="dt">INT</span>,</span>
<span id="cb481-18"><a href="#cb481-18"></a>    CategoryName <span class="dt">VARCHAR</span>(<span class="dv">25</span>),</span>
<span id="cb481-19"><a href="#cb481-19"></a>    <span class="kw">CONSTRAINT</span> cl_uq <span class="kw">UNIQUE</span>(MovieID, CategoryName),</span>
<span id="cb481-20"><a href="#cb481-20"></a>    <span class="kw">CONSTRAINT</span> cl_fk <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (MovieID) <span class="kw">REFERENCES</span> MovieList(<span class="kw">ID</span>)</span>
<span id="cb481-21"><a href="#cb481-21"></a>);</span>
<span id="cb481-22"><a href="#cb481-22"></a></span>
<span id="cb481-23"><a href="#cb481-23"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> CategoryList <span class="kw">VALUES</span> (<span class="dv">1</span>, <span class="st">&#39;Comedy&#39;</span>);</span>
<span id="cb481-24"><a href="#cb481-24"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> CategoryList <span class="kw">VALUES</span> (<span class="dv">1</span>, <span class="st">&#39;Romance&#39;</span>);</span>
<span id="cb481-25"><a href="#cb481-25"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> CategoryList <span class="kw">VALUES</span> (<span class="dv">2</span>, <span class="st">&#39;Romance&#39;</span>);</span>
<span id="cb481-26"><a href="#cb481-26"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> CategoryList <span class="kw">VALUES</span> (<span class="dv">2</span>, <span class="st">&#39;Drama&#39;</span>);</span>
<span id="cb481-27"><a href="#cb481-27"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> CategoryList <span class="kw">VALUES</span> (<span class="dv">3</span>, <span class="st">&#39;Documentary&#39;</span>);</span>
<span id="cb481-28"><a href="#cb481-28"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> CategoryList <span class="kw">VALUES</span> (<span class="dv">4</span>, <span class="st">&#39;Comedy&#39;</span>);</span>
<span id="cb481-29"><a href="#cb481-29"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> CategoryList <span class="kw">VALUES</span> (<span class="dv">5</span>, <span class="st">&#39;Comedy&#39;</span>);</span>
<span id="cb481-30"><a href="#cb481-30"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> CategoryList <span class="kw">VALUES</span> (<span class="dv">5</span>, <span class="st">&#39;Action&#39;</span>);</span></code></pre></div>
<p><strong>QUESTION</strong></p>
<p>Find <em>all movies</em> that belong to at least <em>both</em> <code>Comedy</code> and <code>Romance</code> categories.</p>
<p><strong>Solution</strong></p>
<p>This question can be very tricky sometimes. It may seem that a query like this will be the answer:-</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb482-1"><a href="#cb482-1"></a><span class="kw">SELECT</span>  <span class="kw">DISTINCT</span> a.MovieName</span>
<span id="cb482-2"><a href="#cb482-2"></a><span class="kw">FROM</span>    MovieList a</span>
<span id="cb482-3"><a href="#cb482-3"></a>        <span class="kw">INNER</span> <span class="kw">JOIN</span> CategoryList b</span>
<span id="cb482-4"><a href="#cb482-4"></a>            <span class="kw">ON</span> a.<span class="kw">ID</span> <span class="op">=</span> b.MovieID</span>
<span id="cb482-5"><a href="#cb482-5"></a><span class="kw">WHERE</span>   b.CategoryName <span class="op">=</span> <span class="st">&#39;Comedy&#39;</span> <span class="kw">AND</span></span>
<span id="cb482-6"><a href="#cb482-6"></a>        b.CategoryName <span class="op">=</span> <span class="st">&#39;Romance&#39;</span></span></code></pre></div>
<h5>
<a href="http://sqlfiddle.com/#!2/b60cb/4" rel="noreferrer">SQLFiddle Demo</a>
</h2>
<p>which is definitely very wrong because it produces <em>no result</em>. The explanation of this is that there is only one valid value of <code>CategoryName</code> on <em>each row</em>. For instance, the first condition returns <em>true</em>, the second condition is always false. Thus, by using <code>AND</code> operator, both condition should be true; otherwise, it will be false. Another query is like this,</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb483-1"><a href="#cb483-1"></a><span class="kw">SELECT</span>  <span class="kw">DISTINCT</span> a.MovieName</span>
<span id="cb483-2"><a href="#cb483-2"></a><span class="kw">FROM</span>    MovieList a</span>
<span id="cb483-3"><a href="#cb483-3"></a>        <span class="kw">INNER</span> <span class="kw">JOIN</span> CategoryList b</span>
<span id="cb483-4"><a href="#cb483-4"></a>            <span class="kw">ON</span> a.<span class="kw">ID</span> <span class="op">=</span> b.MovieID</span>
<span id="cb483-5"><a href="#cb483-5"></a><span class="kw">WHERE</span>   b.CategoryName <span class="kw">IN</span> (<span class="st">&#39;Comedy&#39;</span>,<span class="st">&#39;Romance&#39;</span>)</span></code></pre></div>
<h5>
<a href="http://sqlfiddle.com/#!2/b60cb/2" rel="noreferrer">SQLFiddle Demo</a>
</h2>
<p>and the result is still incorrect because it matches to record that has <em>at least</em> one match on the <code>categoryName</code>. The <strong>real solution</strong> <em>would be by counting the number of record instances per movie</em>. The number of instance should match to the total number of the values supplied in the condition.</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb484-1"><a href="#cb484-1"></a><span class="kw">SELECT</span>  a.MovieName</span>
<span id="cb484-2"><a href="#cb484-2"></a><span class="kw">FROM</span>    MovieList a</span>
<span id="cb484-3"><a href="#cb484-3"></a>        <span class="kw">INNER</span> <span class="kw">JOIN</span> CategoryList b</span>
<span id="cb484-4"><a href="#cb484-4"></a>            <span class="kw">ON</span> a.<span class="kw">ID</span> <span class="op">=</span> b.MovieID</span>
<span id="cb484-5"><a href="#cb484-5"></a><span class="kw">WHERE</span>   b.CategoryName <span class="kw">IN</span> (<span class="st">&#39;Comedy&#39;</span>,<span class="st">&#39;Romance&#39;</span>)</span>
<span id="cb484-6"><a href="#cb484-6"></a><span class="kw">GROUP</span> <span class="kw">BY</span> a.MovieName</span>
<span id="cb484-7"><a href="#cb484-7"></a><span class="kw">HAVING</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="op">=</span> <span class="dv">2</span></span></code></pre></div>
<h5>
<a href="http://sqlfiddle.com/#!2/b60cb/3" rel="noreferrer">SQLFiddle Demo (the answer)</a>
</h2>
<ul>
<li>
<a href="http://www.simple-talk.com/sql/t-sql-programming/divided-we-stand-the-sql-of-relational-division/" rel="noreferrer">SQL of Relational Division</a>
</li>
</ul>
<hr>
<h5>
<strong>Trick No. 2 (<em>maximum record for each entry</em>)</strong>
</h1>
<p>Given schema,</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb485-1"><a href="#cb485-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> Software</span>
<span id="cb485-2"><a href="#cb485-2"></a>(</span>
<span id="cb485-3"><a href="#cb485-3"></a>    <span class="kw">ID</span> <span class="dt">INT</span>,</span>
<span id="cb485-4"><a href="#cb485-4"></a>    SoftwareName <span class="dt">VARCHAR</span>(<span class="dv">25</span>),</span>
<span id="cb485-5"><a href="#cb485-5"></a>    Descriptions <span class="dt">VARCHAR</span>(<span class="dv">150</span>),</span>
<span id="cb485-6"><a href="#cb485-6"></a>    <span class="kw">CONSTRAINT</span> sw_pk <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (<span class="kw">ID</span>),</span>
<span id="cb485-7"><a href="#cb485-7"></a>    <span class="kw">CONSTRAINT</span> sw_uq <span class="kw">UNIQUE</span> (SoftwareName)  </span>
<span id="cb485-8"><a href="#cb485-8"></a>);</span>
<span id="cb485-9"><a href="#cb485-9"></a></span>
<span id="cb485-10"><a href="#cb485-10"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> Software <span class="kw">VALUES</span> (<span class="dv">1</span>,<span class="st">&#39;PaintMe&#39;</span>,<span class="st">&#39;used for photo editing&#39;</span>);</span>
<span id="cb485-11"><a href="#cb485-11"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> Software <span class="kw">VALUES</span> (<span class="dv">2</span>,<span class="st">&#39;World Map&#39;</span>,<span class="st">&#39;contains map of different places of the world&#39;</span>);</span>
<span id="cb485-12"><a href="#cb485-12"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> Software <span class="kw">VALUES</span> (<span class="dv">3</span>,<span class="st">&#39;Dictionary&#39;</span>,<span class="st">&#39;contains description, synonym, antonym of the words&#39;</span>);</span>
<span id="cb485-13"><a href="#cb485-13"></a></span>
<span id="cb485-14"><a href="#cb485-14"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> VersionList</span>
<span id="cb485-15"><a href="#cb485-15"></a>(</span>
<span id="cb485-16"><a href="#cb485-16"></a>    SoftwareID <span class="dt">INT</span>,</span>
<span id="cb485-17"><a href="#cb485-17"></a>    VersionNo <span class="dt">INT</span>,</span>
<span id="cb485-18"><a href="#cb485-18"></a>    DateReleased <span class="dt">DATE</span>,</span>
<span id="cb485-19"><a href="#cb485-19"></a>    <span class="kw">CONSTRAINT</span> sw_uq <span class="kw">UNIQUE</span> (SoftwareID, VersionNo),</span>
<span id="cb485-20"><a href="#cb485-20"></a>    <span class="kw">CONSTRAINT</span> sw_fk <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (SOftwareID) <span class="kw">REFERENCES</span> Software(<span class="kw">ID</span>)</span>
<span id="cb485-21"><a href="#cb485-21"></a>);</span>
<span id="cb485-22"><a href="#cb485-22"></a></span>
<span id="cb485-23"><a href="#cb485-23"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> VersionList <span class="kw">VALUES</span> (<span class="dv">3</span>, <span class="dv">2</span>, <span class="st">&#39;2009-12-01&#39;</span>);</span>
<span id="cb485-24"><a href="#cb485-24"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> VersionList <span class="kw">VALUES</span> (<span class="dv">3</span>, <span class="dv">1</span>, <span class="st">&#39;2009-11-01&#39;</span>);</span>
<span id="cb485-25"><a href="#cb485-25"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> VersionList <span class="kw">VALUES</span> (<span class="dv">3</span>, <span class="dv">3</span>, <span class="st">&#39;2010-01-01&#39;</span>);</span>
<span id="cb485-26"><a href="#cb485-26"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> VersionList <span class="kw">VALUES</span> (<span class="dv">2</span>, <span class="dv">2</span>, <span class="st">&#39;2010-12-01&#39;</span>);</span>
<span id="cb485-27"><a href="#cb485-27"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> VersionList <span class="kw">VALUES</span> (<span class="dv">2</span>, <span class="dv">1</span>, <span class="st">&#39;2009-12-01&#39;</span>);</span>
<span id="cb485-28"><a href="#cb485-28"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> VersionList <span class="kw">VALUES</span> (<span class="dv">1</span>, <span class="dv">3</span>, <span class="st">&#39;2011-12-01&#39;</span>);</span>
<span id="cb485-29"><a href="#cb485-29"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> VersionList <span class="kw">VALUES</span> (<span class="dv">1</span>, <span class="dv">2</span>, <span class="st">&#39;2010-12-01&#39;</span>);</span>
<span id="cb485-30"><a href="#cb485-30"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> VersionList <span class="kw">VALUES</span> (<span class="dv">1</span>, <span class="dv">1</span>, <span class="st">&#39;2009-12-01&#39;</span>);</span>
<span id="cb485-31"><a href="#cb485-31"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> VersionList <span class="kw">VALUES</span> (<span class="dv">1</span>, <span class="dv">4</span>, <span class="st">&#39;2012-12-01&#39;</span>);</span></code></pre></div>
<p><strong>QUESTION</strong></p>
<p>Find the latest version on each software. Display the following columns: <code>SoftwareName</code>,<code>Descriptions</code>,<code>LatestVersion</code> (<em>from VersionNo column</em>),<code>DateReleased</code></p>
<p><strong>Solution</strong></p>
<p>Some SQL developers mistakenly use <code>MAX()</code> aggregate function. They tend to create like this,</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb486-1"><a href="#cb486-1"></a><span class="kw">SELECT</span>  a.SoftwareName, a.Descriptions,</span>
<span id="cb486-2"><a href="#cb486-2"></a>        <span class="fu">MAX</span>(b.VersionNo) <span class="kw">AS</span> LatestVersion, b.DateReleased</span>
<span id="cb486-3"><a href="#cb486-3"></a><span class="kw">FROM</span>    Software a</span>
<span id="cb486-4"><a href="#cb486-4"></a>        <span class="kw">INNER</span> <span class="kw">JOIN</span> VersionList b</span>
<span id="cb486-5"><a href="#cb486-5"></a>            <span class="kw">ON</span> a.<span class="kw">ID</span> <span class="op">=</span> b.SoftwareID</span>
<span id="cb486-6"><a href="#cb486-6"></a><span class="kw">GROUP</span> <span class="kw">BY</span> a.<span class="kw">ID</span></span>
<span id="cb486-7"><a href="#cb486-7"></a><span class="kw">ORDER</span> <span class="kw">BY</span> a.<span class="kw">ID</span></span></code></pre></div>
<h5>
<a href="http://sqlfiddle.com/#!2/89929/2" rel="noreferrer">SQLFiddle Demo</a>
</h2>
<p>(<em>most RDBMS generates a syntax error on this because of not specifying some of the non-aggregated columns on the <code>group by</code> clause</em>) the result produces the correct <code>LatestVersion</code> on each software but obviously the <code>DateReleased</code> are incorrect. <code>MySQL</code> doesn’t support <code>Window Functions</code> and <code>Common Table Expression</code> yet as some RDBMS do already. The workaround on this problem is to create a <code>subquery</code> which gets the individual maximum <code>versionNo</code> on each software and later on be joined on the other tables.</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb487-1"><a href="#cb487-1"></a><span class="kw">SELECT</span>  a.SoftwareName, a.Descriptions,</span>
<span id="cb487-2"><a href="#cb487-2"></a>        b.LatestVersion, c.DateReleased</span>
<span id="cb487-3"><a href="#cb487-3"></a><span class="kw">FROM</span>    Software a</span>
<span id="cb487-4"><a href="#cb487-4"></a>        <span class="kw">INNER</span> <span class="kw">JOIN</span></span>
<span id="cb487-5"><a href="#cb487-5"></a>        (</span>
<span id="cb487-6"><a href="#cb487-6"></a>            <span class="kw">SELECT</span>  SoftwareID, <span class="fu">MAX</span>(VersionNO) LatestVersion</span>
<span id="cb487-7"><a href="#cb487-7"></a>            <span class="kw">FROM</span>    VersionList</span>
<span id="cb487-8"><a href="#cb487-8"></a>            <span class="kw">GROUP</span> <span class="kw">BY</span> SoftwareID</span>
<span id="cb487-9"><a href="#cb487-9"></a>        ) b <span class="kw">ON</span> a.<span class="kw">ID</span> <span class="op">=</span> b.SoftwareID</span>
<span id="cb487-10"><a href="#cb487-10"></a>        <span class="kw">INNER</span> <span class="kw">JOIN</span> VersionList c</span>
<span id="cb487-11"><a href="#cb487-11"></a>            <span class="kw">ON</span>  c.SoftwareID <span class="op">=</span> b.SoftwareID <span class="kw">AND</span></span>
<span id="cb487-12"><a href="#cb487-12"></a>                c.VersionNO <span class="op">=</span> b.LatestVersion</span>
<span id="cb487-13"><a href="#cb487-13"></a><span class="kw">GROUP</span> <span class="kw">BY</span> a.<span class="kw">ID</span></span>
<span id="cb487-14"><a href="#cb487-14"></a><span class="kw">ORDER</span> <span class="kw">BY</span> a.<span class="kw">ID</span></span></code></pre></div>
<h5>
<a href="http://sqlfiddle.com/#!2/89929/3" rel="noreferrer">SQLFiddle Demo (the answer)</a>
</h2>
<hr>
<p>So that was it. I’ll be posting another soon as I recall any other <em>FAQ</em> on <code>MySQL</code> tag. Thank you for reading this little article. I hope that you have atleast get even a little knowledge from this.</p>
<p><strong>UPDATE 1</strong></p>
<hr>
<h5>
<strong>Trick No. 3 (<em>Finding the latest record between two IDs</em>)</strong>
</h1>
<p>Given Schema</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb488-1"><a href="#cb488-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> userList</span>
<span id="cb488-2"><a href="#cb488-2"></a>(</span>
<span id="cb488-3"><a href="#cb488-3"></a>    <span class="kw">ID</span> <span class="dt">INT</span>,</span>
<span id="cb488-4"><a href="#cb488-4"></a>    NAME <span class="dt">VARCHAR</span>(<span class="dv">20</span>),</span>
<span id="cb488-5"><a href="#cb488-5"></a>    <span class="kw">CONSTRAINT</span> us_pk <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (<span class="kw">ID</span>),</span>
<span id="cb488-6"><a href="#cb488-6"></a>    <span class="kw">CONSTRAINT</span> us_uq <span class="kw">UNIQUE</span> (NAME)  </span>
<span id="cb488-7"><a href="#cb488-7"></a>);</span>
<span id="cb488-8"><a href="#cb488-8"></a></span>
<span id="cb488-9"><a href="#cb488-9"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> userList <span class="kw">VALUES</span> (<span class="dv">1</span>, <span class="st">&#39;Fluffeh&#39;</span>);</span>
<span id="cb488-10"><a href="#cb488-10"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> userList <span class="kw">VALUES</span> (<span class="dv">2</span>, <span class="st">&#39;John Woo&#39;</span>);</span>
<span id="cb488-11"><a href="#cb488-11"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> userList <span class="kw">VALUES</span> (<span class="dv">3</span>, <span class="st">&#39;hims056&#39;</span>);</span>
<span id="cb488-12"><a href="#cb488-12"></a></span>
<span id="cb488-13"><a href="#cb488-13"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> CONVERSATION</span>
<span id="cb488-14"><a href="#cb488-14"></a>(</span>
<span id="cb488-15"><a href="#cb488-15"></a>    <span class="kw">ID</span> <span class="dt">INT</span>,</span>
<span id="cb488-16"><a href="#cb488-16"></a>    FROM_ID <span class="dt">INT</span>,</span>
<span id="cb488-17"><a href="#cb488-17"></a>    TO_ID <span class="dt">INT</span>,</span>
<span id="cb488-18"><a href="#cb488-18"></a>    MESSAGE <span class="dt">VARCHAR</span>(<span class="dv">250</span>),</span>
<span id="cb488-19"><a href="#cb488-19"></a>    DeliveryDate <span class="dt">DATE</span></span>
<span id="cb488-20"><a href="#cb488-20"></a>);</span>
<span id="cb488-21"><a href="#cb488-21"></a></span>
<span id="cb488-22"><a href="#cb488-22"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> CONVERSATION <span class="kw">VALUES</span> (<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="st">&#39;hi john&#39;</span>, <span class="st">&#39;2012-01-01&#39;</span>);</span>
<span id="cb488-23"><a href="#cb488-23"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> CONVERSATION <span class="kw">VALUES</span> (<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="st">&#39;hello fluff&#39;</span>, <span class="st">&#39;2012-01-02&#39;</span>);</span>
<span id="cb488-24"><a href="#cb488-24"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> CONVERSATION <span class="kw">VALUES</span> (<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="st">&#39;hey hims&#39;</span>, <span class="st">&#39;2012-01-03&#39;</span>);</span>
<span id="cb488-25"><a href="#cb488-25"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> CONVERSATION <span class="kw">VALUES</span> (<span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="st">&#39;please reply&#39;</span>, <span class="st">&#39;2012-01-04&#39;</span>);</span>
<span id="cb488-26"><a href="#cb488-26"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> CONVERSATION <span class="kw">VALUES</span> (<span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="st">&#39;how are you?&#39;</span>, <span class="st">&#39;2012-01-05&#39;</span>);</span>
<span id="cb488-27"><a href="#cb488-27"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> CONVERSATION <span class="kw">VALUES</span> (<span class="dv">6</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="st">&#39;sample message!&#39;</span>, <span class="st">&#39;2012-01-05&#39;</span>);</span></code></pre></div>
<p><strong>QUESTION</strong></p>
<p>Find the latest conversation between two users.</p>
<p><strong>Solution</strong></p>
<div class="sourceCode" id="cb489"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb489-1"><a href="#cb489-1"></a><span class="kw">SELECT</span>    b.Name SenderName,</span>
<span id="cb489-2"><a href="#cb489-2"></a>          c.Name RecipientName,</span>
<span id="cb489-3"><a href="#cb489-3"></a>          a.Message,</span>
<span id="cb489-4"><a href="#cb489-4"></a>          a.DeliveryDate</span>
<span id="cb489-5"><a href="#cb489-5"></a><span class="kw">FROM</span>      Conversation a</span>
<span id="cb489-6"><a href="#cb489-6"></a>          <span class="kw">INNER</span> <span class="kw">JOIN</span> userList b</span>
<span id="cb489-7"><a href="#cb489-7"></a>            <span class="kw">ON</span> a.From_ID <span class="op">=</span> b.<span class="kw">ID</span></span>
<span id="cb489-8"><a href="#cb489-8"></a>          <span class="kw">INNER</span> <span class="kw">JOIN</span> userList c</span>
<span id="cb489-9"><a href="#cb489-9"></a>            <span class="kw">ON</span> a.To_ID <span class="op">=</span> c.<span class="kw">ID</span></span>
<span id="cb489-10"><a href="#cb489-10"></a><span class="kw">WHERE</span>     (<span class="fu">LEAST</span>(a.FROM_ID, a.TO_ID), <span class="fu">GREATEST</span>(a.FROM_ID, a.TO_ID), DeliveryDate)</span>
<span id="cb489-11"><a href="#cb489-11"></a><span class="kw">IN</span></span>
<span id="cb489-12"><a href="#cb489-12"></a>(</span>
<span id="cb489-13"><a href="#cb489-13"></a>    <span class="kw">SELECT</span>  <span class="fu">LEAST</span>(FROM_ID, TO_ID) minFROM,</span>
<span id="cb489-14"><a href="#cb489-14"></a>            <span class="fu">GREATEST</span>(FROM_ID, TO_ID) maxTo,</span>
<span id="cb489-15"><a href="#cb489-15"></a>            <span class="fu">MAX</span>(DeliveryDate) maxDate</span>
<span id="cb489-16"><a href="#cb489-16"></a>    <span class="kw">FROM</span>    Conversation</span>
<span id="cb489-17"><a href="#cb489-17"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span> minFROM, maxTo</span>
<span id="cb489-18"><a href="#cb489-18"></a>)</span></code></pre></div>
<h5>
<a href="http://sqlfiddle.com/#!2/b7bd1/1" rel="noreferrer">SQLFiddle Demo</a>
</h2>
</section>
<section id="answer-3-score-63" class="level4">
<h4>Answer 3 (score 63)</h4>
<h5>
Part 2 - Subqueries
</h1>
<p>Okay, now the boss has burst in again - <em>I want a list of all of our cars with the brand and a total of how many of that brand we have!</em></p>
<p>This is a great opportunity to use the next trick in our bag of SQL goodies - the subquery. If you are unfamiliar with the term, a subquery is a query that runs inside another query. There are many different ways to use them.</p>
<p>For our request, lets first put a simple query together that will list each car and the brand:</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb490-1"><a href="#cb490-1"></a><span class="kw">select</span></span>
<span id="cb490-2"><a href="#cb490-2"></a>    a.<span class="kw">ID</span>,</span>
<span id="cb490-3"><a href="#cb490-3"></a>    b.brand</span>
<span id="cb490-4"><a href="#cb490-4"></a><span class="kw">from</span></span>
<span id="cb490-5"><a href="#cb490-5"></a>    cars a</span>
<span id="cb490-6"><a href="#cb490-6"></a>        <span class="kw">join</span> brands b</span>
<span id="cb490-7"><a href="#cb490-7"></a>            <span class="kw">on</span> a.brand<span class="op">=</span>b.<span class="kw">ID</span></span></code></pre></div>
<p>Now, if we wanted to simply get a count of cars sorted by brand, we could of course write this:</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb491-1"><a href="#cb491-1"></a><span class="kw">select</span></span>
<span id="cb491-2"><a href="#cb491-2"></a>    b.brand,</span>
<span id="cb491-3"><a href="#cb491-3"></a>    <span class="fu">count</span>(a.<span class="kw">ID</span>) <span class="kw">as</span> countCars</span>
<span id="cb491-4"><a href="#cb491-4"></a><span class="kw">from</span></span>
<span id="cb491-5"><a href="#cb491-5"></a>    cars a</span>
<span id="cb491-6"><a href="#cb491-6"></a>        <span class="kw">join</span> brands b</span>
<span id="cb491-7"><a href="#cb491-7"></a>            <span class="kw">on</span> a.brand<span class="op">=</span>b.<span class="kw">ID</span></span>
<span id="cb491-8"><a href="#cb491-8"></a><span class="kw">group</span> <span class="kw">by</span></span>
<span id="cb491-9"><a href="#cb491-9"></a>    b.brand</span>
<span id="cb491-10"><a href="#cb491-10"></a></span>
<span id="cb491-11"><a href="#cb491-11"></a><span class="op">+</span><span class="co">--------+-----------+</span></span>
<span id="cb491-12"><a href="#cb491-12"></a>| brand  | countCars |</span>
<span id="cb491-13"><a href="#cb491-13"></a><span class="op">+</span><span class="co">--------+-----------+</span></span>
<span id="cb491-14"><a href="#cb491-14"></a>| BMW    |         <span class="dv">2</span> |</span>
<span id="cb491-15"><a href="#cb491-15"></a>| Ford   |         <span class="dv">2</span> |</span>
<span id="cb491-16"><a href="#cb491-16"></a>| Nissan |         <span class="dv">1</span> |</span>
<span id="cb491-17"><a href="#cb491-17"></a>| Smart  |         <span class="dv">1</span> |</span>
<span id="cb491-18"><a href="#cb491-18"></a>| Toyota |         <span class="dv">5</span> |</span>
<span id="cb491-19"><a href="#cb491-19"></a><span class="op">+</span><span class="co">--------+-----------+</span></span></code></pre></div>
<p>So, we should be able to simply add in the count function to our original query right?</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb492-1"><a href="#cb492-1"></a><span class="kw">select</span></span>
<span id="cb492-2"><a href="#cb492-2"></a>    a.<span class="kw">ID</span>,</span>
<span id="cb492-3"><a href="#cb492-3"></a>    b.brand,</span>
<span id="cb492-4"><a href="#cb492-4"></a>    <span class="fu">count</span>(a.<span class="kw">ID</span>) <span class="kw">as</span> countCars</span>
<span id="cb492-5"><a href="#cb492-5"></a><span class="kw">from</span></span>
<span id="cb492-6"><a href="#cb492-6"></a>    cars a</span>
<span id="cb492-7"><a href="#cb492-7"></a>        <span class="kw">join</span> brands b</span>
<span id="cb492-8"><a href="#cb492-8"></a>            <span class="kw">on</span> a.brand<span class="op">=</span>b.<span class="kw">ID</span></span>
<span id="cb492-9"><a href="#cb492-9"></a><span class="kw">group</span> <span class="kw">by</span></span>
<span id="cb492-10"><a href="#cb492-10"></a>    a.<span class="kw">ID</span>,</span>
<span id="cb492-11"><a href="#cb492-11"></a>    b.brand</span>
<span id="cb492-12"><a href="#cb492-12"></a></span>
<span id="cb492-13"><a href="#cb492-13"></a><span class="op">+</span><span class="co">----+--------+-----------+</span></span>
<span id="cb492-14"><a href="#cb492-14"></a>| <span class="kw">ID</span> | brand  | countCars |</span>
<span id="cb492-15"><a href="#cb492-15"></a><span class="op">+</span><span class="co">----+--------+-----------+</span></span>
<span id="cb492-16"><a href="#cb492-16"></a>|  <span class="dv">1</span> | Toyota |         <span class="dv">1</span> |</span>
<span id="cb492-17"><a href="#cb492-17"></a>|  <span class="dv">2</span> | Ford   |         <span class="dv">1</span> |</span>
<span id="cb492-18"><a href="#cb492-18"></a>|  <span class="dv">3</span> | Nissan |         <span class="dv">1</span> |</span>
<span id="cb492-19"><a href="#cb492-19"></a>|  <span class="dv">4</span> | Smart  |         <span class="dv">1</span> |</span>
<span id="cb492-20"><a href="#cb492-20"></a>|  <span class="dv">5</span> | Toyota |         <span class="dv">1</span> |</span>
<span id="cb492-21"><a href="#cb492-21"></a>|  <span class="dv">6</span> | BMW    |         <span class="dv">1</span> |</span>
<span id="cb492-22"><a href="#cb492-22"></a>|  <span class="dv">7</span> | Ford   |         <span class="dv">1</span> |</span>
<span id="cb492-23"><a href="#cb492-23"></a>|  <span class="dv">8</span> | Toyota |         <span class="dv">1</span> |</span>
<span id="cb492-24"><a href="#cb492-24"></a>|  <span class="dv">9</span> | Toyota |         <span class="dv">1</span> |</span>
<span id="cb492-25"><a href="#cb492-25"></a>| <span class="dv">10</span> | BMW    |         <span class="dv">1</span> |</span>
<span id="cb492-26"><a href="#cb492-26"></a>| <span class="dv">11</span> | Toyota |         <span class="dv">1</span> |</span>
<span id="cb492-27"><a href="#cb492-27"></a><span class="op">+</span><span class="co">----+--------+-----------+</span></span>
<span id="cb492-28"><a href="#cb492-28"></a><span class="dv">11</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>Sadly, no, we can’t do that. The reason is that when we add in the car ID (column a.ID) we have to add it into the group by - so now, when the count function works, there is only one ID matched per ID.</p>
<p>This is where we can however use a subquery - in fact we can do two completely different types of subquery that will return the same results that we need for this. The first is to simply put the subquery in the <code>select</code> clause. This means each time we get a row of data, the subquery will run off, get a column of data and then pop it into our row of data.</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb493-1"><a href="#cb493-1"></a><span class="kw">select</span></span>
<span id="cb493-2"><a href="#cb493-2"></a>    a.<span class="kw">ID</span>,</span>
<span id="cb493-3"><a href="#cb493-3"></a>    b.brand,</span>
<span id="cb493-4"><a href="#cb493-4"></a>    (</span>
<span id="cb493-5"><a href="#cb493-5"></a>    <span class="kw">select</span></span>
<span id="cb493-6"><a href="#cb493-6"></a>        <span class="fu">count</span>(c.<span class="kw">ID</span>)</span>
<span id="cb493-7"><a href="#cb493-7"></a>    <span class="kw">from</span></span>
<span id="cb493-8"><a href="#cb493-8"></a>        cars c</span>
<span id="cb493-9"><a href="#cb493-9"></a>    <span class="kw">where</span></span>
<span id="cb493-10"><a href="#cb493-10"></a>        a.brand<span class="op">=</span>c.brand</span>
<span id="cb493-11"><a href="#cb493-11"></a>    ) <span class="kw">as</span> countCars</span>
<span id="cb493-12"><a href="#cb493-12"></a><span class="kw">from</span></span>
<span id="cb493-13"><a href="#cb493-13"></a>    cars a</span>
<span id="cb493-14"><a href="#cb493-14"></a>        <span class="kw">join</span> brands b</span>
<span id="cb493-15"><a href="#cb493-15"></a>            <span class="kw">on</span> a.brand<span class="op">=</span>b.<span class="kw">ID</span></span>
<span id="cb493-16"><a href="#cb493-16"></a></span>
<span id="cb493-17"><a href="#cb493-17"></a><span class="op">+</span><span class="co">----+--------+-----------+</span></span>
<span id="cb493-18"><a href="#cb493-18"></a>| <span class="kw">ID</span> | brand  | countCars |</span>
<span id="cb493-19"><a href="#cb493-19"></a><span class="op">+</span><span class="co">----+--------+-----------+</span></span>
<span id="cb493-20"><a href="#cb493-20"></a>|  <span class="dv">2</span> | Ford   |         <span class="dv">2</span> |</span>
<span id="cb493-21"><a href="#cb493-21"></a>|  <span class="dv">7</span> | Ford   |         <span class="dv">2</span> |</span>
<span id="cb493-22"><a href="#cb493-22"></a>|  <span class="dv">1</span> | Toyota |         <span class="dv">5</span> |</span>
<span id="cb493-23"><a href="#cb493-23"></a>|  <span class="dv">5</span> | Toyota |         <span class="dv">5</span> |</span>
<span id="cb493-24"><a href="#cb493-24"></a>|  <span class="dv">8</span> | Toyota |         <span class="dv">5</span> |</span>
<span id="cb493-25"><a href="#cb493-25"></a>|  <span class="dv">9</span> | Toyota |         <span class="dv">5</span> |</span>
<span id="cb493-26"><a href="#cb493-26"></a>| <span class="dv">11</span> | Toyota |         <span class="dv">5</span> |</span>
<span id="cb493-27"><a href="#cb493-27"></a>|  <span class="dv">3</span> | Nissan |         <span class="dv">1</span> |</span>
<span id="cb493-28"><a href="#cb493-28"></a>|  <span class="dv">4</span> | Smart  |         <span class="dv">1</span> |</span>
<span id="cb493-29"><a href="#cb493-29"></a>|  <span class="dv">6</span> | BMW    |         <span class="dv">2</span> |</span>
<span id="cb493-30"><a href="#cb493-30"></a>| <span class="dv">10</span> | BMW    |         <span class="dv">2</span> |</span>
<span id="cb493-31"><a href="#cb493-31"></a><span class="op">+</span><span class="co">----+--------+-----------+</span></span>
<span id="cb493-32"><a href="#cb493-32"></a><span class="dv">11</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>And Bam!, this would do us. If you noticed though, this sub query will have to run for each and every single row of data we return. Even in this little example, we only have five different Brands of car, but the subquery ran eleven times as we have eleven rows of data that we are returning. So, in this case, it doesn’t seem like the most efficient way to write code.</p>
<p>For a different approach, lets run a subquery and pretend it is a table:</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb494-1"><a href="#cb494-1"></a><span class="kw">select</span></span>
<span id="cb494-2"><a href="#cb494-2"></a>    a.<span class="kw">ID</span>,</span>
<span id="cb494-3"><a href="#cb494-3"></a>    b.brand,</span>
<span id="cb494-4"><a href="#cb494-4"></a>    d.countCars</span>
<span id="cb494-5"><a href="#cb494-5"></a><span class="kw">from</span></span>
<span id="cb494-6"><a href="#cb494-6"></a>    cars a</span>
<span id="cb494-7"><a href="#cb494-7"></a>        <span class="kw">join</span> brands b</span>
<span id="cb494-8"><a href="#cb494-8"></a>            <span class="kw">on</span> a.brand<span class="op">=</span>b.<span class="kw">ID</span></span>
<span id="cb494-9"><a href="#cb494-9"></a>        <span class="kw">join</span></span>
<span id="cb494-10"><a href="#cb494-10"></a>            (</span>
<span id="cb494-11"><a href="#cb494-11"></a>            <span class="kw">select</span></span>
<span id="cb494-12"><a href="#cb494-12"></a>                c.brand,</span>
<span id="cb494-13"><a href="#cb494-13"></a>                <span class="fu">count</span>(c.<span class="kw">ID</span>) <span class="kw">as</span> countCars</span>
<span id="cb494-14"><a href="#cb494-14"></a>            <span class="kw">from</span></span>
<span id="cb494-15"><a href="#cb494-15"></a>                cars c</span>
<span id="cb494-16"><a href="#cb494-16"></a>            <span class="kw">group</span> <span class="kw">by</span></span>
<span id="cb494-17"><a href="#cb494-17"></a>                c.brand</span>
<span id="cb494-18"><a href="#cb494-18"></a>            ) d</span>
<span id="cb494-19"><a href="#cb494-19"></a>            <span class="kw">on</span> a.brand<span class="op">=</span>d.brand</span>
<span id="cb494-20"><a href="#cb494-20"></a></span>
<span id="cb494-21"><a href="#cb494-21"></a><span class="op">+</span><span class="co">----+--------+-----------+</span></span>
<span id="cb494-22"><a href="#cb494-22"></a>| <span class="kw">ID</span> | brand  | countCars |</span>
<span id="cb494-23"><a href="#cb494-23"></a><span class="op">+</span><span class="co">----+--------+-----------+</span></span>
<span id="cb494-24"><a href="#cb494-24"></a>|  <span class="dv">1</span> | Toyota |         <span class="dv">5</span> |</span>
<span id="cb494-25"><a href="#cb494-25"></a>|  <span class="dv">2</span> | Ford   |         <span class="dv">2</span> |</span>
<span id="cb494-26"><a href="#cb494-26"></a>|  <span class="dv">3</span> | Nissan |         <span class="dv">1</span> |</span>
<span id="cb494-27"><a href="#cb494-27"></a>|  <span class="dv">4</span> | Smart  |         <span class="dv">1</span> |</span>
<span id="cb494-28"><a href="#cb494-28"></a>|  <span class="dv">5</span> | Toyota |         <span class="dv">5</span> |</span>
<span id="cb494-29"><a href="#cb494-29"></a>|  <span class="dv">6</span> | BMW    |         <span class="dv">2</span> |</span>
<span id="cb494-30"><a href="#cb494-30"></a>|  <span class="dv">7</span> | Ford   |         <span class="dv">2</span> |</span>
<span id="cb494-31"><a href="#cb494-31"></a>|  <span class="dv">8</span> | Toyota |         <span class="dv">5</span> |</span>
<span id="cb494-32"><a href="#cb494-32"></a>|  <span class="dv">9</span> | Toyota |         <span class="dv">5</span> |</span>
<span id="cb494-33"><a href="#cb494-33"></a>| <span class="dv">10</span> | BMW    |         <span class="dv">2</span> |</span>
<span id="cb494-34"><a href="#cb494-34"></a>| <span class="dv">11</span> | Toyota |         <span class="dv">5</span> |</span>
<span id="cb494-35"><a href="#cb494-35"></a><span class="op">+</span><span class="co">----+--------+-----------+</span></span>
<span id="cb494-36"><a href="#cb494-36"></a><span class="dv">11</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>Okay, so we have the same results (ordered slightly different - it seems the database wanted to return results ordered by the first column we picked this time) - but the same right numbers.</p>
<p>So, what’s the difference between the two - and when should we use each type of subquery? First, lets make sure we understand how that second query works. We selected two tables in the <code>from</code> clause of our query, and then wrote a query and told the database that it was in fact a table instead - which the database is perfectly happy with. There <em>can</em> be some benefits to using this method (as well as some limitations). Foremost is that this subquery ran <em>once</em>. If our database contained a large volume of data, there could well be a massive improvement over the first method. However, as we are using this as a table, we have to bring in extra rows of data - so that they can actually be joined back to our rows of data. We also have to be sure that there are <em>enough</em> rows of data if we are going to use a simple join like in the query above. If you recall, the join will only pull back rows that have matching data on <em>both</em> sides of the join. If we aren’t careful, this could result in valid data not being returned from our cars table if there wasn’t a matching row in this subquery.</p>
<p>Now, looking back at the first subquery, there are some limitations as well. because we are pulling data back into a single row, we can <em>ONLY</em> pull back one row of data. Subqueries used in the <code>select</code> clause of a query very often use only an aggregate function such as <code>sum</code>, <code>count</code>, <code>max</code> or another similar aggregate function. They don’t <em>have</em> to, but that is often how they are written.</p>
<p>So, before we move on, lets have a quick look at where else we can use a subquery. We can use it in the <code>where</code> clause - now, this example is a little contrived as in our database, there are better ways of getting the following data, but seeing as it is only for an example, lets have a look:</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb495-1"><a href="#cb495-1"></a><span class="kw">select</span></span>
<span id="cb495-2"><a href="#cb495-2"></a>    <span class="kw">ID</span>,</span>
<span id="cb495-3"><a href="#cb495-3"></a>    brand</span>
<span id="cb495-4"><a href="#cb495-4"></a><span class="kw">from</span></span>
<span id="cb495-5"><a href="#cb495-5"></a>    brands</span>
<span id="cb495-6"><a href="#cb495-6"></a><span class="kw">where</span></span>
<span id="cb495-7"><a href="#cb495-7"></a>    brand <span class="kw">like</span> <span class="st">&#39;%o%&#39;</span></span>
<span id="cb495-8"><a href="#cb495-8"></a></span>
<span id="cb495-9"><a href="#cb495-9"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb495-10"><a href="#cb495-10"></a>| <span class="kw">ID</span> | brand  |</span>
<span id="cb495-11"><a href="#cb495-11"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb495-12"><a href="#cb495-12"></a>|  <span class="dv">1</span> | Ford   |</span>
<span id="cb495-13"><a href="#cb495-13"></a>|  <span class="dv">2</span> | Toyota |</span>
<span id="cb495-14"><a href="#cb495-14"></a>|  <span class="dv">6</span> | Holden |</span>
<span id="cb495-15"><a href="#cb495-15"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb495-16"><a href="#cb495-16"></a><span class="dv">3</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>This returns us a list of brand IDs and Brand names (the second column is only added to show us the brands) that contain the letter <code>o</code> in the name.</p>
<p>Now, we could use the results of this query in a where clause this:</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb496-1"><a href="#cb496-1"></a><span class="kw">select</span></span>
<span id="cb496-2"><a href="#cb496-2"></a>    a.<span class="kw">ID</span>,</span>
<span id="cb496-3"><a href="#cb496-3"></a>    b.brand</span>
<span id="cb496-4"><a href="#cb496-4"></a><span class="kw">from</span></span>
<span id="cb496-5"><a href="#cb496-5"></a>    cars a</span>
<span id="cb496-6"><a href="#cb496-6"></a>        <span class="kw">join</span> brands b</span>
<span id="cb496-7"><a href="#cb496-7"></a>            <span class="kw">on</span> a.brand<span class="op">=</span>b.<span class="kw">ID</span></span>
<span id="cb496-8"><a href="#cb496-8"></a><span class="kw">where</span></span>
<span id="cb496-9"><a href="#cb496-9"></a>    a.brand <span class="kw">in</span></span>
<span id="cb496-10"><a href="#cb496-10"></a>        (</span>
<span id="cb496-11"><a href="#cb496-11"></a>        <span class="kw">select</span></span>
<span id="cb496-12"><a href="#cb496-12"></a>            <span class="kw">ID</span></span>
<span id="cb496-13"><a href="#cb496-13"></a>        <span class="kw">from</span></span>
<span id="cb496-14"><a href="#cb496-14"></a>            brands</span>
<span id="cb496-15"><a href="#cb496-15"></a>        <span class="kw">where</span></span>
<span id="cb496-16"><a href="#cb496-16"></a>            brand <span class="kw">like</span> <span class="st">&#39;%o%&#39;</span></span>
<span id="cb496-17"><a href="#cb496-17"></a>        )</span>
<span id="cb496-18"><a href="#cb496-18"></a></span>
<span id="cb496-19"><a href="#cb496-19"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb496-20"><a href="#cb496-20"></a>| <span class="kw">ID</span> | brand  |</span>
<span id="cb496-21"><a href="#cb496-21"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb496-22"><a href="#cb496-22"></a>|  <span class="dv">2</span> | Ford   |</span>
<span id="cb496-23"><a href="#cb496-23"></a>|  <span class="dv">7</span> | Ford   |</span>
<span id="cb496-24"><a href="#cb496-24"></a>|  <span class="dv">1</span> | Toyota |</span>
<span id="cb496-25"><a href="#cb496-25"></a>|  <span class="dv">5</span> | Toyota |</span>
<span id="cb496-26"><a href="#cb496-26"></a>|  <span class="dv">8</span> | Toyota |</span>
<span id="cb496-27"><a href="#cb496-27"></a>|  <span class="dv">9</span> | Toyota |</span>
<span id="cb496-28"><a href="#cb496-28"></a>| <span class="dv">11</span> | Toyota |</span>
<span id="cb496-29"><a href="#cb496-29"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb496-30"><a href="#cb496-30"></a><span class="dv">7</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>As you can see, even though the subquery was returning the three brand IDs, our cars table only had entries for two of them.</p>
<p>In this case, for further detail, the subquery is working as if we wrote the following code:</p>
<div class="sourceCode" id="cb497"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb497-1"><a href="#cb497-1"></a><span class="kw">select</span></span>
<span id="cb497-2"><a href="#cb497-2"></a>    a.<span class="kw">ID</span>,</span>
<span id="cb497-3"><a href="#cb497-3"></a>    b.brand</span>
<span id="cb497-4"><a href="#cb497-4"></a><span class="kw">from</span></span>
<span id="cb497-5"><a href="#cb497-5"></a>    cars a</span>
<span id="cb497-6"><a href="#cb497-6"></a>        <span class="kw">join</span> brands b</span>
<span id="cb497-7"><a href="#cb497-7"></a>            <span class="kw">on</span> a.brand<span class="op">=</span>b.<span class="kw">ID</span></span>
<span id="cb497-8"><a href="#cb497-8"></a><span class="kw">where</span></span>
<span id="cb497-9"><a href="#cb497-9"></a>    a.brand <span class="kw">in</span> (<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>)</span>
<span id="cb497-10"><a href="#cb497-10"></a></span>
<span id="cb497-11"><a href="#cb497-11"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb497-12"><a href="#cb497-12"></a>| <span class="kw">ID</span> | brand  |</span>
<span id="cb497-13"><a href="#cb497-13"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb497-14"><a href="#cb497-14"></a>|  <span class="dv">1</span> | Toyota |</span>
<span id="cb497-15"><a href="#cb497-15"></a>|  <span class="dv">2</span> | Ford   |</span>
<span id="cb497-16"><a href="#cb497-16"></a>|  <span class="dv">5</span> | Toyota |</span>
<span id="cb497-17"><a href="#cb497-17"></a>|  <span class="dv">7</span> | Ford   |</span>
<span id="cb497-18"><a href="#cb497-18"></a>|  <span class="dv">8</span> | Toyota |</span>
<span id="cb497-19"><a href="#cb497-19"></a>|  <span class="dv">9</span> | Toyota |</span>
<span id="cb497-20"><a href="#cb497-20"></a>| <span class="dv">11</span> | Toyota |</span>
<span id="cb497-21"><a href="#cb497-21"></a><span class="op">+</span><span class="co">----+--------+</span></span>
<span id="cb497-22"><a href="#cb497-22"></a><span class="dv">7</span> <span class="kw">rows</span> <span class="kw">in</span> <span class="kw">set</span> (<span class="fl">0.00</span> sec)</span></code></pre></div>
<p>Again, you can see how a subquery vs manual inputs has changed the order of the rows when returning from the database.</p>
<p>While we are discussing subqueries, lets see what else we can do with a subquery:</p>
<ul>
<li>
You can place a subquery within another subquery, and so on and so on. There is a limit which depends on your database, but short of recursive functions of some insane and maniacal programmer, most folks will never hit that limit.
</li>
<li>
You can place a number of subqueries into a single query, a few in the <code>select</code> clause, some in the <code>from</code> clause and a couple more in the <code>where</code> clause - just remember that each one you put in is making your query more complex and likely to take longer to execute.
</li>
</ul>
<p>If you need to write some efficient code, it can be beneficial to write the query a number of ways and see (either by timing it or by using an explain plan) which is the optimal query to get your results. The first way that works may not always be the best way of doing it.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-do-i-set-a-column-value-to-null-in-sql-server-management-studio-score-774030-in-2019" class="level3">
<h3>77: How do I set a column value to NULL in SQL Server Management Studio? (score <a href="https://stackoverflow.com/q/444657.html">774030</a> in 2019)</h3>
<section id="question-75" class="level4">
<h4>Question</h4>
<p>How do I clear the value from a cell and make it NULL?</p>
</section>
<section id="answer-accepted-score-186" class="level4">
<h4>Answer accepted (score 186)</h4>
<p>If you’ve opened a table and you want to clear an existing value to NULL, click on the value, and press <kbd><code>Ctrl</code></kbd>+<kbd><code>0</code></kbd>.</p>
</section>
<section id="answer-2-score-300" class="level4">
<h4>Answer 2 (score 300)</h4>
<p>I think <a href="https://stackoverflow.com/a/444658/1165522"><span class="citation" data-cites="Zack">@Zack</span></a> properly answered the question but just to cover all the bases:</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb498-1"><a href="#cb498-1"></a><span class="kw">Update</span> myTable <span class="kw">set</span> MyColumn <span class="op">=</span> <span class="kw">NULL</span></span></code></pre></div>
<p>This would set the entire column to null as the Question Title asks.</p>
<p>To set a specific row on a specific column to null use:</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb499-1"><a href="#cb499-1"></a><span class="kw">Update</span> myTable <span class="kw">set</span> MyColumn <span class="op">=</span> <span class="kw">NULL</span> <span class="kw">where</span> Field <span class="op">=</span> Condition.</span></code></pre></div>
<p>This would set a specific cell to null as the inner question asks.</p>
</section>
<section id="answer-3-score-29" class="level4">
<h4>Answer 3 (score 29)</h4>
<p>If you are using the table interface you can type in NULL (all caps)</p>
<p>otherwise you can run an update statement where you could:</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb500-1"><a href="#cb500-1"></a><span class="kw">Update</span> <span class="kw">table</span> <span class="kw">set</span> ColumnName <span class="op">=</span> <span class="kw">NULL</span> <span class="kw">where</span> [<span class="kw">Filter</span> <span class="cf">for</span> <span class="dt">record</span> here]</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-to-calculate-percentage-with-a-sql-statement-score-771868-in-2013" class="level3">
<h3>78: How to calculate percentage with a SQL statement (score <a href="https://stackoverflow.com/q/770579.html">771868</a> in 2013)</h3>
<section id="question-76" class="level4">
<h4>Question</h4>
<p>I have a SQL Server table that contains users &amp; their grades. For simplicity’s sake, lets just say there are 2 columns - <code>name</code> &amp; <code>grade</code>. So a typical row would be Name: “John Doe”, Grade:“A”.</p>
<p>I’m looking for one SQL statement that will find the percentages of all possible answers. (A, B, C, etc…) Also, is there a way to do this without defining all possible answers (open text field - users could enter ‘pass/fail’, ‘none’, etc…)</p>
<p>The final output I’m looking for is A: 5%, B: 15%, C: 40%, etc…</p>
</section>
<section id="answer-accepted-score-210" class="level4">
<h4>Answer accepted (score 210)</h4>
<p>I have tested the following and this does work. The answer by gordyii was close but had the multiplication of 100 in the wrong place and had some missing parenthesis.</p>
<div class="sourceCode" id="cb501"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb501-1"><a href="#cb501-1"></a><span class="kw">Select</span> Grade, (<span class="fu">Count</span>(Grade)<span class="op">*</span> <span class="dv">100</span> <span class="op">/</span> (<span class="kw">Select</span> <span class="fu">Count</span>(<span class="op">*</span>) <span class="kw">From</span> MyTable)) <span class="kw">as</span> Score</span>
<span id="cb501-2"><a href="#cb501-2"></a><span class="kw">From</span> MyTable</span>
<span id="cb501-3"><a href="#cb501-3"></a><span class="kw">Group</span> <span class="kw">By</span> Grade</span></code></pre></div>
</section>
<section id="answer-2-score-195" class="level4">
<h4>Answer 2 (score 195)</h4>
<ol>
<li>
<p>
The most efficient (using over()).
</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb502-1"><a href="#cb502-1"></a><span class="kw">select</span> Grade, <span class="fu">count</span>(<span class="op">*</span>) <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> <span class="fu">sum</span>(<span class="fu">count</span>(<span class="op">*</span>)) <span class="kw">over</span>()</span>
<span id="cb502-2"><a href="#cb502-2"></a><span class="kw">from</span> MyTable</span>
<span id="cb502-3"><a href="#cb502-3"></a><span class="kw">group</span> <span class="kw">by</span> Grade</span>
<span id="cb502-4"><a href="#cb502-4"></a>```<span class="op">&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb502-5"><a href="#cb502-5"></a><span class="op">&lt;</span>li<span class="op">&gt;&lt;</span>p<span class="op">&gt;</span>Universal (<span class="kw">any</span> SQL version).<span class="op">&lt;/</span>p<span class="op">&gt;</span></span>
<span id="cb502-6"><a href="#cb502-6"></a></span>
<span id="cb502-7"><a href="#cb502-7"></a>```sql</span>
<span id="cb502-8"><a href="#cb502-8"></a><span class="kw">select</span> Grade, <span class="fu">count</span>(<span class="op">*</span>) <span class="op">*</span> <span class="fl">100.0</span> <span class="op">/</span> (<span class="kw">select</span> <span class="fu">count</span>(<span class="op">*</span>) <span class="kw">from</span> MyTable)</span>
<span id="cb502-9"><a href="#cb502-9"></a><span class="kw">from</span> MyTable</span>
<span id="cb502-10"><a href="#cb502-10"></a><span class="kw">group</span> <span class="kw">by</span> Grade;</span>
<span id="cb502-11"><a href="#cb502-11"></a>```<span class="op">&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb502-12"><a href="#cb502-12"></a><span class="op">&lt;</span>li<span class="op">&gt;&lt;</span>p<span class="op">&gt;</span><span class="kw">With</span> CTE, <span class="kw">the</span> <span class="fu">least</span> efficient.<span class="op">&lt;/</span>p<span class="op">&gt;</span></span>
<span id="cb502-13"><a href="#cb502-13"></a></span>
<span id="cb502-14"><a href="#cb502-14"></a>```sql</span>
<span id="cb502-15"><a href="#cb502-15"></a><span class="kw">with</span> t(Grade, GradeCount) </span>
<span id="cb502-16"><a href="#cb502-16"></a><span class="kw">as</span> </span>
<span id="cb502-17"><a href="#cb502-17"></a>( </span>
<span id="cb502-18"><a href="#cb502-18"></a>    <span class="kw">select</span> Grade, <span class="fu">count</span>(<span class="op">*</span>) </span>
<span id="cb502-19"><a href="#cb502-19"></a>    <span class="kw">from</span> MyTable</span>
<span id="cb502-20"><a href="#cb502-20"></a>    <span class="kw">group</span> <span class="kw">by</span> Grade</span>
<span id="cb502-21"><a href="#cb502-21"></a>)</span>
<span id="cb502-22"><a href="#cb502-22"></a><span class="kw">select</span> Grade, GradeCount <span class="op">*</span> <span class="fl">100.0</span><span class="op">/</span>(<span class="kw">select</span> <span class="fu">sum</span>(GradeCount) <span class="kw">from</span> t)</span>
<span id="cb502-23"><a href="#cb502-23"></a><span class="kw">from</span> t;</span>
<span id="cb502-24"><a href="#cb502-24"></a>```<span class="op">&lt;/</span>li<span class="op">&gt;</span></span>
<span id="cb502-25"><a href="#cb502-25"></a><span class="op">&lt;/</span>ol<span class="op">&gt;</span></span>
<span id="cb502-26"><a href="#cb502-26"></a></span>
<span id="cb502-27"><a href="#cb502-27"></a>#### Answer <span class="dv">3</span> (score <span class="dv">38</span>)</span>
<span id="cb502-28"><a href="#cb502-28"></a><span class="kw">Instead</span> <span class="kw">of</span> <span class="kw">using</span> a separate CTE <span class="kw">to</span> get <span class="kw">the</span> total, you can <span class="kw">use</span> a window <span class="kw">function</span> <span class="kw">without</span> <span class="kw">the</span> <span class="ot">&quot;partition by&quot;</span> clause.  </span>
<span id="cb502-29"><a href="#cb502-29"></a></span>
<span id="cb502-30"><a href="#cb502-30"></a><span class="cf">If</span> you are <span class="kw">using</span>:  </span>
<span id="cb502-31"><a href="#cb502-31"></a></span>
<span id="cb502-32"><a href="#cb502-32"></a>```sql</span>
<span id="cb502-33"><a href="#cb502-33"></a><span class="fu">count</span>(<span class="op">*</span>)</span></code></pre></div>
<p>to get the count for a group, you can use:</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb503-1"><a href="#cb503-1"></a><span class="fu">sum</span>(<span class="fu">count</span>(<span class="op">*</span>)) <span class="kw">over</span> ()</span></code></pre></div>
<p>to get the total count.</p>
<p>For example:</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb504-1"><a href="#cb504-1"></a><span class="kw">select</span> Grade, <span class="fl">100.</span> <span class="op">*</span> <span class="fu">count</span>(<span class="op">*</span>) <span class="op">/</span> <span class="fu">sum</span>(<span class="fu">count</span>(<span class="op">*</span>)) <span class="kw">over</span> ()</span>
<span id="cb504-2"><a href="#cb504-2"></a><span class="kw">from</span> <span class="kw">table</span></span>
<span id="cb504-3"><a href="#cb504-3"></a><span class="kw">group</span> <span class="kw">by</span> Grade;</span></code></pre></div>
<p>It tends to be faster in my experience, but I think it might internally use a temp table in some cases (I’ve seen “Worktable” when running with “set statistics io on”).</p>
<p>
<strong>EDIT:</strong> I’m not sure if my example query is what you are looking for, I was just illustrating how the windowing functions work.
</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="conversion-failed-when-converting-date-andor-time-from-character-string-while-inserting-datetime-score-771777-in-2013" class="level3">
<h3>79: Conversion failed when converting date and/or time from character string while inserting datetime (score <a href="https://stackoverflow.com/q/14119133.html">771777</a> in 2013)</h3>
<section id="question-77" class="level4">
<h4>Question</h4>
<p>I was trying to create a table as follows,</p>
<div class="sourceCode" id="cb505"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb505-1"><a href="#cb505-1"></a><span class="kw">create</span> <span class="kw">table</span> table1(date1 datetime,date2 datetime);</span></code></pre></div>
<p>First I tried inserting values as below,</p>
<div class="sourceCode" id="cb506"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb506-1"><a href="#cb506-1"></a><span class="kw">insert</span> <span class="kw">into</span> table1 <span class="kw">values</span>(<span class="st">&#39;21-02-2012 6:10:00 PM&#39;</span>,<span class="st">&#39;01-01-2001 12:00:00 AM&#39;</span>);</span></code></pre></div>
<p>It has given error saying,</p>
<blockquote>
<em>Cannot convert varchar to datetime</em>
</blockquote>
<p>Then I tried below format as one of the post suggested by our stackoverflow,</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb507-1"><a href="#cb507-1"></a><span class="kw">insert</span> <span class="kw">into</span> table1 <span class="kw">values</span>(<span class="fu">convert</span>(datetime,<span class="st">&#39;21-02-2012 6:10:00 PM&#39;</span>,<span class="dv">5</span>)</span>
<span id="cb507-2"><a href="#cb507-2"></a>                          ,<span class="fu">convert</span>(datetime,<span class="st">&#39;01-01-2001 12:00:00 AM&#39;</span>,<span class="dv">5</span>));</span></code></pre></div>
<p>But am still getting the error saying,</p>
<blockquote>
<em>Conversion failed when converting date and/or time from character string</em>
</blockquote>
<p>Any suggestions?</p>
</section>
<section id="answer-accepted-score-138" class="level4">
<h4>Answer accepted (score 138)</h4>
<p>There are many formats supported by SQL Server - see the <a href="http://msdn.microsoft.com/en-us/library/ms187928.aspx" rel="noreferrer">MSDN Books Online on CAST and CONVERT</a>. Most of those formats are <strong>dependent</strong> on what settings you have - therefore, these settings might work some times - and sometimes not.</p>
<p>The way to solve this is to use the (slightly adapted) <strong>ISO-8601 date format</strong> that is supported by SQL Server - this format works <strong>always</strong> - regardless of your SQL Server language and dateformat settings.</p>
<p>The <a href="http://msdn.microsoft.com/en-us/library/ms180878.aspx" rel="noreferrer">ISO-8601 format</a> is supported by SQL Server comes in two flavors:</p>
<ul>
<li>
<code>YYYYMMDD</code> for just dates (no time portion); note here: <strong>no dashes!</strong>, that’s very important! <code>YYYY-MM-DD</code> is <strong>NOT</strong> independent of the dateformat settings in your SQL Server and will <strong>NOT</strong> work in all situations!
</li>
</ul>
<p>or:</p>
<ul>
<li>
<code>YYYY-MM-DDTHH:MM:SS</code> for dates and times - note here: this format <em>has</em> dashes (but they <em>can</em> be omitted), and a fixed <code>T</code> as delimiter between the date and time portion of your <code>DATETIME</code>.
</li>
</ul>
<p>This is valid for SQL Server 2000 and newer.</p>
<p>So in your concrete case - use these strings:</p>
<div class="sourceCode" id="cb508"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb508-1"><a href="#cb508-1"></a><span class="kw">insert</span> <span class="kw">into</span> table1 <span class="kw">values</span>(<span class="st">&#39;2012-02-21T18:10:00&#39;</span>, <span class="st">&#39;2012-01-01T00:00:00&#39;</span>);</span></code></pre></div>
<p>and you should be fine (note: you need to use the international <strong>24-hour</strong> format rather than 12-hour AM/PM format for this).</p>
<p><strong>Alternatively</strong>: if you’re on SQL Server <strong>2008</strong> or newer, you could also use the <code>DATETIME2</code> datatype (instead of plain <code>DATETIME</code>) and your current <code>INSERT</code> would just work without any problems! :-) <code>DATETIME2</code> is a lot better and a lot less picky on conversions - and it’s the recommend date/time data types for SQL Server 2008 or newer anyway.</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb509-1"><a href="#cb509-1"></a><span class="kw">SELECT</span></span>
<span id="cb509-2"><a href="#cb509-2"></a>   <span class="fu">CAST</span>(<span class="st">&#39;02-21-2012 6:10:00 PM&#39;</span> <span class="kw">AS</span> DATETIME2),     <span class="co">-- works just fine</span></span>
<span id="cb509-3"><a href="#cb509-3"></a>   <span class="fu">CAST</span>(<span class="st">&#39;01-01-2012 12:00:00 AM&#39;</span> <span class="kw">AS</span> DATETIME2)   <span class="co">-- works just fine  </span></span></code></pre></div>
<p>Don’t ask me why this whole topic is so tricky and somewhat confusing - that’s just the way it is. But with the <code>YYYYMMDD</code> format, you should be fine for any version of SQL Server and for any language and dateformat setting in your SQL Server.</p>
</section>
<section id="answer-2-score-21" class="level4">
<h4>Answer 2 (score 21)</h4>
<p>The conversion in SQL server fails sometimes not because of the Date or Time formats used, It is Merely because you are trying to store wrong data that is not acceptable to the system.</p>
<p>Example:</p>
<p><code>Create Table MyTable (MyDate);</code></p>
<p><code>Insert Into MyTable(MyDate) Values ('2015-02-29');</code></p>
<p>The SQL server will throw the following error:</p>
<p><code>Conversion failed when converting date and/or time from character string.</code></p>
<p>The reason for this error is simply there is no such date (Feb-29) in Year (2015).</p>
</section>
<section id="answer-3-score-13-2" class="level4">
<h4>Answer 3 (score 13)</h4>
<p>Simple answer - 5 is Italian “yy” and 105 is Italian “yyyy”. Therefore:</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb510-1"><a href="#cb510-1"></a><span class="kw">SELECT</span> <span class="fu">convert</span>(datetime,<span class="st">&#39;21-02-12 6:10:00 PM&#39;</span>,<span class="dv">5</span>)</span></code></pre></div>
<p>will work correctly, but</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb511-1"><a href="#cb511-1"></a><span class="kw">SELECT</span> <span class="fu">convert</span>(datetime,<span class="st">&#39;21-02-12 6:10:00 PM&#39;</span>,<span class="dv">105</span>)</span></code></pre></div>
<p>will give error.</p>
<p>Likewise,</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb512-1"><a href="#cb512-1"></a><span class="kw">SELECT</span> <span class="fu">convert</span>(datetime,<span class="st">&#39;21-02-2012 6:10:00 PM&#39;</span>,<span class="dv">5</span>)</span></code></pre></div>
<p>will give error, where as</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb513-1"><a href="#cb513-1"></a><span class="kw">SELECT</span> <span class="fu">convert</span>(datetime,<span class="st">&#39;21-02-2012 6:10:00 PM&#39;</span>,<span class="dv">105</span>)</span></code></pre></div>
<p>will work.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="insert-into-a-mysql-table-or-update-if-exists-score-762170-in-2019" class="level3">
<h3>80: Insert into a MySQL table or update if exists (score <a href="https://stackoverflow.com/q/4205181.html">762170</a> in 2019)</h3>
<section id="question-78" class="level4">
<h4>Question</h4>
<p>I want to add a row to a database table, but if a row exists with the same unique key I want to update the row.</p>
<p>For example,</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb514-1"><a href="#cb514-1"></a><span class="kw">insert</span> <span class="kw">into</span> <span class="kw">table</span> (<span class="kw">id</span>, name, age) <span class="kw">values</span>(<span class="dv">1</span>, <span class="ot">&quot;A&quot;</span>, <span class="dv">19</span>)</span></code></pre></div>
<p>Let’s say the unique key is <code>id</code>, and in my database there is a row with <code>id = 1</code>. In that case I want to update that row with these values. Normally this gives an error. If I use <code>insert IGNORE</code> it will ignore the error, but it still won’t update.</p>
</section>
<section id="answer-accepted-score-1502" class="level4">
<h4>Answer accepted (score 1502)</h4>
<p>Use <a href="https://dev.mysql.com/doc/en/insert-on-duplicate.html" rel="noreferrer"><code>INSERT ... ON DUPLICATE KEY UPDATE</code></a></p>
<p><strong>QUERY:</strong></p>
<div class="sourceCode" id="cb515"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb515-1"><a href="#cb515-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> <span class="kw">table</span> (<span class="kw">id</span>, name, age) <span class="kw">VALUES</span>(<span class="dv">1</span>, <span class="ot">&quot;A&quot;</span>, <span class="dv">19</span>) <span class="kw">ON</span> DUPLICATE <span class="kw">KEY</span> <span class="kw">UPDATE</span>    </span>
<span id="cb515-2"><a href="#cb515-2"></a>name<span class="op">=</span><span class="ot">&quot;A&quot;</span>, age<span class="op">=</span><span class="dv">19</span></span></code></pre></div>
</section>
<section id="answer-2-score-228" class="level4">
<h4>Answer 2 (score 228)</h4>
<p>Check out REPLACE</p>
<p><a href="http://dev.mysql.com/doc/refman/5.0/en/replace.html" rel="noreferrer">http://dev.mysql.com/doc/refman/5.0/en/replace.html</a></p>
<div class="sourceCode" id="cb516"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb516-1"><a href="#cb516-1"></a><span class="kw">REPLACE</span> <span class="kw">into</span> <span class="kw">table</span> (<span class="kw">id</span>, name, age) <span class="kw">values</span>(<span class="dv">1</span>, <span class="ot">&quot;A&quot;</span>, <span class="dv">19</span>)</span></code></pre></div>
</section>
<section id="answer-3-score-38-1" class="level4">
<h4>Answer 3 (score 38)</h4>
<p>When using batch insert use the following syntax:</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb517-1"><a href="#cb517-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> <span class="kw">TABLE</span> (<span class="kw">id</span>, name, age) <span class="kw">VALUES</span> (<span class="dv">1</span>, <span class="ot">&quot;A&quot;</span>, <span class="dv">19</span>), (<span class="dv">2</span>, <span class="ot">&quot;B&quot;</span>, <span class="dv">17</span>), (<span class="dv">3</span>, <span class="ot">&quot;C&quot;</span>, <span class="dv">22</span>)</span>
<span id="cb517-2"><a href="#cb517-2"></a><span class="kw">ON</span> DUPLICATE <span class="kw">KEY</span> <span class="kw">UPDATE</span></span>
<span id="cb517-3"><a href="#cb517-3"></a>    name <span class="op">=</span> <span class="kw">VALUES</span> (name),</span>
<span id="cb517-4"><a href="#cb517-4"></a>    <span class="op">..</span>.</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-to-replace-a-string-in-a-sql-server-table-column-score-755845-in-2018" class="level3">
<h3>81: How to replace a string in a SQL Server Table Column (score <a href="https://stackoverflow.com/q/814548.html">755845</a> in 2018)</h3>
<section id="question-79" class="level4">
<h4>Question</h4>
<p>I have a table (<code>SQL Sever</code>) which references paths (<code>UNC</code> or otherwise), but now the path is going to change.</p>
<p>In the path column, I have many records and I need to change just a portion of the path, but not the entire path. And I need to change the same string to the new one, in every record.</p>
<p>How can I do this with a simple <code>update</code>?</p>
</section>
<section id="answer-accepted-score-585" class="level4">
<h4>Answer accepted (score 585)</h4>
<p>It’s this easy:</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb518-1"><a href="#cb518-1"></a><span class="kw">update</span> my_table</span>
<span id="cb518-2"><a href="#cb518-2"></a><span class="kw">set</span> path <span class="op">=</span> <span class="kw">replace</span>(path, <span class="st">&#39;oldstring&#39;</span>, <span class="st">&#39;newstring&#39;</span>)</span></code></pre></div>
</section>
<section id="answer-2-score-129" class="level4">
<h4>Answer 2 (score 129)</h4>
<div class="sourceCode" id="cb519"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb519-1"><a href="#cb519-1"></a><span class="kw">UPDATE</span> [<span class="kw">table</span>]</span>
<span id="cb519-2"><a href="#cb519-2"></a><span class="kw">SET</span> [<span class="kw">column</span>] <span class="op">=</span> <span class="kw">REPLACE</span>([<span class="kw">column</span>], <span class="st">&#39;/foo/&#39;</span>, <span class="st">&#39;/bar/&#39;</span>)</span></code></pre></div>
</section>
<section id="answer-3-score-25-1" class="level4">
<h4>Answer 3 (score 25)</h4>
<p>I tried the above but it did not yield the correct result. The following one does:</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb520-1"><a href="#cb520-1"></a><span class="kw">update</span> <span class="kw">table</span></span>
<span id="cb520-2"><a href="#cb520-2"></a><span class="kw">set</span> path <span class="op">=</span> <span class="kw">replace</span>(path, <span class="st">&#39;oldstring&#39;</span>, <span class="st">&#39;newstring&#39;</span>) <span class="kw">where</span> path <span class="op">=</span> <span class="st">&#39;oldstring&#39;</span></span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="sql-if-clause-within-where-clause-score-754551-in-2008" class="level3">
<h3>82: SQL: IF clause within WHERE clause (score <a href="https://stackoverflow.com/q/87821.html">754551</a> in 2008)</h3>
<section id="question-80" class="level4">
<h4>Question</h4>
<p>Is it possible to use an <strong>IF</strong> clause within a <strong>WHERE</strong> clause in MS SQL?</p>
<p>Example:</p>
<div class="sourceCode" id="cb521"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb521-1"><a href="#cb521-1"></a><span class="kw">WHERE</span></span>
<span id="cb521-2"><a href="#cb521-2"></a>    <span class="cf">IF</span> IsNumeric(@OrderNumber) <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb521-3"><a href="#cb521-3"></a>        OrderNumber <span class="op">=</span> @OrderNumber</span>
<span id="cb521-4"><a href="#cb521-4"></a>    <span class="cf">ELSE</span></span>
<span id="cb521-5"><a href="#cb521-5"></a>        OrderNumber <span class="kw">LIKE</span> <span class="st">&#39;%&#39;</span> <span class="op">+</span> @OrderNumber <span class="op">+</span> <span class="st">&#39;%&#39;</span></span></code></pre></div>
</section>
<section id="answer-accepted-score-199" class="level4">
<h4>Answer accepted (score 199)</h4>
<p>
Use a <a href="http://msdn.microsoft.com/en-us/library/ms181765.aspx" rel="noreferrer">CASE</a> statement<br> <strong>UPDATE:</strong> The previous syntax (as pointed out by a few people) doesn’t work. You can use CASE as follows:
</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb522-1"><a href="#cb522-1"></a><span class="kw">WHERE</span> OrderNumber <span class="kw">LIKE</span></span>
<span id="cb522-2"><a href="#cb522-2"></a>  <span class="cf">CASE</span> <span class="cf">WHEN</span> IsNumeric(@OrderNumber) <span class="op">=</span> <span class="dv">1</span> <span class="cf">THEN</span> </span>
<span id="cb522-3"><a href="#cb522-3"></a>    @OrderNumber </span>
<span id="cb522-4"><a href="#cb522-4"></a>  <span class="cf">ELSE</span></span>
<span id="cb522-5"><a href="#cb522-5"></a>    <span class="st">&#39;%&#39;</span> <span class="op">+</span> @OrderNumber</span>
<span id="cb522-6"><a href="#cb522-6"></a>  <span class="cf">END</span></span></code></pre></div>
<p>Or you can use an IF statement like @<a href="https://stackoverflow.com/questions/87821/sql-if-clause-within-where-clause#87992">N. J. Reed</a> points out.</p>
</section>
<section id="answer-2-score-130" class="level4">
<h4>Answer 2 (score 130)</h4>
<p>You should be able to do this without any IF or CASE</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb523-1"><a href="#cb523-1"></a> <span class="kw">WHERE</span> </span>
<span id="cb523-2"><a href="#cb523-2"></a>   (IsNumeric(@OrderNumber) <span class="kw">AND</span></span>
<span id="cb523-3"><a href="#cb523-3"></a>      (<span class="fu">CAST</span> OrderNumber <span class="kw">AS</span> <span class="dt">VARCHAR</span>) <span class="op">=</span> (<span class="fu">CAST</span> @OrderNumber <span class="kw">AS</span> <span class="dt">VARCHAR</span>)</span>
<span id="cb523-4"><a href="#cb523-4"></a> <span class="kw">OR</span></span>
<span id="cb523-5"><a href="#cb523-5"></a>   (<span class="kw">NOT</span> IsNumeric(@OrderNumber) <span class="kw">AND</span></span>
<span id="cb523-6"><a href="#cb523-6"></a>       OrderNumber <span class="kw">LIKE</span> (<span class="st">&#39;%&#39;</span> <span class="op">+</span> @OrderNumber))</span></code></pre></div>
<p>Depending on the flavour of SQL you may need to tweak the casts on the order number to an INT or VARCHAR depending on whether implicit casts are supported.</p>
<p>This is a very common technique in a WHERE clause. If you want to apply some “IF” logic in the WHERE clause all you need to do is add the extra condition with an boolean AND to the section where it needs to be applied.</p>
</section>
<section id="answer-3-score-22-1" class="level4">
<h4>Answer 3 (score 22)</h4>
<p>You don’t need a IF statement at all.</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb524-1"><a href="#cb524-1"></a><span class="kw">WHERE</span></span>
<span id="cb524-2"><a href="#cb524-2"></a>    (IsNumeric(@OrderNumber) <span class="op">=</span> <span class="dv">1</span> <span class="kw">AND</span> OrderNumber <span class="op">=</span> @OrderNumber)</span>
<span id="cb524-3"><a href="#cb524-3"></a><span class="kw">OR</span> (IsNumeric(@OrderNumber) <span class="op">=</span> <span class="dv">0</span> <span class="kw">AND</span> OrderNumber <span class="kw">LIKE</span> <span class="st">&#39;%&#39;</span> <span class="op">+</span> @OrderNumber <span class="op">+</span> <span class="st">&#39;%&#39;</span>)</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="sql-error-ora-01722-invalid-number-score-751360-in-2018" class="level3">
<h3>83: SQL error “ORA-01722: invalid number” (score <a href="https://stackoverflow.com/q/12549029.html">751360</a> in 2018)</h3>
<section id="question-81" class="level4">
<h4>Question</h4>
<p>
A very easy one for someone, The following insert is giving me the
</p>
<blockquote>
ORA-01722: invalid number
</blockquote>
<p>why?</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb525-1"><a href="#cb525-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> CUSTOMER <span class="kw">VALUES</span> (<span class="dv">1</span>,<span class="st">&#39;MALADY&#39;</span>,<span class="st">&#39;Claire&#39;</span>,<span class="st">&#39;27 Smith St Caulfield&#39;</span>,<span class="st">&#39;0419 853 694&#39;</span>);</span>
<span id="cb525-2"><a href="#cb525-2"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> CUSTOMER <span class="kw">VALUES</span> (<span class="dv">2</span>,<span class="st">&#39;GIBSON&#39;</span>,<span class="st">&#39;Jake&#39;</span>,<span class="st">&#39;27 Smith St Caulfield&#39;</span>,<span class="st">&#39;0415 713 598&#39;</span>);</span>
<span id="cb525-3"><a href="#cb525-3"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> CUSTOMER <span class="kw">VALUES</span> (<span class="dv">3</span>,<span class="st">&#39;LUU&#39;</span>,<span class="st">&#39;Barry&#39;</span>,<span class="st">&#39;5  Jones St Malvern&#39;</span>,<span class="st">&#39;0413 591 341&#39;</span>);</span>
<span id="cb525-4"><a href="#cb525-4"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> CUSTOMER <span class="kw">VALUES</span> (<span class="dv">4</span>,<span class="st">&#39;JONES&#39;</span>,<span class="st">&#39;Michael&#39;</span>,<span class="st">&#39;7  Smith St Caulfield&#39;</span>,<span class="st">&#39;0419 853 694&#39;</span>);</span>
<span id="cb525-5"><a href="#cb525-5"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> CUSTOMER <span class="kw">VALUES</span> (<span class="dv">5</span>,<span class="st">&#39;MALADY&#39;</span>,<span class="st">&#39;Betty&#39;</span>,<span class="st">&#39;27 Smith St Knox&#39;</span>,<span class="st">&#39;0418 418 347&#39;</span>);</span></code></pre></div>
</section>
<section id="answer-2-score-113-1" class="level4">
<h4>Answer 2 (score 113)</h4>
<p>An ORA-01722 error occurs when an attempt is made to convert a character string into a number, and the string cannot be converted into a number.</p>
<p>Without seeing your table definition, it looks like you’re trying to convert the numeric sequence at the end of your values list to a number, and the spaces that delimit it are throwing this error. But based on the information you’ve given us, it could be happening on any field (other than the first one).</p>
</section>
<section id="answer-3-score-23-4" class="level4">
<h4>Answer 3 (score 23)</h4>
<p>Suppose telephone number is defined as <code>NUMBER</code> then the blanks cannot be converted into a number:</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb526-1"><a href="#cb526-1"></a><span class="kw">create</span> <span class="kw">table</span> telephone_number (tel_number <span class="dt">number</span>);</span>
<span id="cb526-2"><a href="#cb526-2"></a><span class="kw">insert</span> <span class="kw">into</span> telephone_number <span class="kw">values</span> (<span class="st">&#39;0419 853 694&#39;</span>);</span></code></pre></div>
<p>The above gives you a</p>
<blockquote>
ORA-01722: invalid number
</blockquote>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-to-avoid-the-divide-by-zero-error-in-sql-score-744505-in-2018" class="level3">
<h3>84: How to avoid the “divide by zero” error in SQL? (score <a href="https://stackoverflow.com/q/861778.html">744505</a> in 2018)</h3>
<section id="question-82" class="level4">
<h4>Question</h4>
<p>I have this error message:</p>
<blockquote>
Msg 8134, Level 16, State 1, Line 1 Divide by zero error encountered.
</blockquote>
<p>What is the best way to write SQL code so that I will never see this error message again?</p>
<p>I could do either of the following:</p>
<ul>
<li>
Add a where clause so that my divisor is never zero
</li>
</ul>
<p>Or</p>
<ul>
<li>
I could add a case statement, so that there is a special treatment for zero.
</li>
</ul>
<p>Is the best way to use a <code>NULLIF</code> clause?</p>
<p>Is there better way, or how can this be enforced?</p>
</section>
<section id="answer-accepted-score-586" class="level4">
<h4>Answer accepted (score 586)</h4>
<p>In order to avoid a “Division by zero” error we have programmed it like this:</p>
<div class="sourceCode" id="cb527"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb527-1"><a href="#cb527-1"></a><span class="kw">Select</span> <span class="cf">Case</span> <span class="cf">when</span> divisor<span class="op">=</span><span class="dv">0</span> <span class="cf">then</span> <span class="kw">null</span></span>
<span id="cb527-2"><a href="#cb527-2"></a><span class="cf">Else</span> dividend <span class="op">/</span> divisor</span>
<span id="cb527-3"><a href="#cb527-3"></a><span class="cf">End</span> ,,,</span></code></pre></div>
<p>But here is a much nicer way of doing it:</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb528-1"><a href="#cb528-1"></a><span class="kw">Select</span> dividend <span class="op">/</span> <span class="fu">NULLIF</span>(divisor, <span class="dv">0</span>) <span class="op">..</span>.</span></code></pre></div>
<p>Now the only problem is to remember the NullIf bit, if I use the “/” key.</p>
</section>
<section id="answer-2-score-165" class="level4">
<h4>Answer 2 (score 165)</h4>
<p>In case you want to return zero, in case a zero devision would happen, you can use:</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb529-1"><a href="#cb529-1"></a><span class="kw">SELECT</span> <span class="fu">COALESCE</span>(dividend <span class="op">/</span> <span class="fu">NULLIF</span>(divisor,<span class="dv">0</span>), <span class="dv">0</span>) <span class="kw">FROM</span> sometable</span></code></pre></div>
<p>For every divisor that is zero, you will get a zero in the result set.</p>
</section>
<section id="answer-3-score-63-1" class="level4">
<h4>Answer 3 (score 63)</h4>
<h5>
This seemed to be the best fix for my situation when trying to address dividing by zero, which does happen in my data.
</h2>
<p>Suppose you want to calculate the male–female ratios for various school clubs, but you discover that the following query fails and issues a divide-by-zero error when it tries to calculate ratio for the Lord of the Rings Club, which has no women:</p>
<div class="sourceCode" id="cb530"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb530-1"><a href="#cb530-1"></a><span class="kw">SELECT</span> club_id, males, females, males<span class="op">/</span>females <span class="kw">AS</span> ratio</span>
<span id="cb530-2"><a href="#cb530-2"></a>  <span class="kw">FROM</span> school_clubs;</span></code></pre></div>
<p>You can use the function <code>NULLIF</code> to avoid division by zero. <code>NULLIF</code> compares two expressions and returns null if they are equal or the first expression otherwise.</p>
<p>Rewrite the query as:</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb531-1"><a href="#cb531-1"></a><span class="kw">SELECT</span> club_id, males, females, males<span class="op">/</span><span class="fu">NULLIF</span>(females, <span class="dv">0</span>) <span class="kw">AS</span> ratio</span>
<span id="cb531-2"><a href="#cb531-2"></a>  <span class="kw">FROM</span> school_clubs;</span></code></pre></div>
<p>Any number divided by <code>NULL</code> gives <code>NULL</code>, and no error is generated.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="select-statement-to-find-duplicates-on-certain-fields-score-743636-in-2014" class="level3">
<h3>85: Select statement to find duplicates on certain fields (score <a href="https://stackoverflow.com/q/4434118.html">743636</a> in 2014)</h3>
<section id="question-83" class="level4">
<h4>Question</h4>
<p>Can you help me with SQL statements to find duplicates on multiple fields?</p>
<p>For example, in pseudo code:</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb532-1"><a href="#cb532-1"></a><span class="kw">select</span> <span class="fu">count</span>(field1,field2,field3) </span>
<span id="cb532-2"><a href="#cb532-2"></a><span class="kw">from</span> <span class="kw">table</span> </span>
<span id="cb532-3"><a href="#cb532-3"></a><span class="kw">where</span> <span class="kw">the</span> combination <span class="kw">of</span> field1, field2, field3 occurs multiple times</span></code></pre></div>
<p>and from the above statement <em>if there are multiple occurrences</em> I would like to select <em>every record except the first one</em>.</p>
</section>
<section id="answer-accepted-score-834" class="level4">
<h4>Answer accepted (score 834)</h4>
<p>To get the list of fields for which there are multiple records, you can use..</p>
<div class="sourceCode" id="cb533"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb533-1"><a href="#cb533-1"></a><span class="kw">select</span> field1,field2,field3, <span class="fu">count</span>(<span class="op">*</span>)</span>
<span id="cb533-2"><a href="#cb533-2"></a>  <span class="kw">from</span> table_name</span>
<span id="cb533-3"><a href="#cb533-3"></a>  <span class="kw">group</span> <span class="kw">by</span> field1,field2,field3</span>
<span id="cb533-4"><a href="#cb533-4"></a>  <span class="kw">having</span> <span class="fu">count</span>(<span class="op">*</span>) <span class="op">&gt;</span> <span class="dv">1</span></span></code></pre></div>
<p>Check this link for more information on how to delete the rows.</p>
<p><a href="http://support.microsoft.com/kb/139444" rel="noreferrer">http://support.microsoft.com/kb/139444</a></p>
<p>Edit : As the other users mentioned, there should be a criterion for deciding how you define “first rows” before you use the approach in the link above. Based on that you’ll need to use an order by clause and a sub query if needed. If you can post some sample data, it would really help.</p>
</section>
<section id="answer-2-score-42" class="level4">
<h4>Answer 2 (score 42)</h4>
<p>You mention “the first one”, so I assume that you have some kind of ordering on your data. Let’s assume that your data is ordered by some field <code>ID</code>.</p>
<p>This SQL should get you the duplicate entries except for the first one. It basically selects all rows for which another row with (a) the same fields and (b) a lower ID exists. Performance won’t be great, but it might solve your problem.</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb534-1"><a href="#cb534-1"></a><span class="kw">SELECT</span> A.<span class="kw">ID</span>, A.field1, A.field2, A.field3</span>
<span id="cb534-2"><a href="#cb534-2"></a>  <span class="kw">FROM</span> myTable A</span>
<span id="cb534-3"><a href="#cb534-3"></a> <span class="kw">WHERE</span> <span class="kw">EXISTS</span> (<span class="kw">SELECT</span> B.<span class="kw">ID</span></span>
<span id="cb534-4"><a href="#cb534-4"></a>                 <span class="kw">FROM</span> myTable B</span>
<span id="cb534-5"><a href="#cb534-5"></a>                <span class="kw">WHERE</span> B.field1 <span class="op">=</span> A.field1</span>
<span id="cb534-6"><a href="#cb534-6"></a>                  <span class="kw">AND</span> B.field2 <span class="op">=</span> A.field2</span>
<span id="cb534-7"><a href="#cb534-7"></a>                  <span class="kw">AND</span> B.field3 <span class="op">=</span> A.field3</span>
<span id="cb534-8"><a href="#cb534-8"></a>                  <span class="kw">AND</span> B.<span class="kw">ID</span> <span class="op">&lt;</span> A.<span class="kw">ID</span>)</span></code></pre></div>
</section>
<section id="answer-3-score-17-2" class="level4">
<h4>Answer 3 (score 17)</h4>
<p>This is a fun solution with SQL Server 2005 that I like. I’m going to assume that by “for every record except for the first one”, you mean that there is another “id” column that we can use to identify which row is “first”.</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb535-1"><a href="#cb535-1"></a><span class="kw">SELECT</span> <span class="kw">id</span></span>
<span id="cb535-2"><a href="#cb535-2"></a>    , field1</span>
<span id="cb535-3"><a href="#cb535-3"></a>    , field2</span>
<span id="cb535-4"><a href="#cb535-4"></a>    , field3</span>
<span id="cb535-5"><a href="#cb535-5"></a><span class="kw">FROM</span></span>
<span id="cb535-6"><a href="#cb535-6"></a>(</span>
<span id="cb535-7"><a href="#cb535-7"></a>    <span class="kw">SELECT</span> <span class="kw">id</span></span>
<span id="cb535-8"><a href="#cb535-8"></a>        , field1</span>
<span id="cb535-9"><a href="#cb535-9"></a>        , field2</span>
<span id="cb535-10"><a href="#cb535-10"></a>        , field3</span>
<span id="cb535-11"><a href="#cb535-11"></a>        , <span class="fu">RANK</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> field1, field2, field3 <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="kw">id</span> <span class="kw">ASC</span>) <span class="kw">AS</span> [<span class="fu">rank</span>]</span>
<span id="cb535-12"><a href="#cb535-12"></a>    <span class="kw">FROM</span> table_name</span>
<span id="cb535-13"><a href="#cb535-13"></a>) a</span>
<span id="cb535-14"><a href="#cb535-14"></a><span class="kw">WHERE</span> [<span class="fu">rank</span>] <span class="op">&gt;</span> <span class="dv">1</span></span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="case-in-select-statement-score-742394-in-2013" class="level3">
<h3>86: Case in Select Statement (score <a href="https://stackoverflow.com/q/14189216.html">742394</a> in 2013)</h3>
<section id="question-84" class="level4">
<h4>Question</h4>
<p>I have an SQL statement that has a <code>CASE</code> from <code>SELECT</code> and I just can’t get it right. Can you guys show me an example of <code>CASE</code> where the cases are the conditions and the results are from the cases. For example:</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb536-1"><a href="#cb536-1"></a>     <span class="kw">Select</span> xxx, yyy</span>
<span id="cb536-2"><a href="#cb536-2"></a>     <span class="cf">case</span> : <span class="kw">desc</span> <span class="cf">case</span> <span class="cf">when</span> bbb <span class="cf">then</span> <span class="st">&#39;blackberry&#39;</span>;</span>
<span id="cb536-3"><a href="#cb536-3"></a>     <span class="cf">when</span> sss <span class="cf">then</span> <span class="st">&#39;samsung&#39;</span>;</span>
<span id="cb536-4"><a href="#cb536-4"></a>     <span class="cf">end</span> </span>
<span id="cb536-5"><a href="#cb536-5"></a>     <span class="kw">from</span> (<span class="kw">select</span> ???? <span class="op">....</span>.</span></code></pre></div>
<p>where the results show</p>
<div class="sourceCode" id="cb537"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb537-1"><a href="#cb537-1"></a> name                         age       handphone</span>
<span id="cb537-2"><a href="#cb537-2"></a>xxx1                         yyy1      blackberry</span>
<span id="cb537-3"><a href="#cb537-3"></a>xxx2                         yyy2      blackberry</span></code></pre></div>
</section>
<section id="answer-2-score-186-1" class="level4">
<h4>Answer 2 (score 186)</h4>
<p>The MSDN is a good reference for these type of questions regarding syntax and usage. This is from the Transact SQL Reference - CASE page.</p>
<p><a href="http://msdn.microsoft.com/en-us/library/ms181765.aspx" rel="noreferrer">http://msdn.microsoft.com/en-us/library/ms181765.aspx</a></p>
<div class="sourceCode" id="cb538"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb538-1"><a href="#cb538-1"></a><span class="kw">USE</span> AdventureWorks2012;</span>
<span id="cb538-2"><a href="#cb538-2"></a>GO</span>
<span id="cb538-3"><a href="#cb538-3"></a><span class="kw">SELECT</span>   ProductNumber, Name, <span class="ot">&quot;Price Range&quot;</span> <span class="op">=</span> </span>
<span id="cb538-4"><a href="#cb538-4"></a>  <span class="cf">CASE</span> </span>
<span id="cb538-5"><a href="#cb538-5"></a>     <span class="cf">WHEN</span> ListPrice <span class="op">=</span>  <span class="dv">0</span> <span class="cf">THEN</span> <span class="st">&#39;Mfg item - not for resale&#39;</span></span>
<span id="cb538-6"><a href="#cb538-6"></a>     <span class="cf">WHEN</span> ListPrice <span class="op">&lt;</span> <span class="dv">50</span> <span class="cf">THEN</span> <span class="st">&#39;Under $50&#39;</span></span>
<span id="cb538-7"><a href="#cb538-7"></a>     <span class="cf">WHEN</span> ListPrice <span class="op">&gt;=</span> <span class="dv">50</span> <span class="kw">and</span> ListPrice <span class="op">&lt;</span> <span class="dv">250</span> <span class="cf">THEN</span> <span class="st">&#39;Under $250&#39;</span></span>
<span id="cb538-8"><a href="#cb538-8"></a>     <span class="cf">WHEN</span> ListPrice <span class="op">&gt;=</span> <span class="dv">250</span> <span class="kw">and</span> ListPrice <span class="op">&lt;</span> <span class="dv">1000</span> <span class="cf">THEN</span> <span class="st">&#39;Under $1000&#39;</span></span>
<span id="cb538-9"><a href="#cb538-9"></a>     <span class="cf">ELSE</span> <span class="st">&#39;Over $1000&#39;</span></span>
<span id="cb538-10"><a href="#cb538-10"></a>  <span class="cf">END</span></span>
<span id="cb538-11"><a href="#cb538-11"></a><span class="kw">FROM</span> Production.Product</span>
<span id="cb538-12"><a href="#cb538-12"></a><span class="kw">ORDER</span> <span class="kw">BY</span> ProductNumber ;</span>
<span id="cb538-13"><a href="#cb538-13"></a>GO</span></code></pre></div>
<p>Another good site you may want to check out if you’re using SQL Server is <a href="http://sqlservercentral.com" rel="noreferrer">SQL Server Central</a>. This has a large variety of resources available for whatever area of SQL Server you would like to learn.</p>
</section>
<section id="answer-3-score-77" class="level4">
<h4>Answer 3 (score 77)</h4>
<p>I think these could be helpful for you .</p>
<p><strong>Using a <code>SELECT</code> statement with a simple <code>CASE</code> expression</strong></p>
<p>Within a <code>SELECT</code> statement, a simple <code>CASE</code> expression allows for only an equality check; no other comparisons are made. The following example uses the <code>CASE</code> expression to change the display of product line categories to make them more understandable.</p>
<div class="sourceCode" id="cb539"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb539-1"><a href="#cb539-1"></a><span class="kw">USE</span> AdventureWorks2012;</span>
<span id="cb539-2"><a href="#cb539-2"></a>GO</span>
<span id="cb539-3"><a href="#cb539-3"></a><span class="kw">SELECT</span>   ProductNumber, <span class="kw">Category</span> <span class="op">=</span></span>
<span id="cb539-4"><a href="#cb539-4"></a>      <span class="cf">CASE</span> ProductLine</span>
<span id="cb539-5"><a href="#cb539-5"></a>         <span class="cf">WHEN</span> <span class="st">&#39;R&#39;</span> <span class="cf">THEN</span> <span class="st">&#39;Road&#39;</span></span>
<span id="cb539-6"><a href="#cb539-6"></a>         <span class="cf">WHEN</span> <span class="st">&#39;M&#39;</span> <span class="cf">THEN</span> <span class="st">&#39;Mountain&#39;</span></span>
<span id="cb539-7"><a href="#cb539-7"></a>         <span class="cf">WHEN</span> <span class="st">&#39;T&#39;</span> <span class="cf">THEN</span> <span class="st">&#39;Touring&#39;</span></span>
<span id="cb539-8"><a href="#cb539-8"></a>         <span class="cf">WHEN</span> <span class="st">&#39;S&#39;</span> <span class="cf">THEN</span> <span class="st">&#39;Other sale items&#39;</span></span>
<span id="cb539-9"><a href="#cb539-9"></a>         <span class="cf">ELSE</span> <span class="st">&#39;Not for sale&#39;</span></span>
<span id="cb539-10"><a href="#cb539-10"></a>      <span class="cf">END</span>,</span>
<span id="cb539-11"><a href="#cb539-11"></a>   Name</span>
<span id="cb539-12"><a href="#cb539-12"></a><span class="kw">FROM</span> Production.Product</span>
<span id="cb539-13"><a href="#cb539-13"></a><span class="kw">ORDER</span> <span class="kw">BY</span> ProductNumber;</span>
<span id="cb539-14"><a href="#cb539-14"></a>GO</span></code></pre></div>
<p><strong>Using a <code>SELECT</code> statement with a searched <code>CASE</code> expression</strong></p>
<p>Within a <code>SELECT</code> statement, the searched <code>CASE</code> expression allows for values to be replaced in the result set based on comparison values. The following example displays the list price as a text comment based on the price range for a product.</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb540-1"><a href="#cb540-1"></a><span class="kw">USE</span> AdventureWorks2012;</span>
<span id="cb540-2"><a href="#cb540-2"></a>GO</span>
<span id="cb540-3"><a href="#cb540-3"></a><span class="kw">SELECT</span>   ProductNumber, Name, <span class="ot">&quot;Price Range&quot;</span> <span class="op">=</span> </span>
<span id="cb540-4"><a href="#cb540-4"></a>      <span class="cf">CASE</span> </span>
<span id="cb540-5"><a href="#cb540-5"></a>         <span class="cf">WHEN</span> ListPrice <span class="op">=</span>  <span class="dv">0</span> <span class="cf">THEN</span> <span class="st">&#39;Mfg item - not for resale&#39;</span></span>
<span id="cb540-6"><a href="#cb540-6"></a>         <span class="cf">WHEN</span> ListPrice <span class="op">&lt;</span> <span class="dv">50</span> <span class="cf">THEN</span> <span class="st">&#39;Under $50&#39;</span></span>
<span id="cb540-7"><a href="#cb540-7"></a>         <span class="cf">WHEN</span> ListPrice <span class="op">&gt;=</span> <span class="dv">50</span> <span class="kw">and</span> ListPrice <span class="op">&lt;</span> <span class="dv">250</span> <span class="cf">THEN</span> <span class="st">&#39;Under $250&#39;</span></span>
<span id="cb540-8"><a href="#cb540-8"></a>         <span class="cf">WHEN</span> ListPrice <span class="op">&gt;=</span> <span class="dv">250</span> <span class="kw">and</span> ListPrice <span class="op">&lt;</span> <span class="dv">1000</span> <span class="cf">THEN</span> <span class="st">&#39;Under $1000&#39;</span></span>
<span id="cb540-9"><a href="#cb540-9"></a>         <span class="cf">ELSE</span> <span class="st">&#39;Over $1000&#39;</span></span>
<span id="cb540-10"><a href="#cb540-10"></a>      <span class="cf">END</span></span>
<span id="cb540-11"><a href="#cb540-11"></a><span class="kw">FROM</span> Production.Product</span>
<span id="cb540-12"><a href="#cb540-12"></a><span class="kw">ORDER</span> <span class="kw">BY</span> ProductNumber ;</span>
<span id="cb540-13"><a href="#cb540-13"></a>GO</span></code></pre></div>
<p><strong>Using <code>CASE</code> in an <code>ORDER BY</code> clause</strong></p>
<p>The following examples uses the <code>CASE</code> expression in an <code>ORDER BY</code> clause to determine the sort order of the rows based on a given column value. In the first example, the value in the SalariedFlag column of the HumanResources.Employee table is evaluated. Employees that have the SalariedFlag set to 1 are returned in order by the BusinessEntityID in descending order. Employees that have the SalariedFlag set to 0 are returned in order by the BusinessEntityID in ascending order. In the second example, the result set is ordered by the column TerritoryName when the column CountryRegionName is equal to ‘United States’ and by CountryRegionName for all other rows.</p>
<div class="sourceCode" id="cb541"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb541-1"><a href="#cb541-1"></a><span class="kw">SELECT</span> BusinessEntityID, SalariedFlag</span>
<span id="cb541-2"><a href="#cb541-2"></a><span class="kw">FROM</span> HumanResources.Employee</span>
<span id="cb541-3"><a href="#cb541-3"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="cf">CASE</span> SalariedFlag <span class="cf">WHEN</span> <span class="dv">1</span> <span class="cf">THEN</span> BusinessEntityID <span class="cf">END</span> <span class="kw">DESC</span></span>
<span id="cb541-4"><a href="#cb541-4"></a>        ,<span class="cf">CASE</span> <span class="cf">WHEN</span> SalariedFlag <span class="op">=</span> <span class="dv">0</span> <span class="cf">THEN</span> BusinessEntityID <span class="cf">END</span>;</span>
<span id="cb541-5"><a href="#cb541-5"></a>GO</span>
<span id="cb541-6"><a href="#cb541-6"></a></span>
<span id="cb541-7"><a href="#cb541-7"></a></span>
<span id="cb541-8"><a href="#cb541-8"></a><span class="kw">SELECT</span> BusinessEntityID, LastName, TerritoryName, CountryRegionName</span>
<span id="cb541-9"><a href="#cb541-9"></a><span class="kw">FROM</span> Sales.vSalesPerson</span>
<span id="cb541-10"><a href="#cb541-10"></a><span class="kw">WHERE</span> TerritoryName <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span></span>
<span id="cb541-11"><a href="#cb541-11"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="cf">CASE</span> CountryRegionName <span class="cf">WHEN</span> <span class="st">&#39;United States&#39;</span> <span class="cf">THEN</span> TerritoryName</span>
<span id="cb541-12"><a href="#cb541-12"></a>         <span class="cf">ELSE</span> CountryRegionName <span class="cf">END</span>;</span></code></pre></div>
<p><strong>Using <code>CASE</code> in an <code>UPDATE</code> statement</strong></p>
<p>The following example uses the <code>CASE</code> expression in an <code>UPDATE</code> statement to determine the value that is set for the column VacationHours for employees with SalariedFlag set to 0. When subtracting 10 hours from VacationHours results in a negative value, VacationHours is increased by 40 hours; otherwise, VacationHours is increased by 20 hours. The <code>OUTPUT</code> clause is used to display the before and after vacation values.</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb542-1"><a href="#cb542-1"></a><span class="kw">USE</span> AdventureWorks2012;</span>
<span id="cb542-2"><a href="#cb542-2"></a>GO</span>
<span id="cb542-3"><a href="#cb542-3"></a><span class="kw">UPDATE</span> HumanResources.Employee</span>
<span id="cb542-4"><a href="#cb542-4"></a><span class="kw">SET</span> VacationHours <span class="op">=</span> </span>
<span id="cb542-5"><a href="#cb542-5"></a>    ( <span class="cf">CASE</span></span>
<span id="cb542-6"><a href="#cb542-6"></a>         <span class="cf">WHEN</span> ((VacationHours <span class="op">-</span> <span class="fl">10.00</span>) <span class="op">&lt;</span> <span class="dv">0</span>) <span class="cf">THEN</span> VacationHours <span class="op">+</span> <span class="dv">40</span></span>
<span id="cb542-7"><a href="#cb542-7"></a>         <span class="cf">ELSE</span> (VacationHours <span class="op">+</span> <span class="fl">20.00</span>)</span>
<span id="cb542-8"><a href="#cb542-8"></a>       <span class="cf">END</span></span>
<span id="cb542-9"><a href="#cb542-9"></a>    )</span>
<span id="cb542-10"><a href="#cb542-10"></a>OUTPUT Deleted.BusinessEntityID, Deleted.VacationHours <span class="kw">AS</span> BeforeValue, </span>
<span id="cb542-11"><a href="#cb542-11"></a>       Inserted.VacationHours <span class="kw">AS</span> AfterValue</span>
<span id="cb542-12"><a href="#cb542-12"></a><span class="kw">WHERE</span> SalariedFlag <span class="op">=</span> <span class="dv">0</span>; </span></code></pre></div>
<p><strong>Using <code>CASE</code> in a <code>HAVING</code> clause</strong></p>
<p>The following example uses the <code>CASE</code> expression in a <code>HAVING</code> clause to restrict the rows returned by the <code>SELECT</code> statement. The statement returns the the maximum hourly rate for each job title in the HumanResources.Employee table. The <code>HAVING</code> clause restricts the titles to those that are held by men with a maximum pay rate greater than 40 dollars or women with a maximum pay rate greater than 42 dollars.</p>
<div class="sourceCode" id="cb543"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb543-1"><a href="#cb543-1"></a><span class="kw">USE</span> AdventureWorks2012;</span>
<span id="cb543-2"><a href="#cb543-2"></a>GO</span>
<span id="cb543-3"><a href="#cb543-3"></a><span class="kw">SELECT</span> JobTitle, <span class="fu">MAX</span>(ph1.Rate)<span class="kw">AS</span> MaximumRate</span>
<span id="cb543-4"><a href="#cb543-4"></a><span class="kw">FROM</span> HumanResources.Employee <span class="kw">AS</span> e</span>
<span id="cb543-5"><a href="#cb543-5"></a><span class="kw">JOIN</span> HumanResources.EmployeePayHistory <span class="kw">AS</span> ph1 <span class="kw">ON</span> e.BusinessEntityID <span class="op">=</span> ph1.BusinessEntityID</span>
<span id="cb543-6"><a href="#cb543-6"></a><span class="kw">GROUP</span> <span class="kw">BY</span> JobTitle</span>
<span id="cb543-7"><a href="#cb543-7"></a><span class="kw">HAVING</span> (<span class="fu">MAX</span>(<span class="cf">CASE</span> <span class="cf">WHEN</span> Gender <span class="op">=</span> <span class="st">&#39;M&#39;</span> </span>
<span id="cb543-8"><a href="#cb543-8"></a>        <span class="cf">THEN</span> ph1.Rate </span>
<span id="cb543-9"><a href="#cb543-9"></a>        <span class="cf">ELSE</span> <span class="kw">NULL</span> <span class="cf">END</span>) <span class="op">&gt;</span> <span class="fl">40.00</span></span>
<span id="cb543-10"><a href="#cb543-10"></a>     <span class="kw">OR</span> <span class="fu">MAX</span>(<span class="cf">CASE</span> <span class="cf">WHEN</span> Gender  <span class="op">=</span> <span class="st">&#39;F&#39;</span> </span>
<span id="cb543-11"><a href="#cb543-11"></a>        <span class="cf">THEN</span> ph1.Rate  </span>
<span id="cb543-12"><a href="#cb543-12"></a>        <span class="cf">ELSE</span> <span class="kw">NULL</span> <span class="cf">END</span>) <span class="op">&gt;</span> <span class="fl">42.00</span>)</span>
<span id="cb543-13"><a href="#cb543-13"></a><span class="kw">ORDER</span> <span class="kw">BY</span> MaximumRate <span class="kw">DESC</span>;</span></code></pre></div>
<p>For more details description of these example visit the <a href="https://docs.microsoft.com/en-us/sql/t-sql/language-elements/case-transact-sql" rel="noreferrer">source</a>.</p>
<p>Also visit <a href="https://docs.oracle.com/cd/B19306_01/appdev.102/b14261/case_statement.htm" rel="noreferrer">here</a> and <a href="https://www.techonthenet.com/sql_server/functions/case.php" rel="noreferrer">here</a> for some examples with great details.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="sql-server-select-into-variable-score-742086-in-2011" class="level3">
<h3>87: SQL Server SELECT INTO <span class="citation" data-cites="variable">@variable</span>? (score <a href="https://stackoverflow.com/q/4823880.html">742086</a> in 2011)</h3>
<section id="question-85" class="level4">
<h4>Question</h4>
<p>I have the following code in one of my Sql (2008) Stored Procs which executes perfectly fine:</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb544-1"><a href="#cb544-1"></a>    <span class="kw">CREATE</span> <span class="kw">PROCEDURE</span> [dbo].[Item_AddItem]</span>
<span id="cb544-2"><a href="#cb544-2"></a>        @CustomerId uniqueidentifier,</span>
<span id="cb544-3"><a href="#cb544-3"></a>        @Description <span class="dt">nvarchar</span>(<span class="dv">100</span>),</span>
<span id="cb544-4"><a href="#cb544-4"></a>        @Type <span class="dt">int</span>,</span>
<span id="cb544-5"><a href="#cb544-5"></a>        @Username <span class="dt">nvarchar</span>(<span class="dv">100</span>),</span>
<span id="cb544-6"><a href="#cb544-6"></a>    <span class="kw">AS</span></span>
<span id="cb544-7"><a href="#cb544-7"></a>    <span class="cf">BEGIN</span></span>
<span id="cb544-8"><a href="#cb544-8"></a></span>
<span id="cb544-9"><a href="#cb544-9"></a>        <span class="kw">DECLARE</span> @TopRelatedItemId uniqueidentifier;</span>
<span id="cb544-10"><a href="#cb544-10"></a>        <span class="kw">SET</span> @TopRelatedItemId <span class="op">=</span> </span>
<span id="cb544-11"><a href="#cb544-11"></a>        (</span>
<span id="cb544-12"><a href="#cb544-12"></a>           <span class="kw">SELECT</span> top(<span class="dv">1</span>) RelatedItemId </span>
<span id="cb544-13"><a href="#cb544-13"></a>           <span class="kw">FROM</span> RelatedItems </span>
<span id="cb544-14"><a href="#cb544-14"></a>           <span class="kw">WHERE</span> CustomerId <span class="op">=</span> @CustomerId</span>
<span id="cb544-15"><a href="#cb544-15"></a>        ) </span>
<span id="cb544-16"><a href="#cb544-16"></a></span>
<span id="cb544-17"><a href="#cb544-17"></a>        <span class="kw">DECLARE</span> @TempItem <span class="kw">TABLE</span></span>
<span id="cb544-18"><a href="#cb544-18"></a>        (</span>
<span id="cb544-19"><a href="#cb544-19"></a>            ItemId uniqueidentifier,</span>
<span id="cb544-20"><a href="#cb544-20"></a>            CustomerId uniqueidentifier,</span>
<span id="cb544-21"><a href="#cb544-21"></a>            Description <span class="dt">nvarchar</span>(<span class="dv">100</span>),</span>
<span id="cb544-22"><a href="#cb544-22"></a>            <span class="kw">Type</span> <span class="dt">int</span>,</span>
<span id="cb544-23"><a href="#cb544-23"></a>            Username <span class="dt">nvarchar</span>(<span class="dv">100</span>),</span>
<span id="cb544-24"><a href="#cb544-24"></a>            <span class="dt">TimeStamp</span> datetime</span>
<span id="cb544-25"><a href="#cb544-25"></a>        );</span>
<span id="cb544-26"><a href="#cb544-26"></a></span>
<span id="cb544-27"><a href="#cb544-27"></a>        <span class="kw">INSERT</span> <span class="kw">INTO</span> Item</span>
<span id="cb544-28"><a href="#cb544-28"></a>        OUTPUT INSERTED.<span class="op">*</span> <span class="kw">INTO</span> @TempItem</span>
<span id="cb544-29"><a href="#cb544-29"></a>        <span class="kw">SELECT</span> NEWID(), @CustomerId, @Description, @Type, @Username, GETDATE()</span>
<span id="cb544-30"><a href="#cb544-30"></a></span>
<span id="cb544-31"><a href="#cb544-31"></a>        <span class="kw">SELECT</span></span>
<span id="cb544-32"><a href="#cb544-32"></a>            ItemId,</span>
<span id="cb544-33"><a href="#cb544-33"></a>            CustomerId,</span>
<span id="cb544-34"><a href="#cb544-34"></a>            @TopRelatedItemId,</span>
<span id="cb544-35"><a href="#cb544-35"></a>            Description,</span>
<span id="cb544-36"><a href="#cb544-36"></a>            <span class="kw">Type</span>,</span>
<span id="cb544-37"><a href="#cb544-37"></a>            Username,</span>
<span id="cb544-38"><a href="#cb544-38"></a>            <span class="dt">TimeStamp</span></span>
<span id="cb544-39"><a href="#cb544-39"></a>        <span class="kw">FROM</span></span>
<span id="cb544-40"><a href="#cb544-40"></a>            @TempItem</span>
<span id="cb544-41"><a href="#cb544-41"></a><span class="cf">END</span></span>
<span id="cb544-42"><a href="#cb544-42"></a>GO</span></code></pre></div>
<p><strong>So the question for you guys is is there a possibility to do something along the lines of:</strong></p>
<div class="sourceCode" id="cb545"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb545-1"><a href="#cb545-1"></a><span class="kw">DECLARE</span> @TempCustomer <span class="kw">TABLE</span></span>
<span id="cb545-2"><a href="#cb545-2"></a>(</span>
<span id="cb545-3"><a href="#cb545-3"></a>   CustomerId uniqueidentifier,</span>
<span id="cb545-4"><a href="#cb545-4"></a>   FirstName <span class="dt">nvarchar</span>(<span class="dv">100</span>),</span>
<span id="cb545-5"><a href="#cb545-5"></a>   LastName <span class="dt">nvarchar</span>(<span class="dv">100</span>),</span>
<span id="cb545-6"><a href="#cb545-6"></a>   Email <span class="dt">nvarchar</span>(<span class="dv">100</span>)</span>
<span id="cb545-7"><a href="#cb545-7"></a>);</span>
<span id="cb545-8"><a href="#cb545-8"></a><span class="kw">SELECT</span> </span>
<span id="cb545-9"><a href="#cb545-9"></a>    CustomerId, </span>
<span id="cb545-10"><a href="#cb545-10"></a>    FirstName, </span>
<span id="cb545-11"><a href="#cb545-11"></a>    LastName, </span>
<span id="cb545-12"><a href="#cb545-12"></a>    Email </span>
<span id="cb545-13"><a href="#cb545-13"></a><span class="kw">INTO</span> </span>
<span id="cb545-14"><a href="#cb545-14"></a>    @TempCustomer </span>
<span id="cb545-15"><a href="#cb545-15"></a><span class="kw">FROM</span> </span>
<span id="cb545-16"><a href="#cb545-16"></a>    Customer</span>
<span id="cb545-17"><a href="#cb545-17"></a><span class="kw">WHERE</span> </span>
<span id="cb545-18"><a href="#cb545-18"></a>    CustomerId <span class="op">=</span> @CustomerId</span></code></pre></div>
<p>So that I could reuse this data from memory in other following statements? SQL Server throws a fit with the above statement, however i don’t want to have to create separate variables and initialize each one of them via a separate SELECT statement against the same table…. UGH!!!</p>
<p>Any suggestions on how to achieve something along the lines without multiple queries against the same table?</p>
</section>
<section id="answer-accepted-score-195" class="level4">
<h4>Answer accepted (score 195)</h4>
<p>You cannot SELECT .. INTO .. a TABLE VARIABLE. The best you can do is create it first, then insert into it. Your 2nd snippet has to be</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb546-1"><a href="#cb546-1"></a><span class="kw">DECLARE</span> @TempCustomer <span class="kw">TABLE</span></span>
<span id="cb546-2"><a href="#cb546-2"></a>(</span>
<span id="cb546-3"><a href="#cb546-3"></a>   CustomerId uniqueidentifier,</span>
<span id="cb546-4"><a href="#cb546-4"></a>   FirstName <span class="dt">nvarchar</span>(<span class="dv">100</span>),</span>
<span id="cb546-5"><a href="#cb546-5"></a>   LastName <span class="dt">nvarchar</span>(<span class="dv">100</span>),</span>
<span id="cb546-6"><a href="#cb546-6"></a>   Email <span class="dt">nvarchar</span>(<span class="dv">100</span>)</span>
<span id="cb546-7"><a href="#cb546-7"></a>);</span>
<span id="cb546-8"><a href="#cb546-8"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> </span>
<span id="cb546-9"><a href="#cb546-9"></a>    @TempCustomer </span>
<span id="cb546-10"><a href="#cb546-10"></a><span class="kw">SELECT</span> </span>
<span id="cb546-11"><a href="#cb546-11"></a>    CustomerId, </span>
<span id="cb546-12"><a href="#cb546-12"></a>    FirstName, </span>
<span id="cb546-13"><a href="#cb546-13"></a>    LastName, </span>
<span id="cb546-14"><a href="#cb546-14"></a>    Email </span>
<span id="cb546-15"><a href="#cb546-15"></a><span class="kw">FROM</span> </span>
<span id="cb546-16"><a href="#cb546-16"></a>    Customer</span>
<span id="cb546-17"><a href="#cb546-17"></a><span class="kw">WHERE</span> </span>
<span id="cb546-18"><a href="#cb546-18"></a>    CustomerId <span class="op">=</span> @CustomerId</span></code></pre></div>
</section>
<section id="answer-2-score-472" class="level4">
<h4>Answer 2 (score 472)</h4>
<p>If you wanted to simply assign some variables for later use, you can do them in one shot with something along these lines:</p>
<div class="sourceCode" id="cb547"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb547-1"><a href="#cb547-1"></a><span class="kw">declare</span> @var1 <span class="dt">int</span>,@var2 <span class="dt">int</span>,@var3 <span class="dt">int</span>;</span>
<span id="cb547-2"><a href="#cb547-2"></a></span>
<span id="cb547-3"><a href="#cb547-3"></a><span class="kw">select</span> </span>
<span id="cb547-4"><a href="#cb547-4"></a>    @var1 <span class="op">=</span> field1,</span>
<span id="cb547-5"><a href="#cb547-5"></a>    @var2 <span class="op">=</span> field2,</span>
<span id="cb547-6"><a href="#cb547-6"></a>    @var3 <span class="op">=</span> field3</span>
<span id="cb547-7"><a href="#cb547-7"></a><span class="kw">from</span></span>
<span id="cb547-8"><a href="#cb547-8"></a>    <span class="kw">table</span></span>
<span id="cb547-9"><a href="#cb547-9"></a><span class="kw">where</span></span>
<span id="cb547-10"><a href="#cb547-10"></a>    condition</span></code></pre></div>
<p>If that’s the type of thing you’re after</p>
</section>
<section id="answer-3-score-30-1" class="level4">
<h4>Answer 3 (score 30)</h4>
<p>you can do this:</p>
<div class="sourceCode" id="cb548"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb548-1"><a href="#cb548-1"></a><span class="kw">SELECT</span> </span>
<span id="cb548-2"><a href="#cb548-2"></a>    CustomerId, </span>
<span id="cb548-3"><a href="#cb548-3"></a>    FirstName, </span>
<span id="cb548-4"><a href="#cb548-4"></a>    LastName, </span>
<span id="cb548-5"><a href="#cb548-5"></a>    Email</span>
<span id="cb548-6"><a href="#cb548-6"></a><span class="kw">INTO</span> #tempCustomer </span>
<span id="cb548-7"><a href="#cb548-7"></a><span class="kw">FROM</span> </span>
<span id="cb548-8"><a href="#cb548-8"></a>    Customer</span>
<span id="cb548-9"><a href="#cb548-9"></a><span class="kw">WHERE</span> </span>
<span id="cb548-10"><a href="#cb548-10"></a>    CustomerId <span class="op">=</span> @CustomerId</span></code></pre></div>
<p>then later</p>
<div class="sourceCode" id="cb549"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb549-1"><a href="#cb549-1"></a><span class="kw">SELECT</span> CustomerId <span class="kw">FROM</span> #tempCustomer</span></code></pre></div>
<p>you doesn’t need to declare the structure of #tempCustomer</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="inserting-data-into-a-temporary-table-score-737037-in" class="level3">
<h3>88: Inserting data into a temporary table (score <a href="https://stackoverflow.com/q/11778952.html">737037</a> in )</h3>
<section id="question-86" class="level4">
<h4>Question</h4>
<p>After having created a temporary table and declaring the data types like so;</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb550-1"><a href="#cb550-1"></a> <span class="kw">CREATE</span> <span class="kw">TABLE</span> #TempTable(</span>
<span id="cb550-2"><a href="#cb550-2"></a> <span class="kw">ID</span> <span class="dt">int</span>,</span>
<span id="cb550-3"><a href="#cb550-3"></a> <span class="dt">Date</span> datetime,</span>
<span id="cb550-4"><a href="#cb550-4"></a> Name <span class="dt">char</span>(<span class="dv">20</span>))</span></code></pre></div>
<p>How do I then insert the relevant data which is already held on a physical table within the database?</p>
</section>
<section id="answer-accepted-score-227" class="level4">
<h4>Answer accepted (score 227)</h4>
<div class="sourceCode" id="cb551"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb551-1"><a href="#cb551-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> #TempTable (<span class="kw">ID</span>, <span class="dt">Date</span>, Name) </span>
<span id="cb551-2"><a href="#cb551-2"></a><span class="kw">SELECT</span> <span class="kw">id</span>, <span class="dt">date</span>, name </span>
<span id="cb551-3"><a href="#cb551-3"></a><span class="kw">FROM</span> physical_table</span></code></pre></div>
</section>
<section id="answer-2-score-83" class="level4">
<h4>Answer 2 (score 83)</h4>
<p>To insert all data from all columns, just use this:</p>
<div class="sourceCode" id="cb552"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb552-1"><a href="#cb552-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">INTO</span> #TempTable</span>
<span id="cb552-2"><a href="#cb552-2"></a><span class="kw">FROM</span> OriginalTable</span></code></pre></div>
<p>Don’t forget to <code>DROP</code> the temporary table after you have finished with it and <em>before</em> you try creating it again:</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb553-1"><a href="#cb553-1"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> #TempTable</span></code></pre></div>
</section>
<section id="answer-3-score-72-1" class="level4">
<h4>Answer 3 (score 72)</h4>
<div class="sourceCode" id="cb554"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb554-1"><a href="#cb554-1"></a><span class="kw">SELECT</span>  <span class="kw">ID</span> , <span class="dt">Date</span> , Name <span class="kw">into</span> #temp <span class="kw">from</span> [TableName]</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-do-i-do-multiple-case-when-conditions-using-sql-server-2008-score-736058-in-2017" class="level3">
<h3>89: How do I do multiple CASE WHEN conditions using SQL Server 2008? (score <a href="https://stackoverflow.com/q/14630984.html">736058</a> in 2017)</h3>
<section id="question-87" class="level4">
<h4>Question</h4>
<p>What I’m trying to do is use more than one CASE WHEN condition for the same column.</p>
<p>Here is my code for the query:</p>
<div class="sourceCode" id="cb555"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb555-1"><a href="#cb555-1"></a>   <span class="kw">SELECT</span>   Url<span class="op">=</span><span class="st">&#39;&#39;</span>,</span>
<span id="cb555-2"><a href="#cb555-2"></a>            p.ArtNo,</span>
<span id="cb555-3"><a href="#cb555-3"></a>            p.[Description],</span>
<span id="cb555-4"><a href="#cb555-4"></a>            p.<span class="kw">Specification</span>,</span>
<span id="cb555-5"><a href="#cb555-5"></a>            <span class="cf">CASE</span> </span>
<span id="cb555-6"><a href="#cb555-6"></a>            <span class="cf">WHEN</span> <span class="dv">1</span> <span class="op">=</span> <span class="dv">1</span> <span class="kw">or</span> <span class="dv">1</span> <span class="op">=</span> <span class="dv">1</span> </span>
<span id="cb555-7"><a href="#cb555-7"></a>               <span class="cf">THEN</span> <span class="dv">1</span> </span>
<span id="cb555-8"><a href="#cb555-8"></a>               <span class="cf">ELSE</span> <span class="dv">0</span> </span>
<span id="cb555-9"><a href="#cb555-9"></a>            <span class="cf">END</span> <span class="kw">as</span> Qty,</span>
<span id="cb555-10"><a href="#cb555-10"></a>            p.NetPrice,</span>
<span id="cb555-11"><a href="#cb555-11"></a>            [Status] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb555-12"><a href="#cb555-12"></a>      <span class="kw">FROM</span>  Product p (NOLOCK)</span></code></pre></div>
<p>However, what I want to do is use more then one WHEN for the same column “qty”.</p>
<p>As in the following code:</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb556-1"><a href="#cb556-1"></a><span class="cf">IF</span></span>
<span id="cb556-2"><a href="#cb556-2"></a><span class="op">//</span> CODE</span>
<span id="cb556-3"><a href="#cb556-3"></a><span class="cf">ELSE</span> <span class="cf">IF</span></span>
<span id="cb556-4"><a href="#cb556-4"></a><span class="op">//</span> CODE</span>
<span id="cb556-5"><a href="#cb556-5"></a><span class="cf">ELSE</span> <span class="cf">IF</span></span>
<span id="cb556-6"><a href="#cb556-6"></a><span class="op">//</span> CODE</span>
<span id="cb556-7"><a href="#cb556-7"></a><span class="cf">ELSE</span></span>
<span id="cb556-8"><a href="#cb556-8"></a><span class="op">//</span> CODE</span></code></pre></div>
</section>
<section id="answer-accepted-score-337" class="level4">
<h4>Answer accepted (score 337)</h4>
<p>There are <a href="https://docs.microsoft.com/en-in/sql/t-sql/language-elements/case-transact-sql" rel="noreferrer">two formats of case expression</a>. You can do <code>CASE</code> with many <code>WHEN</code> as;</p>
<div class="sourceCode" id="cb557"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb557-1"><a href="#cb557-1"></a><span class="cf">CASE</span>  <span class="cf">WHEN</span> Col1 <span class="op">=</span> <span class="dv">1</span> <span class="kw">OR</span> Col3 <span class="op">=</span> <span class="dv">1</span>  <span class="cf">THEN</span> <span class="dv">1</span> </span>
<span id="cb557-2"><a href="#cb557-2"></a>      <span class="cf">WHEN</span> Col1 <span class="op">=</span> <span class="dv">2</span> <span class="cf">THEN</span> <span class="dv">2</span></span>
<span id="cb557-3"><a href="#cb557-3"></a>      <span class="op">..</span>.</span>
<span id="cb557-4"><a href="#cb557-4"></a>      <span class="cf">ELSE</span> <span class="dv">0</span> <span class="cf">END</span> <span class="kw">as</span> Qty</span></code></pre></div>
<p><em>Or</em> a Simple <code>CASE</code> expression</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb558-1"><a href="#cb558-1"></a><span class="cf">CASE</span> Col1 <span class="cf">WHEN</span> <span class="dv">1</span> <span class="cf">THEN</span> <span class="dv">11</span> <span class="cf">WHEN</span> <span class="dv">2</span> <span class="cf">THEN</span> <span class="dv">21</span> <span class="cf">ELSE</span> <span class="dv">13</span> <span class="cf">END</span></span></code></pre></div>
<p><em>Or</em> <code>CASE</code> <em>within</em> <code>CASE</code> as;</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb559-1"><a href="#cb559-1"></a><span class="cf">CASE</span>  <span class="cf">WHEN</span> Col1 <span class="op">&lt;</span> <span class="dv">2</span> <span class="cf">THEN</span>  </span>
<span id="cb559-2"><a href="#cb559-2"></a>                    <span class="cf">CASE</span> Col2 <span class="cf">WHEN</span> <span class="st">&#39;X&#39;</span> <span class="cf">THEN</span> <span class="dv">10</span> <span class="cf">ELSE</span> <span class="dv">11</span> <span class="cf">END</span></span>
<span id="cb559-3"><a href="#cb559-3"></a>      <span class="cf">WHEN</span> Col1 <span class="op">=</span> <span class="dv">2</span> <span class="cf">THEN</span> <span class="dv">2</span></span>
<span id="cb559-4"><a href="#cb559-4"></a>      <span class="op">..</span>.</span>
<span id="cb559-5"><a href="#cb559-5"></a>      <span class="cf">ELSE</span> <span class="dv">0</span> <span class="cf">END</span> <span class="kw">as</span> Qty</span></code></pre></div>
</section>
<section id="answer-2-score-11" class="level4">
<h4>Answer 2 (score 11)</h4>
<p>Just use this one, You have to use more when they are classes.</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb560-1"><a href="#cb560-1"></a><span class="kw">SELECT</span>   Url<span class="op">=</span><span class="st">&#39;&#39;</span>,</span>
<span id="cb560-2"><a href="#cb560-2"></a>         p.ArtNo,</span>
<span id="cb560-3"><a href="#cb560-3"></a>         p.[Description],</span>
<span id="cb560-4"><a href="#cb560-4"></a>         p.<span class="kw">Specification</span>,</span>
<span id="cb560-5"><a href="#cb560-5"></a>         <span class="cf">CASE</span> </span>
<span id="cb560-6"><a href="#cb560-6"></a>         <span class="cf">WHEN</span> <span class="dv">1</span> <span class="op">=</span> <span class="dv">1</span> <span class="kw">or</span> <span class="dv">1</span> <span class="op">=</span> <span class="dv">1</span> </span>
<span id="cb560-7"><a href="#cb560-7"></a>            <span class="cf">THEN</span> <span class="dv">1</span> </span>
<span id="cb560-8"><a href="#cb560-8"></a>         <span class="cf">WHEN</span> <span class="dv">2</span> <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb560-9"><a href="#cb560-9"></a>             <span class="cf">THEN</span> <span class="dv">2</span></span>
<span id="cb560-10"><a href="#cb560-10"></a>         <span class="cf">WHEN</span> <span class="dv">3</span> <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb560-11"><a href="#cb560-11"></a>              <span class="cf">THEN</span> <span class="dv">3</span></span>
<span id="cb560-12"><a href="#cb560-12"></a>          <span class="cf">ELSE</span> <span class="dv">0</span> </span>
<span id="cb560-13"><a href="#cb560-13"></a>        <span class="cf">END</span> <span class="kw">as</span> Qty,</span>
<span id="cb560-14"><a href="#cb560-14"></a>        p.NetPrice,</span>
<span id="cb560-15"><a href="#cb560-15"></a>        [Status] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb560-16"><a href="#cb560-16"></a>  <span class="kw">FROM</span>  Product p (NOLOCK)</span></code></pre></div>
</section>
<section id="answer-3-score-3" class="level4">
<h4>Answer 3 (score 3)</h4>
<p>You can use below example of case when with multiple conditions.</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb561-1"><a href="#cb561-1"></a><span class="kw">SELECT</span></span>
<span id="cb561-2"><a href="#cb561-2"></a>  <span class="kw">id</span>,stud_name,</span>
<span id="cb561-3"><a href="#cb561-3"></a>  <span class="cf">CASE</span></span>
<span id="cb561-4"><a href="#cb561-4"></a>    <span class="cf">WHEN</span> marks <span class="op">&lt;=</span> <span class="dv">40</span> <span class="cf">THEN</span> <span class="st">&#39;Bad&#39;</span></span>
<span id="cb561-5"><a href="#cb561-5"></a>    <span class="cf">WHEN</span> (marks <span class="op">&gt;=</span> <span class="dv">40</span> <span class="kw">AND</span></span>
<span id="cb561-6"><a href="#cb561-6"></a>      marks <span class="op">&lt;=</span> <span class="dv">100</span>) <span class="cf">THEN</span> <span class="st">&#39;good&#39;</span></span>
<span id="cb561-7"><a href="#cb561-7"></a>    <span class="cf">ELSE</span> <span class="st">&#39;best&#39;</span></span>
<span id="cb561-8"><a href="#cb561-8"></a>  <span class="cf">END</span> <span class="kw">AS</span> Grade</span>
<span id="cb561-9"><a href="#cb561-9"></a><span class="kw">FROM</span> Result</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="write-a-number-with-two-decimal-places-sql-server-score-733058-in-2013" class="level3">
<h3>90: Write a number with two decimal places SQL server (score <a href="https://stackoverflow.com/q/441600.html">733058</a> in 2013)</h3>
<section id="question-88" class="level4">
<h4>Question</h4>
<p>How do you write a number with two decimal places for sql server?</p>
</section>
<section id="answer-2-score-191" class="level4">
<h4>Answer 2 (score 191)</h4>
<p>try this</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb562-1"><a href="#cb562-1"></a><span class="kw">SELECT</span> <span class="fu">CONVERT</span>(<span class="dt">DECIMAL</span>(<span class="dv">10</span>,<span class="dv">2</span>),YOURCOLUMN)</span></code></pre></div>
</section>
<section id="answer-3-score-61-1" class="level4">
<h4>Answer 3 (score 61)</h4>
<p>Use <code>Str()</code> Function. It takes three arguments(the number, the number total characters to display, and the number of decimal places to display</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb563-1"><a href="#cb563-1"></a>  <span class="kw">Select</span> Str(<span class="fl">12345.6789</span>, <span class="dv">12</span>, <span class="dv">3</span>)</span></code></pre></div>
<p>displays: ’ 12345.679’ ( 3 spaces, 5 digits 12345, a decimal point, and three decimal digits (679). - it rounds if it has to truncate, (unless the integer part is too large for the total size, in which case asterisks are displayed instead.)</p>
<p>for a Total of 12 characters, with 3 to the right of decimal point.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="remove-all-spaces-from-a-string-in-sql-server-score-729620-in-2018" class="level3">
<h3>91: Remove all spaces from a string in SQL Server (score <a href="https://stackoverflow.com/q/10432086.html">729620</a> in 2018)</h3>
<section id="question-89" class="level4">
<h4>Question</h4>
<p>What is the best way to remove all spaces from a string in SQL Server 2008?</p>
<p><code>LTRIM(RTRIM('  a b '))</code> would remove all spaces at the right and left of the string, but I also need to remove the space in the middle.</p>
</section>
<section id="answer-accepted-score-348" class="level4">
<h4>Answer accepted (score 348)</h4>
<p>Simply replace it;</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb564-1"><a href="#cb564-1"></a><span class="kw">SELECT</span> <span class="kw">REPLACE</span>(fld_or_variable, <span class="st">&#39; &#39;</span>, <span class="st">&#39;&#39;</span>)</span></code></pre></div>
<p>
<strong>Edit:</strong> Just to clarify; its a global replace, there is no need to <code>trim()</code> or worry about multiple spaces for either <code>char</code> or <code>varchar</code>:
</p>
<div class="sourceCode" id="cb565"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb565-1"><a href="#cb565-1"></a><span class="kw">create</span> <span class="kw">table</span> #t (</span>
<span id="cb565-2"><a href="#cb565-2"></a>    c <span class="dt">char</span>(<span class="dv">8</span>),</span>
<span id="cb565-3"><a href="#cb565-3"></a>    v <span class="dt">varchar</span>(<span class="dv">8</span>))</span>
<span id="cb565-4"><a href="#cb565-4"></a></span>
<span id="cb565-5"><a href="#cb565-5"></a><span class="kw">insert</span> #t (c, v) <span class="kw">values</span> </span>
<span id="cb565-6"><a href="#cb565-6"></a>    (<span class="st">&#39;a a&#39;</span>    , <span class="st">&#39;a a&#39;</span>    ),</span>
<span id="cb565-7"><a href="#cb565-7"></a>    (<span class="st">&#39;a a  &#39;</span>  , <span class="st">&#39;a a  &#39;</span>  ),</span>
<span id="cb565-8"><a href="#cb565-8"></a>    (<span class="st">&#39;  a a&#39;</span>  , <span class="st">&#39;  a a&#39;</span>  ),</span>
<span id="cb565-9"><a href="#cb565-9"></a>    (<span class="st">&#39;  a a  &#39;</span>, <span class="st">&#39;  a a  &#39;</span>)</span>
<span id="cb565-10"><a href="#cb565-10"></a></span>
<span id="cb565-11"><a href="#cb565-11"></a><span class="kw">select</span></span>
<span id="cb565-12"><a href="#cb565-12"></a>    <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> c <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> [<span class="kw">IN</span>], <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="kw">replace</span>(c, <span class="st">&#39; &#39;</span>, <span class="st">&#39;&#39;</span>) <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span> [<span class="kw">OUT</span>]</span>
<span id="cb565-13"><a href="#cb565-13"></a><span class="kw">from</span> #t  </span>
<span id="cb565-14"><a href="#cb565-14"></a><span class="kw">union</span> <span class="kw">all</span> <span class="kw">select</span></span>
<span id="cb565-15"><a href="#cb565-15"></a>    <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> v <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span>, <span class="st">&#39;&quot;&#39;</span> <span class="op">+</span> <span class="kw">replace</span>(v, <span class="st">&#39; &#39;</span>, <span class="st">&#39;&#39;</span>) <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span></span>
<span id="cb565-16"><a href="#cb565-16"></a><span class="kw">from</span> #t </span></code></pre></div>
<p><strong>Result</strong></p>
<div class="sourceCode" id="cb566"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb566-1"><a href="#cb566-1"></a><span class="kw">IN</span>             <span class="kw">OUT</span></span>
<span id="cb566-2"><a href="#cb566-2"></a><span class="op">===================</span></span>
<span id="cb566-3"><a href="#cb566-3"></a><span class="ot">&quot;a a     &quot;</span>     <span class="ot">&quot;aa&quot;</span></span>
<span id="cb566-4"><a href="#cb566-4"></a><span class="ot">&quot;a a     &quot;</span>     <span class="ot">&quot;aa&quot;</span></span>
<span id="cb566-5"><a href="#cb566-5"></a><span class="ot">&quot;  a a   &quot;</span>     <span class="ot">&quot;aa&quot;</span></span>
<span id="cb566-6"><a href="#cb566-6"></a><span class="ot">&quot;  a a   &quot;</span>     <span class="ot">&quot;aa&quot;</span></span>
<span id="cb566-7"><a href="#cb566-7"></a><span class="ot">&quot;a a&quot;</span>          <span class="ot">&quot;aa&quot;</span></span>
<span id="cb566-8"><a href="#cb566-8"></a><span class="ot">&quot;a a  &quot;</span>        <span class="ot">&quot;aa&quot;</span></span>
<span id="cb566-9"><a href="#cb566-9"></a><span class="ot">&quot;  a a&quot;</span>        <span class="ot">&quot;aa&quot;</span></span>
<span id="cb566-10"><a href="#cb566-10"></a><span class="ot">&quot;  a a  &quot;</span>      <span class="ot">&quot;aa&quot;</span></span></code></pre></div>
</section>
<section id="answer-2-score-33" class="level4">
<h4>Answer 2 (score 33)</h4>
<p>I would use a REPLACE</p>
<div class="sourceCode" id="cb567"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb567-1"><a href="#cb567-1"></a><span class="kw">select</span> <span class="kw">REPLACE</span> (<span class="st">&#39; Hello , How Are You ?&#39;</span>, <span class="st">&#39; &#39;</span>, <span class="st">&#39;&#39;</span> )</span></code></pre></div>
<p><a href="http://msdn.microsoft.com/en-us/library/ms186862.aspx">REPLACE</a></p>
</section>
<section id="answer-3-score-23-5" class="level4">
<h4>Answer 3 (score 23)</h4>
<p>If it is an update on a table all you have to do is run this update multiple times until it is affecting 0 rows.</p>
<div class="sourceCode" id="cb568"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb568-1"><a href="#cb568-1"></a><span class="kw">update</span> tableName</span>
<span id="cb568-2"><a href="#cb568-2"></a><span class="kw">set</span> colName <span class="op">=</span> <span class="kw">REPLACE</span>(<span class="fu">LTRIM</span>(<span class="fu">RTRIM</span>(colName)), <span class="st">&#39;  &#39;</span>, <span class="st">&#39; &#39;</span>)</span>
<span id="cb568-3"><a href="#cb568-3"></a><span class="kw">where</span> colName <span class="kw">like</span> <span class="st">&#39;%  %&#39;</span></span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="error-string-or-binary-data-would-be-truncated-when-trying-to-insert-score-726384-in-2017" class="level3">
<h3>92: error, string or binary data would be truncated when trying to insert (score <a href="https://stackoverflow.com/q/5591473.html">726384</a> in 2017)</h3>
<section id="question-90" class="level4">
<h4>Question</h4>
<p>I am running data.bat file with the following lines:</p>
<div class="sourceCode" id="cb569"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb569-1"><a href="#cb569-1"></a><span class="co">Rem Tis batch file will populate tables</span></span>
<span id="cb569-2"><a href="#cb569-2"></a></span>
<span id="cb569-3"><a href="#cb569-3"></a>cd\program files\Microsoft SQL Server\MSSQL</span>
<span id="cb569-4"><a href="#cb569-4"></a>osql <span class="op">-</span>U sa <span class="op">-</span>P <span class="kw">Password</span> <span class="op">-</span>d MyBusiness <span class="op">-</span>i c:\<span class="kw">data</span>.sql</span></code></pre></div>
<p>The contents of the data.sql file is:</p>
<div class="sourceCode" id="cb570"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb570-1"><a href="#cb570-1"></a>   <span class="kw">insert</span> Customers</span>
<span id="cb570-2"><a href="#cb570-2"></a>            (CustomerID, CompanyName, Phone)</span>
<span id="cb570-3"><a href="#cb570-3"></a>             <span class="kw">Values</span>(<span class="st">&#39;101&#39;</span>,<span class="st">&#39;Southwinds&#39;</span>,<span class="st">&#39;19126602729&#39;</span>)</span></code></pre></div>
<p>There are 8 more similar lines for adding records.</p>
<p>When I run this with <code>start</code> &gt; <code>run</code> &gt; <code>cmd</code> &gt; <code>c:\data.bat</code>, I get this error message:</p>
<div class="sourceCode" id="cb571"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb571-1"><a href="#cb571-1"></a><span class="dv">1</span><span class="op">&gt;</span><span class="dv">2</span><span class="op">&gt;</span><span class="dv">3</span><span class="op">&gt;</span><span class="dv">4</span><span class="op">&gt;</span><span class="dv">5</span><span class="op">&gt;....&lt;</span><span class="dv">1</span> <span class="kw">row</span> affected<span class="op">&gt;</span></span>
<span id="cb571-2"><a href="#cb571-2"></a>Msg <span class="dv">8152</span>, <span class="kw">Level</span> <span class="dv">16</span>, State <span class="dv">4</span>, Server SP1001, Line <span class="dv">1</span></span>
<span id="cb571-3"><a href="#cb571-3"></a>string <span class="kw">or</span> binary <span class="kw">data</span> would be truncated.</span>
<span id="cb571-4"><a href="#cb571-4"></a></span>
<span id="cb571-5"><a href="#cb571-5"></a><span class="op">&lt;</span><span class="dv">1</span> <span class="kw">row</span> affected<span class="op">&gt;</span></span>
<span id="cb571-6"><a href="#cb571-6"></a></span>
<span id="cb571-7"><a href="#cb571-7"></a><span class="op">&lt;</span><span class="dv">1</span> <span class="kw">row</span> affected<span class="op">&gt;</span></span>
<span id="cb571-8"><a href="#cb571-8"></a></span>
<span id="cb571-9"><a href="#cb571-9"></a><span class="op">&lt;</span><span class="dv">1</span> <span class="kw">row</span> affected<span class="op">&gt;</span></span>
<span id="cb571-10"><a href="#cb571-10"></a></span>
<span id="cb571-11"><a href="#cb571-11"></a><span class="op">&lt;</span><span class="dv">1</span> <span class="kw">row</span> affected<span class="op">&gt;</span></span>
<span id="cb571-12"><a href="#cb571-12"></a></span>
<span id="cb571-13"><a href="#cb571-13"></a><span class="op">&lt;</span><span class="dv">1</span> <span class="kw">row</span> affected<span class="op">&gt;</span></span>
<span id="cb571-14"><a href="#cb571-14"></a></span>
<span id="cb571-15"><a href="#cb571-15"></a><span class="op">&lt;</span><span class="dv">1</span> <span class="kw">row</span> affected<span class="op">&gt;</span></span></code></pre></div>
<p>Also, I am a newbie obviously, but what do <code>Level #</code>, and <code>state #</code> mean, and how do I look up error messages such as the one above: 8152?</p>
</section>
<section id="answer-accepted-score-577" class="level4">
<h4>Answer accepted (score 577)</h4>
<p>From <a href="http://www.tek-tips.com/viewthread.cfm?qid=1042136" rel="noreferrer"><span class="citation" data-cites="gmmastros">@gmmastros</span>’s answer</a></p>
<p>Whenever you see the message….</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb572-1"><a href="#cb572-1"></a>string <span class="kw">or</span> binary <span class="kw">data</span> would be truncated </span></code></pre></div>
<p>Think to yourself… The field is NOT big enough to hold my data.</p>
<p>Check the table structure for the customers table. I think you’ll find that the length of one or more fields is NOT big enough to hold the data you are trying to insert. For example, if the Phone field is a varchar(8) field, and you try to put 11 characters in to it, you will get this error.</p>
</section>
<section id="answer-2-score-21-1" class="level4">
<h4>Answer 2 (score 21)</h4>
<p>
I had this issue although data length was shorter than the field length. It turned out that the problem was having another log table (for audit trail), filled by a trigger on the main table, where the column size also had to be changed.
</p>
</section>
<section id="answer-3-score-18" class="level4">
<h4>Answer 3 (score 18)</h4>
<p>In one of the <code>INSERT</code> statements you are attempting to insert a too long string into a string (<code>varchar</code> or <code>nvarchar</code>) column.</p>
<p>If it’s not obvious which <code>INSERT</code> is the offender by a mere look at the script, you could count the <code>&amp;lt;1 row affected&amp;gt;</code> lines that occur <em>before</em> the error message. The obtained number plus one gives you the statement number. In your case it seems to be the second INSERT that produces the error.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-to-select-all-records-from-one-table-that-do-not-exist-in-another-table-score-725294-in-2013" class="level3">
<h3>93: How to select all records from one table that do not exist in another table? (score <a href="https://stackoverflow.com/q/2686254.html">725294</a> in 2013)</h3>
<section id="question-91" class="level4">
<h4>Question</h4>
<blockquote>
<p>
table1 (id, name)<br> table2 (id, name)
</p>
</blockquote>
<p>Query:</p>
<div class="sourceCode" id="cb573"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb573-1"><a href="#cb573-1"></a><span class="kw">SELECT</span> name   </span>
<span id="cb573-2"><a href="#cb573-2"></a><span class="kw">FROM</span> table2  </span>
<span id="cb573-3"><a href="#cb573-3"></a><span class="co">-- that are not in table1 already</span></span></code></pre></div>
</section>
<section id="answer-accepted-score-753" class="level4">
<h4>Answer accepted (score 753)</h4>
<div class="sourceCode" id="cb574"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb574-1"><a href="#cb574-1"></a><span class="kw">SELECT</span> t1.name</span>
<span id="cb574-2"><a href="#cb574-2"></a><span class="kw">FROM</span> table1 t1</span>
<span id="cb574-3"><a href="#cb574-3"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> table2 t2 <span class="kw">ON</span> t2.name <span class="op">=</span> t1.name</span>
<span id="cb574-4"><a href="#cb574-4"></a><span class="kw">WHERE</span> t2.name <span class="kw">IS</span> <span class="kw">NULL</span></span></code></pre></div>
<p><strong>Q</strong>: What is happening here?</p>
<p><strong>A</strong>: Conceptually, we select all rows from <code>table1</code> and for each row we attempt to find a row in <code>table2</code> with the same value for the <code>name</code> column. If there is no such row, we just leave the <code>table2</code> portion of our result empty for that row. Then we constrain our selection by picking only those rows in the result where the matching row does not exist. Finally, We ignore all fields from our result except for the <code>name</code> column (the one we are sure that exists, from <code>table1</code>).</p>
<p>While it may not be the most performant method possible in all cases, it should work in basically every database engine ever that attempts to implement <a href="https://en.wikipedia.org/wiki/SQL-92" rel="noreferrer">ANSI 92 SQL</a></p>
</section>
<section id="answer-2-score-214" class="level4">
<h4>Answer 2 (score 214)</h4>
<p>You can either do</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb575-1"><a href="#cb575-1"></a><span class="kw">SELECT</span> name</span>
<span id="cb575-2"><a href="#cb575-2"></a><span class="kw">FROM</span> table2</span>
<span id="cb575-3"><a href="#cb575-3"></a><span class="kw">WHERE</span> name <span class="kw">NOT</span> <span class="kw">IN</span></span>
<span id="cb575-4"><a href="#cb575-4"></a>    (<span class="kw">SELECT</span> name </span>
<span id="cb575-5"><a href="#cb575-5"></a>     <span class="kw">FROM</span> table1)</span></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb576-1"><a href="#cb576-1"></a><span class="kw">SELECT</span> name </span>
<span id="cb576-2"><a href="#cb576-2"></a><span class="kw">FROM</span> table2 </span>
<span id="cb576-3"><a href="#cb576-3"></a><span class="kw">WHERE</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> </span>
<span id="cb576-4"><a href="#cb576-4"></a>    (<span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb576-5"><a href="#cb576-5"></a>     <span class="kw">FROM</span> table1 </span>
<span id="cb576-6"><a href="#cb576-6"></a>     <span class="kw">WHERE</span> table1.name <span class="op">=</span> table2.name)</span></code></pre></div>
<hr>
<p>See <a href="https://stackoverflow.com/questions/2246772/whats-the-difference-between-not-exists-vs-not-in-vs-left-join-where-is-null">this question</a> for 3 techniques to accomplish this</p>
</section>
<section id="answer-3-score-69" class="level4">
<h4>Answer 3 (score 69)</h4>
<p>I don’t have enough rep points to vote up the 2nd answer. But I have to disagree with the comments on the top answer. The second answer:</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb577-1"><a href="#cb577-1"></a><span class="kw">SELECT</span> name</span>
<span id="cb577-2"><a href="#cb577-2"></a><span class="kw">FROM</span> table2</span>
<span id="cb577-3"><a href="#cb577-3"></a><span class="kw">WHERE</span> name <span class="kw">NOT</span> <span class="kw">IN</span></span>
<span id="cb577-4"><a href="#cb577-4"></a>    (<span class="kw">SELECT</span> name </span>
<span id="cb577-5"><a href="#cb577-5"></a>     <span class="kw">FROM</span> table1)</span></code></pre></div>
<p>Is FAR more efficient in practice. I don’t know why, but I’m running it against 800k+ records and the difference is tremendous with the advantage given to the 2nd answer posted above. Just my $0.02</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="mysql-query-string-contains-score-721783-in-2017" class="level3">
<h3>94: MySQL query String contains (score <a href="https://stackoverflow.com/q/2602252.html">721783</a> in 2017)</h3>
<section id="question-92" class="level4">
<h4>Question</h4>
<p>I’ve been trying to figure out how I can make a query with MySQL that checks if the value (string <code>$haystack</code> ) in a certain column contains certain data (string <code>$needle</code>), like this:</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb578-1"><a href="#cb578-1"></a>mysql_query(<span class="ot">&quot;</span></span>
<span id="cb578-2"><a href="#cb578-2"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb578-3"><a href="#cb578-3"></a><span class="kw">FROM</span> `table`</span>
<span id="cb578-4"><a href="#cb578-4"></a><span class="kw">WHERE</span> `column`.<span class="kw">contains</span>(<span class="st">&#39;{$needle}&#39;</span>)</span>
<span id="cb578-5"><a href="#cb578-5"></a><span class="ot">&quot;);</span></span></code></pre></div>
<p>In PHP, the function is called <code>substr($haystack, $needle)</code>, so maybe:</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb579-1"><a href="#cb579-1"></a><span class="kw">WHERE</span> <span class="fu">substr</span>(`column`, <span class="st">&#39;{$needle}&#39;</span>)<span class="op">=</span><span class="dv">1</span></span></code></pre></div>
</section>
<section id="answer-accepted-score-396" class="level4">
<h4>Answer accepted (score 396)</h4>
<p>Quite simple actually:</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb580-1"><a href="#cb580-1"></a>mysql_query(<span class="ot">&quot;</span></span>
<span id="cb580-2"><a href="#cb580-2"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb580-3"><a href="#cb580-3"></a><span class="kw">FROM</span> `table`</span>
<span id="cb580-4"><a href="#cb580-4"></a><span class="kw">WHERE</span> `column` <span class="kw">LIKE</span> <span class="st">&#39;%{$needle}%&#39;</span></span>
<span id="cb580-5"><a href="#cb580-5"></a><span class="ot">&quot;);</span></span></code></pre></div>
<p>The <code>%</code> is a wildcard for any character. Do note that this can get slow on very large datasets so if your database grows you’ll need to use fulltext indices.</p>
</section>
<section id="answer-2-score-132" class="level4">
<h4>Answer 2 (score 132)</h4>
<p>Use:</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb581-1"><a href="#cb581-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb581-2"><a href="#cb581-2"></a>  <span class="kw">FROM</span> `table`</span>
<span id="cb581-3"><a href="#cb581-3"></a> <span class="kw">WHERE</span> <span class="fu">INSTR</span>(`column`, <span class="st">&#39;{$needle}&#39;</span>) <span class="op">&gt;</span> <span class="dv">0</span></span></code></pre></div>
<p>Reference:</p>
<ul>
<li>
<a href="http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_instr" rel="noreferrer">INSTR</a>
</li>
</ul>
</section>
<section id="answer-3-score-50" class="level4">
<h4>Answer 3 (score 50)</h4>
<div class="sourceCode" id="cb582"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb582-1"><a href="#cb582-1"></a><span class="kw">WHERE</span> `column` <span class="kw">LIKE</span> <span class="st">&#39;%$needle%&#39;</span></span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="oracle-select-top-10-records-score-720286-in-2017" class="level3">
<h3>95: Oracle SELECT TOP 10 records (score <a href="https://stackoverflow.com/q/2498035.html">720286</a> in 2017)</h3>
<section id="question-93" class="level4">
<h4>Question</h4>
<p>I have an big problem with an SQL Statement in Oracle. I want to select the TOP 10 Records ordered by STORAGE_DB which aren’t in a list from an other select statement.</p>
<p>This one works fine for all records:</p>
<div class="sourceCode" id="cb583"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb583-1"><a href="#cb583-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> </span>
<span id="cb583-2"><a href="#cb583-2"></a>  APP_ID, </span>
<span id="cb583-3"><a href="#cb583-3"></a>  NAME, </span>
<span id="cb583-4"><a href="#cb583-4"></a>  STORAGE_GB, </span>
<span id="cb583-5"><a href="#cb583-5"></a>  HISTORY_CREATED, </span>
<span id="cb583-6"><a href="#cb583-6"></a>  <span class="fu">TO_CHAR</span>(HISTORY_DATE, <span class="st">&#39;DD.MM.YYYY&#39;</span>) <span class="kw">AS</span> HISTORY_DATE  </span>
<span id="cb583-7"><a href="#cb583-7"></a>  <span class="kw">FROM</span> HISTORY <span class="kw">WHERE</span> </span>
<span id="cb583-8"><a href="#cb583-8"></a>      STORAGE_GB <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">AND</span> </span>
<span id="cb583-9"><a href="#cb583-9"></a>        APP_ID <span class="kw">NOT</span> <span class="kw">IN</span> (<span class="kw">SELECT</span> APP_ID</span>
<span id="cb583-10"><a href="#cb583-10"></a>                       <span class="kw">FROM</span> HISTORY</span>
<span id="cb583-11"><a href="#cb583-11"></a>                        <span class="kw">WHERE</span> <span class="fu">TO_CHAR</span>(HISTORY_DATE, <span class="st">&#39;DD.MM.YYYY&#39;</span>) <span class="op">=</span> <span class="st">&#39;06.02.2009&#39;</span>) </span></code></pre></div>
<p>But when I am adding</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb584-1"><a href="#cb584-1"></a><span class="kw">AND</span> <span class="kw">ROWNUM</span> <span class="op">&lt;=</span> <span class="dv">10</span></span>
<span id="cb584-2"><a href="#cb584-2"></a><span class="kw">ORDER</span> <span class="kw">BY</span> STORAGE_GB <span class="kw">DESC</span></span></code></pre></div>
<p>I’m getting some kind of “random” Records. I think because the limit takes in place before the order.</p>
<p>Does someone has an good solution? The other problem: This query is realy slow (10k+ records)</p>
</section>
<section id="answer-accepted-score-173" class="level4">
<h4>Answer accepted (score 173)</h4>
<p>You’ll need to put your current query in subquery as below :</p>
<div class="sourceCode" id="cb585"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb585-1"><a href="#cb585-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> (</span>
<span id="cb585-2"><a href="#cb585-2"></a>  <span class="kw">SELECT</span> <span class="kw">DISTINCT</span> </span>
<span id="cb585-3"><a href="#cb585-3"></a>  APP_ID, </span>
<span id="cb585-4"><a href="#cb585-4"></a>  NAME, </span>
<span id="cb585-5"><a href="#cb585-5"></a>  STORAGE_GB, </span>
<span id="cb585-6"><a href="#cb585-6"></a>  HISTORY_CREATED, </span>
<span id="cb585-7"><a href="#cb585-7"></a>  <span class="fu">TO_CHAR</span>(HISTORY_DATE, <span class="st">&#39;DD.MM.YYYY&#39;</span>) <span class="kw">AS</span> HISTORY_DATE  </span>
<span id="cb585-8"><a href="#cb585-8"></a>  <span class="kw">FROM</span> HISTORY <span class="kw">WHERE</span> </span>
<span id="cb585-9"><a href="#cb585-9"></a>    STORAGE_GB <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">AND</span> </span>
<span id="cb585-10"><a href="#cb585-10"></a>      APP_ID <span class="kw">NOT</span> <span class="kw">IN</span> (<span class="kw">SELECT</span> APP_ID <span class="kw">FROM</span> HISTORY <span class="kw">WHERE</span> <span class="fu">TO_CHAR</span>(HISTORY_DATE, <span class="st">&#39;DD.MM.YYYY&#39;</span>) <span class="op">=</span><span class="st">&#39;06.02.2009&#39;</span>)</span>
<span id="cb585-11"><a href="#cb585-11"></a>  <span class="kw">ORDER</span> <span class="kw">BY</span> STORAGE_GB <span class="kw">DESC</span> )</span>
<span id="cb585-12"><a href="#cb585-12"></a><span class="kw">WHERE</span> <span class="kw">ROWNUM</span> <span class="op">&lt;=</span> <span class="dv">10</span></span></code></pre></div>
<p>
Oracle applies <a href="http://www.adp-gmbh.ch/ora/sql/rownum.html" rel="noreferrer">rownum</a> to the result after it has been returned.<br> You need to filter the result after it has been returned, so a subquery is required. You can also use <a href="http://www.adp-gmbh.ch/ora/sql/analytical/rank.html" rel="noreferrer">RANK()</a> function to get Top-N results. <br><br> For performance try using <code>NOT EXISTS</code> in place of <code>NOT IN</code>. See <a href="http://www.4tm.com.ar/4tmsite/wordpress/?p=25" rel="noreferrer">this</a> for more.
</p>
</section>
<section id="answer-2-score-31" class="level4">
<h4>Answer 2 (score 31)</h4>
<p>If you are using Oracle 12c, use:</p>
<blockquote>
FETCH NEXT <strong><em>N</em></strong> ROWS ONLY
</blockquote>
<div class="sourceCode" id="cb586"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb586-1"><a href="#cb586-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> </span>
<span id="cb586-2"><a href="#cb586-2"></a>  APP_ID, </span>
<span id="cb586-3"><a href="#cb586-3"></a>  NAME, </span>
<span id="cb586-4"><a href="#cb586-4"></a>  STORAGE_GB, </span>
<span id="cb586-5"><a href="#cb586-5"></a>  HISTORY_CREATED, </span>
<span id="cb586-6"><a href="#cb586-6"></a>  <span class="fu">TO_CHAR</span>(HISTORY_DATE, <span class="st">&#39;DD.MM.YYYY&#39;</span>) <span class="kw">AS</span> HISTORY_DATE  </span>
<span id="cb586-7"><a href="#cb586-7"></a>  <span class="kw">FROM</span> HISTORY <span class="kw">WHERE</span> </span>
<span id="cb586-8"><a href="#cb586-8"></a>    STORAGE_GB <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">AND</span> </span>
<span id="cb586-9"><a href="#cb586-9"></a>      APP_ID <span class="kw">NOT</span> <span class="kw">IN</span> (<span class="kw">SELECT</span> APP_ID <span class="kw">FROM</span> HISTORY <span class="kw">WHERE</span> <span class="fu">TO_CHAR</span>(HISTORY_DATE, <span class="st">&#39;DD.MM.YYYY&#39;</span>) <span class="op">=</span><span class="st">&#39;06.02.2009&#39;</span>)</span>
<span id="cb586-10"><a href="#cb586-10"></a>  <span class="kw">ORDER</span> <span class="kw">BY</span> STORAGE_GB <span class="kw">DESC</span></span>
<span id="cb586-11"><a href="#cb586-11"></a>FETCH <span class="kw">NEXT</span> <span class="dv">10</span> <span class="kw">ROWS</span> <span class="kw">ONLY</span></span></code></pre></div>
<p>More info: <a href="http://docs.oracle.com/javadb/10.5.3.0/ref/rrefsqljoffsetfetch.html" rel="noreferrer">http://docs.oracle.com/javadb/10.5.3.0/ref/rrefsqljoffsetfetch.html</a></p>
</section>
<section id="answer-3-score-22-2" class="level4">
<h4>Answer 3 (score 22)</h4>
<p>With regards to the poor performance there are any number of things it could be, and it really ought to be a separate question. However, there is one obvious thing that could be a problem:</p>
<div class="sourceCode" id="cb587"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb587-1"><a href="#cb587-1"></a><span class="kw">WHERE</span> <span class="fu">TO_CHAR</span>(HISTORY_DATE, <span class="st">&#39;DD.MM.YYYY&#39;</span>) <span class="op">=</span> <span class="st">&#39;06.02.2009&#39;</span>) </span></code></pre></div>
<p>If HISTORY_DATE really is a date column and if it has an index then this rewrite will perform better:</p>
<div class="sourceCode" id="cb588"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb588-1"><a href="#cb588-1"></a><span class="kw">WHERE</span> HISTORY_DATE <span class="op">=</span> <span class="fu">TO_DATE</span> (<span class="st">&#39;06.02.2009&#39;</span>, <span class="st">&#39;DD.MM.YYYY&#39;</span>)  </span></code></pre></div>
<p>This is because a datatype conversion disables the use of a B-Tree index.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="pad-a-string-with-leading-zeros-so-its-3-characters-long-in-sql-server-2008-score-718842-in-2015" class="level3">
<h3>96: Pad a string with leading zeros so it’s 3 characters long in SQL Server 2008 (score <a href="https://stackoverflow.com/q/16760900.html">718842</a> in 2015)</h3>
<section id="question-94" class="level4">
<h4>Question</h4>
<p>I have a string that is up to 3 characters long when it’s first created in SQL Server 2008 R2.</p>
<p>I would like to pad it with leading zeros, so if its original value was ‘1’ then the new value would be ‘001’. Or if its original value was ‘23’ the new value is ‘023’. Or if its original value is ‘124’ then new value is the same as original value.</p>
<p>I am using SQL Server 2008 R2. How would I do this using T-SQL?</p>
</section>
<section id="answer-accepted-score-613" class="level4">
<h4>Answer accepted (score 613)</h4>
<p>If the field is already a string, this will work</p>
<div class="sourceCode" id="cb589"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb589-1"><a href="#cb589-1"></a> <span class="kw">SELECT</span> <span class="kw">RIGHT</span>(<span class="st">&#39;000&#39;</span><span class="op">+</span>ISNULL(field,<span class="st">&#39;&#39;</span>),<span class="dv">3</span>)</span></code></pre></div>
<p>If you want nulls to show as ‘000’</p>
<p>It might be an integer – then you would want</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb590-1"><a href="#cb590-1"></a> <span class="kw">SELECT</span> <span class="kw">RIGHT</span>(<span class="st">&#39;000&#39;</span><span class="op">+</span><span class="fu">CAST</span>(field <span class="kw">AS</span> <span class="dt">VARCHAR</span>(<span class="dv">3</span>)),<span class="dv">3</span>)</span></code></pre></div>
<blockquote>
As required by the question this answer only works if the length &lt;= 3, if you want something larger you need to change the string constant and the two integer constants to the width needed. eg <code>'0000' and VARCHAR(4)),4</code>
</blockquote>
</section>
<section id="answer-2-score-122" class="level4">
<h4>Answer 2 (score 122)</h4>
<p>Although the question was for SQL Server 2008 R2, in case someone is reading this with version 2012 and above, since then it became much easier by the use of <a href="https://msdn.microsoft.com/en-us/library/hh213505.aspx" rel="noreferrer">FORMAT</a>.</p>
<p>You can either pass a <a href="https://docs.microsoft.com/en-us/dotnet/standard/base-types/standard-numeric-format-strings" rel="noreferrer">standard numeric format string</a> or a <a href="https://docs.microsoft.com/en-us/dotnet/standard/base-types/custom-numeric-format-strings" rel="noreferrer">custom numeric format string</a> as the format argument (thank <a href="https://stackoverflow.com/users/1548895/vadim-ovchinnikov">Vadim Ovchinnikov</a> for this hint).</p>
<p>For this question for example a code like</p>
<div class="sourceCode" id="cb591"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb591-1"><a href="#cb591-1"></a><span class="kw">DECLARE</span> @myInt <span class="dt">INT</span> <span class="op">=</span> <span class="dv">1</span>;</span>
<span id="cb591-2"><a href="#cb591-2"></a><span class="co">-- One way using a standard numeric format string</span></span>
<span id="cb591-3"><a href="#cb591-3"></a>PRINT FORMAT(@myInt,<span class="st">&#39;D3&#39;</span>);</span>
<span id="cb591-4"><a href="#cb591-4"></a><span class="co">-- Other way using a custom numeric format string</span></span>
<span id="cb591-5"><a href="#cb591-5"></a>PRINT FORMAT(@myInt,<span class="st">&#39;00#&#39;</span>);</span></code></pre></div>
<p>outputs</p>
<div class="sourceCode" id="cb592"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb592-1"><a href="#cb592-1"></a><span class="dv">001</span></span>
<span id="cb592-2"><a href="#cb592-2"></a><span class="dv">001</span></span></code></pre></div>
</section>
<section id="answer-3-score-101" class="level4">
<h4>Answer 3 (score 101)</h4>
<p><strong>The safe method:</strong></p>
<div class="sourceCode" id="cb593"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb593-1"><a href="#cb593-1"></a><span class="kw">SELECT</span> <span class="kw">REPLACE</span>(STR(n,<span class="dv">3</span>),<span class="st">&#39; &#39;</span>,<span class="st">&#39;0&#39;</span>)</span></code></pre></div>
<p>This has the advantage of returning the string <code>'***'</code> for n &lt; 0 or n &gt; 999, which is a nice and obvious indicator of out-of-bounds input. The other methods listed here will fail silently by truncating the input to a 3-character substring.</p>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="best-approach-to-remove-time-part-of-datetime-in-sql-server-score-715443-in-2011" class="level3">
<h3>97: Best approach to remove time part of datetime in SQL Server (score <a href="https://stackoverflow.com/q/1177449.html">715443</a> in 2011)</h3>
<section id="question-95" class="level4">
<h4>Question</h4>
<p>Which method provides the best performance when removing the time portion from a datetime field in SQL Server?</p>
<div class="sourceCode" id="cb594"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb594-1"><a href="#cb594-1"></a>a) <span class="kw">select</span> DATEADD(dd, DATEDIFF(dd, <span class="dv">0</span>, getdate()), <span class="dv">0</span>)</span></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb595-1"><a href="#cb595-1"></a>b) <span class="kw">select</span> <span class="fu">cast</span>(<span class="fu">convert</span>(<span class="dt">char</span>(<span class="dv">11</span>), getdate(), <span class="dv">113</span>) <span class="kw">as</span> datetime)</span></code></pre></div>
<p>The second method does send a few more bytes either way but that might not be as important as the speed of the conversion.</p>
<p>Both also appear to be very fast, but there might be a difference in speed when dealing with hundreds-of-thousands or more rows?</p>
<p>Also, is it possible that there are even better methods to get rid of the time portion of a datetime in SQL?</p>
</section>
<section id="answer-accepted-score-536" class="level4">
<h4>Answer accepted (score 536)</h4>
<p>Strictly, method <code>a</code> is the least resource intensive:</p>
<div class="sourceCode" id="cb596"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb596-1"><a href="#cb596-1"></a>a) <span class="kw">select</span> DATEADD(dd, DATEDIFF(dd, <span class="dv">0</span>, getdate()), <span class="dv">0</span>)</span></code></pre></div>
<p>Proven less CPU intensive for same total duration a million rows by some one with way too much time on their hands: <a href="https://stackoverflow.com/questions/133081/most-efficient-way-in-sql-server-to-get-date-from-datetime">Most efficient way in SQL Server to get date from date+time?</a></p>
<p>I saw a similar test elsewhere with similar results too.</p>
<p>I prefer the DATEADD/DATEDIFF because:</p>
<ul>
<li>
varchar is subject to language/dateformat issues<br> Example: <a href="https://stackoverflow.com/q/3596663/27535">Why is my CASE expression non-deterministic?</a>
</li>
<li>
float relies on internal storage
</li>
<li>
it extends to work out first day of month, tomorrow etc by changing “0” base
</li>
</ul>
<p><strong>Edit, Oct 2011</strong></p>
<p>For SQL Server 2008+, you can CAST to <code>date</code>. Or just use <code>date</code> so no time to remove.</p>
<p><strong>Edit, Jan 2012</strong></p>
<p>A worked example of how flexible this is: <a href="https://stackoverflow.com/questions/8722022/need-to-calculate-by-rounded-time-or-date-figure-in-sql-server/8723311#8723311">Need to calculate by rounded time or date figure in sql server</a></p>
<p><strong>Edit, May 2012</strong></p>
<p>Do not use this in WHERE clauses and the like without thinking: adding a function or CAST to a column invalidates index usage. See number 2 here: <a href="http://www.simple-talk.com/sql/t-sql-programming/ten-common-sql-programming-mistakes/" rel="noreferrer">http://www.simple-talk.com/sql/t-sql-programming/ten-common-sql-programming-mistakes/</a></p>
<p>Now, this does have an example of later SQL Server optimiser versions managing CAST to date correctly, but <em>generally</em> it will be a bad idea …</p>
<p><strong>Edit, Sep 2018, for datetime2</strong></p>
<div class="sourceCode" id="cb597"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb597-1"><a href="#cb597-1"></a><span class="kw">DECLARE</span> @datetime2value datetime2 <span class="op">=</span> <span class="st">&#39;02180912 11:45&#39;</span> <span class="co">--this is deliberately within datetime2, year 0218</span></span>
<span id="cb597-2"><a href="#cb597-2"></a><span class="kw">DECLARE</span> @datetime2epoch datetime2 <span class="op">=</span> <span class="st">&#39;19000101&#39;</span></span>
<span id="cb597-3"><a href="#cb597-3"></a></span>
<span id="cb597-4"><a href="#cb597-4"></a><span class="kw">select</span> DATEADD(dd, DATEDIFF(dd, @datetime2epoch, @datetime2value), @datetime2epoch)</span></code></pre></div>
</section>
<section id="answer-2-score-62" class="level4">
<h4>Answer 2 (score 62)</h4>
<p>In SQL Server 2008, you can use:</p>
<div class="sourceCode" id="cb598"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb598-1"><a href="#cb598-1"></a><span class="fu">CONVERT</span>(<span class="dt">DATE</span>, getdate(), <span class="dv">101</span>)</span></code></pre></div>
</section>
<section id="answer-3-score-45" class="level4">
<h4>Answer 3 (score 45)</h4>
<p>Of-course this is an old thread but to make it complete.</p>
<p>From SQL 2008 you can use DATE datatype so you can simply do:</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb599-1"><a href="#cb599-1"></a><span class="kw">SELECT</span> <span class="fu">CONVERT</span>(<span class="dt">DATE</span>,GETDATE())</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="the-multi-part-identifier-could-not-be-bound-score-713638-in-2016" class="level3">
<h3>98: The multi-part identifier could not be bound (score <a href="https://stackoverflow.com/q/7314134.html">713638</a> in 2016)</h3>
<section id="question-96" class="level4">
<h4>Question</h4>
<p>
I’ve seen similar errors on SO, but I don’t find a solution for my problem. I have a SQL query like:
</p>
<div class="sourceCode" id="cb600"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb600-1"><a href="#cb600-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span></span>
<span id="cb600-2"><a href="#cb600-2"></a>        a.maxa ,</span>
<span id="cb600-3"><a href="#cb600-3"></a>        b.mahuyen ,</span>
<span id="cb600-4"><a href="#cb600-4"></a>        a.tenxa ,</span>
<span id="cb600-5"><a href="#cb600-5"></a>        b.tenhuyen ,</span>
<span id="cb600-6"><a href="#cb600-6"></a>        ISNULL(dkcd.tong, <span class="dv">0</span>) <span class="kw">AS</span> tongdkcd</span>
<span id="cb600-7"><a href="#cb600-7"></a><span class="kw">FROM</span>    phuongxa a ,</span>
<span id="cb600-8"><a href="#cb600-8"></a>        quanhuyen b</span>
<span id="cb600-9"><a href="#cb600-9"></a>        <span class="kw">LEFT</span> <span class="kw">OUTER</span> <span class="kw">JOIN</span> ( <span class="kw">SELECT</span>    maxa ,</span>
<span id="cb600-10"><a href="#cb600-10"></a>                                    <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> tong</span>
<span id="cb600-11"><a href="#cb600-11"></a>                          <span class="kw">FROM</span>      khaosat</span>
<span id="cb600-12"><a href="#cb600-12"></a>                          <span class="kw">WHERE</span>     <span class="fu">CONVERT</span>(DATETIME, ngaylap, <span class="dv">103</span>) <span class="kw">BETWEEN</span> <span class="st">&#39;Sep 1 2011&#39;</span></span>
<span id="cb600-13"><a href="#cb600-13"></a>                                                              <span class="kw">AND</span></span>
<span id="cb600-14"><a href="#cb600-14"></a>                                                              <span class="st">&#39;Sep 5 2011&#39;</span></span>
<span id="cb600-15"><a href="#cb600-15"></a>                          <span class="kw">GROUP</span> <span class="kw">BY</span>  maxa</span>
<span id="cb600-16"><a href="#cb600-16"></a>                        ) <span class="kw">AS</span> dkcd <span class="kw">ON</span> dkcd.maxa <span class="op">=</span> a.maxa</span>
<span id="cb600-17"><a href="#cb600-17"></a><span class="kw">WHERE</span>   a.maxa <span class="op">&lt;&gt;</span> <span class="st">&#39;99&#39;</span></span>
<span id="cb600-18"><a href="#cb600-18"></a>        <span class="kw">AND</span> <span class="kw">LEFT</span>(a.maxa, <span class="dv">2</span>) <span class="op">=</span> b.mahuyen</span>
<span id="cb600-19"><a href="#cb600-19"></a><span class="kw">ORDER</span> <span class="kw">BY</span> maxa;</span></code></pre></div>
<p>
When I execute this query, the error result is: <strong>The multi-part identifier “a.maxa” could not be bound.</strong> Why? <br> P/s: if i divide the query into 2 individual query, it run ok.
</p>
<div class="sourceCode" id="cb601"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb601-1"><a href="#cb601-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span></span>
<span id="cb601-2"><a href="#cb601-2"></a>        a.maxa ,</span>
<span id="cb601-3"><a href="#cb601-3"></a>        b.mahuyen ,</span>
<span id="cb601-4"><a href="#cb601-4"></a>        a.tenxa ,</span>
<span id="cb601-5"><a href="#cb601-5"></a>        b.tenhuyen</span>
<span id="cb601-6"><a href="#cb601-6"></a><span class="kw">FROM</span>    phuongxa a ,</span>
<span id="cb601-7"><a href="#cb601-7"></a>        quanhuyen b</span>
<span id="cb601-8"><a href="#cb601-8"></a><span class="kw">WHERE</span>   a.maxa <span class="op">&lt;&gt;</span> <span class="st">&#39;99&#39;</span></span>
<span id="cb601-9"><a href="#cb601-9"></a>        <span class="kw">AND</span> <span class="kw">LEFT</span>(a.maxa, <span class="dv">2</span>) <span class="op">=</span> b.mahuyen</span>
<span id="cb601-10"><a href="#cb601-10"></a><span class="kw">ORDER</span> <span class="kw">BY</span> maxa;</span></code></pre></div>
<p>and</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb602-1"><a href="#cb602-1"></a><span class="kw">SELECT</span>  maxa ,</span>
<span id="cb602-2"><a href="#cb602-2"></a>        <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> tong</span>
<span id="cb602-3"><a href="#cb602-3"></a><span class="kw">FROM</span>    khaosat</span>
<span id="cb602-4"><a href="#cb602-4"></a><span class="kw">WHERE</span>   <span class="fu">CONVERT</span>(DATETIME, ngaylap, <span class="dv">103</span>) <span class="kw">BETWEEN</span> <span class="st">&#39;Sep 1 2011&#39;</span></span>
<span id="cb602-5"><a href="#cb602-5"></a>                                        <span class="kw">AND</span>     <span class="st">&#39;Sep 5 2011&#39;</span></span>
<span id="cb602-6"><a href="#cb602-6"></a><span class="kw">GROUP</span> <span class="kw">BY</span> maxa;</span></code></pre></div>
</section>
<section id="answer-accepted-score-209" class="level4">
<h4>Answer accepted (score 209)</h4>
<p>You are mixing implicit joins with explicit joins. That is allowed, but you need to be aware of how to do that properly.</p>
<p>The thing is, explicit joins (the ones that are implemented using the <code>JOIN</code> keyword) take precedence over implicit ones (the ‘comma’ joins, where the join condition is specified in the <code>WHERE</code> clause).</p>
<p>Here’s an outline of your query:</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb603-1"><a href="#cb603-1"></a><span class="kw">SELECT</span></span>
<span id="cb603-2"><a href="#cb603-2"></a>  …</span>
<span id="cb603-3"><a href="#cb603-3"></a><span class="kw">FROM</span> a, b <span class="kw">LEFT</span> <span class="kw">JOIN</span> dkcd <span class="kw">ON</span> …</span>
<span id="cb603-4"><a href="#cb603-4"></a><span class="kw">WHERE</span> …</span></code></pre></div>
<p>You are probably expecting it to behave like this:</p>
<div class="sourceCode" id="cb604"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb604-1"><a href="#cb604-1"></a><span class="kw">SELECT</span></span>
<span id="cb604-2"><a href="#cb604-2"></a>  …</span>
<span id="cb604-3"><a href="#cb604-3"></a><span class="kw">FROM</span> (a, b) <span class="kw">LEFT</span> <span class="kw">JOIN</span> dkcd <span class="kw">ON</span> …</span>
<span id="cb604-4"><a href="#cb604-4"></a><span class="kw">WHERE</span> …</span></code></pre></div>
<p>that is, the combination of tables <code>a</code> and <code>b</code> is joined with the table <code>dkcd</code>. In fact, what’s happening is</p>
<div class="sourceCode" id="cb605"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb605-1"><a href="#cb605-1"></a><span class="kw">SELECT</span></span>
<span id="cb605-2"><a href="#cb605-2"></a>  …</span>
<span id="cb605-3"><a href="#cb605-3"></a><span class="kw">FROM</span> a, (b <span class="kw">LEFT</span> <span class="kw">JOIN</span> dkcd <span class="kw">ON</span> …)</span>
<span id="cb605-4"><a href="#cb605-4"></a><span class="kw">WHERE</span> …</span></code></pre></div>
<p>that is, as you may already have understood, <code>dkcd</code> is joined specifically against <code>b</code> and only <code>b</code>, then the result of the join is combined with <code>a</code> and filtered further with the <code>WHERE</code> clause. In this case, any reference to <code>a</code> in the <code>ON</code> clause is invalid, <code>a</code> is unknown at that point. That is why you are getting the error message.</p>
<p>If I were you, I would probably try to rewrite this query, and one possible solution might be:</p>
<div class="sourceCode" id="cb606"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb606-1"><a href="#cb606-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span></span>
<span id="cb606-2"><a href="#cb606-2"></a>  a.maxa,</span>
<span id="cb606-3"><a href="#cb606-3"></a>  b.mahuyen,</span>
<span id="cb606-4"><a href="#cb606-4"></a>  a.tenxa,</span>
<span id="cb606-5"><a href="#cb606-5"></a>  b.tenhuyen,</span>
<span id="cb606-6"><a href="#cb606-6"></a>  ISNULL(dkcd.tong, <span class="dv">0</span>) <span class="kw">AS</span> tongdkcd</span>
<span id="cb606-7"><a href="#cb606-7"></a><span class="kw">FROM</span> phuongxa a</span>
<span id="cb606-8"><a href="#cb606-8"></a>  <span class="kw">INNER</span> <span class="kw">JOIN</span> quanhuyen b <span class="kw">ON</span> <span class="kw">LEFT</span>(a.maxa, <span class="dv">2</span>) <span class="op">=</span> b.mahuyen</span>
<span id="cb606-9"><a href="#cb606-9"></a>  <span class="kw">LEFT</span> <span class="kw">OUTER</span> <span class="kw">JOIN</span> (</span>
<span id="cb606-10"><a href="#cb606-10"></a>    <span class="kw">SELECT</span></span>
<span id="cb606-11"><a href="#cb606-11"></a>      maxa,</span>
<span id="cb606-12"><a href="#cb606-12"></a>      <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> tong</span>
<span id="cb606-13"><a href="#cb606-13"></a>    <span class="kw">FROM</span> khaosat</span>
<span id="cb606-14"><a href="#cb606-14"></a>    <span class="kw">WHERE</span> <span class="fu">CONVERT</span>(datetime, ngaylap, <span class="dv">103</span>) <span class="kw">BETWEEN</span> <span class="st">&#39;Sep 1 2011&#39;</span> <span class="kw">AND</span> <span class="st">&#39;Sep 5 2011&#39;</span></span>
<span id="cb606-15"><a href="#cb606-15"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span> maxa</span>
<span id="cb606-16"><a href="#cb606-16"></a>  ) <span class="kw">AS</span> dkcd <span class="kw">ON</span> dkcd.maxa <span class="op">=</span> a.maxa</span>
<span id="cb606-17"><a href="#cb606-17"></a><span class="kw">WHERE</span> a.maxa <span class="op">&lt;&gt;</span> <span class="st">&#39;99&#39;</span></span>
<span id="cb606-18"><a href="#cb606-18"></a><span class="kw">ORDER</span> <span class="kw">BY</span> a.maxa</span></code></pre></div>
<p>Here the tables <code>a</code> and <code>b</code> are joined first, then the result is joined to <code>dkcd</code>. Basically, this is the same query as yours, only using a different syntax for one of the joins, which makes a great difference: the reference <code>a.maxa</code> in the <code>dkcd</code>’s join condition is now absolutely valid.</p>
<p>As <span class="citation" data-cites="Aaron">@Aaron</span> Bertrand has correctly noted, you should probably qualify <code>maxa</code> with a specific alias, probably <code>a</code>, in the <code>ORDER BY</code> clause.</p>
</section>
<section id="answer-2-score-37" class="level4">
<h4>Answer 2 (score 37)</h4>
<p>Sometimes this error occurs when you use your schema (dbo) in your query in a wrong way.</p>
<p>for example if you write:</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb607-1"><a href="#cb607-1"></a><span class="kw">select</span> dbo.prd.name</span>
<span id="cb607-2"><a href="#cb607-2"></a><span class="kw">from</span> dbo.product prd</span></code></pre></div>
<p>you will get the error.</p>
<p>In this situations change it to:</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb608-1"><a href="#cb608-1"></a><span class="kw">select</span> prd.name</span>
<span id="cb608-2"><a href="#cb608-2"></a><span class="kw">from</span> dbo.product prd</span></code></pre></div>
</section>
<section id="answer-3-score-10" class="level4">
<h4>Answer 3 (score 10)</h4>
<p>if you have given alies name change that to actual name</p>
<p>for example</p>
<div class="sourceCode" id="cb609"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb609-1"><a href="#cb609-1"></a><span class="kw">SELECT</span>  </span>
<span id="cb609-2"><a href="#cb609-2"></a>    A.name,A.<span class="dt">date</span></span>
<span id="cb609-3"><a href="#cb609-3"></a>  <span class="kw">FROM</span> [LoginInfo].[dbo].[TableA] <span class="kw">as</span> A</span>
<span id="cb609-4"><a href="#cb609-4"></a>   <span class="kw">join</span> </span>
<span id="cb609-5"><a href="#cb609-5"></a>  [LoginInfo].[dbo].[TableA] <span class="kw">as</span> B </span>
<span id="cb609-6"><a href="#cb609-6"></a>  <span class="kw">on</span>  [LoginInfo].[dbo].[TableA].name<span class="op">=</span>[LoginInfo].[dbo].[TableB].name;</span></code></pre></div>
<p>change that to</p>
<div class="sourceCode" id="cb610"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb610-1"><a href="#cb610-1"></a><span class="kw">SELECT</span>  </span>
<span id="cb610-2"><a href="#cb610-2"></a>    A.name,A.<span class="dt">date</span></span>
<span id="cb610-3"><a href="#cb610-3"></a>  <span class="kw">FROM</span> [LoginInfo].[dbo].[TableA] <span class="kw">as</span> A</span>
<span id="cb610-4"><a href="#cb610-4"></a>   <span class="kw">join</span> </span>
<span id="cb610-5"><a href="#cb610-5"></a>  [LoginInfo].[dbo].[TableA] <span class="kw">as</span> B </span>
<span id="cb610-6"><a href="#cb610-6"></a>  <span class="kw">on</span>  A.name<span class="op">=</span>B.name;</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="get-month-and-year-from-a-datetime-in-sql-server-2005-score-711888-in-2017" class="level3">
<h3>99: Get month and year from a datetime in SQL Server 2005 (score <a href="https://stackoverflow.com/q/45535.html">711888</a> in 2017)</h3>
<section id="question-97" class="level4">
<h4>Question</h4>
<p>I need the month+year from the datetime in SQL Server like ‘Jan 2008’. I’m grouping the query by month, year. I’ve searched and found functions like datepart, convert, etc., but none of them seem useful for this. Am I missing something here? Is there a function for this?</p>
</section>
<section id="answer-accepted-score-72" class="level4">
<h4>Answer accepted (score 72)</h4>
<p>If you mean you want them back as a string, in that format;</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb611-1"><a href="#cb611-1"></a><span class="kw">SELECT</span> </span>
<span id="cb611-2"><a href="#cb611-2"></a>  <span class="fu">CONVERT</span>(<span class="dt">CHAR</span>(<span class="dv">4</span>), date_of_birth, <span class="dv">100</span>) <span class="op">+</span> <span class="fu">CONVERT</span>(<span class="dt">CHAR</span>(<span class="dv">4</span>), date_of_birth, <span class="dv">120</span>) </span>
<span id="cb611-3"><a href="#cb611-3"></a><span class="kw">FROM</span> customers</span></code></pre></div>
<p><a href="http://msdn.microsoft.com/en-us/library/ms187928.aspx" rel="noreferrer">Here are the other format options</a></p>
</section>
<section id="answer-2-score-168" class="level4">
<h4>Answer 2 (score 168)</h4>
<div class="sourceCode" id="cb612"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb612-1"><a href="#cb612-1"></a><span class="kw">select</span> </span>
<span id="cb612-2"><a href="#cb612-2"></a>datepart(<span class="dt">month</span>,getdate()) <span class="co">-- integer (1,2,3...)</span></span>
<span id="cb612-3"><a href="#cb612-3"></a>,datepart(<span class="dt">year</span>,getdate()) <span class="co">-- integer</span></span>
<span id="cb612-4"><a href="#cb612-4"></a>,datename(<span class="dt">month</span>,getdate()) <span class="co">-- string (&#39;September&#39;,...)</span></span></code></pre></div>
</section>
<section id="answer-3-score-40" class="level4">
<h4>Answer 3 (score 40)</h4>
<p>Beginning with SQL Server 2012, you can use:</p>
<div class="sourceCode" id="cb613"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb613-1"><a href="#cb613-1"></a><span class="kw">SELECT</span> FORMAT(@date, <span class="st">&#39;yyyyMM&#39;</span>)</span></code></pre></div>
<p></b> </em> </i> </small> </strong> </sub> </sup></p>
</section>
</section>
<section id="how-do-i-list-all-the-columns-in-a-table-score-710519-in" class="level3">
<h3>100: How do I list all the columns in a table? (score <a href="https://stackoverflow.com/q/1580450.html">710519</a> in )</h3>
<section id="question-98" class="level4">
<h4>Question</h4>
<p>For the various popular database systems, how do you list all the columns in a table?</p>
</section>
<section id="answer-2-score-239" class="level4">
<h4>Answer 2 (score 239)</h4>
<p>For MySQL, use:</p>
<div class="sourceCode" id="cb614"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb614-1"><a href="#cb614-1"></a>DESCRIBE name_of_table;</span></code></pre></div>
<p>This also works for Oracle as long as you are using SQL*Plus, or Oracle’s SQL Developer.</p>
</section>
<section id="answer-3-score-111" class="level4">
<h4>Answer 3 (score 111)</h4>
<p>For Oracle (PL/SQL)</p>
<div class="sourceCode" id="cb615"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb615-1"><a href="#cb615-1"></a><span class="kw">SELECT</span> column_name</span>
<span id="cb615-2"><a href="#cb615-2"></a><span class="kw">FROM</span> user_tab_cols</span>
<span id="cb615-3"><a href="#cb615-3"></a><span class="kw">WHERE</span> table_name <span class="op">=</span> <span class="st">&#39;myTableName&#39;</span></span></code></pre></div>
<p>For MySQL</p>
<div class="sourceCode" id="cb616"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb616-1"><a href="#cb616-1"></a>SHOW <span class="kw">COLUMNS</span> <span class="kw">FROM</span> table_name</span></code></pre></div>
</section>
</section>
</section>
</body>
</html>
